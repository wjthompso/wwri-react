(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))y(x);new MutationObserver(x=>{for(const C of x)if(C.type==="childList")for(const S of C.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&y(S)}).observe(document,{childList:!0,subtree:!0});function u(x){const C={};return x.integrity&&(C.integrity=x.integrity),x.referrerPolicy&&(C.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?C.credentials="include":x.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function y(x){if(x.ep)return;x.ep=!0;const C=u(x);fetch(x.href,C)}})();var Ag=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lv(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var cv={exports:{}},df={},uv={exports:{}},Tr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Bd=Symbol.for("react.element"),bw=Symbol.for("react.portal"),ww=Symbol.for("react.fragment"),Sw=Symbol.for("react.strict_mode"),kw=Symbol.for("react.profiler"),Cw=Symbol.for("react.provider"),Tw=Symbol.for("react.context"),Iw=Symbol.for("react.forward_ref"),Ew=Symbol.for("react.suspense"),Pw=Symbol.for("react.memo"),Aw=Symbol.for("react.lazy"),Z_=Symbol.iterator;function Mw(i){return i===null||typeof i!="object"?null:(i=Z_&&i[Z_]||i["@@iterator"],typeof i=="function"?i:null)}var hv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},dv=Object.assign,pv={};function gh(i,s,u){this.props=i,this.context=s,this.refs=pv,this.updater=u||hv}gh.prototype.isReactComponent={};gh.prototype.setState=function(i,s){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,s,"setState")};gh.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function fv(){}fv.prototype=gh.prototype;function Mg(i,s,u){this.props=i,this.context=s,this.refs=pv,this.updater=u||hv}var zg=Mg.prototype=new fv;zg.constructor=Mg;dv(zg,gh.prototype);zg.isPureReactComponent=!0;var H_=Array.isArray,mv=Object.prototype.hasOwnProperty,Dg={current:null},gv={key:!0,ref:!0,__self:!0,__source:!0};function yv(i,s,u){var y,x={},C=null,S=null;if(s!=null)for(y in s.ref!==void 0&&(S=s.ref),s.key!==void 0&&(C=""+s.key),s)mv.call(s,y)&&!gv.hasOwnProperty(y)&&(x[y]=s[y]);var d=arguments.length-2;if(d===1)x.children=u;else if(1<d){for(var V=Array(d),ee=0;ee<d;ee++)V[ee]=arguments[ee+2];x.children=V}if(i&&i.defaultProps)for(y in d=i.defaultProps,d)x[y]===void 0&&(x[y]=d[y]);return{$$typeof:Bd,type:i,key:C,ref:S,props:x,_owner:Dg.current}}function zw(i,s){return{$$typeof:Bd,type:i.type,key:s,ref:i.ref,props:i.props,_owner:i._owner}}function Lg(i){return typeof i=="object"&&i!==null&&i.$$typeof===Bd}function Dw(i){var s={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(u){return s[u]})}var W_=/\/+/g;function um(i,s){return typeof i=="object"&&i!==null&&i.key!=null?Dw(""+i.key):s.toString(36)}function Tp(i,s,u,y,x){var C=typeof i;(C==="undefined"||C==="boolean")&&(i=null);var S=!1;if(i===null)S=!0;else switch(C){case"string":case"number":S=!0;break;case"object":switch(i.$$typeof){case Bd:case bw:S=!0}}if(S)return S=i,x=x(S),i=y===""?"."+um(S,0):y,H_(x)?(u="",i!=null&&(u=i.replace(W_,"$&/")+"/"),Tp(x,s,u,"",function(ee){return ee})):x!=null&&(Lg(x)&&(x=zw(x,u+(!x.key||S&&S.key===x.key?"":(""+x.key).replace(W_,"$&/")+"/")+i)),s.push(x)),1;if(S=0,y=y===""?".":y+":",H_(i))for(var d=0;d<i.length;d++){C=i[d];var V=y+um(C,d);S+=Tp(C,s,u,V,x)}else if(V=Mw(i),typeof V=="function")for(i=V.call(i),d=0;!(C=i.next()).done;)C=C.value,V=y+um(C,d++),S+=Tp(C,s,u,V,x);else if(C==="object")throw s=String(i),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return S}function lp(i,s,u){if(i==null)return i;var y=[],x=0;return Tp(i,y,"","",function(C){return s.call(u,C,x++)}),y}function Lw(i){if(i._status===-1){var s=i._result;s=s(),s.then(function(u){(i._status===0||i._status===-1)&&(i._status=1,i._result=u)},function(u){(i._status===0||i._status===-1)&&(i._status=2,i._result=u)}),i._status===-1&&(i._status=0,i._result=s)}if(i._status===1)return i._result.default;throw i._result}var Hn={current:null},Ip={transition:null},Rw={ReactCurrentDispatcher:Hn,ReactCurrentBatchConfig:Ip,ReactCurrentOwner:Dg};function _v(){throw Error("act(...) is not supported in production builds of React.")}Tr.Children={map:lp,forEach:function(i,s,u){lp(i,function(){s.apply(this,arguments)},u)},count:function(i){var s=0;return lp(i,function(){s++}),s},toArray:function(i){return lp(i,function(s){return s})||[]},only:function(i){if(!Lg(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};Tr.Component=gh;Tr.Fragment=ww;Tr.Profiler=kw;Tr.PureComponent=Mg;Tr.StrictMode=Sw;Tr.Suspense=Ew;Tr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rw;Tr.act=_v;Tr.cloneElement=function(i,s,u){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var y=dv({},i.props),x=i.key,C=i.ref,S=i._owner;if(s!=null){if(s.ref!==void 0&&(C=s.ref,S=Dg.current),s.key!==void 0&&(x=""+s.key),i.type&&i.type.defaultProps)var d=i.type.defaultProps;for(V in s)mv.call(s,V)&&!gv.hasOwnProperty(V)&&(y[V]=s[V]===void 0&&d!==void 0?d[V]:s[V])}var V=arguments.length-2;if(V===1)y.children=u;else if(1<V){d=Array(V);for(var ee=0;ee<V;ee++)d[ee]=arguments[ee+2];y.children=d}return{$$typeof:Bd,type:i.type,key:x,ref:C,props:y,_owner:S}};Tr.createContext=function(i){return i={$$typeof:Tw,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:Cw,_context:i},i.Consumer=i};Tr.createElement=yv;Tr.createFactory=function(i){var s=yv.bind(null,i);return s.type=i,s};Tr.createRef=function(){return{current:null}};Tr.forwardRef=function(i){return{$$typeof:Iw,render:i}};Tr.isValidElement=Lg;Tr.lazy=function(i){return{$$typeof:Aw,_payload:{_status:-1,_result:i},_init:Lw}};Tr.memo=function(i,s){return{$$typeof:Pw,type:i,compare:s===void 0?null:s}};Tr.startTransition=function(i){var s=Ip.transition;Ip.transition={};try{i()}finally{Ip.transition=s}};Tr.unstable_act=_v;Tr.useCallback=function(i,s){return Hn.current.useCallback(i,s)};Tr.useContext=function(i){return Hn.current.useContext(i)};Tr.useDebugValue=function(){};Tr.useDeferredValue=function(i){return Hn.current.useDeferredValue(i)};Tr.useEffect=function(i,s){return Hn.current.useEffect(i,s)};Tr.useId=function(){return Hn.current.useId()};Tr.useImperativeHandle=function(i,s,u){return Hn.current.useImperativeHandle(i,s,u)};Tr.useInsertionEffect=function(i,s){return Hn.current.useInsertionEffect(i,s)};Tr.useLayoutEffect=function(i,s){return Hn.current.useLayoutEffect(i,s)};Tr.useMemo=function(i,s){return Hn.current.useMemo(i,s)};Tr.useReducer=function(i,s,u){return Hn.current.useReducer(i,s,u)};Tr.useRef=function(i){return Hn.current.useRef(i)};Tr.useState=function(i){return Hn.current.useState(i)};Tr.useSyncExternalStore=function(i,s,u){return Hn.current.useSyncExternalStore(i,s,u)};Tr.useTransition=function(){return Hn.current.useTransition()};Tr.version="18.3.1";uv.exports=Tr;var Ot=uv.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fw=Ot,Bw=Symbol.for("react.element"),Nw=Symbol.for("react.fragment"),Ow=Object.prototype.hasOwnProperty,$w=Fw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,jw={key:!0,ref:!0,__self:!0,__source:!0};function vv(i,s,u){var y,x={},C=null,S=null;u!==void 0&&(C=""+u),s.key!==void 0&&(C=""+s.key),s.ref!==void 0&&(S=s.ref);for(y in s)Ow.call(s,y)&&!jw.hasOwnProperty(y)&&(x[y]=s[y]);if(i&&i.defaultProps)for(y in s=i.defaultProps,s)x[y]===void 0&&(x[y]=s[y]);return{$$typeof:Bw,type:i,key:C,ref:S,props:x,_owner:$w.current}}df.Fragment=Nw;df.jsx=vv;df.jsxs=vv;cv.exports=df;var te=cv.exports,xv={exports:{}},Ts={},bv={exports:{}},wv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function s(Qe,Xe){var It=Qe.length;Qe.push(Xe);e:for(;0<It;){var $t=It-1>>>1,nt=Qe[$t];if(0<x(nt,Xe))Qe[$t]=Xe,Qe[It]=nt,It=$t;else break e}}function u(Qe){return Qe.length===0?null:Qe[0]}function y(Qe){if(Qe.length===0)return null;var Xe=Qe[0],It=Qe.pop();if(It!==Xe){Qe[0]=It;e:for(var $t=0,nt=Qe.length,er=nt>>>1;$t<er;){var mr=2*($t+1)-1,pr=Qe[mr],tr=mr+1,ar=Qe[tr];if(0>x(pr,It))tr<nt&&0>x(ar,pr)?(Qe[$t]=ar,Qe[tr]=It,$t=tr):(Qe[$t]=pr,Qe[mr]=It,$t=mr);else if(tr<nt&&0>x(ar,It))Qe[$t]=ar,Qe[tr]=It,$t=tr;else break e}}return Xe}function x(Qe,Xe){var It=Qe.sortIndex-Xe.sortIndex;return It!==0?It:Qe.id-Xe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var C=performance;i.unstable_now=function(){return C.now()}}else{var S=Date,d=S.now();i.unstable_now=function(){return S.now()-d}}var V=[],ee=[],Te=1,ie=null,G=3,He=!1,Ke=!1,ke=!1,ht=typeof setTimeout=="function"?setTimeout:null,pe=typeof clearTimeout=="function"?clearTimeout:null,oe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function me(Qe){for(var Xe=u(ee);Xe!==null;){if(Xe.callback===null)y(ee);else if(Xe.startTime<=Qe)y(ee),Xe.sortIndex=Xe.expirationTime,s(V,Xe);else break;Xe=u(ee)}}function De(Qe){if(ke=!1,me(Qe),!Ke)if(u(V)!==null)Ke=!0,Jt(Ue);else{var Xe=u(ee);Xe!==null&&pt(De,Xe.startTime-Qe)}}function Ue(Qe,Xe){Ke=!1,ke&&(ke=!1,pe(re),re=-1),He=!0;var It=G;try{for(me(Xe),ie=u(V);ie!==null&&(!(ie.expirationTime>Xe)||Qe&&!Me());){var $t=ie.callback;if(typeof $t=="function"){ie.callback=null,G=ie.priorityLevel;var nt=$t(ie.expirationTime<=Xe);Xe=i.unstable_now(),typeof nt=="function"?ie.callback=nt:ie===u(V)&&y(V),me(Xe)}else y(V);ie=u(V)}if(ie!==null)var er=!0;else{var mr=u(ee);mr!==null&&pt(De,mr.startTime-Xe),er=!1}return er}finally{ie=null,G=It,He=!1}}var ze=!1,Ge=null,re=-1,ne=5,fe=-1;function Me(){return!(i.unstable_now()-fe<ne)}function Oe(){if(Ge!==null){var Qe=i.unstable_now();fe=Qe;var Xe=!0;try{Xe=Ge(!0,Qe)}finally{Xe?tt():(ze=!1,Ge=null)}}else ze=!1}var tt;if(typeof oe=="function")tt=function(){oe(Oe)};else if(typeof MessageChannel<"u"){var dt=new MessageChannel,dr=dt.port2;dt.port1.onmessage=Oe,tt=function(){dr.postMessage(null)}}else tt=function(){ht(Oe,0)};function Jt(Qe){Ge=Qe,ze||(ze=!0,tt())}function pt(Qe,Xe){re=ht(function(){Qe(i.unstable_now())},Xe)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Qe){Qe.callback=null},i.unstable_continueExecution=function(){Ke||He||(Ke=!0,Jt(Ue))},i.unstable_forceFrameRate=function(Qe){0>Qe||125<Qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<Qe?Math.floor(1e3/Qe):5},i.unstable_getCurrentPriorityLevel=function(){return G},i.unstable_getFirstCallbackNode=function(){return u(V)},i.unstable_next=function(Qe){switch(G){case 1:case 2:case 3:var Xe=3;break;default:Xe=G}var It=G;G=Xe;try{return Qe()}finally{G=It}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Qe,Xe){switch(Qe){case 1:case 2:case 3:case 4:case 5:break;default:Qe=3}var It=G;G=Qe;try{return Xe()}finally{G=It}},i.unstable_scheduleCallback=function(Qe,Xe,It){var $t=i.unstable_now();switch(typeof It=="object"&&It!==null?(It=It.delay,It=typeof It=="number"&&0<It?$t+It:$t):It=$t,Qe){case 1:var nt=-1;break;case 2:nt=250;break;case 5:nt=1073741823;break;case 4:nt=1e4;break;default:nt=5e3}return nt=It+nt,Qe={id:Te++,callback:Xe,priorityLevel:Qe,startTime:It,expirationTime:nt,sortIndex:-1},It>$t?(Qe.sortIndex=It,s(ee,Qe),u(V)===null&&Qe===u(ee)&&(ke?(pe(re),re=-1):ke=!0,pt(De,It-$t))):(Qe.sortIndex=nt,s(V,Qe),Ke||He||(Ke=!0,Jt(Ue))),Qe},i.unstable_shouldYield=Me,i.unstable_wrapCallback=function(Qe){var Xe=G;return function(){var It=G;G=Xe;try{return Qe.apply(this,arguments)}finally{G=It}}}})(wv);bv.exports=wv;var Vw=bv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uw=Ot,Cs=Vw;function at(i){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+i,u=1;u<arguments.length;u++)s+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Sv=new Set,xd={};function eu(i,s){lh(i,s),lh(i+"Capture",s)}function lh(i,s){for(xd[i]=s,i=0;i<s.length;i++)Sv.add(s[i])}var Ro=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nm=Object.prototype.hasOwnProperty,qw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,K_={},X_={};function Gw(i){return Nm.call(X_,i)?!0:Nm.call(K_,i)?!1:qw.test(i)?X_[i]=!0:(K_[i]=!0,!1)}function Zw(i,s,u,y){if(u!==null&&u.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return y?!1:u!==null?!u.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function Hw(i,s,u,y){if(s===null||typeof s>"u"||Zw(i,s,u,y))return!0;if(y)return!1;if(u!==null)switch(u.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Wn(i,s,u,y,x,C,S){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=y,this.attributeNamespace=x,this.mustUseProperty=u,this.propertyName=i,this.type=s,this.sanitizeURL=C,this.removeEmptyString=S}var Pn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Pn[i]=new Wn(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var s=i[0];Pn[s]=new Wn(s,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Pn[i]=new Wn(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Pn[i]=new Wn(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Pn[i]=new Wn(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Pn[i]=new Wn(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Pn[i]=new Wn(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Pn[i]=new Wn(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Pn[i]=new Wn(i,5,!1,i.toLowerCase(),null,!1,!1)});var Rg=/[\-:]([a-z])/g;function Fg(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var s=i.replace(Rg,Fg);Pn[s]=new Wn(s,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var s=i.replace(Rg,Fg);Pn[s]=new Wn(s,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var s=i.replace(Rg,Fg);Pn[s]=new Wn(s,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Pn[i]=new Wn(i,1,!1,i.toLowerCase(),null,!1,!1)});Pn.xlinkHref=new Wn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Pn[i]=new Wn(i,1,!1,i.toLowerCase(),null,!0,!0)});function Bg(i,s,u,y){var x=Pn.hasOwnProperty(s)?Pn[s]:null;(x!==null?x.type!==0:y||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(Hw(s,u,x,y)&&(u=null),y||x===null?Gw(s)&&(u===null?i.removeAttribute(s):i.setAttribute(s,""+u)):x.mustUseProperty?i[x.propertyName]=u===null?x.type===3?!1:"":u:(s=x.attributeName,y=x.attributeNamespace,u===null?i.removeAttribute(s):(x=x.type,u=x===3||x===4&&u===!0?"":""+u,y?i.setAttributeNS(y,s,u):i.setAttribute(s,u))))}var Oo=Uw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,cp=Symbol.for("react.element"),qu=Symbol.for("react.portal"),Gu=Symbol.for("react.fragment"),Ng=Symbol.for("react.strict_mode"),Om=Symbol.for("react.profiler"),kv=Symbol.for("react.provider"),Cv=Symbol.for("react.context"),Og=Symbol.for("react.forward_ref"),$m=Symbol.for("react.suspense"),jm=Symbol.for("react.suspense_list"),$g=Symbol.for("react.memo"),Dl=Symbol.for("react.lazy"),Tv=Symbol.for("react.offscreen"),Y_=Symbol.iterator;function Jh(i){return i===null||typeof i!="object"?null:(i=Y_&&i[Y_]||i["@@iterator"],typeof i=="function"?i:null)}var Ti=Object.assign,hm;function ad(i){if(hm===void 0)try{throw Error()}catch(u){var s=u.stack.trim().match(/\n( *(at )?)/);hm=s&&s[1]||""}return`
`+hm+i}var dm=!1;function pm(i,s){if(!i||dm)return"";dm=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(ee){var y=ee}Reflect.construct(i,[],s)}else{try{s.call()}catch(ee){y=ee}i.call(s.prototype)}else{try{throw Error()}catch(ee){y=ee}i()}}catch(ee){if(ee&&y&&typeof ee.stack=="string"){for(var x=ee.stack.split(`
`),C=y.stack.split(`
`),S=x.length-1,d=C.length-1;1<=S&&0<=d&&x[S]!==C[d];)d--;for(;1<=S&&0<=d;S--,d--)if(x[S]!==C[d]){if(S!==1||d!==1)do if(S--,d--,0>d||x[S]!==C[d]){var V=`
`+x[S].replace(" at new "," at ");return i.displayName&&V.includes("<anonymous>")&&(V=V.replace("<anonymous>",i.displayName)),V}while(1<=S&&0<=d);break}}}finally{dm=!1,Error.prepareStackTrace=u}return(i=i?i.displayName||i.name:"")?ad(i):""}function Ww(i){switch(i.tag){case 5:return ad(i.type);case 16:return ad("Lazy");case 13:return ad("Suspense");case 19:return ad("SuspenseList");case 0:case 2:case 15:return i=pm(i.type,!1),i;case 11:return i=pm(i.type.render,!1),i;case 1:return i=pm(i.type,!0),i;default:return""}}function Vm(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Gu:return"Fragment";case qu:return"Portal";case Om:return"Profiler";case Ng:return"StrictMode";case $m:return"Suspense";case jm:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Cv:return(i.displayName||"Context")+".Consumer";case kv:return(i._context.displayName||"Context")+".Provider";case Og:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case $g:return s=i.displayName||null,s!==null?s:Vm(i.type)||"Memo";case Dl:s=i._payload,i=i._init;try{return Vm(i(s))}catch{}}return null}function Kw(i){var s=i.type;switch(i.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=s.render,i=i.displayName||i.name||"",s.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Vm(s);case 8:return s===Ng?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Xl(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Iv(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Xw(i){var s=Iv(i)?"checked":"value",u=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),y=""+i[s];if(!i.hasOwnProperty(s)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var x=u.get,C=u.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return x.call(this)},set:function(S){y=""+S,C.call(this,S)}}),Object.defineProperty(i,s,{enumerable:u.enumerable}),{getValue:function(){return y},setValue:function(S){y=""+S},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function up(i){i._valueTracker||(i._valueTracker=Xw(i))}function Ev(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var u=s.getValue(),y="";return i&&(y=Iv(i)?i.checked?"true":"false":i.value),i=y,i!==u?(s.setValue(i),!0):!1}function Np(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Um(i,s){var u=s.checked;return Ti({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??i._wrapperState.initialChecked})}function J_(i,s){var u=s.defaultValue==null?"":s.defaultValue,y=s.checked!=null?s.checked:s.defaultChecked;u=Xl(s.value!=null?s.value:u),i._wrapperState={initialChecked:y,initialValue:u,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function Pv(i,s){s=s.checked,s!=null&&Bg(i,"checked",s,!1)}function qm(i,s){Pv(i,s);var u=Xl(s.value),y=s.type;if(u!=null)y==="number"?(u===0&&i.value===""||i.value!=u)&&(i.value=""+u):i.value!==""+u&&(i.value=""+u);else if(y==="submit"||y==="reset"){i.removeAttribute("value");return}s.hasOwnProperty("value")?Gm(i,s.type,u):s.hasOwnProperty("defaultValue")&&Gm(i,s.type,Xl(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(i.defaultChecked=!!s.defaultChecked)}function Q_(i,s,u){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var y=s.type;if(!(y!=="submit"&&y!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+i._wrapperState.initialValue,u||s===i.value||(i.value=s),i.defaultValue=s}u=i.name,u!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,u!==""&&(i.name=u)}function Gm(i,s,u){(s!=="number"||Np(i.ownerDocument)!==i)&&(u==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+u&&(i.defaultValue=""+u))}var od=Array.isArray;function rh(i,s,u,y){if(i=i.options,s){s={};for(var x=0;x<u.length;x++)s["$"+u[x]]=!0;for(u=0;u<i.length;u++)x=s.hasOwnProperty("$"+i[u].value),i[u].selected!==x&&(i[u].selected=x),x&&y&&(i[u].defaultSelected=!0)}else{for(u=""+Xl(u),s=null,x=0;x<i.length;x++){if(i[x].value===u){i[x].selected=!0,y&&(i[x].defaultSelected=!0);return}s!==null||i[x].disabled||(s=i[x])}s!==null&&(s.selected=!0)}}function Zm(i,s){if(s.dangerouslySetInnerHTML!=null)throw Error(at(91));return Ti({},s,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function e0(i,s){var u=s.value;if(u==null){if(u=s.children,s=s.defaultValue,u!=null){if(s!=null)throw Error(at(92));if(od(u)){if(1<u.length)throw Error(at(93));u=u[0]}s=u}s==null&&(s=""),u=s}i._wrapperState={initialValue:Xl(u)}}function Av(i,s){var u=Xl(s.value),y=Xl(s.defaultValue);u!=null&&(u=""+u,u!==i.value&&(i.value=u),s.defaultValue==null&&i.defaultValue!==u&&(i.defaultValue=u)),y!=null&&(i.defaultValue=""+y)}function t0(i){var s=i.textContent;s===i._wrapperState.initialValue&&s!==""&&s!==null&&(i.value=s)}function Mv(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hm(i,s){return i==null||i==="http://www.w3.org/1999/xhtml"?Mv(s):i==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var hp,zv=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,u,y,x){MSApp.execUnsafeLocalFunction(function(){return i(s,u,y,x)})}:i}(function(i,s){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=s;else{for(hp=hp||document.createElement("div"),hp.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=hp.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;s.firstChild;)i.appendChild(s.firstChild)}});function bd(i,s){if(s){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===3){u.nodeValue=s;return}}i.textContent=s}var ud={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Yw=["Webkit","ms","Moz","O"];Object.keys(ud).forEach(function(i){Yw.forEach(function(s){s=s+i.charAt(0).toUpperCase()+i.substring(1),ud[s]=ud[i]})});function Dv(i,s,u){return s==null||typeof s=="boolean"||s===""?"":u||typeof s!="number"||s===0||ud.hasOwnProperty(i)&&ud[i]?(""+s).trim():s+"px"}function Lv(i,s){i=i.style;for(var u in s)if(s.hasOwnProperty(u)){var y=u.indexOf("--")===0,x=Dv(u,s[u],y);u==="float"&&(u="cssFloat"),y?i.setProperty(u,x):i[u]=x}}var Jw=Ti({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Wm(i,s){if(s){if(Jw[i]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(at(137,i));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(at(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(at(61))}if(s.style!=null&&typeof s.style!="object")throw Error(at(62))}}function Km(i,s){if(i.indexOf("-")===-1)return typeof s.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xm=null;function jg(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Ym=null,ih=null,nh=null;function r0(i){if(i=$d(i)){if(typeof Ym!="function")throw Error(at(280));var s=i.stateNode;s&&(s=yf(s),Ym(i.stateNode,i.type,s))}}function Rv(i){ih?nh?nh.push(i):nh=[i]:ih=i}function Fv(){if(ih){var i=ih,s=nh;if(nh=ih=null,r0(i),s)for(i=0;i<s.length;i++)r0(s[i])}}function Bv(i,s){return i(s)}function Nv(){}var fm=!1;function Ov(i,s,u){if(fm)return i(s,u);fm=!0;try{return Bv(i,s,u)}finally{fm=!1,(ih!==null||nh!==null)&&(Nv(),Fv())}}function wd(i,s){var u=i.stateNode;if(u===null)return null;var y=yf(u);if(y===null)return null;u=y[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(i=i.type,y=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!y;break e;default:i=!1}if(i)return null;if(u&&typeof u!="function")throw Error(at(231,s,typeof u));return u}var Jm=!1;if(Ro)try{var Qh={};Object.defineProperty(Qh,"passive",{get:function(){Jm=!0}}),window.addEventListener("test",Qh,Qh),window.removeEventListener("test",Qh,Qh)}catch{Jm=!1}function Qw(i,s,u,y,x,C,S,d,V){var ee=Array.prototype.slice.call(arguments,3);try{s.apply(u,ee)}catch(Te){this.onError(Te)}}var hd=!1,Op=null,$p=!1,Qm=null,e2={onError:function(i){hd=!0,Op=i}};function t2(i,s,u,y,x,C,S,d,V){hd=!1,Op=null,Qw.apply(e2,arguments)}function r2(i,s,u,y,x,C,S,d,V){if(t2.apply(this,arguments),hd){if(hd){var ee=Op;hd=!1,Op=null}else throw Error(at(198));$p||($p=!0,Qm=ee)}}function tu(i){var s=i,u=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,s.flags&4098&&(u=s.return),i=s.return;while(i)}return s.tag===3?u:null}function $v(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function i0(i){if(tu(i)!==i)throw Error(at(188))}function i2(i){var s=i.alternate;if(!s){if(s=tu(i),s===null)throw Error(at(188));return s!==i?null:i}for(var u=i,y=s;;){var x=u.return;if(x===null)break;var C=x.alternate;if(C===null){if(y=x.return,y!==null){u=y;continue}break}if(x.child===C.child){for(C=x.child;C;){if(C===u)return i0(x),i;if(C===y)return i0(x),s;C=C.sibling}throw Error(at(188))}if(u.return!==y.return)u=x,y=C;else{for(var S=!1,d=x.child;d;){if(d===u){S=!0,u=x,y=C;break}if(d===y){S=!0,y=x,u=C;break}d=d.sibling}if(!S){for(d=C.child;d;){if(d===u){S=!0,u=C,y=x;break}if(d===y){S=!0,y=C,u=x;break}d=d.sibling}if(!S)throw Error(at(189))}}if(u.alternate!==y)throw Error(at(190))}if(u.tag!==3)throw Error(at(188));return u.stateNode.current===u?i:s}function jv(i){return i=i2(i),i!==null?Vv(i):null}function Vv(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var s=Vv(i);if(s!==null)return s;i=i.sibling}return null}var Uv=Cs.unstable_scheduleCallback,n0=Cs.unstable_cancelCallback,n2=Cs.unstable_shouldYield,s2=Cs.unstable_requestPaint,ji=Cs.unstable_now,a2=Cs.unstable_getCurrentPriorityLevel,Vg=Cs.unstable_ImmediatePriority,qv=Cs.unstable_UserBlockingPriority,jp=Cs.unstable_NormalPriority,o2=Cs.unstable_LowPriority,Gv=Cs.unstable_IdlePriority,pf=null,Ja=null;function l2(i){if(Ja&&typeof Ja.onCommitFiberRoot=="function")try{Ja.onCommitFiberRoot(pf,i,void 0,(i.current.flags&128)===128)}catch{}}var _a=Math.clz32?Math.clz32:h2,c2=Math.log,u2=Math.LN2;function h2(i){return i>>>=0,i===0?32:31-(c2(i)/u2|0)|0}var dp=64,pp=4194304;function ld(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Vp(i,s){var u=i.pendingLanes;if(u===0)return 0;var y=0,x=i.suspendedLanes,C=i.pingedLanes,S=u&268435455;if(S!==0){var d=S&~x;d!==0?y=ld(d):(C&=S,C!==0&&(y=ld(C)))}else S=u&~x,S!==0?y=ld(S):C!==0&&(y=ld(C));if(y===0)return 0;if(s!==0&&s!==y&&!(s&x)&&(x=y&-y,C=s&-s,x>=C||x===16&&(C&4194240)!==0))return s;if(y&4&&(y|=u&16),s=i.entangledLanes,s!==0)for(i=i.entanglements,s&=y;0<s;)u=31-_a(s),x=1<<u,y|=i[u],s&=~x;return y}function d2(i,s){switch(i){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function p2(i,s){for(var u=i.suspendedLanes,y=i.pingedLanes,x=i.expirationTimes,C=i.pendingLanes;0<C;){var S=31-_a(C),d=1<<S,V=x[S];V===-1?(!(d&u)||d&y)&&(x[S]=d2(d,s)):V<=s&&(i.expiredLanes|=d),C&=~d}}function eg(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Zv(){var i=dp;return dp<<=1,!(dp&4194240)&&(dp=64),i}function mm(i){for(var s=[],u=0;31>u;u++)s.push(i);return s}function Nd(i,s,u){i.pendingLanes|=s,s!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,s=31-_a(s),i[s]=u}function f2(i,s){var u=i.pendingLanes&~s;i.pendingLanes=s,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=s,i.mutableReadLanes&=s,i.entangledLanes&=s,s=i.entanglements;var y=i.eventTimes;for(i=i.expirationTimes;0<u;){var x=31-_a(u),C=1<<x;s[x]=0,y[x]=-1,i[x]=-1,u&=~C}}function Ug(i,s){var u=i.entangledLanes|=s;for(i=i.entanglements;u;){var y=31-_a(u),x=1<<y;x&s|i[y]&s&&(i[y]|=s),u&=~x}}var ti=0;function Hv(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Wv,qg,Kv,Xv,Yv,tg=!1,fp=[],jl=null,Vl=null,Ul=null,Sd=new Map,kd=new Map,Rl=[],m2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function s0(i,s){switch(i){case"focusin":case"focusout":jl=null;break;case"dragenter":case"dragleave":Vl=null;break;case"mouseover":case"mouseout":Ul=null;break;case"pointerover":case"pointerout":Sd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":kd.delete(s.pointerId)}}function ed(i,s,u,y,x,C){return i===null||i.nativeEvent!==C?(i={blockedOn:s,domEventName:u,eventSystemFlags:y,nativeEvent:C,targetContainers:[x]},s!==null&&(s=$d(s),s!==null&&qg(s)),i):(i.eventSystemFlags|=y,s=i.targetContainers,x!==null&&s.indexOf(x)===-1&&s.push(x),i)}function g2(i,s,u,y,x){switch(s){case"focusin":return jl=ed(jl,i,s,u,y,x),!0;case"dragenter":return Vl=ed(Vl,i,s,u,y,x),!0;case"mouseover":return Ul=ed(Ul,i,s,u,y,x),!0;case"pointerover":var C=x.pointerId;return Sd.set(C,ed(Sd.get(C)||null,i,s,u,y,x)),!0;case"gotpointercapture":return C=x.pointerId,kd.set(C,ed(kd.get(C)||null,i,s,u,y,x)),!0}return!1}function Jv(i){var s=qc(i.target);if(s!==null){var u=tu(s);if(u!==null){if(s=u.tag,s===13){if(s=$v(u),s!==null){i.blockedOn=s,Yv(i.priority,function(){Kv(u)});return}}else if(s===3&&u.stateNode.current.memoizedState.isDehydrated){i.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Ep(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var u=rg(i.domEventName,i.eventSystemFlags,s[0],i.nativeEvent);if(u===null){u=i.nativeEvent;var y=new u.constructor(u.type,u);Xm=y,u.target.dispatchEvent(y),Xm=null}else return s=$d(u),s!==null&&qg(s),i.blockedOn=u,!1;s.shift()}return!0}function a0(i,s,u){Ep(i)&&u.delete(s)}function y2(){tg=!1,jl!==null&&Ep(jl)&&(jl=null),Vl!==null&&Ep(Vl)&&(Vl=null),Ul!==null&&Ep(Ul)&&(Ul=null),Sd.forEach(a0),kd.forEach(a0)}function td(i,s){i.blockedOn===s&&(i.blockedOn=null,tg||(tg=!0,Cs.unstable_scheduleCallback(Cs.unstable_NormalPriority,y2)))}function Cd(i){function s(x){return td(x,i)}if(0<fp.length){td(fp[0],i);for(var u=1;u<fp.length;u++){var y=fp[u];y.blockedOn===i&&(y.blockedOn=null)}}for(jl!==null&&td(jl,i),Vl!==null&&td(Vl,i),Ul!==null&&td(Ul,i),Sd.forEach(s),kd.forEach(s),u=0;u<Rl.length;u++)y=Rl[u],y.blockedOn===i&&(y.blockedOn=null);for(;0<Rl.length&&(u=Rl[0],u.blockedOn===null);)Jv(u),u.blockedOn===null&&Rl.shift()}var sh=Oo.ReactCurrentBatchConfig,Up=!0;function _2(i,s,u,y){var x=ti,C=sh.transition;sh.transition=null;try{ti=1,Gg(i,s,u,y)}finally{ti=x,sh.transition=C}}function v2(i,s,u,y){var x=ti,C=sh.transition;sh.transition=null;try{ti=4,Gg(i,s,u,y)}finally{ti=x,sh.transition=C}}function Gg(i,s,u,y){if(Up){var x=rg(i,s,u,y);if(x===null)Cm(i,s,y,qp,u),s0(i,y);else if(g2(x,i,s,u,y))y.stopPropagation();else if(s0(i,y),s&4&&-1<m2.indexOf(i)){for(;x!==null;){var C=$d(x);if(C!==null&&Wv(C),C=rg(i,s,u,y),C===null&&Cm(i,s,y,qp,u),C===x)break;x=C}x!==null&&y.stopPropagation()}else Cm(i,s,y,null,u)}}var qp=null;function rg(i,s,u,y){if(qp=null,i=jg(y),i=qc(i),i!==null)if(s=tu(i),s===null)i=null;else if(u=s.tag,u===13){if(i=$v(s),i!==null)return i;i=null}else if(u===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null);return qp=i,null}function Qv(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(a2()){case Vg:return 1;case qv:return 4;case jp:case o2:return 16;case Gv:return 536870912;default:return 16}default:return 16}}var Bl=null,Zg=null,Pp=null;function e1(){if(Pp)return Pp;var i,s=Zg,u=s.length,y,x="value"in Bl?Bl.value:Bl.textContent,C=x.length;for(i=0;i<u&&s[i]===x[i];i++);var S=u-i;for(y=1;y<=S&&s[u-y]===x[C-y];y++);return Pp=x.slice(i,1<y?1-y:void 0)}function Ap(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function mp(){return!0}function o0(){return!1}function Is(i){function s(u,y,x,C,S){this._reactName=u,this._targetInst=x,this.type=y,this.nativeEvent=C,this.target=S,this.currentTarget=null;for(var d in i)i.hasOwnProperty(d)&&(u=i[d],this[d]=u?u(C):C[d]);return this.isDefaultPrevented=(C.defaultPrevented!=null?C.defaultPrevented:C.returnValue===!1)?mp:o0,this.isPropagationStopped=o0,this}return Ti(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=mp)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=mp)},persist:function(){},isPersistent:mp}),s}var yh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hg=Is(yh),Od=Ti({},yh,{view:0,detail:0}),x2=Is(Od),gm,ym,rd,ff=Ti({},Od,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wg,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==rd&&(rd&&i.type==="mousemove"?(gm=i.screenX-rd.screenX,ym=i.screenY-rd.screenY):ym=gm=0,rd=i),gm)},movementY:function(i){return"movementY"in i?i.movementY:ym}}),l0=Is(ff),b2=Ti({},ff,{dataTransfer:0}),w2=Is(b2),S2=Ti({},Od,{relatedTarget:0}),_m=Is(S2),k2=Ti({},yh,{animationName:0,elapsedTime:0,pseudoElement:0}),C2=Is(k2),T2=Ti({},yh,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),I2=Is(T2),E2=Ti({},yh,{data:0}),c0=Is(E2),P2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},A2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},M2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function z2(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=M2[i])?!!s[i]:!1}function Wg(){return z2}var D2=Ti({},Od,{key:function(i){if(i.key){var s=P2[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Ap(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?A2[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wg,charCode:function(i){return i.type==="keypress"?Ap(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Ap(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),L2=Is(D2),R2=Ti({},ff,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),u0=Is(R2),F2=Ti({},Od,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wg}),B2=Is(F2),N2=Ti({},yh,{propertyName:0,elapsedTime:0,pseudoElement:0}),O2=Is(N2),$2=Ti({},ff,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),j2=Is($2),V2=[9,13,27,32],Kg=Ro&&"CompositionEvent"in window,dd=null;Ro&&"documentMode"in document&&(dd=document.documentMode);var U2=Ro&&"TextEvent"in window&&!dd,t1=Ro&&(!Kg||dd&&8<dd&&11>=dd),h0=" ",d0=!1;function r1(i,s){switch(i){case"keyup":return V2.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function i1(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Zu=!1;function q2(i,s){switch(i){case"compositionend":return i1(s);case"keypress":return s.which!==32?null:(d0=!0,h0);case"textInput":return i=s.data,i===h0&&d0?null:i;default:return null}}function G2(i,s){if(Zu)return i==="compositionend"||!Kg&&r1(i,s)?(i=e1(),Pp=Zg=Bl=null,Zu=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return t1&&s.locale!=="ko"?null:s.data;default:return null}}var Z2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function p0(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!Z2[i.type]:s==="textarea"}function n1(i,s,u,y){Rv(y),s=Gp(s,"onChange"),0<s.length&&(u=new Hg("onChange","change",null,u,y),i.push({event:u,listeners:s}))}var pd=null,Td=null;function H2(i){m1(i,0)}function mf(i){var s=Ku(i);if(Ev(s))return i}function W2(i,s){if(i==="change")return s}var s1=!1;if(Ro){var vm;if(Ro){var xm="oninput"in document;if(!xm){var f0=document.createElement("div");f0.setAttribute("oninput","return;"),xm=typeof f0.oninput=="function"}vm=xm}else vm=!1;s1=vm&&(!document.documentMode||9<document.documentMode)}function m0(){pd&&(pd.detachEvent("onpropertychange",a1),Td=pd=null)}function a1(i){if(i.propertyName==="value"&&mf(Td)){var s=[];n1(s,Td,i,jg(i)),Ov(H2,s)}}function K2(i,s,u){i==="focusin"?(m0(),pd=s,Td=u,pd.attachEvent("onpropertychange",a1)):i==="focusout"&&m0()}function X2(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return mf(Td)}function Y2(i,s){if(i==="click")return mf(s)}function J2(i,s){if(i==="input"||i==="change")return mf(s)}function Q2(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var xa=typeof Object.is=="function"?Object.is:Q2;function Id(i,s){if(xa(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var u=Object.keys(i),y=Object.keys(s);if(u.length!==y.length)return!1;for(y=0;y<u.length;y++){var x=u[y];if(!Nm.call(s,x)||!xa(i[x],s[x]))return!1}return!0}function g0(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function y0(i,s){var u=g0(i);i=0;for(var y;u;){if(u.nodeType===3){if(y=i+u.textContent.length,i<=s&&y>=s)return{node:u,offset:s-i};i=y}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=g0(u)}}function o1(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?o1(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function l1(){for(var i=window,s=Np();s instanceof i.HTMLIFrameElement;){try{var u=typeof s.contentWindow.location.href=="string"}catch{u=!1}if(u)i=s.contentWindow;else break;s=Np(i.document)}return s}function Xg(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}function eS(i){var s=l1(),u=i.focusedElem,y=i.selectionRange;if(s!==u&&u&&u.ownerDocument&&o1(u.ownerDocument.documentElement,u)){if(y!==null&&Xg(u)){if(s=y.start,i=y.end,i===void 0&&(i=s),"selectionStart"in u)u.selectionStart=s,u.selectionEnd=Math.min(i,u.value.length);else if(i=(s=u.ownerDocument||document)&&s.defaultView||window,i.getSelection){i=i.getSelection();var x=u.textContent.length,C=Math.min(y.start,x);y=y.end===void 0?C:Math.min(y.end,x),!i.extend&&C>y&&(x=y,y=C,C=x),x=y0(u,C);var S=y0(u,y);x&&S&&(i.rangeCount!==1||i.anchorNode!==x.node||i.anchorOffset!==x.offset||i.focusNode!==S.node||i.focusOffset!==S.offset)&&(s=s.createRange(),s.setStart(x.node,x.offset),i.removeAllRanges(),C>y?(i.addRange(s),i.extend(S.node,S.offset)):(s.setEnd(S.node,S.offset),i.addRange(s)))}}for(s=[],i=u;i=i.parentNode;)i.nodeType===1&&s.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<s.length;u++)i=s[u],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var tS=Ro&&"documentMode"in document&&11>=document.documentMode,Hu=null,ig=null,fd=null,ng=!1;function _0(i,s,u){var y=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;ng||Hu==null||Hu!==Np(y)||(y=Hu,"selectionStart"in y&&Xg(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),fd&&Id(fd,y)||(fd=y,y=Gp(ig,"onSelect"),0<y.length&&(s=new Hg("onSelect","select",null,s,u),i.push({event:s,listeners:y}),s.target=Hu)))}function gp(i,s){var u={};return u[i.toLowerCase()]=s.toLowerCase(),u["Webkit"+i]="webkit"+s,u["Moz"+i]="moz"+s,u}var Wu={animationend:gp("Animation","AnimationEnd"),animationiteration:gp("Animation","AnimationIteration"),animationstart:gp("Animation","AnimationStart"),transitionend:gp("Transition","TransitionEnd")},bm={},c1={};Ro&&(c1=document.createElement("div").style,"AnimationEvent"in window||(delete Wu.animationend.animation,delete Wu.animationiteration.animation,delete Wu.animationstart.animation),"TransitionEvent"in window||delete Wu.transitionend.transition);function gf(i){if(bm[i])return bm[i];if(!Wu[i])return i;var s=Wu[i],u;for(u in s)if(s.hasOwnProperty(u)&&u in c1)return bm[i]=s[u];return i}var u1=gf("animationend"),h1=gf("animationiteration"),d1=gf("animationstart"),p1=gf("transitionend"),f1=new Map,v0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Jl(i,s){f1.set(i,s),eu(s,[i])}for(var wm=0;wm<v0.length;wm++){var Sm=v0[wm],rS=Sm.toLowerCase(),iS=Sm[0].toUpperCase()+Sm.slice(1);Jl(rS,"on"+iS)}Jl(u1,"onAnimationEnd");Jl(h1,"onAnimationIteration");Jl(d1,"onAnimationStart");Jl("dblclick","onDoubleClick");Jl("focusin","onFocus");Jl("focusout","onBlur");Jl(p1,"onTransitionEnd");lh("onMouseEnter",["mouseout","mouseover"]);lh("onMouseLeave",["mouseout","mouseover"]);lh("onPointerEnter",["pointerout","pointerover"]);lh("onPointerLeave",["pointerout","pointerover"]);eu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));eu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));eu("onBeforeInput",["compositionend","keypress","textInput","paste"]);eu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));eu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));eu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nS=new Set("cancel close invalid load scroll toggle".split(" ").concat(cd));function x0(i,s,u){var y=i.type||"unknown-event";i.currentTarget=u,r2(y,s,void 0,i),i.currentTarget=null}function m1(i,s){s=(s&4)!==0;for(var u=0;u<i.length;u++){var y=i[u],x=y.event;y=y.listeners;e:{var C=void 0;if(s)for(var S=y.length-1;0<=S;S--){var d=y[S],V=d.instance,ee=d.currentTarget;if(d=d.listener,V!==C&&x.isPropagationStopped())break e;x0(x,d,ee),C=V}else for(S=0;S<y.length;S++){if(d=y[S],V=d.instance,ee=d.currentTarget,d=d.listener,V!==C&&x.isPropagationStopped())break e;x0(x,d,ee),C=V}}}if($p)throw i=Qm,$p=!1,Qm=null,i}function hi(i,s){var u=s[cg];u===void 0&&(u=s[cg]=new Set);var y=i+"__bubble";u.has(y)||(g1(s,i,2,!1),u.add(y))}function km(i,s,u){var y=0;s&&(y|=4),g1(u,i,y,s)}var yp="_reactListening"+Math.random().toString(36).slice(2);function Ed(i){if(!i[yp]){i[yp]=!0,Sv.forEach(function(u){u!=="selectionchange"&&(nS.has(u)||km(u,!1,i),km(u,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[yp]||(s[yp]=!0,km("selectionchange",!1,s))}}function g1(i,s,u,y){switch(Qv(s)){case 1:var x=_2;break;case 4:x=v2;break;default:x=Gg}u=x.bind(null,s,u,i),x=void 0,!Jm||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(x=!0),y?x!==void 0?i.addEventListener(s,u,{capture:!0,passive:x}):i.addEventListener(s,u,!0):x!==void 0?i.addEventListener(s,u,{passive:x}):i.addEventListener(s,u,!1)}function Cm(i,s,u,y,x){var C=y;if(!(s&1)&&!(s&2)&&y!==null)e:for(;;){if(y===null)return;var S=y.tag;if(S===3||S===4){var d=y.stateNode.containerInfo;if(d===x||d.nodeType===8&&d.parentNode===x)break;if(S===4)for(S=y.return;S!==null;){var V=S.tag;if((V===3||V===4)&&(V=S.stateNode.containerInfo,V===x||V.nodeType===8&&V.parentNode===x))return;S=S.return}for(;d!==null;){if(S=qc(d),S===null)return;if(V=S.tag,V===5||V===6){y=C=S;continue e}d=d.parentNode}}y=y.return}Ov(function(){var ee=C,Te=jg(u),ie=[];e:{var G=f1.get(i);if(G!==void 0){var He=Hg,Ke=i;switch(i){case"keypress":if(Ap(u)===0)break e;case"keydown":case"keyup":He=L2;break;case"focusin":Ke="focus",He=_m;break;case"focusout":Ke="blur",He=_m;break;case"beforeblur":case"afterblur":He=_m;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":He=l0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":He=w2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":He=B2;break;case u1:case h1:case d1:He=C2;break;case p1:He=O2;break;case"scroll":He=x2;break;case"wheel":He=j2;break;case"copy":case"cut":case"paste":He=I2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":He=u0}var ke=(s&4)!==0,ht=!ke&&i==="scroll",pe=ke?G!==null?G+"Capture":null:G;ke=[];for(var oe=ee,me;oe!==null;){me=oe;var De=me.stateNode;if(me.tag===5&&De!==null&&(me=De,pe!==null&&(De=wd(oe,pe),De!=null&&ke.push(Pd(oe,De,me)))),ht)break;oe=oe.return}0<ke.length&&(G=new He(G,Ke,null,u,Te),ie.push({event:G,listeners:ke}))}}if(!(s&7)){e:{if(G=i==="mouseover"||i==="pointerover",He=i==="mouseout"||i==="pointerout",G&&u!==Xm&&(Ke=u.relatedTarget||u.fromElement)&&(qc(Ke)||Ke[Fo]))break e;if((He||G)&&(G=Te.window===Te?Te:(G=Te.ownerDocument)?G.defaultView||G.parentWindow:window,He?(Ke=u.relatedTarget||u.toElement,He=ee,Ke=Ke?qc(Ke):null,Ke!==null&&(ht=tu(Ke),Ke!==ht||Ke.tag!==5&&Ke.tag!==6)&&(Ke=null)):(He=null,Ke=ee),He!==Ke)){if(ke=l0,De="onMouseLeave",pe="onMouseEnter",oe="mouse",(i==="pointerout"||i==="pointerover")&&(ke=u0,De="onPointerLeave",pe="onPointerEnter",oe="pointer"),ht=He==null?G:Ku(He),me=Ke==null?G:Ku(Ke),G=new ke(De,oe+"leave",He,u,Te),G.target=ht,G.relatedTarget=me,De=null,qc(Te)===ee&&(ke=new ke(pe,oe+"enter",Ke,u,Te),ke.target=me,ke.relatedTarget=ht,De=ke),ht=De,He&&Ke)t:{for(ke=He,pe=Ke,oe=0,me=ke;me;me=Vu(me))oe++;for(me=0,De=pe;De;De=Vu(De))me++;for(;0<oe-me;)ke=Vu(ke),oe--;for(;0<me-oe;)pe=Vu(pe),me--;for(;oe--;){if(ke===pe||pe!==null&&ke===pe.alternate)break t;ke=Vu(ke),pe=Vu(pe)}ke=null}else ke=null;He!==null&&b0(ie,G,He,ke,!1),Ke!==null&&ht!==null&&b0(ie,ht,Ke,ke,!0)}}e:{if(G=ee?Ku(ee):window,He=G.nodeName&&G.nodeName.toLowerCase(),He==="select"||He==="input"&&G.type==="file")var Ue=W2;else if(p0(G))if(s1)Ue=J2;else{Ue=X2;var ze=K2}else(He=G.nodeName)&&He.toLowerCase()==="input"&&(G.type==="checkbox"||G.type==="radio")&&(Ue=Y2);if(Ue&&(Ue=Ue(i,ee))){n1(ie,Ue,u,Te);break e}ze&&ze(i,G,ee),i==="focusout"&&(ze=G._wrapperState)&&ze.controlled&&G.type==="number"&&Gm(G,"number",G.value)}switch(ze=ee?Ku(ee):window,i){case"focusin":(p0(ze)||ze.contentEditable==="true")&&(Hu=ze,ig=ee,fd=null);break;case"focusout":fd=ig=Hu=null;break;case"mousedown":ng=!0;break;case"contextmenu":case"mouseup":case"dragend":ng=!1,_0(ie,u,Te);break;case"selectionchange":if(tS)break;case"keydown":case"keyup":_0(ie,u,Te)}var Ge;if(Kg)e:{switch(i){case"compositionstart":var re="onCompositionStart";break e;case"compositionend":re="onCompositionEnd";break e;case"compositionupdate":re="onCompositionUpdate";break e}re=void 0}else Zu?r1(i,u)&&(re="onCompositionEnd"):i==="keydown"&&u.keyCode===229&&(re="onCompositionStart");re&&(t1&&u.locale!=="ko"&&(Zu||re!=="onCompositionStart"?re==="onCompositionEnd"&&Zu&&(Ge=e1()):(Bl=Te,Zg="value"in Bl?Bl.value:Bl.textContent,Zu=!0)),ze=Gp(ee,re),0<ze.length&&(re=new c0(re,i,null,u,Te),ie.push({event:re,listeners:ze}),Ge?re.data=Ge:(Ge=i1(u),Ge!==null&&(re.data=Ge)))),(Ge=U2?q2(i,u):G2(i,u))&&(ee=Gp(ee,"onBeforeInput"),0<ee.length&&(Te=new c0("onBeforeInput","beforeinput",null,u,Te),ie.push({event:Te,listeners:ee}),Te.data=Ge))}m1(ie,s)})}function Pd(i,s,u){return{instance:i,listener:s,currentTarget:u}}function Gp(i,s){for(var u=s+"Capture",y=[];i!==null;){var x=i,C=x.stateNode;x.tag===5&&C!==null&&(x=C,C=wd(i,u),C!=null&&y.unshift(Pd(i,C,x)),C=wd(i,s),C!=null&&y.push(Pd(i,C,x))),i=i.return}return y}function Vu(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function b0(i,s,u,y,x){for(var C=s._reactName,S=[];u!==null&&u!==y;){var d=u,V=d.alternate,ee=d.stateNode;if(V!==null&&V===y)break;d.tag===5&&ee!==null&&(d=ee,x?(V=wd(u,C),V!=null&&S.unshift(Pd(u,V,d))):x||(V=wd(u,C),V!=null&&S.push(Pd(u,V,d)))),u=u.return}S.length!==0&&i.push({event:s,listeners:S})}var sS=/\r\n?/g,aS=/\u0000|\uFFFD/g;function w0(i){return(typeof i=="string"?i:""+i).replace(sS,`
`).replace(aS,"")}function _p(i,s,u){if(s=w0(s),w0(i)!==s&&u)throw Error(at(425))}function Zp(){}var sg=null,ag=null;function og(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var lg=typeof setTimeout=="function"?setTimeout:void 0,oS=typeof clearTimeout=="function"?clearTimeout:void 0,S0=typeof Promise=="function"?Promise:void 0,lS=typeof queueMicrotask=="function"?queueMicrotask:typeof S0<"u"?function(i){return S0.resolve(null).then(i).catch(cS)}:lg;function cS(i){setTimeout(function(){throw i})}function Tm(i,s){var u=s,y=0;do{var x=u.nextSibling;if(i.removeChild(u),x&&x.nodeType===8)if(u=x.data,u==="/$"){if(y===0){i.removeChild(x),Cd(s);return}y--}else u!=="$"&&u!=="$?"&&u!=="$!"||y++;u=x}while(u);Cd(s)}function ql(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return i}function k0(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var u=i.data;if(u==="$"||u==="$!"||u==="$?"){if(s===0)return i;s--}else u==="/$"&&s++}i=i.previousSibling}return null}var _h=Math.random().toString(36).slice(2),Ya="__reactFiber$"+_h,Ad="__reactProps$"+_h,Fo="__reactContainer$"+_h,cg="__reactEvents$"+_h,uS="__reactListeners$"+_h,hS="__reactHandles$"+_h;function qc(i){var s=i[Ya];if(s)return s;for(var u=i.parentNode;u;){if(s=u[Fo]||u[Ya]){if(u=s.alternate,s.child!==null||u!==null&&u.child!==null)for(i=k0(i);i!==null;){if(u=i[Ya])return u;i=k0(i)}return s}i=u,u=i.parentNode}return null}function $d(i){return i=i[Ya]||i[Fo],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Ku(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(at(33))}function yf(i){return i[Ad]||null}var ug=[],Xu=-1;function Ql(i){return{current:i}}function di(i){0>Xu||(i.current=ug[Xu],ug[Xu]=null,Xu--)}function oi(i,s){Xu++,ug[Xu]=i.current,i.current=s}var Yl={},Bn=Ql(Yl),is=Ql(!1),Kc=Yl;function ch(i,s){var u=i.type.contextTypes;if(!u)return Yl;var y=i.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===s)return y.__reactInternalMemoizedMaskedChildContext;var x={},C;for(C in u)x[C]=s[C];return y&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=x),x}function ns(i){return i=i.childContextTypes,i!=null}function Hp(){di(is),di(Bn)}function C0(i,s,u){if(Bn.current!==Yl)throw Error(at(168));oi(Bn,s),oi(is,u)}function y1(i,s,u){var y=i.stateNode;if(s=s.childContextTypes,typeof y.getChildContext!="function")return u;y=y.getChildContext();for(var x in y)if(!(x in s))throw Error(at(108,Kw(i)||"Unknown",x));return Ti({},u,y)}function Wp(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Yl,Kc=Bn.current,oi(Bn,i),oi(is,is.current),!0}function T0(i,s,u){var y=i.stateNode;if(!y)throw Error(at(169));u?(i=y1(i,s,Kc),y.__reactInternalMemoizedMergedChildContext=i,di(is),di(Bn),oi(Bn,i)):di(is),oi(is,u)}var Mo=null,_f=!1,Im=!1;function _1(i){Mo===null?Mo=[i]:Mo.push(i)}function dS(i){_f=!0,_1(i)}function ec(){if(!Im&&Mo!==null){Im=!0;var i=0,s=ti;try{var u=Mo;for(ti=1;i<u.length;i++){var y=u[i];do y=y(!0);while(y!==null)}Mo=null,_f=!1}catch(x){throw Mo!==null&&(Mo=Mo.slice(i+1)),Uv(Vg,ec),x}finally{ti=s,Im=!1}}return null}var Yu=[],Ju=0,Kp=null,Xp=0,Vs=[],Us=0,Xc=null,zo=1,Do="";function Vc(i,s){Yu[Ju++]=Xp,Yu[Ju++]=Kp,Kp=i,Xp=s}function v1(i,s,u){Vs[Us++]=zo,Vs[Us++]=Do,Vs[Us++]=Xc,Xc=i;var y=zo;i=Do;var x=32-_a(y)-1;y&=~(1<<x),u+=1;var C=32-_a(s)+x;if(30<C){var S=x-x%5;C=(y&(1<<S)-1).toString(32),y>>=S,x-=S,zo=1<<32-_a(s)+x|u<<x|y,Do=C+i}else zo=1<<C|u<<x|y,Do=i}function Yg(i){i.return!==null&&(Vc(i,1),v1(i,1,0))}function Jg(i){for(;i===Kp;)Kp=Yu[--Ju],Yu[Ju]=null,Xp=Yu[--Ju],Yu[Ju]=null;for(;i===Xc;)Xc=Vs[--Us],Vs[Us]=null,Do=Vs[--Us],Vs[Us]=null,zo=Vs[--Us],Vs[Us]=null}var ks=null,Ss=null,vi=!1,ya=null;function x1(i,s){var u=qs(5,null,null,0);u.elementType="DELETED",u.stateNode=s,u.return=i,s=i.deletions,s===null?(i.deletions=[u],i.flags|=16):s.push(u)}function I0(i,s){switch(i.tag){case 5:var u=i.type;return s=s.nodeType!==1||u.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(i.stateNode=s,ks=i,Ss=ql(s.firstChild),!0):!1;case 6:return s=i.pendingProps===""||s.nodeType!==3?null:s,s!==null?(i.stateNode=s,ks=i,Ss=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(u=Xc!==null?{id:zo,overflow:Do}:null,i.memoizedState={dehydrated:s,treeContext:u,retryLane:1073741824},u=qs(18,null,null,0),u.stateNode=s,u.return=i,i.child=u,ks=i,Ss=null,!0):!1;default:return!1}}function hg(i){return(i.mode&1)!==0&&(i.flags&128)===0}function dg(i){if(vi){var s=Ss;if(s){var u=s;if(!I0(i,s)){if(hg(i))throw Error(at(418));s=ql(u.nextSibling);var y=ks;s&&I0(i,s)?x1(y,u):(i.flags=i.flags&-4097|2,vi=!1,ks=i)}}else{if(hg(i))throw Error(at(418));i.flags=i.flags&-4097|2,vi=!1,ks=i}}}function E0(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;ks=i}function vp(i){if(i!==ks)return!1;if(!vi)return E0(i),vi=!0,!1;var s;if((s=i.tag!==3)&&!(s=i.tag!==5)&&(s=i.type,s=s!=="head"&&s!=="body"&&!og(i.type,i.memoizedProps)),s&&(s=Ss)){if(hg(i))throw b1(),Error(at(418));for(;s;)x1(i,s),s=ql(s.nextSibling)}if(E0(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(at(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8){var u=i.data;if(u==="/$"){if(s===0){Ss=ql(i.nextSibling);break e}s--}else u!=="$"&&u!=="$!"&&u!=="$?"||s++}i=i.nextSibling}Ss=null}}else Ss=ks?ql(i.stateNode.nextSibling):null;return!0}function b1(){for(var i=Ss;i;)i=ql(i.nextSibling)}function uh(){Ss=ks=null,vi=!1}function Qg(i){ya===null?ya=[i]:ya.push(i)}var pS=Oo.ReactCurrentBatchConfig;function id(i,s,u){if(i=u.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(at(309));var y=u.stateNode}if(!y)throw Error(at(147,i));var x=y,C=""+i;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===C?s.ref:(s=function(S){var d=x.refs;S===null?delete d[C]:d[C]=S},s._stringRef=C,s)}if(typeof i!="string")throw Error(at(284));if(!u._owner)throw Error(at(290,i))}return i}function xp(i,s){throw i=Object.prototype.toString.call(s),Error(at(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i))}function P0(i){var s=i._init;return s(i._payload)}function w1(i){function s(pe,oe){if(i){var me=pe.deletions;me===null?(pe.deletions=[oe],pe.flags|=16):me.push(oe)}}function u(pe,oe){if(!i)return null;for(;oe!==null;)s(pe,oe),oe=oe.sibling;return null}function y(pe,oe){for(pe=new Map;oe!==null;)oe.key!==null?pe.set(oe.key,oe):pe.set(oe.index,oe),oe=oe.sibling;return pe}function x(pe,oe){return pe=Wl(pe,oe),pe.index=0,pe.sibling=null,pe}function C(pe,oe,me){return pe.index=me,i?(me=pe.alternate,me!==null?(me=me.index,me<oe?(pe.flags|=2,oe):me):(pe.flags|=2,oe)):(pe.flags|=1048576,oe)}function S(pe){return i&&pe.alternate===null&&(pe.flags|=2),pe}function d(pe,oe,me,De){return oe===null||oe.tag!==6?(oe=Lm(me,pe.mode,De),oe.return=pe,oe):(oe=x(oe,me),oe.return=pe,oe)}function V(pe,oe,me,De){var Ue=me.type;return Ue===Gu?Te(pe,oe,me.props.children,De,me.key):oe!==null&&(oe.elementType===Ue||typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===Dl&&P0(Ue)===oe.type)?(De=x(oe,me.props),De.ref=id(pe,oe,me),De.return=pe,De):(De=Bp(me.type,me.key,me.props,null,pe.mode,De),De.ref=id(pe,oe,me),De.return=pe,De)}function ee(pe,oe,me,De){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==me.containerInfo||oe.stateNode.implementation!==me.implementation?(oe=Rm(me,pe.mode,De),oe.return=pe,oe):(oe=x(oe,me.children||[]),oe.return=pe,oe)}function Te(pe,oe,me,De,Ue){return oe===null||oe.tag!==7?(oe=Wc(me,pe.mode,De,Ue),oe.return=pe,oe):(oe=x(oe,me),oe.return=pe,oe)}function ie(pe,oe,me){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return oe=Lm(""+oe,pe.mode,me),oe.return=pe,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case cp:return me=Bp(oe.type,oe.key,oe.props,null,pe.mode,me),me.ref=id(pe,null,oe),me.return=pe,me;case qu:return oe=Rm(oe,pe.mode,me),oe.return=pe,oe;case Dl:var De=oe._init;return ie(pe,De(oe._payload),me)}if(od(oe)||Jh(oe))return oe=Wc(oe,pe.mode,me,null),oe.return=pe,oe;xp(pe,oe)}return null}function G(pe,oe,me,De){var Ue=oe!==null?oe.key:null;if(typeof me=="string"&&me!==""||typeof me=="number")return Ue!==null?null:d(pe,oe,""+me,De);if(typeof me=="object"&&me!==null){switch(me.$$typeof){case cp:return me.key===Ue?V(pe,oe,me,De):null;case qu:return me.key===Ue?ee(pe,oe,me,De):null;case Dl:return Ue=me._init,G(pe,oe,Ue(me._payload),De)}if(od(me)||Jh(me))return Ue!==null?null:Te(pe,oe,me,De,null);xp(pe,me)}return null}function He(pe,oe,me,De,Ue){if(typeof De=="string"&&De!==""||typeof De=="number")return pe=pe.get(me)||null,d(oe,pe,""+De,Ue);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case cp:return pe=pe.get(De.key===null?me:De.key)||null,V(oe,pe,De,Ue);case qu:return pe=pe.get(De.key===null?me:De.key)||null,ee(oe,pe,De,Ue);case Dl:var ze=De._init;return He(pe,oe,me,ze(De._payload),Ue)}if(od(De)||Jh(De))return pe=pe.get(me)||null,Te(oe,pe,De,Ue,null);xp(oe,De)}return null}function Ke(pe,oe,me,De){for(var Ue=null,ze=null,Ge=oe,re=oe=0,ne=null;Ge!==null&&re<me.length;re++){Ge.index>re?(ne=Ge,Ge=null):ne=Ge.sibling;var fe=G(pe,Ge,me[re],De);if(fe===null){Ge===null&&(Ge=ne);break}i&&Ge&&fe.alternate===null&&s(pe,Ge),oe=C(fe,oe,re),ze===null?Ue=fe:ze.sibling=fe,ze=fe,Ge=ne}if(re===me.length)return u(pe,Ge),vi&&Vc(pe,re),Ue;if(Ge===null){for(;re<me.length;re++)Ge=ie(pe,me[re],De),Ge!==null&&(oe=C(Ge,oe,re),ze===null?Ue=Ge:ze.sibling=Ge,ze=Ge);return vi&&Vc(pe,re),Ue}for(Ge=y(pe,Ge);re<me.length;re++)ne=He(Ge,pe,re,me[re],De),ne!==null&&(i&&ne.alternate!==null&&Ge.delete(ne.key===null?re:ne.key),oe=C(ne,oe,re),ze===null?Ue=ne:ze.sibling=ne,ze=ne);return i&&Ge.forEach(function(Me){return s(pe,Me)}),vi&&Vc(pe,re),Ue}function ke(pe,oe,me,De){var Ue=Jh(me);if(typeof Ue!="function")throw Error(at(150));if(me=Ue.call(me),me==null)throw Error(at(151));for(var ze=Ue=null,Ge=oe,re=oe=0,ne=null,fe=me.next();Ge!==null&&!fe.done;re++,fe=me.next()){Ge.index>re?(ne=Ge,Ge=null):ne=Ge.sibling;var Me=G(pe,Ge,fe.value,De);if(Me===null){Ge===null&&(Ge=ne);break}i&&Ge&&Me.alternate===null&&s(pe,Ge),oe=C(Me,oe,re),ze===null?Ue=Me:ze.sibling=Me,ze=Me,Ge=ne}if(fe.done)return u(pe,Ge),vi&&Vc(pe,re),Ue;if(Ge===null){for(;!fe.done;re++,fe=me.next())fe=ie(pe,fe.value,De),fe!==null&&(oe=C(fe,oe,re),ze===null?Ue=fe:ze.sibling=fe,ze=fe);return vi&&Vc(pe,re),Ue}for(Ge=y(pe,Ge);!fe.done;re++,fe=me.next())fe=He(Ge,pe,re,fe.value,De),fe!==null&&(i&&fe.alternate!==null&&Ge.delete(fe.key===null?re:fe.key),oe=C(fe,oe,re),ze===null?Ue=fe:ze.sibling=fe,ze=fe);return i&&Ge.forEach(function(Oe){return s(pe,Oe)}),vi&&Vc(pe,re),Ue}function ht(pe,oe,me,De){if(typeof me=="object"&&me!==null&&me.type===Gu&&me.key===null&&(me=me.props.children),typeof me=="object"&&me!==null){switch(me.$$typeof){case cp:e:{for(var Ue=me.key,ze=oe;ze!==null;){if(ze.key===Ue){if(Ue=me.type,Ue===Gu){if(ze.tag===7){u(pe,ze.sibling),oe=x(ze,me.props.children),oe.return=pe,pe=oe;break e}}else if(ze.elementType===Ue||typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===Dl&&P0(Ue)===ze.type){u(pe,ze.sibling),oe=x(ze,me.props),oe.ref=id(pe,ze,me),oe.return=pe,pe=oe;break e}u(pe,ze);break}else s(pe,ze);ze=ze.sibling}me.type===Gu?(oe=Wc(me.props.children,pe.mode,De,me.key),oe.return=pe,pe=oe):(De=Bp(me.type,me.key,me.props,null,pe.mode,De),De.ref=id(pe,oe,me),De.return=pe,pe=De)}return S(pe);case qu:e:{for(ze=me.key;oe!==null;){if(oe.key===ze)if(oe.tag===4&&oe.stateNode.containerInfo===me.containerInfo&&oe.stateNode.implementation===me.implementation){u(pe,oe.sibling),oe=x(oe,me.children||[]),oe.return=pe,pe=oe;break e}else{u(pe,oe);break}else s(pe,oe);oe=oe.sibling}oe=Rm(me,pe.mode,De),oe.return=pe,pe=oe}return S(pe);case Dl:return ze=me._init,ht(pe,oe,ze(me._payload),De)}if(od(me))return Ke(pe,oe,me,De);if(Jh(me))return ke(pe,oe,me,De);xp(pe,me)}return typeof me=="string"&&me!==""||typeof me=="number"?(me=""+me,oe!==null&&oe.tag===6?(u(pe,oe.sibling),oe=x(oe,me),oe.return=pe,pe=oe):(u(pe,oe),oe=Lm(me,pe.mode,De),oe.return=pe,pe=oe),S(pe)):u(pe,oe)}return ht}var hh=w1(!0),S1=w1(!1),Yp=Ql(null),Jp=null,Qu=null,ey=null;function ty(){ey=Qu=Jp=null}function ry(i){var s=Yp.current;di(Yp),i._currentValue=s}function pg(i,s,u){for(;i!==null;){var y=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,y!==null&&(y.childLanes|=s)):y!==null&&(y.childLanes&s)!==s&&(y.childLanes|=s),i===u)break;i=i.return}}function ah(i,s){Jp=i,ey=Qu=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&s&&(rs=!0),i.firstContext=null)}function Zs(i){var s=i._currentValue;if(ey!==i)if(i={context:i,memoizedValue:s,next:null},Qu===null){if(Jp===null)throw Error(at(308));Qu=i,Jp.dependencies={lanes:0,firstContext:i}}else Qu=Qu.next=i;return s}var Gc=null;function iy(i){Gc===null?Gc=[i]:Gc.push(i)}function k1(i,s,u,y){var x=s.interleaved;return x===null?(u.next=u,iy(s)):(u.next=x.next,x.next=u),s.interleaved=u,Bo(i,y)}function Bo(i,s){i.lanes|=s;var u=i.alternate;for(u!==null&&(u.lanes|=s),u=i,i=i.return;i!==null;)i.childLanes|=s,u=i.alternate,u!==null&&(u.childLanes|=s),u=i,i=i.return;return u.tag===3?u.stateNode:null}var Ll=!1;function ny(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function C1(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Lo(i,s){return{eventTime:i,lane:s,tag:0,payload:null,callback:null,next:null}}function Gl(i,s,u){var y=i.updateQueue;if(y===null)return null;if(y=y.shared,Or&2){var x=y.pending;return x===null?s.next=s:(s.next=x.next,x.next=s),y.pending=s,Bo(i,u)}return x=y.interleaved,x===null?(s.next=s,iy(y)):(s.next=x.next,x.next=s),y.interleaved=s,Bo(i,u)}function Mp(i,s,u){if(s=s.updateQueue,s!==null&&(s=s.shared,(u&4194240)!==0)){var y=s.lanes;y&=i.pendingLanes,u|=y,s.lanes=u,Ug(i,u)}}function A0(i,s){var u=i.updateQueue,y=i.alternate;if(y!==null&&(y=y.updateQueue,u===y)){var x=null,C=null;if(u=u.firstBaseUpdate,u!==null){do{var S={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};C===null?x=C=S:C=C.next=S,u=u.next}while(u!==null);C===null?x=C=s:C=C.next=s}else x=C=s;u={baseState:y.baseState,firstBaseUpdate:x,lastBaseUpdate:C,shared:y.shared,effects:y.effects},i.updateQueue=u;return}i=u.lastBaseUpdate,i===null?u.firstBaseUpdate=s:i.next=s,u.lastBaseUpdate=s}function Qp(i,s,u,y){var x=i.updateQueue;Ll=!1;var C=x.firstBaseUpdate,S=x.lastBaseUpdate,d=x.shared.pending;if(d!==null){x.shared.pending=null;var V=d,ee=V.next;V.next=null,S===null?C=ee:S.next=ee,S=V;var Te=i.alternate;Te!==null&&(Te=Te.updateQueue,d=Te.lastBaseUpdate,d!==S&&(d===null?Te.firstBaseUpdate=ee:d.next=ee,Te.lastBaseUpdate=V))}if(C!==null){var ie=x.baseState;S=0,Te=ee=V=null,d=C;do{var G=d.lane,He=d.eventTime;if((y&G)===G){Te!==null&&(Te=Te.next={eventTime:He,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var Ke=i,ke=d;switch(G=s,He=u,ke.tag){case 1:if(Ke=ke.payload,typeof Ke=="function"){ie=Ke.call(He,ie,G);break e}ie=Ke;break e;case 3:Ke.flags=Ke.flags&-65537|128;case 0:if(Ke=ke.payload,G=typeof Ke=="function"?Ke.call(He,ie,G):Ke,G==null)break e;ie=Ti({},ie,G);break e;case 2:Ll=!0}}d.callback!==null&&d.lane!==0&&(i.flags|=64,G=x.effects,G===null?x.effects=[d]:G.push(d))}else He={eventTime:He,lane:G,tag:d.tag,payload:d.payload,callback:d.callback,next:null},Te===null?(ee=Te=He,V=ie):Te=Te.next=He,S|=G;if(d=d.next,d===null){if(d=x.shared.pending,d===null)break;G=d,d=G.next,G.next=null,x.lastBaseUpdate=G,x.shared.pending=null}}while(!0);if(Te===null&&(V=ie),x.baseState=V,x.firstBaseUpdate=ee,x.lastBaseUpdate=Te,s=x.shared.interleaved,s!==null){x=s;do S|=x.lane,x=x.next;while(x!==s)}else C===null&&(x.shared.lanes=0);Jc|=S,i.lanes=S,i.memoizedState=ie}}function M0(i,s,u){if(i=s.effects,s.effects=null,i!==null)for(s=0;s<i.length;s++){var y=i[s],x=y.callback;if(x!==null){if(y.callback=null,y=u,typeof x!="function")throw Error(at(191,x));x.call(y)}}}var jd={},Qa=Ql(jd),Md=Ql(jd),zd=Ql(jd);function Zc(i){if(i===jd)throw Error(at(174));return i}function sy(i,s){switch(oi(zd,s),oi(Md,i),oi(Qa,jd),i=s.nodeType,i){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Hm(null,"");break;default:i=i===8?s.parentNode:s,s=i.namespaceURI||null,i=i.tagName,s=Hm(s,i)}di(Qa),oi(Qa,s)}function dh(){di(Qa),di(Md),di(zd)}function T1(i){Zc(zd.current);var s=Zc(Qa.current),u=Hm(s,i.type);s!==u&&(oi(Md,i),oi(Qa,u))}function ay(i){Md.current===i&&(di(Qa),di(Md))}var ki=Ql(0);function ef(i){for(var s=i;s!==null;){if(s.tag===13){var u=s.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Em=[];function oy(){for(var i=0;i<Em.length;i++)Em[i]._workInProgressVersionPrimary=null;Em.length=0}var zp=Oo.ReactCurrentDispatcher,Pm=Oo.ReactCurrentBatchConfig,Yc=0,Ci=null,nn=null,fn=null,tf=!1,md=!1,Dd=0,fS=0;function Ln(){throw Error(at(321))}function ly(i,s){if(s===null)return!1;for(var u=0;u<s.length&&u<i.length;u++)if(!xa(i[u],s[u]))return!1;return!0}function cy(i,s,u,y,x,C){if(Yc=C,Ci=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,zp.current=i===null||i.memoizedState===null?_S:vS,i=u(y,x),md){C=0;do{if(md=!1,Dd=0,25<=C)throw Error(at(301));C+=1,fn=nn=null,s.updateQueue=null,zp.current=xS,i=u(y,x)}while(md)}if(zp.current=rf,s=nn!==null&&nn.next!==null,Yc=0,fn=nn=Ci=null,tf=!1,s)throw Error(at(300));return i}function uy(){var i=Dd!==0;return Dd=0,i}function Xa(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return fn===null?Ci.memoizedState=fn=i:fn=fn.next=i,fn}function Hs(){if(nn===null){var i=Ci.alternate;i=i!==null?i.memoizedState:null}else i=nn.next;var s=fn===null?Ci.memoizedState:fn.next;if(s!==null)fn=s,nn=i;else{if(i===null)throw Error(at(310));nn=i,i={memoizedState:nn.memoizedState,baseState:nn.baseState,baseQueue:nn.baseQueue,queue:nn.queue,next:null},fn===null?Ci.memoizedState=fn=i:fn=fn.next=i}return fn}function Ld(i,s){return typeof s=="function"?s(i):s}function Am(i){var s=Hs(),u=s.queue;if(u===null)throw Error(at(311));u.lastRenderedReducer=i;var y=nn,x=y.baseQueue,C=u.pending;if(C!==null){if(x!==null){var S=x.next;x.next=C.next,C.next=S}y.baseQueue=x=C,u.pending=null}if(x!==null){C=x.next,y=y.baseState;var d=S=null,V=null,ee=C;do{var Te=ee.lane;if((Yc&Te)===Te)V!==null&&(V=V.next={lane:0,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null}),y=ee.hasEagerState?ee.eagerState:i(y,ee.action);else{var ie={lane:Te,action:ee.action,hasEagerState:ee.hasEagerState,eagerState:ee.eagerState,next:null};V===null?(d=V=ie,S=y):V=V.next=ie,Ci.lanes|=Te,Jc|=Te}ee=ee.next}while(ee!==null&&ee!==C);V===null?S=y:V.next=d,xa(y,s.memoizedState)||(rs=!0),s.memoizedState=y,s.baseState=S,s.baseQueue=V,u.lastRenderedState=y}if(i=u.interleaved,i!==null){x=i;do C=x.lane,Ci.lanes|=C,Jc|=C,x=x.next;while(x!==i)}else x===null&&(u.lanes=0);return[s.memoizedState,u.dispatch]}function Mm(i){var s=Hs(),u=s.queue;if(u===null)throw Error(at(311));u.lastRenderedReducer=i;var y=u.dispatch,x=u.pending,C=s.memoizedState;if(x!==null){u.pending=null;var S=x=x.next;do C=i(C,S.action),S=S.next;while(S!==x);xa(C,s.memoizedState)||(rs=!0),s.memoizedState=C,s.baseQueue===null&&(s.baseState=C),u.lastRenderedState=C}return[C,y]}function I1(){}function E1(i,s){var u=Ci,y=Hs(),x=s(),C=!xa(y.memoizedState,x);if(C&&(y.memoizedState=x,rs=!0),y=y.queue,hy(M1.bind(null,u,y,i),[i]),y.getSnapshot!==s||C||fn!==null&&fn.memoizedState.tag&1){if(u.flags|=2048,Rd(9,A1.bind(null,u,y,x,s),void 0,null),mn===null)throw Error(at(349));Yc&30||P1(u,s,x)}return x}function P1(i,s,u){i.flags|=16384,i={getSnapshot:s,value:u},s=Ci.updateQueue,s===null?(s={lastEffect:null,stores:null},Ci.updateQueue=s,s.stores=[i]):(u=s.stores,u===null?s.stores=[i]:u.push(i))}function A1(i,s,u,y){s.value=u,s.getSnapshot=y,z1(s)&&D1(i)}function M1(i,s,u){return u(function(){z1(s)&&D1(i)})}function z1(i){var s=i.getSnapshot;i=i.value;try{var u=s();return!xa(i,u)}catch{return!0}}function D1(i){var s=Bo(i,1);s!==null&&va(s,i,1,-1)}function z0(i){var s=Xa();return typeof i=="function"&&(i=i()),s.memoizedState=s.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ld,lastRenderedState:i},s.queue=i,i=i.dispatch=yS.bind(null,Ci,i),[s.memoizedState,i]}function Rd(i,s,u,y){return i={tag:i,create:s,destroy:u,deps:y,next:null},s=Ci.updateQueue,s===null?(s={lastEffect:null,stores:null},Ci.updateQueue=s,s.lastEffect=i.next=i):(u=s.lastEffect,u===null?s.lastEffect=i.next=i:(y=u.next,u.next=i,i.next=y,s.lastEffect=i)),i}function L1(){return Hs().memoizedState}function Dp(i,s,u,y){var x=Xa();Ci.flags|=i,x.memoizedState=Rd(1|s,u,void 0,y===void 0?null:y)}function vf(i,s,u,y){var x=Hs();y=y===void 0?null:y;var C=void 0;if(nn!==null){var S=nn.memoizedState;if(C=S.destroy,y!==null&&ly(y,S.deps)){x.memoizedState=Rd(s,u,C,y);return}}Ci.flags|=i,x.memoizedState=Rd(1|s,u,C,y)}function D0(i,s){return Dp(8390656,8,i,s)}function hy(i,s){return vf(2048,8,i,s)}function R1(i,s){return vf(4,2,i,s)}function F1(i,s){return vf(4,4,i,s)}function B1(i,s){if(typeof s=="function")return i=i(),s(i),function(){s(null)};if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function N1(i,s,u){return u=u!=null?u.concat([i]):null,vf(4,4,B1.bind(null,s,i),u)}function dy(){}function O1(i,s){var u=Hs();s=s===void 0?null:s;var y=u.memoizedState;return y!==null&&s!==null&&ly(s,y[1])?y[0]:(u.memoizedState=[i,s],i)}function $1(i,s){var u=Hs();s=s===void 0?null:s;var y=u.memoizedState;return y!==null&&s!==null&&ly(s,y[1])?y[0]:(i=i(),u.memoizedState=[i,s],i)}function j1(i,s,u){return Yc&21?(xa(u,s)||(u=Zv(),Ci.lanes|=u,Jc|=u,i.baseState=!0),s):(i.baseState&&(i.baseState=!1,rs=!0),i.memoizedState=u)}function mS(i,s){var u=ti;ti=u!==0&&4>u?u:4,i(!0);var y=Pm.transition;Pm.transition={};try{i(!1),s()}finally{ti=u,Pm.transition=y}}function V1(){return Hs().memoizedState}function gS(i,s,u){var y=Hl(i);if(u={lane:y,action:u,hasEagerState:!1,eagerState:null,next:null},U1(i))q1(s,u);else if(u=k1(i,s,u,y),u!==null){var x=Zn();va(u,i,y,x),G1(u,s,y)}}function yS(i,s,u){var y=Hl(i),x={lane:y,action:u,hasEagerState:!1,eagerState:null,next:null};if(U1(i))q1(s,x);else{var C=i.alternate;if(i.lanes===0&&(C===null||C.lanes===0)&&(C=s.lastRenderedReducer,C!==null))try{var S=s.lastRenderedState,d=C(S,u);if(x.hasEagerState=!0,x.eagerState=d,xa(d,S)){var V=s.interleaved;V===null?(x.next=x,iy(s)):(x.next=V.next,V.next=x),s.interleaved=x;return}}catch{}finally{}u=k1(i,s,x,y),u!==null&&(x=Zn(),va(u,i,y,x),G1(u,s,y))}}function U1(i){var s=i.alternate;return i===Ci||s!==null&&s===Ci}function q1(i,s){md=tf=!0;var u=i.pending;u===null?s.next=s:(s.next=u.next,u.next=s),i.pending=s}function G1(i,s,u){if(u&4194240){var y=s.lanes;y&=i.pendingLanes,u|=y,s.lanes=u,Ug(i,u)}}var rf={readContext:Zs,useCallback:Ln,useContext:Ln,useEffect:Ln,useImperativeHandle:Ln,useInsertionEffect:Ln,useLayoutEffect:Ln,useMemo:Ln,useReducer:Ln,useRef:Ln,useState:Ln,useDebugValue:Ln,useDeferredValue:Ln,useTransition:Ln,useMutableSource:Ln,useSyncExternalStore:Ln,useId:Ln,unstable_isNewReconciler:!1},_S={readContext:Zs,useCallback:function(i,s){return Xa().memoizedState=[i,s===void 0?null:s],i},useContext:Zs,useEffect:D0,useImperativeHandle:function(i,s,u){return u=u!=null?u.concat([i]):null,Dp(4194308,4,B1.bind(null,s,i),u)},useLayoutEffect:function(i,s){return Dp(4194308,4,i,s)},useInsertionEffect:function(i,s){return Dp(4,2,i,s)},useMemo:function(i,s){var u=Xa();return s=s===void 0?null:s,i=i(),u.memoizedState=[i,s],i},useReducer:function(i,s,u){var y=Xa();return s=u!==void 0?u(s):s,y.memoizedState=y.baseState=s,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:s},y.queue=i,i=i.dispatch=gS.bind(null,Ci,i),[y.memoizedState,i]},useRef:function(i){var s=Xa();return i={current:i},s.memoizedState=i},useState:z0,useDebugValue:dy,useDeferredValue:function(i){return Xa().memoizedState=i},useTransition:function(){var i=z0(!1),s=i[0];return i=mS.bind(null,i[1]),Xa().memoizedState=i,[s,i]},useMutableSource:function(){},useSyncExternalStore:function(i,s,u){var y=Ci,x=Xa();if(vi){if(u===void 0)throw Error(at(407));u=u()}else{if(u=s(),mn===null)throw Error(at(349));Yc&30||P1(y,s,u)}x.memoizedState=u;var C={value:u,getSnapshot:s};return x.queue=C,D0(M1.bind(null,y,C,i),[i]),y.flags|=2048,Rd(9,A1.bind(null,y,C,u,s),void 0,null),u},useId:function(){var i=Xa(),s=mn.identifierPrefix;if(vi){var u=Do,y=zo;u=(y&~(1<<32-_a(y)-1)).toString(32)+u,s=":"+s+"R"+u,u=Dd++,0<u&&(s+="H"+u.toString(32)),s+=":"}else u=fS++,s=":"+s+"r"+u.toString(32)+":";return i.memoizedState=s},unstable_isNewReconciler:!1},vS={readContext:Zs,useCallback:O1,useContext:Zs,useEffect:hy,useImperativeHandle:N1,useInsertionEffect:R1,useLayoutEffect:F1,useMemo:$1,useReducer:Am,useRef:L1,useState:function(){return Am(Ld)},useDebugValue:dy,useDeferredValue:function(i){var s=Hs();return j1(s,nn.memoizedState,i)},useTransition:function(){var i=Am(Ld)[0],s=Hs().memoizedState;return[i,s]},useMutableSource:I1,useSyncExternalStore:E1,useId:V1,unstable_isNewReconciler:!1},xS={readContext:Zs,useCallback:O1,useContext:Zs,useEffect:hy,useImperativeHandle:N1,useInsertionEffect:R1,useLayoutEffect:F1,useMemo:$1,useReducer:Mm,useRef:L1,useState:function(){return Mm(Ld)},useDebugValue:dy,useDeferredValue:function(i){var s=Hs();return nn===null?s.memoizedState=i:j1(s,nn.memoizedState,i)},useTransition:function(){var i=Mm(Ld)[0],s=Hs().memoizedState;return[i,s]},useMutableSource:I1,useSyncExternalStore:E1,useId:V1,unstable_isNewReconciler:!1};function ma(i,s){if(i&&i.defaultProps){s=Ti({},s),i=i.defaultProps;for(var u in i)s[u]===void 0&&(s[u]=i[u]);return s}return s}function fg(i,s,u,y){s=i.memoizedState,u=u(y,s),u=u==null?s:Ti({},s,u),i.memoizedState=u,i.lanes===0&&(i.updateQueue.baseState=u)}var xf={isMounted:function(i){return(i=i._reactInternals)?tu(i)===i:!1},enqueueSetState:function(i,s,u){i=i._reactInternals;var y=Zn(),x=Hl(i),C=Lo(y,x);C.payload=s,u!=null&&(C.callback=u),s=Gl(i,C,x),s!==null&&(va(s,i,x,y),Mp(s,i,x))},enqueueReplaceState:function(i,s,u){i=i._reactInternals;var y=Zn(),x=Hl(i),C=Lo(y,x);C.tag=1,C.payload=s,u!=null&&(C.callback=u),s=Gl(i,C,x),s!==null&&(va(s,i,x,y),Mp(s,i,x))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var u=Zn(),y=Hl(i),x=Lo(u,y);x.tag=2,s!=null&&(x.callback=s),s=Gl(i,x,y),s!==null&&(va(s,i,y,u),Mp(s,i,y))}};function L0(i,s,u,y,x,C,S){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(y,C,S):s.prototype&&s.prototype.isPureReactComponent?!Id(u,y)||!Id(x,C):!0}function Z1(i,s,u){var y=!1,x=Yl,C=s.contextType;return typeof C=="object"&&C!==null?C=Zs(C):(x=ns(s)?Kc:Bn.current,y=s.contextTypes,C=(y=y!=null)?ch(i,x):Yl),s=new s(u,C),i.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=xf,i.stateNode=s,s._reactInternals=i,y&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=x,i.__reactInternalMemoizedMaskedChildContext=C),s}function R0(i,s,u,y){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(u,y),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(u,y),s.state!==i&&xf.enqueueReplaceState(s,s.state,null)}function mg(i,s,u,y){var x=i.stateNode;x.props=u,x.state=i.memoizedState,x.refs={},ny(i);var C=s.contextType;typeof C=="object"&&C!==null?x.context=Zs(C):(C=ns(s)?Kc:Bn.current,x.context=ch(i,C)),x.state=i.memoizedState,C=s.getDerivedStateFromProps,typeof C=="function"&&(fg(i,s,C,u),x.state=i.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(s=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),s!==x.state&&xf.enqueueReplaceState(x,x.state,null),Qp(i,u,x,y),x.state=i.memoizedState),typeof x.componentDidMount=="function"&&(i.flags|=4194308)}function ph(i,s){try{var u="",y=s;do u+=Ww(y),y=y.return;while(y);var x=u}catch(C){x=`
Error generating stack: `+C.message+`
`+C.stack}return{value:i,source:s,stack:x,digest:null}}function zm(i,s,u){return{value:i,source:null,stack:u??null,digest:s??null}}function gg(i,s){try{console.error(s.value)}catch(u){setTimeout(function(){throw u})}}var bS=typeof WeakMap=="function"?WeakMap:Map;function H1(i,s,u){u=Lo(-1,u),u.tag=3,u.payload={element:null};var y=s.value;return u.callback=function(){sf||(sf=!0,Tg=y),gg(i,s)},u}function W1(i,s,u){u=Lo(-1,u),u.tag=3;var y=i.type.getDerivedStateFromError;if(typeof y=="function"){var x=s.value;u.payload=function(){return y(x)},u.callback=function(){gg(i,s)}}var C=i.stateNode;return C!==null&&typeof C.componentDidCatch=="function"&&(u.callback=function(){gg(i,s),typeof y!="function"&&(Zl===null?Zl=new Set([this]):Zl.add(this));var S=s.stack;this.componentDidCatch(s.value,{componentStack:S!==null?S:""})}),u}function F0(i,s,u){var y=i.pingCache;if(y===null){y=i.pingCache=new bS;var x=new Set;y.set(s,x)}else x=y.get(s),x===void 0&&(x=new Set,y.set(s,x));x.has(u)||(x.add(u),i=RS.bind(null,i,s,u),s.then(i,i))}function B0(i){do{var s;if((s=i.tag===13)&&(s=i.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return i;i=i.return}while(i!==null);return null}function N0(i,s,u,y,x){return i.mode&1?(i.flags|=65536,i.lanes=x,i):(i===s?i.flags|=65536:(i.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(s=Lo(-1,1),s.tag=2,Gl(u,s,1))),u.lanes|=1),i)}var wS=Oo.ReactCurrentOwner,rs=!1;function Gn(i,s,u,y){s.child=i===null?S1(s,null,u,y):hh(s,i.child,u,y)}function O0(i,s,u,y,x){u=u.render;var C=s.ref;return ah(s,x),y=cy(i,s,u,y,C,x),u=uy(),i!==null&&!rs?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~x,No(i,s,x)):(vi&&u&&Yg(s),s.flags|=1,Gn(i,s,y,x),s.child)}function $0(i,s,u,y,x){if(i===null){var C=u.type;return typeof C=="function"&&!xy(C)&&C.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(s.tag=15,s.type=C,K1(i,s,C,y,x)):(i=Bp(u.type,null,y,s,s.mode,x),i.ref=s.ref,i.return=s,s.child=i)}if(C=i.child,!(i.lanes&x)){var S=C.memoizedProps;if(u=u.compare,u=u!==null?u:Id,u(S,y)&&i.ref===s.ref)return No(i,s,x)}return s.flags|=1,i=Wl(C,y),i.ref=s.ref,i.return=s,s.child=i}function K1(i,s,u,y,x){if(i!==null){var C=i.memoizedProps;if(Id(C,y)&&i.ref===s.ref)if(rs=!1,s.pendingProps=y=C,(i.lanes&x)!==0)i.flags&131072&&(rs=!0);else return s.lanes=i.lanes,No(i,s,x)}return yg(i,s,u,y,x)}function X1(i,s,u){var y=s.pendingProps,x=y.children,C=i!==null?i.memoizedState:null;if(y.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},oi(th,ws),ws|=u;else{if(!(u&1073741824))return i=C!==null?C.baseLanes|u:u,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:i,cachePool:null,transitions:null},s.updateQueue=null,oi(th,ws),ws|=i,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=C!==null?C.baseLanes:u,oi(th,ws),ws|=y}else C!==null?(y=C.baseLanes|u,s.memoizedState=null):y=u,oi(th,ws),ws|=y;return Gn(i,s,x,u),s.child}function Y1(i,s){var u=s.ref;(i===null&&u!==null||i!==null&&i.ref!==u)&&(s.flags|=512,s.flags|=2097152)}function yg(i,s,u,y,x){var C=ns(u)?Kc:Bn.current;return C=ch(s,C),ah(s,x),u=cy(i,s,u,y,C,x),y=uy(),i!==null&&!rs?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~x,No(i,s,x)):(vi&&y&&Yg(s),s.flags|=1,Gn(i,s,u,x),s.child)}function j0(i,s,u,y,x){if(ns(u)){var C=!0;Wp(s)}else C=!1;if(ah(s,x),s.stateNode===null)Lp(i,s),Z1(s,u,y),mg(s,u,y,x),y=!0;else if(i===null){var S=s.stateNode,d=s.memoizedProps;S.props=d;var V=S.context,ee=u.contextType;typeof ee=="object"&&ee!==null?ee=Zs(ee):(ee=ns(u)?Kc:Bn.current,ee=ch(s,ee));var Te=u.getDerivedStateFromProps,ie=typeof Te=="function"||typeof S.getSnapshotBeforeUpdate=="function";ie||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==y||V!==ee)&&R0(s,S,y,ee),Ll=!1;var G=s.memoizedState;S.state=G,Qp(s,y,S,x),V=s.memoizedState,d!==y||G!==V||is.current||Ll?(typeof Te=="function"&&(fg(s,u,Te,y),V=s.memoizedState),(d=Ll||L0(s,u,d,y,G,V,ee))?(ie||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(s.flags|=4194308)):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=y,s.memoizedState=V),S.props=y,S.state=V,S.context=ee,y=d):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),y=!1)}else{S=s.stateNode,C1(i,s),d=s.memoizedProps,ee=s.type===s.elementType?d:ma(s.type,d),S.props=ee,ie=s.pendingProps,G=S.context,V=u.contextType,typeof V=="object"&&V!==null?V=Zs(V):(V=ns(u)?Kc:Bn.current,V=ch(s,V));var He=u.getDerivedStateFromProps;(Te=typeof He=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==ie||G!==V)&&R0(s,S,y,V),Ll=!1,G=s.memoizedState,S.state=G,Qp(s,y,S,x);var Ke=s.memoizedState;d!==ie||G!==Ke||is.current||Ll?(typeof He=="function"&&(fg(s,u,He,y),Ke=s.memoizedState),(ee=Ll||L0(s,u,ee,y,G,Ke,V)||!1)?(Te||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(y,Ke,V),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(y,Ke,V)),typeof S.componentDidUpdate=="function"&&(s.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(s.flags|=1024),s.memoizedProps=y,s.memoizedState=Ke),S.props=y,S.state=Ke,S.context=V,y=ee):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(s.flags|=1024),y=!1)}return _g(i,s,u,y,C,x)}function _g(i,s,u,y,x,C){Y1(i,s);var S=(s.flags&128)!==0;if(!y&&!S)return x&&T0(s,u,!1),No(i,s,C);y=s.stateNode,wS.current=s;var d=S&&typeof u.getDerivedStateFromError!="function"?null:y.render();return s.flags|=1,i!==null&&S?(s.child=hh(s,i.child,null,C),s.child=hh(s,null,d,C)):Gn(i,s,d,C),s.memoizedState=y.state,x&&T0(s,u,!0),s.child}function J1(i){var s=i.stateNode;s.pendingContext?C0(i,s.pendingContext,s.pendingContext!==s.context):s.context&&C0(i,s.context,!1),sy(i,s.containerInfo)}function V0(i,s,u,y,x){return uh(),Qg(x),s.flags|=256,Gn(i,s,u,y),s.child}var vg={dehydrated:null,treeContext:null,retryLane:0};function xg(i){return{baseLanes:i,cachePool:null,transitions:null}}function Q1(i,s,u){var y=s.pendingProps,x=ki.current,C=!1,S=(s.flags&128)!==0,d;if((d=S)||(d=i!==null&&i.memoizedState===null?!1:(x&2)!==0),d?(C=!0,s.flags&=-129):(i===null||i.memoizedState!==null)&&(x|=1),oi(ki,x&1),i===null)return dg(s),i=s.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(s.mode&1?i.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(S=y.children,i=y.fallback,C?(y=s.mode,C=s.child,S={mode:"hidden",children:S},!(y&1)&&C!==null?(C.childLanes=0,C.pendingProps=S):C=Sf(S,y,0,null),i=Wc(i,y,u,null),C.return=s,i.return=s,C.sibling=i,s.child=C,s.child.memoizedState=xg(u),s.memoizedState=vg,i):py(s,S));if(x=i.memoizedState,x!==null&&(d=x.dehydrated,d!==null))return SS(i,s,S,y,d,x,u);if(C){C=y.fallback,S=s.mode,x=i.child,d=x.sibling;var V={mode:"hidden",children:y.children};return!(S&1)&&s.child!==x?(y=s.child,y.childLanes=0,y.pendingProps=V,s.deletions=null):(y=Wl(x,V),y.subtreeFlags=x.subtreeFlags&14680064),d!==null?C=Wl(d,C):(C=Wc(C,S,u,null),C.flags|=2),C.return=s,y.return=s,y.sibling=C,s.child=y,y=C,C=s.child,S=i.child.memoizedState,S=S===null?xg(u):{baseLanes:S.baseLanes|u,cachePool:null,transitions:S.transitions},C.memoizedState=S,C.childLanes=i.childLanes&~u,s.memoizedState=vg,y}return C=i.child,i=C.sibling,y=Wl(C,{mode:"visible",children:y.children}),!(s.mode&1)&&(y.lanes=u),y.return=s,y.sibling=null,i!==null&&(u=s.deletions,u===null?(s.deletions=[i],s.flags|=16):u.push(i)),s.child=y,s.memoizedState=null,y}function py(i,s){return s=Sf({mode:"visible",children:s},i.mode,0,null),s.return=i,i.child=s}function bp(i,s,u,y){return y!==null&&Qg(y),hh(s,i.child,null,u),i=py(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function SS(i,s,u,y,x,C,S){if(u)return s.flags&256?(s.flags&=-257,y=zm(Error(at(422))),bp(i,s,S,y)):s.memoizedState!==null?(s.child=i.child,s.flags|=128,null):(C=y.fallback,x=s.mode,y=Sf({mode:"visible",children:y.children},x,0,null),C=Wc(C,x,S,null),C.flags|=2,y.return=s,C.return=s,y.sibling=C,s.child=y,s.mode&1&&hh(s,i.child,null,S),s.child.memoizedState=xg(S),s.memoizedState=vg,C);if(!(s.mode&1))return bp(i,s,S,null);if(x.data==="$!"){if(y=x.nextSibling&&x.nextSibling.dataset,y)var d=y.dgst;return y=d,C=Error(at(419)),y=zm(C,y,void 0),bp(i,s,S,y)}if(d=(S&i.childLanes)!==0,rs||d){if(y=mn,y!==null){switch(S&-S){case 4:x=2;break;case 16:x=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:x=32;break;case 536870912:x=268435456;break;default:x=0}x=x&(y.suspendedLanes|S)?0:x,x!==0&&x!==C.retryLane&&(C.retryLane=x,Bo(i,x),va(y,i,x,-1))}return vy(),y=zm(Error(at(421))),bp(i,s,S,y)}return x.data==="$?"?(s.flags|=128,s.child=i.child,s=FS.bind(null,i),x._reactRetry=s,null):(i=C.treeContext,Ss=ql(x.nextSibling),ks=s,vi=!0,ya=null,i!==null&&(Vs[Us++]=zo,Vs[Us++]=Do,Vs[Us++]=Xc,zo=i.id,Do=i.overflow,Xc=s),s=py(s,y.children),s.flags|=4096,s)}function U0(i,s,u){i.lanes|=s;var y=i.alternate;y!==null&&(y.lanes|=s),pg(i.return,s,u)}function Dm(i,s,u,y,x){var C=i.memoizedState;C===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:y,tail:u,tailMode:x}:(C.isBackwards=s,C.rendering=null,C.renderingStartTime=0,C.last=y,C.tail=u,C.tailMode=x)}function ex(i,s,u){var y=s.pendingProps,x=y.revealOrder,C=y.tail;if(Gn(i,s,y.children,u),y=ki.current,y&2)y=y&1|2,s.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&U0(i,u,s);else if(i.tag===19)U0(i,u,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}y&=1}if(oi(ki,y),!(s.mode&1))s.memoizedState=null;else switch(x){case"forwards":for(u=s.child,x=null;u!==null;)i=u.alternate,i!==null&&ef(i)===null&&(x=u),u=u.sibling;u=x,u===null?(x=s.child,s.child=null):(x=u.sibling,u.sibling=null),Dm(s,!1,x,u,C);break;case"backwards":for(u=null,x=s.child,s.child=null;x!==null;){if(i=x.alternate,i!==null&&ef(i)===null){s.child=x;break}i=x.sibling,x.sibling=u,u=x,x=i}Dm(s,!0,u,null,C);break;case"together":Dm(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Lp(i,s){!(s.mode&1)&&i!==null&&(i.alternate=null,s.alternate=null,s.flags|=2)}function No(i,s,u){if(i!==null&&(s.dependencies=i.dependencies),Jc|=s.lanes,!(u&s.childLanes))return null;if(i!==null&&s.child!==i.child)throw Error(at(153));if(s.child!==null){for(i=s.child,u=Wl(i,i.pendingProps),s.child=u,u.return=s;i.sibling!==null;)i=i.sibling,u=u.sibling=Wl(i,i.pendingProps),u.return=s;u.sibling=null}return s.child}function kS(i,s,u){switch(s.tag){case 3:J1(s),uh();break;case 5:T1(s);break;case 1:ns(s.type)&&Wp(s);break;case 4:sy(s,s.stateNode.containerInfo);break;case 10:var y=s.type._context,x=s.memoizedProps.value;oi(Yp,y._currentValue),y._currentValue=x;break;case 13:if(y=s.memoizedState,y!==null)return y.dehydrated!==null?(oi(ki,ki.current&1),s.flags|=128,null):u&s.child.childLanes?Q1(i,s,u):(oi(ki,ki.current&1),i=No(i,s,u),i!==null?i.sibling:null);oi(ki,ki.current&1);break;case 19:if(y=(u&s.childLanes)!==0,i.flags&128){if(y)return ex(i,s,u);s.flags|=128}if(x=s.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),oi(ki,ki.current),y)break;return null;case 22:case 23:return s.lanes=0,X1(i,s,u)}return No(i,s,u)}var tx,bg,rx,ix;tx=function(i,s){for(var u=s.child;u!==null;){if(u.tag===5||u.tag===6)i.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===s)break;for(;u.sibling===null;){if(u.return===null||u.return===s)return;u=u.return}u.sibling.return=u.return,u=u.sibling}};bg=function(){};rx=function(i,s,u,y){var x=i.memoizedProps;if(x!==y){i=s.stateNode,Zc(Qa.current);var C=null;switch(u){case"input":x=Um(i,x),y=Um(i,y),C=[];break;case"select":x=Ti({},x,{value:void 0}),y=Ti({},y,{value:void 0}),C=[];break;case"textarea":x=Zm(i,x),y=Zm(i,y),C=[];break;default:typeof x.onClick!="function"&&typeof y.onClick=="function"&&(i.onclick=Zp)}Wm(u,y);var S;u=null;for(ee in x)if(!y.hasOwnProperty(ee)&&x.hasOwnProperty(ee)&&x[ee]!=null)if(ee==="style"){var d=x[ee];for(S in d)d.hasOwnProperty(S)&&(u||(u={}),u[S]="")}else ee!=="dangerouslySetInnerHTML"&&ee!=="children"&&ee!=="suppressContentEditableWarning"&&ee!=="suppressHydrationWarning"&&ee!=="autoFocus"&&(xd.hasOwnProperty(ee)?C||(C=[]):(C=C||[]).push(ee,null));for(ee in y){var V=y[ee];if(d=x!=null?x[ee]:void 0,y.hasOwnProperty(ee)&&V!==d&&(V!=null||d!=null))if(ee==="style")if(d){for(S in d)!d.hasOwnProperty(S)||V&&V.hasOwnProperty(S)||(u||(u={}),u[S]="");for(S in V)V.hasOwnProperty(S)&&d[S]!==V[S]&&(u||(u={}),u[S]=V[S])}else u||(C||(C=[]),C.push(ee,u)),u=V;else ee==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,d=d?d.__html:void 0,V!=null&&d!==V&&(C=C||[]).push(ee,V)):ee==="children"?typeof V!="string"&&typeof V!="number"||(C=C||[]).push(ee,""+V):ee!=="suppressContentEditableWarning"&&ee!=="suppressHydrationWarning"&&(xd.hasOwnProperty(ee)?(V!=null&&ee==="onScroll"&&hi("scroll",i),C||d===V||(C=[])):(C=C||[]).push(ee,V))}u&&(C=C||[]).push("style",u);var ee=C;(s.updateQueue=ee)&&(s.flags|=4)}};ix=function(i,s,u,y){u!==y&&(s.flags|=4)};function nd(i,s){if(!vi)switch(i.tailMode){case"hidden":s=i.tail;for(var u=null;s!==null;)s.alternate!==null&&(u=s),s=s.sibling;u===null?i.tail=null:u.sibling=null;break;case"collapsed":u=i.tail;for(var y=null;u!==null;)u.alternate!==null&&(y=u),u=u.sibling;y===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:y.sibling=null}}function Rn(i){var s=i.alternate!==null&&i.alternate.child===i.child,u=0,y=0;if(s)for(var x=i.child;x!==null;)u|=x.lanes|x.childLanes,y|=x.subtreeFlags&14680064,y|=x.flags&14680064,x.return=i,x=x.sibling;else for(x=i.child;x!==null;)u|=x.lanes|x.childLanes,y|=x.subtreeFlags,y|=x.flags,x.return=i,x=x.sibling;return i.subtreeFlags|=y,i.childLanes=u,s}function CS(i,s,u){var y=s.pendingProps;switch(Jg(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rn(s),null;case 1:return ns(s.type)&&Hp(),Rn(s),null;case 3:return y=s.stateNode,dh(),di(is),di(Bn),oy(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(i===null||i.child===null)&&(vp(s)?s.flags|=4:i===null||i.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,ya!==null&&(Pg(ya),ya=null))),bg(i,s),Rn(s),null;case 5:ay(s);var x=Zc(zd.current);if(u=s.type,i!==null&&s.stateNode!=null)rx(i,s,u,y,x),i.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!y){if(s.stateNode===null)throw Error(at(166));return Rn(s),null}if(i=Zc(Qa.current),vp(s)){y=s.stateNode,u=s.type;var C=s.memoizedProps;switch(y[Ya]=s,y[Ad]=C,i=(s.mode&1)!==0,u){case"dialog":hi("cancel",y),hi("close",y);break;case"iframe":case"object":case"embed":hi("load",y);break;case"video":case"audio":for(x=0;x<cd.length;x++)hi(cd[x],y);break;case"source":hi("error",y);break;case"img":case"image":case"link":hi("error",y),hi("load",y);break;case"details":hi("toggle",y);break;case"input":J_(y,C),hi("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!C.multiple},hi("invalid",y);break;case"textarea":e0(y,C),hi("invalid",y)}Wm(u,C),x=null;for(var S in C)if(C.hasOwnProperty(S)){var d=C[S];S==="children"?typeof d=="string"?y.textContent!==d&&(C.suppressHydrationWarning!==!0&&_p(y.textContent,d,i),x=["children",d]):typeof d=="number"&&y.textContent!==""+d&&(C.suppressHydrationWarning!==!0&&_p(y.textContent,d,i),x=["children",""+d]):xd.hasOwnProperty(S)&&d!=null&&S==="onScroll"&&hi("scroll",y)}switch(u){case"input":up(y),Q_(y,C,!0);break;case"textarea":up(y),t0(y);break;case"select":case"option":break;default:typeof C.onClick=="function"&&(y.onclick=Zp)}y=x,s.updateQueue=y,y!==null&&(s.flags|=4)}else{S=x.nodeType===9?x:x.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=Mv(u)),i==="http://www.w3.org/1999/xhtml"?u==="script"?(i=S.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof y.is=="string"?i=S.createElement(u,{is:y.is}):(i=S.createElement(u),u==="select"&&(S=i,y.multiple?S.multiple=!0:y.size&&(S.size=y.size))):i=S.createElementNS(i,u),i[Ya]=s,i[Ad]=y,tx(i,s,!1,!1),s.stateNode=i;e:{switch(S=Km(u,y),u){case"dialog":hi("cancel",i),hi("close",i),x=y;break;case"iframe":case"object":case"embed":hi("load",i),x=y;break;case"video":case"audio":for(x=0;x<cd.length;x++)hi(cd[x],i);x=y;break;case"source":hi("error",i),x=y;break;case"img":case"image":case"link":hi("error",i),hi("load",i),x=y;break;case"details":hi("toggle",i),x=y;break;case"input":J_(i,y),x=Um(i,y),hi("invalid",i);break;case"option":x=y;break;case"select":i._wrapperState={wasMultiple:!!y.multiple},x=Ti({},y,{value:void 0}),hi("invalid",i);break;case"textarea":e0(i,y),x=Zm(i,y),hi("invalid",i);break;default:x=y}Wm(u,x),d=x;for(C in d)if(d.hasOwnProperty(C)){var V=d[C];C==="style"?Lv(i,V):C==="dangerouslySetInnerHTML"?(V=V?V.__html:void 0,V!=null&&zv(i,V)):C==="children"?typeof V=="string"?(u!=="textarea"||V!=="")&&bd(i,V):typeof V=="number"&&bd(i,""+V):C!=="suppressContentEditableWarning"&&C!=="suppressHydrationWarning"&&C!=="autoFocus"&&(xd.hasOwnProperty(C)?V!=null&&C==="onScroll"&&hi("scroll",i):V!=null&&Bg(i,C,V,S))}switch(u){case"input":up(i),Q_(i,y,!1);break;case"textarea":up(i),t0(i);break;case"option":y.value!=null&&i.setAttribute("value",""+Xl(y.value));break;case"select":i.multiple=!!y.multiple,C=y.value,C!=null?rh(i,!!y.multiple,C,!1):y.defaultValue!=null&&rh(i,!!y.multiple,y.defaultValue,!0);break;default:typeof x.onClick=="function"&&(i.onclick=Zp)}switch(u){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}}y&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return Rn(s),null;case 6:if(i&&s.stateNode!=null)ix(i,s,i.memoizedProps,y);else{if(typeof y!="string"&&s.stateNode===null)throw Error(at(166));if(u=Zc(zd.current),Zc(Qa.current),vp(s)){if(y=s.stateNode,u=s.memoizedProps,y[Ya]=s,(C=y.nodeValue!==u)&&(i=ks,i!==null))switch(i.tag){case 3:_p(y.nodeValue,u,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&_p(y.nodeValue,u,(i.mode&1)!==0)}C&&(s.flags|=4)}else y=(u.nodeType===9?u:u.ownerDocument).createTextNode(y),y[Ya]=s,s.stateNode=y}return Rn(s),null;case 13:if(di(ki),y=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(vi&&Ss!==null&&s.mode&1&&!(s.flags&128))b1(),uh(),s.flags|=98560,C=!1;else if(C=vp(s),y!==null&&y.dehydrated!==null){if(i===null){if(!C)throw Error(at(318));if(C=s.memoizedState,C=C!==null?C.dehydrated:null,!C)throw Error(at(317));C[Ya]=s}else uh(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;Rn(s),C=!1}else ya!==null&&(Pg(ya),ya=null),C=!0;if(!C)return s.flags&65536?s:null}return s.flags&128?(s.lanes=u,s):(y=y!==null,y!==(i!==null&&i.memoizedState!==null)&&y&&(s.child.flags|=8192,s.mode&1&&(i===null||ki.current&1?sn===0&&(sn=3):vy())),s.updateQueue!==null&&(s.flags|=4),Rn(s),null);case 4:return dh(),bg(i,s),i===null&&Ed(s.stateNode.containerInfo),Rn(s),null;case 10:return ry(s.type._context),Rn(s),null;case 17:return ns(s.type)&&Hp(),Rn(s),null;case 19:if(di(ki),C=s.memoizedState,C===null)return Rn(s),null;if(y=(s.flags&128)!==0,S=C.rendering,S===null)if(y)nd(C,!1);else{if(sn!==0||i!==null&&i.flags&128)for(i=s.child;i!==null;){if(S=ef(i),S!==null){for(s.flags|=128,nd(C,!1),y=S.updateQueue,y!==null&&(s.updateQueue=y,s.flags|=4),s.subtreeFlags=0,y=u,u=s.child;u!==null;)C=u,i=y,C.flags&=14680066,S=C.alternate,S===null?(C.childLanes=0,C.lanes=i,C.child=null,C.subtreeFlags=0,C.memoizedProps=null,C.memoizedState=null,C.updateQueue=null,C.dependencies=null,C.stateNode=null):(C.childLanes=S.childLanes,C.lanes=S.lanes,C.child=S.child,C.subtreeFlags=0,C.deletions=null,C.memoizedProps=S.memoizedProps,C.memoizedState=S.memoizedState,C.updateQueue=S.updateQueue,C.type=S.type,i=S.dependencies,C.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),u=u.sibling;return oi(ki,ki.current&1|2),s.child}i=i.sibling}C.tail!==null&&ji()>fh&&(s.flags|=128,y=!0,nd(C,!1),s.lanes=4194304)}else{if(!y)if(i=ef(S),i!==null){if(s.flags|=128,y=!0,u=i.updateQueue,u!==null&&(s.updateQueue=u,s.flags|=4),nd(C,!0),C.tail===null&&C.tailMode==="hidden"&&!S.alternate&&!vi)return Rn(s),null}else 2*ji()-C.renderingStartTime>fh&&u!==1073741824&&(s.flags|=128,y=!0,nd(C,!1),s.lanes=4194304);C.isBackwards?(S.sibling=s.child,s.child=S):(u=C.last,u!==null?u.sibling=S:s.child=S,C.last=S)}return C.tail!==null?(s=C.tail,C.rendering=s,C.tail=s.sibling,C.renderingStartTime=ji(),s.sibling=null,u=ki.current,oi(ki,y?u&1|2:u&1),s):(Rn(s),null);case 22:case 23:return _y(),y=s.memoizedState!==null,i!==null&&i.memoizedState!==null!==y&&(s.flags|=8192),y&&s.mode&1?ws&1073741824&&(Rn(s),s.subtreeFlags&6&&(s.flags|=8192)):Rn(s),null;case 24:return null;case 25:return null}throw Error(at(156,s.tag))}function TS(i,s){switch(Jg(s),s.tag){case 1:return ns(s.type)&&Hp(),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return dh(),di(is),di(Bn),oy(),i=s.flags,i&65536&&!(i&128)?(s.flags=i&-65537|128,s):null;case 5:return ay(s),null;case 13:if(di(ki),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(at(340));uh()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return di(ki),null;case 4:return dh(),null;case 10:return ry(s.type._context),null;case 22:case 23:return _y(),null;case 24:return null;default:return null}}var wp=!1,Fn=!1,IS=typeof WeakSet=="function"?WeakSet:Set,Rt=null;function eh(i,s){var u=i.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(y){Di(i,s,y)}else u.current=null}function wg(i,s,u){try{u()}catch(y){Di(i,s,y)}}var q0=!1;function ES(i,s){if(sg=Up,i=l1(),Xg(i)){if("selectionStart"in i)var u={start:i.selectionStart,end:i.selectionEnd};else e:{u=(u=i.ownerDocument)&&u.defaultView||window;var y=u.getSelection&&u.getSelection();if(y&&y.rangeCount!==0){u=y.anchorNode;var x=y.anchorOffset,C=y.focusNode;y=y.focusOffset;try{u.nodeType,C.nodeType}catch{u=null;break e}var S=0,d=-1,V=-1,ee=0,Te=0,ie=i,G=null;t:for(;;){for(var He;ie!==u||x!==0&&ie.nodeType!==3||(d=S+x),ie!==C||y!==0&&ie.nodeType!==3||(V=S+y),ie.nodeType===3&&(S+=ie.nodeValue.length),(He=ie.firstChild)!==null;)G=ie,ie=He;for(;;){if(ie===i)break t;if(G===u&&++ee===x&&(d=S),G===C&&++Te===y&&(V=S),(He=ie.nextSibling)!==null)break;ie=G,G=ie.parentNode}ie=He}u=d===-1||V===-1?null:{start:d,end:V}}else u=null}u=u||{start:0,end:0}}else u=null;for(ag={focusedElem:i,selectionRange:u},Up=!1,Rt=s;Rt!==null;)if(s=Rt,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,Rt=i;else for(;Rt!==null;){s=Rt;try{var Ke=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(Ke!==null){var ke=Ke.memoizedProps,ht=Ke.memoizedState,pe=s.stateNode,oe=pe.getSnapshotBeforeUpdate(s.elementType===s.type?ke:ma(s.type,ke),ht);pe.__reactInternalSnapshotBeforeUpdate=oe}break;case 3:var me=s.stateNode.containerInfo;me.nodeType===1?me.textContent="":me.nodeType===9&&me.documentElement&&me.removeChild(me.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(at(163))}}catch(De){Di(s,s.return,De)}if(i=s.sibling,i!==null){i.return=s.return,Rt=i;break}Rt=s.return}return Ke=q0,q0=!1,Ke}function gd(i,s,u){var y=s.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var x=y=y.next;do{if((x.tag&i)===i){var C=x.destroy;x.destroy=void 0,C!==void 0&&wg(s,u,C)}x=x.next}while(x!==y)}}function bf(i,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var u=s=s.next;do{if((u.tag&i)===i){var y=u.create;u.destroy=y()}u=u.next}while(u!==s)}}function Sg(i){var s=i.ref;if(s!==null){var u=i.stateNode;switch(i.tag){case 5:i=u;break;default:i=u}typeof s=="function"?s(i):s.current=i}}function nx(i){var s=i.alternate;s!==null&&(i.alternate=null,nx(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&(delete s[Ya],delete s[Ad],delete s[cg],delete s[uS],delete s[hS])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function sx(i){return i.tag===5||i.tag===3||i.tag===4}function G0(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||sx(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function kg(i,s,u){var y=i.tag;if(y===5||y===6)i=i.stateNode,s?u.nodeType===8?u.parentNode.insertBefore(i,s):u.insertBefore(i,s):(u.nodeType===8?(s=u.parentNode,s.insertBefore(i,u)):(s=u,s.appendChild(i)),u=u._reactRootContainer,u!=null||s.onclick!==null||(s.onclick=Zp));else if(y!==4&&(i=i.child,i!==null))for(kg(i,s,u),i=i.sibling;i!==null;)kg(i,s,u),i=i.sibling}function Cg(i,s,u){var y=i.tag;if(y===5||y===6)i=i.stateNode,s?u.insertBefore(i,s):u.appendChild(i);else if(y!==4&&(i=i.child,i!==null))for(Cg(i,s,u),i=i.sibling;i!==null;)Cg(i,s,u),i=i.sibling}var In=null,ga=!1;function zl(i,s,u){for(u=u.child;u!==null;)ax(i,s,u),u=u.sibling}function ax(i,s,u){if(Ja&&typeof Ja.onCommitFiberUnmount=="function")try{Ja.onCommitFiberUnmount(pf,u)}catch{}switch(u.tag){case 5:Fn||eh(u,s);case 6:var y=In,x=ga;In=null,zl(i,s,u),In=y,ga=x,In!==null&&(ga?(i=In,u=u.stateNode,i.nodeType===8?i.parentNode.removeChild(u):i.removeChild(u)):In.removeChild(u.stateNode));break;case 18:In!==null&&(ga?(i=In,u=u.stateNode,i.nodeType===8?Tm(i.parentNode,u):i.nodeType===1&&Tm(i,u),Cd(i)):Tm(In,u.stateNode));break;case 4:y=In,x=ga,In=u.stateNode.containerInfo,ga=!0,zl(i,s,u),In=y,ga=x;break;case 0:case 11:case 14:case 15:if(!Fn&&(y=u.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){x=y=y.next;do{var C=x,S=C.destroy;C=C.tag,S!==void 0&&(C&2||C&4)&&wg(u,s,S),x=x.next}while(x!==y)}zl(i,s,u);break;case 1:if(!Fn&&(eh(u,s),y=u.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=u.memoizedProps,y.state=u.memoizedState,y.componentWillUnmount()}catch(d){Di(u,s,d)}zl(i,s,u);break;case 21:zl(i,s,u);break;case 22:u.mode&1?(Fn=(y=Fn)||u.memoizedState!==null,zl(i,s,u),Fn=y):zl(i,s,u);break;default:zl(i,s,u)}}function Z0(i){var s=i.updateQueue;if(s!==null){i.updateQueue=null;var u=i.stateNode;u===null&&(u=i.stateNode=new IS),s.forEach(function(y){var x=BS.bind(null,i,y);u.has(y)||(u.add(y),y.then(x,x))})}}function fa(i,s){var u=s.deletions;if(u!==null)for(var y=0;y<u.length;y++){var x=u[y];try{var C=i,S=s,d=S;e:for(;d!==null;){switch(d.tag){case 5:In=d.stateNode,ga=!1;break e;case 3:In=d.stateNode.containerInfo,ga=!0;break e;case 4:In=d.stateNode.containerInfo,ga=!0;break e}d=d.return}if(In===null)throw Error(at(160));ax(C,S,x),In=null,ga=!1;var V=x.alternate;V!==null&&(V.return=null),x.return=null}catch(ee){Di(x,s,ee)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)ox(s,i),s=s.sibling}function ox(i,s){var u=i.alternate,y=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(fa(s,i),Ka(i),y&4){try{gd(3,i,i.return),bf(3,i)}catch(ke){Di(i,i.return,ke)}try{gd(5,i,i.return)}catch(ke){Di(i,i.return,ke)}}break;case 1:fa(s,i),Ka(i),y&512&&u!==null&&eh(u,u.return);break;case 5:if(fa(s,i),Ka(i),y&512&&u!==null&&eh(u,u.return),i.flags&32){var x=i.stateNode;try{bd(x,"")}catch(ke){Di(i,i.return,ke)}}if(y&4&&(x=i.stateNode,x!=null)){var C=i.memoizedProps,S=u!==null?u.memoizedProps:C,d=i.type,V=i.updateQueue;if(i.updateQueue=null,V!==null)try{d==="input"&&C.type==="radio"&&C.name!=null&&Pv(x,C),Km(d,S);var ee=Km(d,C);for(S=0;S<V.length;S+=2){var Te=V[S],ie=V[S+1];Te==="style"?Lv(x,ie):Te==="dangerouslySetInnerHTML"?zv(x,ie):Te==="children"?bd(x,ie):Bg(x,Te,ie,ee)}switch(d){case"input":qm(x,C);break;case"textarea":Av(x,C);break;case"select":var G=x._wrapperState.wasMultiple;x._wrapperState.wasMultiple=!!C.multiple;var He=C.value;He!=null?rh(x,!!C.multiple,He,!1):G!==!!C.multiple&&(C.defaultValue!=null?rh(x,!!C.multiple,C.defaultValue,!0):rh(x,!!C.multiple,C.multiple?[]:"",!1))}x[Ad]=C}catch(ke){Di(i,i.return,ke)}}break;case 6:if(fa(s,i),Ka(i),y&4){if(i.stateNode===null)throw Error(at(162));x=i.stateNode,C=i.memoizedProps;try{x.nodeValue=C}catch(ke){Di(i,i.return,ke)}}break;case 3:if(fa(s,i),Ka(i),y&4&&u!==null&&u.memoizedState.isDehydrated)try{Cd(s.containerInfo)}catch(ke){Di(i,i.return,ke)}break;case 4:fa(s,i),Ka(i);break;case 13:fa(s,i),Ka(i),x=i.child,x.flags&8192&&(C=x.memoizedState!==null,x.stateNode.isHidden=C,!C||x.alternate!==null&&x.alternate.memoizedState!==null||(gy=ji())),y&4&&Z0(i);break;case 22:if(Te=u!==null&&u.memoizedState!==null,i.mode&1?(Fn=(ee=Fn)||Te,fa(s,i),Fn=ee):fa(s,i),Ka(i),y&8192){if(ee=i.memoizedState!==null,(i.stateNode.isHidden=ee)&&!Te&&i.mode&1)for(Rt=i,Te=i.child;Te!==null;){for(ie=Rt=Te;Rt!==null;){switch(G=Rt,He=G.child,G.tag){case 0:case 11:case 14:case 15:gd(4,G,G.return);break;case 1:eh(G,G.return);var Ke=G.stateNode;if(typeof Ke.componentWillUnmount=="function"){y=G,u=G.return;try{s=y,Ke.props=s.memoizedProps,Ke.state=s.memoizedState,Ke.componentWillUnmount()}catch(ke){Di(y,u,ke)}}break;case 5:eh(G,G.return);break;case 22:if(G.memoizedState!==null){W0(ie);continue}}He!==null?(He.return=G,Rt=He):W0(ie)}Te=Te.sibling}e:for(Te=null,ie=i;;){if(ie.tag===5){if(Te===null){Te=ie;try{x=ie.stateNode,ee?(C=x.style,typeof C.setProperty=="function"?C.setProperty("display","none","important"):C.display="none"):(d=ie.stateNode,V=ie.memoizedProps.style,S=V!=null&&V.hasOwnProperty("display")?V.display:null,d.style.display=Dv("display",S))}catch(ke){Di(i,i.return,ke)}}}else if(ie.tag===6){if(Te===null)try{ie.stateNode.nodeValue=ee?"":ie.memoizedProps}catch(ke){Di(i,i.return,ke)}}else if((ie.tag!==22&&ie.tag!==23||ie.memoizedState===null||ie===i)&&ie.child!==null){ie.child.return=ie,ie=ie.child;continue}if(ie===i)break e;for(;ie.sibling===null;){if(ie.return===null||ie.return===i)break e;Te===ie&&(Te=null),ie=ie.return}Te===ie&&(Te=null),ie.sibling.return=ie.return,ie=ie.sibling}}break;case 19:fa(s,i),Ka(i),y&4&&Z0(i);break;case 21:break;default:fa(s,i),Ka(i)}}function Ka(i){var s=i.flags;if(s&2){try{e:{for(var u=i.return;u!==null;){if(sx(u)){var y=u;break e}u=u.return}throw Error(at(160))}switch(y.tag){case 5:var x=y.stateNode;y.flags&32&&(bd(x,""),y.flags&=-33);var C=G0(i);Cg(i,C,x);break;case 3:case 4:var S=y.stateNode.containerInfo,d=G0(i);kg(i,d,S);break;default:throw Error(at(161))}}catch(V){Di(i,i.return,V)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function PS(i,s,u){Rt=i,lx(i)}function lx(i,s,u){for(var y=(i.mode&1)!==0;Rt!==null;){var x=Rt,C=x.child;if(x.tag===22&&y){var S=x.memoizedState!==null||wp;if(!S){var d=x.alternate,V=d!==null&&d.memoizedState!==null||Fn;d=wp;var ee=Fn;if(wp=S,(Fn=V)&&!ee)for(Rt=x;Rt!==null;)S=Rt,V=S.child,S.tag===22&&S.memoizedState!==null?K0(x):V!==null?(V.return=S,Rt=V):K0(x);for(;C!==null;)Rt=C,lx(C),C=C.sibling;Rt=x,wp=d,Fn=ee}H0(i)}else x.subtreeFlags&8772&&C!==null?(C.return=x,Rt=C):H0(i)}}function H0(i){for(;Rt!==null;){var s=Rt;if(s.flags&8772){var u=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:Fn||bf(5,s);break;case 1:var y=s.stateNode;if(s.flags&4&&!Fn)if(u===null)y.componentDidMount();else{var x=s.elementType===s.type?u.memoizedProps:ma(s.type,u.memoizedProps);y.componentDidUpdate(x,u.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var C=s.updateQueue;C!==null&&M0(s,C,y);break;case 3:var S=s.updateQueue;if(S!==null){if(u=null,s.child!==null)switch(s.child.tag){case 5:u=s.child.stateNode;break;case 1:u=s.child.stateNode}M0(s,S,u)}break;case 5:var d=s.stateNode;if(u===null&&s.flags&4){u=d;var V=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":V.autoFocus&&u.focus();break;case"img":V.src&&(u.src=V.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var ee=s.alternate;if(ee!==null){var Te=ee.memoizedState;if(Te!==null){var ie=Te.dehydrated;ie!==null&&Cd(ie)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(at(163))}Fn||s.flags&512&&Sg(s)}catch(G){Di(s,s.return,G)}}if(s===i){Rt=null;break}if(u=s.sibling,u!==null){u.return=s.return,Rt=u;break}Rt=s.return}}function W0(i){for(;Rt!==null;){var s=Rt;if(s===i){Rt=null;break}var u=s.sibling;if(u!==null){u.return=s.return,Rt=u;break}Rt=s.return}}function K0(i){for(;Rt!==null;){var s=Rt;try{switch(s.tag){case 0:case 11:case 15:var u=s.return;try{bf(4,s)}catch(V){Di(s,u,V)}break;case 1:var y=s.stateNode;if(typeof y.componentDidMount=="function"){var x=s.return;try{y.componentDidMount()}catch(V){Di(s,x,V)}}var C=s.return;try{Sg(s)}catch(V){Di(s,C,V)}break;case 5:var S=s.return;try{Sg(s)}catch(V){Di(s,S,V)}}}catch(V){Di(s,s.return,V)}if(s===i){Rt=null;break}var d=s.sibling;if(d!==null){d.return=s.return,Rt=d;break}Rt=s.return}}var AS=Math.ceil,nf=Oo.ReactCurrentDispatcher,fy=Oo.ReactCurrentOwner,Gs=Oo.ReactCurrentBatchConfig,Or=0,mn=null,Yi=null,En=0,ws=0,th=Ql(0),sn=0,Fd=null,Jc=0,wf=0,my=0,yd=null,ts=null,gy=0,fh=1/0,Ao=null,sf=!1,Tg=null,Zl=null,Sp=!1,Nl=null,af=0,_d=0,Ig=null,Rp=-1,Fp=0;function Zn(){return Or&6?ji():Rp!==-1?Rp:Rp=ji()}function Hl(i){return i.mode&1?Or&2&&En!==0?En&-En:pS.transition!==null?(Fp===0&&(Fp=Zv()),Fp):(i=ti,i!==0||(i=window.event,i=i===void 0?16:Qv(i.type)),i):1}function va(i,s,u,y){if(50<_d)throw _d=0,Ig=null,Error(at(185));Nd(i,u,y),(!(Or&2)||i!==mn)&&(i===mn&&(!(Or&2)&&(wf|=u),sn===4&&Fl(i,En)),ss(i,y),u===1&&Or===0&&!(s.mode&1)&&(fh=ji()+500,_f&&ec()))}function ss(i,s){var u=i.callbackNode;p2(i,s);var y=Vp(i,i===mn?En:0);if(y===0)u!==null&&n0(u),i.callbackNode=null,i.callbackPriority=0;else if(s=y&-y,i.callbackPriority!==s){if(u!=null&&n0(u),s===1)i.tag===0?dS(X0.bind(null,i)):_1(X0.bind(null,i)),lS(function(){!(Or&6)&&ec()}),u=null;else{switch(Hv(y)){case 1:u=Vg;break;case 4:u=qv;break;case 16:u=jp;break;case 536870912:u=Gv;break;default:u=jp}u=gx(u,cx.bind(null,i))}i.callbackPriority=s,i.callbackNode=u}}function cx(i,s){if(Rp=-1,Fp=0,Or&6)throw Error(at(327));var u=i.callbackNode;if(oh()&&i.callbackNode!==u)return null;var y=Vp(i,i===mn?En:0);if(y===0)return null;if(y&30||y&i.expiredLanes||s)s=of(i,y);else{s=y;var x=Or;Or|=2;var C=hx();(mn!==i||En!==s)&&(Ao=null,fh=ji()+500,Hc(i,s));do try{DS();break}catch(d){ux(i,d)}while(!0);ty(),nf.current=C,Or=x,Yi!==null?s=0:(mn=null,En=0,s=sn)}if(s!==0){if(s===2&&(x=eg(i),x!==0&&(y=x,s=Eg(i,x))),s===1)throw u=Fd,Hc(i,0),Fl(i,y),ss(i,ji()),u;if(s===6)Fl(i,y);else{if(x=i.current.alternate,!(y&30)&&!MS(x)&&(s=of(i,y),s===2&&(C=eg(i),C!==0&&(y=C,s=Eg(i,C))),s===1))throw u=Fd,Hc(i,0),Fl(i,y),ss(i,ji()),u;switch(i.finishedWork=x,i.finishedLanes=y,s){case 0:case 1:throw Error(at(345));case 2:Uc(i,ts,Ao);break;case 3:if(Fl(i,y),(y&130023424)===y&&(s=gy+500-ji(),10<s)){if(Vp(i,0)!==0)break;if(x=i.suspendedLanes,(x&y)!==y){Zn(),i.pingedLanes|=i.suspendedLanes&x;break}i.timeoutHandle=lg(Uc.bind(null,i,ts,Ao),s);break}Uc(i,ts,Ao);break;case 4:if(Fl(i,y),(y&4194240)===y)break;for(s=i.eventTimes,x=-1;0<y;){var S=31-_a(y);C=1<<S,S=s[S],S>x&&(x=S),y&=~C}if(y=x,y=ji()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*AS(y/1960))-y,10<y){i.timeoutHandle=lg(Uc.bind(null,i,ts,Ao),y);break}Uc(i,ts,Ao);break;case 5:Uc(i,ts,Ao);break;default:throw Error(at(329))}}}return ss(i,ji()),i.callbackNode===u?cx.bind(null,i):null}function Eg(i,s){var u=yd;return i.current.memoizedState.isDehydrated&&(Hc(i,s).flags|=256),i=of(i,s),i!==2&&(s=ts,ts=u,s!==null&&Pg(s)),i}function Pg(i){ts===null?ts=i:ts.push.apply(ts,i)}function MS(i){for(var s=i;;){if(s.flags&16384){var u=s.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var y=0;y<u.length;y++){var x=u[y],C=x.getSnapshot;x=x.value;try{if(!xa(C(),x))return!1}catch{return!1}}}if(u=s.child,s.subtreeFlags&16384&&u!==null)u.return=s,s=u;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Fl(i,s){for(s&=~my,s&=~wf,i.suspendedLanes|=s,i.pingedLanes&=~s,i=i.expirationTimes;0<s;){var u=31-_a(s),y=1<<u;i[u]=-1,s&=~y}}function X0(i){if(Or&6)throw Error(at(327));oh();var s=Vp(i,0);if(!(s&1))return ss(i,ji()),null;var u=of(i,s);if(i.tag!==0&&u===2){var y=eg(i);y!==0&&(s=y,u=Eg(i,y))}if(u===1)throw u=Fd,Hc(i,0),Fl(i,s),ss(i,ji()),u;if(u===6)throw Error(at(345));return i.finishedWork=i.current.alternate,i.finishedLanes=s,Uc(i,ts,Ao),ss(i,ji()),null}function yy(i,s){var u=Or;Or|=1;try{return i(s)}finally{Or=u,Or===0&&(fh=ji()+500,_f&&ec())}}function Qc(i){Nl!==null&&Nl.tag===0&&!(Or&6)&&oh();var s=Or;Or|=1;var u=Gs.transition,y=ti;try{if(Gs.transition=null,ti=1,i)return i()}finally{ti=y,Gs.transition=u,Or=s,!(Or&6)&&ec()}}function _y(){ws=th.current,di(th)}function Hc(i,s){i.finishedWork=null,i.finishedLanes=0;var u=i.timeoutHandle;if(u!==-1&&(i.timeoutHandle=-1,oS(u)),Yi!==null)for(u=Yi.return;u!==null;){var y=u;switch(Jg(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&Hp();break;case 3:dh(),di(is),di(Bn),oy();break;case 5:ay(y);break;case 4:dh();break;case 13:di(ki);break;case 19:di(ki);break;case 10:ry(y.type._context);break;case 22:case 23:_y()}u=u.return}if(mn=i,Yi=i=Wl(i.current,null),En=ws=s,sn=0,Fd=null,my=wf=Jc=0,ts=yd=null,Gc!==null){for(s=0;s<Gc.length;s++)if(u=Gc[s],y=u.interleaved,y!==null){u.interleaved=null;var x=y.next,C=u.pending;if(C!==null){var S=C.next;C.next=x,y.next=S}u.pending=y}Gc=null}return i}function ux(i,s){do{var u=Yi;try{if(ty(),zp.current=rf,tf){for(var y=Ci.memoizedState;y!==null;){var x=y.queue;x!==null&&(x.pending=null),y=y.next}tf=!1}if(Yc=0,fn=nn=Ci=null,md=!1,Dd=0,fy.current=null,u===null||u.return===null){sn=1,Fd=s,Yi=null;break}e:{var C=i,S=u.return,d=u,V=s;if(s=En,d.flags|=32768,V!==null&&typeof V=="object"&&typeof V.then=="function"){var ee=V,Te=d,ie=Te.tag;if(!(Te.mode&1)&&(ie===0||ie===11||ie===15)){var G=Te.alternate;G?(Te.updateQueue=G.updateQueue,Te.memoizedState=G.memoizedState,Te.lanes=G.lanes):(Te.updateQueue=null,Te.memoizedState=null)}var He=B0(S);if(He!==null){He.flags&=-257,N0(He,S,d,C,s),He.mode&1&&F0(C,ee,s),s=He,V=ee;var Ke=s.updateQueue;if(Ke===null){var ke=new Set;ke.add(V),s.updateQueue=ke}else Ke.add(V);break e}else{if(!(s&1)){F0(C,ee,s),vy();break e}V=Error(at(426))}}else if(vi&&d.mode&1){var ht=B0(S);if(ht!==null){!(ht.flags&65536)&&(ht.flags|=256),N0(ht,S,d,C,s),Qg(ph(V,d));break e}}C=V=ph(V,d),sn!==4&&(sn=2),yd===null?yd=[C]:yd.push(C),C=S;do{switch(C.tag){case 3:C.flags|=65536,s&=-s,C.lanes|=s;var pe=H1(C,V,s);A0(C,pe);break e;case 1:d=V;var oe=C.type,me=C.stateNode;if(!(C.flags&128)&&(typeof oe.getDerivedStateFromError=="function"||me!==null&&typeof me.componentDidCatch=="function"&&(Zl===null||!Zl.has(me)))){C.flags|=65536,s&=-s,C.lanes|=s;var De=W1(C,d,s);A0(C,De);break e}}C=C.return}while(C!==null)}px(u)}catch(Ue){s=Ue,Yi===u&&u!==null&&(Yi=u=u.return);continue}break}while(!0)}function hx(){var i=nf.current;return nf.current=rf,i===null?rf:i}function vy(){(sn===0||sn===3||sn===2)&&(sn=4),mn===null||!(Jc&268435455)&&!(wf&268435455)||Fl(mn,En)}function of(i,s){var u=Or;Or|=2;var y=hx();(mn!==i||En!==s)&&(Ao=null,Hc(i,s));do try{zS();break}catch(x){ux(i,x)}while(!0);if(ty(),Or=u,nf.current=y,Yi!==null)throw Error(at(261));return mn=null,En=0,sn}function zS(){for(;Yi!==null;)dx(Yi)}function DS(){for(;Yi!==null&&!n2();)dx(Yi)}function dx(i){var s=mx(i.alternate,i,ws);i.memoizedProps=i.pendingProps,s===null?px(i):Yi=s,fy.current=null}function px(i){var s=i;do{var u=s.alternate;if(i=s.return,s.flags&32768){if(u=TS(u,s),u!==null){u.flags&=32767,Yi=u;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{sn=6,Yi=null;return}}else if(u=CS(u,s,ws),u!==null){Yi=u;return}if(s=s.sibling,s!==null){Yi=s;return}Yi=s=i}while(s!==null);sn===0&&(sn=5)}function Uc(i,s,u){var y=ti,x=Gs.transition;try{Gs.transition=null,ti=1,LS(i,s,u,y)}finally{Gs.transition=x,ti=y}return null}function LS(i,s,u,y){do oh();while(Nl!==null);if(Or&6)throw Error(at(327));u=i.finishedWork;var x=i.finishedLanes;if(u===null)return null;if(i.finishedWork=null,i.finishedLanes=0,u===i.current)throw Error(at(177));i.callbackNode=null,i.callbackPriority=0;var C=u.lanes|u.childLanes;if(f2(i,C),i===mn&&(Yi=mn=null,En=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||Sp||(Sp=!0,gx(jp,function(){return oh(),null})),C=(u.flags&15990)!==0,u.subtreeFlags&15990||C){C=Gs.transition,Gs.transition=null;var S=ti;ti=1;var d=Or;Or|=4,fy.current=null,ES(i,u),ox(u,i),eS(ag),Up=!!sg,ag=sg=null,i.current=u,PS(u),s2(),Or=d,ti=S,Gs.transition=C}else i.current=u;if(Sp&&(Sp=!1,Nl=i,af=x),C=i.pendingLanes,C===0&&(Zl=null),l2(u.stateNode),ss(i,ji()),s!==null)for(y=i.onRecoverableError,u=0;u<s.length;u++)x=s[u],y(x.value,{componentStack:x.stack,digest:x.digest});if(sf)throw sf=!1,i=Tg,Tg=null,i;return af&1&&i.tag!==0&&oh(),C=i.pendingLanes,C&1?i===Ig?_d++:(_d=0,Ig=i):_d=0,ec(),null}function oh(){if(Nl!==null){var i=Hv(af),s=Gs.transition,u=ti;try{if(Gs.transition=null,ti=16>i?16:i,Nl===null)var y=!1;else{if(i=Nl,Nl=null,af=0,Or&6)throw Error(at(331));var x=Or;for(Or|=4,Rt=i.current;Rt!==null;){var C=Rt,S=C.child;if(Rt.flags&16){var d=C.deletions;if(d!==null){for(var V=0;V<d.length;V++){var ee=d[V];for(Rt=ee;Rt!==null;){var Te=Rt;switch(Te.tag){case 0:case 11:case 15:gd(8,Te,C)}var ie=Te.child;if(ie!==null)ie.return=Te,Rt=ie;else for(;Rt!==null;){Te=Rt;var G=Te.sibling,He=Te.return;if(nx(Te),Te===ee){Rt=null;break}if(G!==null){G.return=He,Rt=G;break}Rt=He}}}var Ke=C.alternate;if(Ke!==null){var ke=Ke.child;if(ke!==null){Ke.child=null;do{var ht=ke.sibling;ke.sibling=null,ke=ht}while(ke!==null)}}Rt=C}}if(C.subtreeFlags&2064&&S!==null)S.return=C,Rt=S;else e:for(;Rt!==null;){if(C=Rt,C.flags&2048)switch(C.tag){case 0:case 11:case 15:gd(9,C,C.return)}var pe=C.sibling;if(pe!==null){pe.return=C.return,Rt=pe;break e}Rt=C.return}}var oe=i.current;for(Rt=oe;Rt!==null;){S=Rt;var me=S.child;if(S.subtreeFlags&2064&&me!==null)me.return=S,Rt=me;else e:for(S=oe;Rt!==null;){if(d=Rt,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:bf(9,d)}}catch(Ue){Di(d,d.return,Ue)}if(d===S){Rt=null;break e}var De=d.sibling;if(De!==null){De.return=d.return,Rt=De;break e}Rt=d.return}}if(Or=x,ec(),Ja&&typeof Ja.onPostCommitFiberRoot=="function")try{Ja.onPostCommitFiberRoot(pf,i)}catch{}y=!0}return y}finally{ti=u,Gs.transition=s}}return!1}function Y0(i,s,u){s=ph(u,s),s=H1(i,s,1),i=Gl(i,s,1),s=Zn(),i!==null&&(Nd(i,1,s),ss(i,s))}function Di(i,s,u){if(i.tag===3)Y0(i,i,u);else for(;s!==null;){if(s.tag===3){Y0(s,i,u);break}else if(s.tag===1){var y=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(Zl===null||!Zl.has(y))){i=ph(u,i),i=W1(s,i,1),s=Gl(s,i,1),i=Zn(),s!==null&&(Nd(s,1,i),ss(s,i));break}}s=s.return}}function RS(i,s,u){var y=i.pingCache;y!==null&&y.delete(s),s=Zn(),i.pingedLanes|=i.suspendedLanes&u,mn===i&&(En&u)===u&&(sn===4||sn===3&&(En&130023424)===En&&500>ji()-gy?Hc(i,0):my|=u),ss(i,s)}function fx(i,s){s===0&&(i.mode&1?(s=pp,pp<<=1,!(pp&130023424)&&(pp=4194304)):s=1);var u=Zn();i=Bo(i,s),i!==null&&(Nd(i,s,u),ss(i,u))}function FS(i){var s=i.memoizedState,u=0;s!==null&&(u=s.retryLane),fx(i,u)}function BS(i,s){var u=0;switch(i.tag){case 13:var y=i.stateNode,x=i.memoizedState;x!==null&&(u=x.retryLane);break;case 19:y=i.stateNode;break;default:throw Error(at(314))}y!==null&&y.delete(s),fx(i,u)}var mx;mx=function(i,s,u){if(i!==null)if(i.memoizedProps!==s.pendingProps||is.current)rs=!0;else{if(!(i.lanes&u)&&!(s.flags&128))return rs=!1,kS(i,s,u);rs=!!(i.flags&131072)}else rs=!1,vi&&s.flags&1048576&&v1(s,Xp,s.index);switch(s.lanes=0,s.tag){case 2:var y=s.type;Lp(i,s),i=s.pendingProps;var x=ch(s,Bn.current);ah(s,u),x=cy(null,s,y,i,x,u);var C=uy();return s.flags|=1,typeof x=="object"&&x!==null&&typeof x.render=="function"&&x.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,ns(y)?(C=!0,Wp(s)):C=!1,s.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,ny(s),x.updater=xf,s.stateNode=x,x._reactInternals=s,mg(s,y,i,u),s=_g(null,s,y,!0,C,u)):(s.tag=0,vi&&C&&Yg(s),Gn(null,s,x,u),s=s.child),s;case 16:y=s.elementType;e:{switch(Lp(i,s),i=s.pendingProps,x=y._init,y=x(y._payload),s.type=y,x=s.tag=OS(y),i=ma(y,i),x){case 0:s=yg(null,s,y,i,u);break e;case 1:s=j0(null,s,y,i,u);break e;case 11:s=O0(null,s,y,i,u);break e;case 14:s=$0(null,s,y,ma(y.type,i),u);break e}throw Error(at(306,y,""))}return s;case 0:return y=s.type,x=s.pendingProps,x=s.elementType===y?x:ma(y,x),yg(i,s,y,x,u);case 1:return y=s.type,x=s.pendingProps,x=s.elementType===y?x:ma(y,x),j0(i,s,y,x,u);case 3:e:{if(J1(s),i===null)throw Error(at(387));y=s.pendingProps,C=s.memoizedState,x=C.element,C1(i,s),Qp(s,y,null,u);var S=s.memoizedState;if(y=S.element,C.isDehydrated)if(C={element:y,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},s.updateQueue.baseState=C,s.memoizedState=C,s.flags&256){x=ph(Error(at(423)),s),s=V0(i,s,y,u,x);break e}else if(y!==x){x=ph(Error(at(424)),s),s=V0(i,s,y,u,x);break e}else for(Ss=ql(s.stateNode.containerInfo.firstChild),ks=s,vi=!0,ya=null,u=S1(s,null,y,u),s.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(uh(),y===x){s=No(i,s,u);break e}Gn(i,s,y,u)}s=s.child}return s;case 5:return T1(s),i===null&&dg(s),y=s.type,x=s.pendingProps,C=i!==null?i.memoizedProps:null,S=x.children,og(y,x)?S=null:C!==null&&og(y,C)&&(s.flags|=32),Y1(i,s),Gn(i,s,S,u),s.child;case 6:return i===null&&dg(s),null;case 13:return Q1(i,s,u);case 4:return sy(s,s.stateNode.containerInfo),y=s.pendingProps,i===null?s.child=hh(s,null,y,u):Gn(i,s,y,u),s.child;case 11:return y=s.type,x=s.pendingProps,x=s.elementType===y?x:ma(y,x),O0(i,s,y,x,u);case 7:return Gn(i,s,s.pendingProps,u),s.child;case 8:return Gn(i,s,s.pendingProps.children,u),s.child;case 12:return Gn(i,s,s.pendingProps.children,u),s.child;case 10:e:{if(y=s.type._context,x=s.pendingProps,C=s.memoizedProps,S=x.value,oi(Yp,y._currentValue),y._currentValue=S,C!==null)if(xa(C.value,S)){if(C.children===x.children&&!is.current){s=No(i,s,u);break e}}else for(C=s.child,C!==null&&(C.return=s);C!==null;){var d=C.dependencies;if(d!==null){S=C.child;for(var V=d.firstContext;V!==null;){if(V.context===y){if(C.tag===1){V=Lo(-1,u&-u),V.tag=2;var ee=C.updateQueue;if(ee!==null){ee=ee.shared;var Te=ee.pending;Te===null?V.next=V:(V.next=Te.next,Te.next=V),ee.pending=V}}C.lanes|=u,V=C.alternate,V!==null&&(V.lanes|=u),pg(C.return,u,s),d.lanes|=u;break}V=V.next}}else if(C.tag===10)S=C.type===s.type?null:C.child;else if(C.tag===18){if(S=C.return,S===null)throw Error(at(341));S.lanes|=u,d=S.alternate,d!==null&&(d.lanes|=u),pg(S,u,s),S=C.sibling}else S=C.child;if(S!==null)S.return=C;else for(S=C;S!==null;){if(S===s){S=null;break}if(C=S.sibling,C!==null){C.return=S.return,S=C;break}S=S.return}C=S}Gn(i,s,x.children,u),s=s.child}return s;case 9:return x=s.type,y=s.pendingProps.children,ah(s,u),x=Zs(x),y=y(x),s.flags|=1,Gn(i,s,y,u),s.child;case 14:return y=s.type,x=ma(y,s.pendingProps),x=ma(y.type,x),$0(i,s,y,x,u);case 15:return K1(i,s,s.type,s.pendingProps,u);case 17:return y=s.type,x=s.pendingProps,x=s.elementType===y?x:ma(y,x),Lp(i,s),s.tag=1,ns(y)?(i=!0,Wp(s)):i=!1,ah(s,u),Z1(s,y,x),mg(s,y,x,u),_g(null,s,y,!0,i,u);case 19:return ex(i,s,u);case 22:return X1(i,s,u)}throw Error(at(156,s.tag))};function gx(i,s){return Uv(i,s)}function NS(i,s,u,y){this.tag=i,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qs(i,s,u,y){return new NS(i,s,u,y)}function xy(i){return i=i.prototype,!(!i||!i.isReactComponent)}function OS(i){if(typeof i=="function")return xy(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Og)return 11;if(i===$g)return 14}return 2}function Wl(i,s){var u=i.alternate;return u===null?(u=qs(i.tag,s,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u.alternate=i,i.alternate=u):(u.pendingProps=s,u.type=i.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=i.flags&14680064,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue,s=i.dependencies,u.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u}function Bp(i,s,u,y,x,C){var S=2;if(y=i,typeof i=="function")xy(i)&&(S=1);else if(typeof i=="string")S=5;else e:switch(i){case Gu:return Wc(u.children,x,C,s);case Ng:S=8,x|=8;break;case Om:return i=qs(12,u,s,x|2),i.elementType=Om,i.lanes=C,i;case $m:return i=qs(13,u,s,x),i.elementType=$m,i.lanes=C,i;case jm:return i=qs(19,u,s,x),i.elementType=jm,i.lanes=C,i;case Tv:return Sf(u,x,C,s);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case kv:S=10;break e;case Cv:S=9;break e;case Og:S=11;break e;case $g:S=14;break e;case Dl:S=16,y=null;break e}throw Error(at(130,i==null?i:typeof i,""))}return s=qs(S,u,s,x),s.elementType=i,s.type=y,s.lanes=C,s}function Wc(i,s,u,y){return i=qs(7,i,y,s),i.lanes=u,i}function Sf(i,s,u,y){return i=qs(22,i,y,s),i.elementType=Tv,i.lanes=u,i.stateNode={isHidden:!1},i}function Lm(i,s,u){return i=qs(6,i,null,s),i.lanes=u,i}function Rm(i,s,u){return s=qs(4,i.children!==null?i.children:[],i.key,s),s.lanes=u,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}function $S(i,s,u,y,x){this.tag=s,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mm(0),this.expirationTimes=mm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mm(0),this.identifierPrefix=y,this.onRecoverableError=x,this.mutableSourceEagerHydrationData=null}function by(i,s,u,y,x,C,S,d,V){return i=new $S(i,s,u,d,V),s===1?(s=1,C===!0&&(s|=8)):s=0,C=qs(3,null,null,s),i.current=C,C.stateNode=i,C.memoizedState={element:y,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},ny(C),i}function jS(i,s,u){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:qu,key:y==null?null:""+y,children:i,containerInfo:s,implementation:u}}function yx(i){if(!i)return Yl;i=i._reactInternals;e:{if(tu(i)!==i||i.tag!==1)throw Error(at(170));var s=i;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(ns(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(at(171))}if(i.tag===1){var u=i.type;if(ns(u))return y1(i,u,s)}return s}function _x(i,s,u,y,x,C,S,d,V){return i=by(u,y,!0,i,x,C,S,d,V),i.context=yx(null),u=i.current,y=Zn(),x=Hl(u),C=Lo(y,x),C.callback=s??null,Gl(u,C,x),i.current.lanes=x,Nd(i,x,y),ss(i,y),i}function kf(i,s,u,y){var x=s.current,C=Zn(),S=Hl(x);return u=yx(u),s.context===null?s.context=u:s.pendingContext=u,s=Lo(C,S),s.payload={element:i},y=y===void 0?null:y,y!==null&&(s.callback=y),i=Gl(x,s,S),i!==null&&(va(i,x,S,C),Mp(i,x,S)),S}function lf(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function J0(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var u=i.retryLane;i.retryLane=u!==0&&u<s?u:s}}function wy(i,s){J0(i,s),(i=i.alternate)&&J0(i,s)}function VS(){return null}var vx=typeof reportError=="function"?reportError:function(i){console.error(i)};function Sy(i){this._internalRoot=i}Cf.prototype.render=Sy.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(at(409));kf(i,s,null,null)};Cf.prototype.unmount=Sy.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;Qc(function(){kf(null,i,null,null)}),s[Fo]=null}};function Cf(i){this._internalRoot=i}Cf.prototype.unstable_scheduleHydration=function(i){if(i){var s=Xv();i={blockedOn:null,target:i,priority:s};for(var u=0;u<Rl.length&&s!==0&&s<Rl[u].priority;u++);Rl.splice(u,0,i),u===0&&Jv(i)}};function ky(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Tf(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Q0(){}function US(i,s,u,y,x){if(x){if(typeof y=="function"){var C=y;y=function(){var ee=lf(S);C.call(ee)}}var S=_x(s,y,i,0,null,!1,!1,"",Q0);return i._reactRootContainer=S,i[Fo]=S.current,Ed(i.nodeType===8?i.parentNode:i),Qc(),S}for(;x=i.lastChild;)i.removeChild(x);if(typeof y=="function"){var d=y;y=function(){var ee=lf(V);d.call(ee)}}var V=by(i,0,!1,null,null,!1,!1,"",Q0);return i._reactRootContainer=V,i[Fo]=V.current,Ed(i.nodeType===8?i.parentNode:i),Qc(function(){kf(s,V,u,y)}),V}function If(i,s,u,y,x){var C=u._reactRootContainer;if(C){var S=C;if(typeof x=="function"){var d=x;x=function(){var V=lf(S);d.call(V)}}kf(s,S,i,x)}else S=US(u,s,i,x,y);return lf(S)}Wv=function(i){switch(i.tag){case 3:var s=i.stateNode;if(s.current.memoizedState.isDehydrated){var u=ld(s.pendingLanes);u!==0&&(Ug(s,u|1),ss(s,ji()),!(Or&6)&&(fh=ji()+500,ec()))}break;case 13:Qc(function(){var y=Bo(i,1);if(y!==null){var x=Zn();va(y,i,1,x)}}),wy(i,1)}};qg=function(i){if(i.tag===13){var s=Bo(i,134217728);if(s!==null){var u=Zn();va(s,i,134217728,u)}wy(i,134217728)}};Kv=function(i){if(i.tag===13){var s=Hl(i),u=Bo(i,s);if(u!==null){var y=Zn();va(u,i,s,y)}wy(i,s)}};Xv=function(){return ti};Yv=function(i,s){var u=ti;try{return ti=i,s()}finally{ti=u}};Ym=function(i,s,u){switch(s){case"input":if(qm(i,u),s=u.name,u.type==="radio"&&s!=null){for(u=i;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<u.length;s++){var y=u[s];if(y!==i&&y.form===i.form){var x=yf(y);if(!x)throw Error(at(90));Ev(y),qm(y,x)}}}break;case"textarea":Av(i,u);break;case"select":s=u.value,s!=null&&rh(i,!!u.multiple,s,!1)}};Bv=yy;Nv=Qc;var qS={usingClientEntryPoint:!1,Events:[$d,Ku,yf,Rv,Fv,yy]},sd={findFiberByHostInstance:qc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},GS={bundleType:sd.bundleType,version:sd.version,rendererPackageName:sd.rendererPackageName,rendererConfig:sd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Oo.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=jv(i),i===null?null:i.stateNode},findFiberByHostInstance:sd.findFiberByHostInstance||VS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kp.isDisabled&&kp.supportsFiber)try{pf=kp.inject(GS),Ja=kp}catch{}}Ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qS;Ts.createPortal=function(i,s){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ky(s))throw Error(at(200));return jS(i,s,null,u)};Ts.createRoot=function(i,s){if(!ky(i))throw Error(at(299));var u=!1,y="",x=vx;return s!=null&&(s.unstable_strictMode===!0&&(u=!0),s.identifierPrefix!==void 0&&(y=s.identifierPrefix),s.onRecoverableError!==void 0&&(x=s.onRecoverableError)),s=by(i,1,!1,null,null,u,!1,y,x),i[Fo]=s.current,Ed(i.nodeType===8?i.parentNode:i),new Sy(s)};Ts.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(at(188)):(i=Object.keys(i).join(","),Error(at(268,i)));return i=jv(s),i=i===null?null:i.stateNode,i};Ts.flushSync=function(i){return Qc(i)};Ts.hydrate=function(i,s,u){if(!Tf(s))throw Error(at(200));return If(null,i,s,!0,u)};Ts.hydrateRoot=function(i,s,u){if(!ky(i))throw Error(at(405));var y=u!=null&&u.hydratedSources||null,x=!1,C="",S=vx;if(u!=null&&(u.unstable_strictMode===!0&&(x=!0),u.identifierPrefix!==void 0&&(C=u.identifierPrefix),u.onRecoverableError!==void 0&&(S=u.onRecoverableError)),s=_x(s,null,i,1,u??null,x,!1,C,S),i[Fo]=s.current,Ed(i),y)for(i=0;i<y.length;i++)u=y[i],x=u._getVersion,x=x(u._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[u,x]:s.mutableSourceEagerHydrationData.push(u,x);return new Cf(s)};Ts.render=function(i,s,u){if(!Tf(s))throw Error(at(200));return If(null,i,s,!1,u)};Ts.unmountComponentAtNode=function(i){if(!Tf(i))throw Error(at(40));return i._reactRootContainer?(Qc(function(){If(null,null,i,!1,function(){i._reactRootContainer=null,i[Fo]=null})}),!0):!1};Ts.unstable_batchedUpdates=yy;Ts.unstable_renderSubtreeIntoContainer=function(i,s,u,y){if(!Tf(u))throw Error(at(200));if(i==null||i._reactInternals===void 0)throw Error(at(38));return If(i,s,u,!1,y)};Ts.version="18.3.1-next-f1338f8080-20240426";function xx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(xx)}catch(i){console.error(i)}}xx(),xv.exports=Ts;var ZS=xv.exports,bx,ev=ZS;bx=ev.createRoot,ev.hydrateRoot;const mh="https://major-sculpin.nceas.ucsb.edu/api",Uu="https://major-sculpin.nceas.ucsb.edu",HS="https://tiles.openfreemap.org/planet/{z}/{x}/{y}.pbf",wx="us",Sx="tract",Ol={tract:{label:"Census Tracts / Subdivisions",us:{tileUrl:`${Uu}/data/us_tracts/{z}/{x}/{y}.pbf`,sourceLayer:"us_tracts",idField:"geoid",nameField:"tract",apiCountry:"us",apiGeoLevel:"tract",displayName:"Census Tract"},canada:{tileUrl:`${Uu}/data/ca_subdivisions/{z}/{x}/{y}.pbf`,sourceLayer:"ca_subdivisions",idField:"csduid",nameField:"subdvsn",apiCountry:"canada",apiGeoLevel:"subdivision",displayName:"Census Subdivision"}},county:{label:"Counties / Divisions",us:{tileUrl:`${Uu}/data/us_counties/{z}/{x}/{y}.pbf`,sourceLayer:"us_counties",idField:"stco_fips",nameField:"county",apiCountry:"us",apiGeoLevel:"county",displayName:"County"},canada:{tileUrl:`${Uu}/data/ca_divisions/{z}/{x}/{y}.pbf`,sourceLayer:"ca_divisions",idField:"cduid",nameField:"division",apiCountry:"canada",apiGeoLevel:"division",displayName:"Census Division"}},state:{label:"States / Provinces",us:{tileUrl:`${Uu}/data/us_states/{z}/{x}/{y}.pbf`,sourceLayer:"us_states",idField:"name",nameField:"name",apiCountry:"us",apiGeoLevel:"state",displayName:"State"},canada:{tileUrl:`${Uu}/data/ca_provinces/{z}/{x}/{y}.pbf`,sourceLayer:"ca_provinces",idField:"name",nameField:"name",apiCountry:"canada",apiGeoLevel:"province",displayName:"Province"}}},$l="geoid";function WS(i,s,u){const y=Ol[u];return{us:`${mh}/${y.us.apiCountry}/${y.us.apiGeoLevel}/${i}/${s}`,canada:`${mh}/${y.canada.apiCountry}/${y.canada.apiGeoLevel}/${i}/${s}`}}function tv(i=wx,s=Sx){return`${mh}/${i}/${s}/summary`}function KS(i){const s=Ol[i];return{us:`${mh}/${s.us.apiCountry}/${s.us.apiGeoLevel}/locations`,canada:`${mh}/${s.canada.apiCountry}/${s.canada.apiGeoLevel}/locations`}}function XS(i,s=wx,u=Sx){return`${mh}/${s}/${u}/region/${i}`}const YS="/assets/Vector-mo6qIbH5.svg",JS=()=>te.jsx("div",{className:"flex h-[60px] min-w-[580px] items-center justify-start text-nowrap bg-headerBackgroundWhite",children:te.jsxs("div",{className:"ml-[20px] inline-flex items-center",children:[te.jsx("img",{src:YS,alt:"logo",width:"45",height:"40",className:"min-h-[45px] min-w-[50px]"}),te.jsx("h1",{className:"ml-4 min-w-[500px] font-IBMPlexSerif text-2xl font-bold ",children:"Pre-production Demo"})]})}),kx="data:image/svg+xml,%3csvg%20width='15'%20height='15'%20viewBox='0%200%2015%2015'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.5%209.09696L1.91065%2014.6863C1.70152%2014.8954%201.43536%2015%201.11217%2015C0.788973%2015%200.522813%2014.8954%200.313688%2014.6863C0.104562%2014.4772%200%2014.211%200%2013.8878C0%2013.5646%200.104562%2013.2985%200.313688%2013.0894L5.90304%207.5L0.313688%201.91065C0.104562%201.70152%200%201.43536%200%201.11217C0%200.788973%200.104562%200.522813%200.313688%200.313688C0.522813%200.104562%200.788973%200%201.11217%200C1.43536%200%201.70152%200.104562%201.91065%200.313688L7.5%205.90304L13.0894%200.313688C13.2985%200.104562%2013.5646%200%2013.8878%200C14.211%200%2014.4772%200.104562%2014.6863%200.313688C14.8954%200.522813%2015%200.788973%2015%201.11217C15%201.43536%2014.8954%201.70152%2014.6863%201.91065L9.09696%207.5L14.6863%2013.0894C14.8954%2013.2985%2015%2013.5646%2015%2013.8878C15%2014.211%2014.8954%2014.4772%2014.6863%2014.6863C14.4772%2014.8954%2014.211%2015%2013.8878%2015C13.5646%2015%2013.2985%2014.8954%2013.0894%2014.6863L7.5%209.09696Z'%20fill='black'/%3e%3c/svg%3e",QS=i=>te.jsx("button",{className:"absolute right-3 top-3 z-10",onClick:()=>i.setOpenLeftSidebar(!1),"aria-label":"Close left sidebar",children:te.jsx("img",{src:kx,className:"h-3 w-3",alt:"Close"})}),ek="data:image/svg+xml,%3csvg%20width='22'%20height='22'%20viewBox='0%200%2022%2022'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3crect%20width='22'%20height='22'%20fill='url(%23pattern0_493_19897)'/%3e%3cdefs%3e%3cpattern%20id='pattern0_493_19897'%20patternContentUnits='objectBoundingBox'%20width='1'%20height='1'%3e%3cuse%20xlink:href='%23image0_493_19897'%20transform='scale(0.0104167)'/%3e%3c/pattern%3e%3cimage%20id='image0_493_19897'%20width='96'%20height='96'%20xlink:href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAACyElEQVR4nO2dvYoUURBGjyiGomiiwQ7GvoL4EJoYbCK+gPgCPoSZmBmsS+NPKmJqYiooiIKpYCaKIpQIuzAMM9v/XXXrfh9U2DScc6tqmqFpUBRFURRFURRFGZ8bwGPgM/ALMMf6C9yuReoF4IUzcKtVwiXgYwDYVqOEU8CbAJCtVgm3AsC1miW8DgDWekrYJ0nOAn8CQLWj+r+HDmrqhFUA6LZW74HTwJNaOuFaQAHUJCGqgGokRBZQhYToAtJLKEFAagmlCEgroSQBKSWUJiCdhBIFpJJQqoA0EkoWkEJC6QKKl5BBQNESsggoVkImAUVKyCagOAkZBfSRMNX9BiergK4SJIB5gbRJkADmB3KSBAkgz8hLsQNMAvyhmDrAH4wtVBpBSID7KTR1gD8I0wjyh2EOpR2ABLifQlMH+IMwjSB/GOZQ2gFIgPsptJ512PE1JnUA08NvgDM9/vHSCGJ6+MeZQoJ2AMPgTyVBAhgOfwoJ6QW8BL6OXLgnwV+X8FwC2Hpy94AvE8z8tvedh9wjbQc0G/D6SlgCfloBzQ54XSUsBT+lgKYFXpuEJeGnE9B0hLdLwtLwUwloesDbJsEDfhoBTU/4mxK84KcQcDgQ/nGu9Lj+6shninQCmpHw+2Tqk1+8gAzwrWQB+zOMmKXGTgoBXV7vWQ1Ystuunwt+0QLaJKxG/Mzcdr0E9JCwGvmgtRT84jvAtkhog9cmYUn4aQTYkYT7HRfmrmeHuRduagHWszY7YemTX70AW5PgBb/qDrCJ/rKUAHwFSgD+EDWCKLeq3wEmAf6n0NQB/iCs1hG0FwCCOdbbCJ8w+R0AhDnVUwLkVQAQ5lR3CJCbAUCYQ30DzhHkQ26lfcrKJqi7BMpF4EMAKLZQPSRgzgPPAsCxGesHcI/guQ48Aj4BPwNAs5H1HXgHPAAue8NVFEVRFEVRFIXi8w/pnUnzD27c5QAAAABJRU5ErkJggg=='/%3e%3c/defs%3e%3c/svg%3e",tk=({percentage:i})=>{const u=2*Math.PI*60,y=u-u*i/100;let x="text-red-500";return i==0?x="text-gray-300":i>=75?x="text-[#32AC03]":i>=25?x="text-[#FAE107]":i<25&&(x="text-[#F00101]"),te.jsxs("div",{className:"relative mb-4 h-40 w-40",children:[te.jsxs("svg",{className:"absolute inset-0 h-full w-full -rotate-90 transform",children:[te.jsx("circle",{className:"text-gray-300",strokeWidth:"25",stroke:"currentColor",fill:"transparent",r:60,cx:"50%",cy:"50%"}),te.jsx("circle",{className:`duration-1 transition-colors ${x}`,strokeWidth:"25",strokeLinecap:"butt",stroke:"currentColor",fill:"transparent",r:60,cx:"50%",cy:"50%",style:{strokeDasharray:u,strokeDashoffset:y,transition:"stroke-dashoffset 1s ease-in-out"}})]}),te.jsx("div",{className:`flex h-full w-full items-center justify-center text-2xl font-semibold transition-colors duration-500 ${x}`,children:i!==0?`${i.toFixed(0)}%`:"--"})]})},Kl=(i,s,u)=>{const y=Math.round(i.r+(s.r-i.r)*u),x=Math.round(i.g+(s.g-i.g)*u),C=Math.round(i.b+(s.b-i.b)*u);return`rgb(${y},${x},${C})`},Cx={infrastructure:{apiKey:"infrastructure",displayName:"Infrastructure",domainId:"infrastructure",brandColor:{r:171,g:16,b:78}},communities:{apiKey:"communities",displayName:"Communities",domainId:"communities",brandColor:{r:225,g:107,b:93}},livelihoods:{apiKey:"livelihoods",displayName:"Livelihoods",domainId:"livelihoods",brandColor:{r:249,g:178,b:103}},sense_of_place:{apiKey:"sense_of_place",displayName:"Sense of Place",domainId:"sense_of_place",brandColor:{r:125,g:200,b:165}},biodiversity:{apiKey:"biodiversity",displayName:"Species",domainId:"biodiversity",brandColor:{r:109,g:169,b:147}},natural_habitats:{apiKey:"natural_habitats",displayName:"Habitats",domainId:"natural_habitats",brandColor:{r:54,g:114,b:111}},water:{apiKey:"water",displayName:"Water",domainId:"water",brandColor:{r:65,g:110,b:146}},air_quality:{apiKey:"air_quality",displayName:"Air Quality",domainId:"air_quality",brandColor:{r:70,g:69,b:85}}},Tx={infrastructure:"infrastructure",communities:"communities",livelihoods:"livelihoods",sense_of_place:"sense_of_place",biodiversity:"biodiversity",natural_habitats:"natural_habitats",water:"water",air_quality:"air_quality"},Ix={r:255,g:255,b:255},_i={r:200,g:200,b:200},Ex={r:255,g:250,b:201},Px={r:123,g:22,b:40};function Vd(i){return i==null||isNaN(i)?0:i>1?Math.min(i/100,1):Math.min(Math.max(i,0),1)}function vd(i,s){if(!s)return`rgb(${_i.r}, ${_i.g}, ${_i.b})`;const u=Tx[i];if(!u)return console.warn(`getDomainScoreColor: No API key mapping for domainId "${i}"`),`rgb(${_i.r}, ${_i.g}, ${_i.b})`;const y=s[u];if(y==null)return console.warn(`getDomainScoreColor: No score for domainId "${i}" (apiKey: "${u}")`),`rgb(${_i.r}, ${_i.g}, ${_i.b})`;const x=Cx[u];if(!x)return console.warn(`getDomainScoreColor: No color config for apiKey "${u}"`),`rgb(${_i.r}, ${_i.g}, ${_i.b})`;const C=Vd(y);return Kl(Ix,x.brandColor,C)}function cf(i,s){if(s==null)return`rgb(${_i.r}, ${_i.g}, ${_i.b})`;const u=Tx[i];if(!u)return`rgb(${_i.r}, ${_i.g}, ${_i.b})`;const y=Cx[u];if(!y)return`rgb(${_i.r}, ${_i.g}, ${_i.b})`;const x=Vd(s);return Kl(Ix,y.brandColor,x)}function rv(i){if(i==null)return`rgb(${_i.r}, ${_i.g}, ${_i.b})`;const s=Vd(i);return Kl(Ex,Px,s)}const rk=[{apiKey:"infrastructure",displayName:"Infrastructure",brandColor:"#ab104e"},{apiKey:"communities",displayName:"Communities",brandColor:"#e16b5d"},{apiKey:"livelihoods",displayName:"Livelihoods",brandColor:"#f9b267"},{apiKey:"sense_of_place",displayName:"Sense of Place",brandColor:"#7dc8a5"},{apiKey:"biodiversity",displayName:"Species",brandColor:"#6da993"},{apiKey:"natural_habitats",displayName:"Habitats",brandColor:"#36726f"},{apiKey:"water",displayName:"Water",brandColor:"#416e92"},{apiKey:"air_quality",displayName:"Air Quality",brandColor:"#464555"}],ik={r:255,g:255,b:255},Ax="#c8c8c8";function nk(i){const s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return s?{r:parseInt(s[1],16),g:parseInt(s[2],16),b:parseInt(s[3],16)}:{r:200,g:200,b:200}}function sk(i,s){if(i==null||isNaN(i))return Ax;const u=Vd(i),y=nk(s);return Kl(ik,y,u)}const ak=({domainScores:i})=>{const s=Ot.useRef(null),[u,y]=Ot.useState("--"),[x,C]=Ot.useState("currentColor"),[S,d]=Ot.useState(null),V=rk.map(ee=>{const Te=(i==null?void 0:i[ee.apiKey])??null,ie=Te!==null?Vd(Te):0,G=sk(Te,ee.brandColor);return{id:ee.apiKey,name:ee.displayName,value:ie,color:G,brandColor:ee.brandColor,hasData:Te!==null}});return Ot.useEffect(()=>{const ee=s.current;if(!ee)return;ee.querySelectorAll("path").forEach(He=>He.remove());const Te=V.length,ie=2*Math.PI/Te,G=Math.PI/2;return V.forEach((He,Ke)=>{const ke=Ke*ie-G,ht=ke+ie,pe=40,oe=pe+Math.max(He.value*125,10),me=Math.cos(ke)*pe,De=Math.sin(ke)*pe,Ue=Math.cos(ht)*pe,ze=Math.sin(ht)*pe,Ge=Math.cos(ht)*oe,re=Math.sin(ht)*oe,ne=Math.cos(ke)*oe,fe=Math.sin(ke)*oe,Me=ht-ke<=Math.PI?"0":"1",Oe=[`M ${me} ${De}`,`A ${pe} ${pe} 0 ${Me} 1 ${Ue} ${ze}`,`L ${Ge} ${re}`,`A ${oe} ${oe} 0 ${Me} 0 ${ne} ${fe}`,"Z"].join(" "),tt=document.createElementNS("http://www.w3.org/2000/svg","path");tt.setAttribute("d",Oe),tt.setAttribute("fill",He.color),tt.setAttribute("class","aster__solid-arc transition-colors duration-100 ease-out cursor-pointer"),tt.addEventListener("mouseover",()=>{ee.querySelectorAll("path.aster__solid-arc").forEach(pt=>{pt!==tt&&pt.setAttribute("fill","#d3d3d3")}),He.hasData?(y((He.value*100).toFixed(0)),C(He.brandColor)):(y("--"),C(Ax)),d(He.name)}),tt.addEventListener("mouseout",()=>{V.forEach((pt,Qe)=>{const Xe=ee.querySelectorAll("path.aster__solid-arc");Xe[Qe]&&Xe[Qe].setAttribute("fill",pt.color)}),y("--"),C("currentColor"),d(null)}),ee.appendChild(tt);const dt=pe+125,dr=[`M ${Math.cos(ke)*pe} ${Math.sin(ke)*pe}`,`A ${pe} ${pe} 0 ${Me} 1 ${Math.cos(ht)*pe} ${Math.sin(ht)*pe}`,`L ${Math.cos(ht)*dt} ${Math.sin(ht)*dt}`,`A ${dt} ${dt} 0 ${Me} 0 ${Math.cos(ke)*dt} ${Math.sin(ke)*dt}`,"Z"].join(" "),Jt=document.createElementNS("http://www.w3.org/2000/svg","path");Jt.setAttribute("d",dr),Jt.setAttribute("fill","none"),Jt.setAttribute("stroke","#ededf1"),Jt.setAttribute("stroke-width","1"),ee.appendChild(Jt)}),()=>{ee.querySelectorAll("path").forEach(He=>He.remove())}},[i]),te.jsxs("div",{id:"flower-chart-container",children:[te.jsx("div",{className:"h-[11rem] w-full",children:te.jsx("svg",{id:"flower-chart-svg",className:"aster__plot flex flex-shrink flex-row justify-start",preserveAspectRatio:"xMidYMid",viewBox:"0 0 400 400",children:te.jsx("g",{id:"flower-chart-arcs",transform:"translate(165,170)",ref:s,children:te.jsx("text",{className:"text-3xl font-bold text-leftSidebarRightBorder",dy:".35em",textAnchor:"middle",fill:x,children:u})})})}),te.jsxs("div",{id:"flower-chart-legend",className:"mb-2 ml-1",children:[te.jsx("h1",{className:"pb-2 font-BeVietnamPro text-sm font-bold text-leftSidebarOverallResilience",children:"Legend"}),te.jsx("div",{className:"flex max-w-[194px] flex-wrap items-center justify-between",children:V.map((ee,Te)=>te.jsxs("div",{id:`legend-item-${ee.id}`,className:`mb-1 inline-flex min-w-[50%] items-center transition-opacity duration-100 ${S&&S!==ee.name?"opacity-50":"opacity-100"}`,children:[te.jsx("div",{className:"mr-1 h-[14px] w-[14px] rounded-sm transition-colors duration-100 ease-out",style:{backgroundColor:S&&S!==ee.name?"#d3d3d3":ee.color}}),te.jsx("p",{className:"font-BeVietnamPro text-xs",children:ee.name})]},Te))})]})]})};function ok({overallResilienceScore:i,domainScores:s}){let u;return i&&i<1?u=i*100:i?u=i:u=0,te.jsxs("div",{id:"left-sidebar-body",className:"flex w-full flex-1 flex-col px-leftSidebarXAxis",children:[te.jsx("h3",{className:"pb-2 pt-3 font-BeVietnamPro text-xs text-leftSidebarNotifier",children:"The following information pertains to the selected region"}),te.jsx("h1",{className:"font-BeVietnamePro text-sm font-bold text-leftSidebarOverallResilience",children:"OVERALL SCORE"}),te.jsx(tk,{percentage:u}),te.jsx("h1",{className:"font-BeVietnamePro pb-2 text-sm font-bold text-leftSidebarOverallResilience",children:"INDIVIDUAL DOMAIN SCORES"}),te.jsx("div",{className:"mb-1 w-[200px]",children:te.jsx(ak,{domainScores:s})}),te.jsxs("button",{className:"mt-2 flex w-full flex-row items-center rounded-md border-[1px] border-black p-1",children:[te.jsx("img",{src:ek,alt:"Graph Report",className:"ml-2 mr-2 h-5 w-5"}),te.jsx("h1",{className:"font-BeVietnamPro font-bold",children:"VIEW REPORT"})]})]})}const lk=({onClick:i})=>te.jsxs("button",{onClick:i,className:"absolute left-1 top-1 z-30 flex h-10 w-10 flex-col items-center justify-center rounded border border-gray-400 bg-white p-2",children:[te.jsx("div",{className:"mb-1 h-0.5 w-6 bg-gray-800"}),te.jsx("div",{className:"mb-1 h-0.5 w-6 bg-gray-800"}),te.jsx("div",{className:"h-0.5 w-6 bg-gray-800"})]}),ck={Alabama:"AL",Alaska:"AK",Arizona:"AZ",Arkansas:"AR",California:"CA",Colorado:"CO",Connecticut:"CT",Delaware:"DE",Florida:"FL",Georgia:"GA",Hawaii:"HI",Idaho:"ID",Illinois:"IL",Indiana:"IN",Iowa:"IA",Kansas:"KS",Kentucky:"KY",Louisiana:"LA",Maine:"ME",Maryland:"MD",Massachusetts:"MA",Michigan:"MI",Minnesota:"MN",Mississippi:"MS",Missouri:"MO",Montana:"MT",Nebraska:"NE",Nevada:"NV","New Hampshire":"NH","New Jersey":"NJ","New Mexico":"NM","New York":"NY","North Carolina":"NC","North Dakota":"ND",Ohio:"OH",Oklahoma:"OK",Oregon:"OR",Pennsylvania:"PA","Rhode Island":"RI","South Carolina":"SC","South Dakota":"SD",Tennessee:"TN",Texas:"TX",Utah:"UT",Vermont:"VT",Virginia:"VA",Washington:"WA","West Virginia":"WV",Wisconsin:"WI",Wyoming:"WY","":""},uk={Alberta:"AB","British Columbia":"BC",Manitoba:"MB","New Brunswick":"NB","Newfoundland and Labrador":"NL","Northwest Territories":"NT","Nova Scotia":"NS",Nunavut:"NU",Ontario:"ON","Prince Edward Island":"PE",Quebec:"QC",Saskatchewan:"SK",Yukon:"YT","":""};function Mx(i){return ck[i]||uk[i]||i}function hk(i,s){if(s==="us"&&i.length>=11){const u=i.slice(-6),y=u.slice(0,4).replace(/^0+/,"")||"0",x=u.slice(4);return`${y}.${x}`}return i}function dk(i,s,u,y,x){const C=Mx(u);switch(x){case"tract":{const S=y==="canada"?"Census Subdivision":"Census Tract",d=hk(i,y),V=s&&u?`${s}, ${C}`:u?C:"",ee=`${S} ${d}`;return{line1:V,line2:ee}}case"county":return s&&u?{line1:`${s}, ${C}`}:s?{line1:s}:{line1:i};case"state":return{line1:u||i};default:return{line1:i}}}function pk({selectedGeoId:i,selectedRegionName:s,selectedStateName:u,selectedCountry:y,selectedGeoLevel:x}){const C=i!=="",S=C?dk(i,s,u,y,x):null;return te.jsx("div",{id:"left-sidebar-header",className:"relative flex min-h-[89px] w-full items-center border-b-[1px] border-solid border-leftSidebarHeaderBottomBorder bg-leftSidebarHeaderBackground pl-[18px] pr-[10px]",children:te.jsxs("div",{children:[te.jsx("h1",{className:"font-BeVietnamPro text-sm font-bold text-leftSidebarHeaderLabelTextColor",children:"SELECTED REGION"}),C?te.jsxs("h2",{className:"font-BeVietnamPro text-base font-bold leading-snug",children:[S==null?void 0:S.line1,(S==null?void 0:S.line2)&&te.jsxs(te.Fragment,{children:[te.jsx("br",{}),S.line2]})]}):te.jsx("h2",{className:"min-h-[49px] max-w-[95%] font-BeVietnamPro text-base font-bold text-leftSidebarHeaderLabelTextColor",children:"Click on a region to view data"})]})})}const fk=({selectedGeoId:i,selectedRegionName:s,selectedStateName:u,selectedCountry:y,selectedGeoLevel:x,selectedMetricValue:C,isOpen:S,setIsOpen:d,domainScores:V,regionAllMetrics:ee})=>{var Ke;const[Te,ie]=Ot.useState(!1);Ot.useEffect(()=>{S||ie(!0)},[S]);const G=()=>{S||ie(!1)},He=((Ke=ee==null?void 0:ee.wwri)==null?void 0:Ke.wwri_final_score)??null;return te.jsxs("div",{className:"",children:[te.jsxs("aside",{id:"left-sidebar",className:`absolute z-10 h-[calc(100vh-140px)] w-[233px] border-r-[1px] border-solid border-leftSidebarRightBorder bg-white transition-transform duration-300 ease-in-out ${S?"translate-x-0":"-translate-x-full"}`,onTransitionEnd:G,children:[te.jsx(QS,{setOpenLeftSidebar:d}),te.jsx(pk,{selectedGeoId:i,selectedRegionName:s,selectedStateName:u,selectedCountry:y,selectedGeoLevel:x}),te.jsx(ok,{overallResilienceScore:He,domainScores:V})]}),!S&&!Te&&te.jsx("div",{id:"hamburger-toggle-for-left-sidebar",className:"relative flex min-w-10 max-w-10",children:te.jsx(lk,{onClick:()=>d(!0)})})]})};var zx={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.3.2/LICENSE.txt
 */(function(i,s){(function(u,y){i.exports=y()})(Ag,function(){var u={},y={};function x(S,d,V){if(y[S]=V,S==="index"){var ee="var sharedModule = {}; ("+y.shared+")(sharedModule); ("+y.worker+")(sharedModule);",Te={};return y.shared(Te),y.index(u,Te),typeof window<"u"&&u.setWorkerUrl(window.URL.createObjectURL(new Blob([ee],{type:"text/javascript"}))),u}}x("shared",["exports"],function(S){function d(r,e,n,o){return new(n||(n=Promise))(function(c,f){function g(T){try{b(o.next(T))}catch(P){f(P)}}function _(T){try{b(o.throw(T))}catch(P){f(P)}}function b(T){var P;T.done?c(T.value):(P=T.value,P instanceof n?P:new n(function(A){A(P)})).then(g,_)}b((o=o.apply(r,e||[])).next())})}function V(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var ee=Te;function Te(r,e){this.x=r,this.y=e}Te.prototype={clone:function(){return new Te(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,n=r.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),n=Math.sin(r),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(r,e){var n=Math.cos(r),o=Math.sin(r),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Te.convert=function(r){return r instanceof Te?r:Array.isArray(r)?new Te(r[0],r[1]):r};var ie=V(ee),G=He;function He(r,e,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=n,this.p2y=o}He.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<e)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=c/f}var g=0,_=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<e));o++)r>c?g=n:_=n,n=.5*(_-g)+g;return n},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var Ke=V(G);let ke,ht;function pe(){return ke==null&&(ke=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ke}function oe(){if(ht==null&&(ht=!1,pe())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<5*5;o++){const c=4*o;e.fillStyle=`rgb(${c},${c+1},${c+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){ht=!0;break}}}return ht||!1}function me(r,e,n,o){const c=new Ke(r,e,n,o);return f=>c.solve(f)}const De=me(.25,.1,.25,1);function Ue(r,e,n){return Math.min(n,Math.max(e,r))}function ze(r,e,n){const o=n-e,c=((r-e)%o+o)%o+e;return c===e?n:c}function Ge(r,...e){for(const n of e)for(const o in n)r[o]=n[o];return r}let re=1;function ne(r,e,n){const o={};for(const c in r)o[c]=e.call(this,r[c],c,r);return o}function fe(r,e,n){const o={};for(const c in r)e.call(this,r[c],c,r)&&(o[c]=r[c]);return o}function Me(r){return Array.isArray(r)?r.map(Me):typeof r=="object"&&r?ne(r,Me):r}const Oe={};function tt(r){Oe[r]||(typeof console<"u"&&console.warn(r),Oe[r]=!0)}function dt(r,e,n){return(n.y-r.y)*(e.x-r.x)>(e.y-r.y)*(n.x-r.x)}function dr(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Jt=null;function pt(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Xe(r,e,n,o,c){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(r,{timestamp:0});try{const g=f==null?void 0:f.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const _=g.startsWith("BGR"),b=new Uint8ClampedArray(o*c*4);if(yield f.copyTo(b,function(T,P,A,L,F){const $=4*Math.max(-P,0),q=(Math.max(0,A)-A)*L*4+$,W=4*L,se=Math.max(0,P),Se=Math.max(0,A);return{rect:{x:se,y:Se,width:Math.min(T.width,P+L)-se,height:Math.min(T.height,A+F)-Se},layout:[{offset:q,stride:W}]}}(r,e,n,o,c)),_)for(let T=0;T<b.length;T+=4){const P=b[T];b[T]=b[T+2],b[T+2]=P}return b}finally{f.close()}})}let It,$t;const nt="AbortError";function er(){return new Error(nt)}const mr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function pr(r){return mr.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const tr="global-dispatcher";class ar extends Error{constructor(e,n,o,c){super(`AJAXError: ${n} (${e}): ${o}`),this.status=e,this.statusText=n,this.url=o,this.body=c}}const Sr=()=>dr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Bt=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=pr(r.url);if(o)return o(r,e);if(dr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:tr},e)}if(!(/^file:/.test(n=r.url)||/^file:/.test(Sr())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,c){return d(this,void 0,void 0,function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Sr(),signal:c.signal});o.type==="json"&&f.headers.set("Accept","application/json");const g=yield fetch(f);if(!g.ok){const T=yield g.blob();throw new ar(g.status,g.statusText,o.url,T)}let _;_=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const b=yield _;if(c.signal.aborted)throw er();return{data:b,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(r,e);if(dr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:tr},e)}var n;return function(o,c){return new Promise((f,g)=>{const _=new XMLHttpRequest;_.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(_.responseType="arraybuffer");for(const b in o.headers)_.setRequestHeader(b,o.headers[b]);o.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=o.credentials==="include",_.onerror=()=>{g(new Error(_.statusText))},_.onload=()=>{if(!c.signal.aborted)if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let b=_.response;if(o.type==="json")try{b=JSON.parse(_.response)}catch(T){return void g(T)}f({data:b,cacheControl:_.getResponseHeader("Cache-Control"),expires:_.getResponseHeader("Expires")})}else{const b=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});g(new ar(_.status,_.statusText,o.url,b))}},c.signal.addEventListener("abort",()=>{_.abort(),g(er())}),_.send(o.body)})}(r,e)};function gr(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const e=new URL(r),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Lr(r,e,n){n[r]&&n[r].indexOf(e)!==-1||(n[r]=n[r]||[],n[r].push(e))}function Ir(r,e,n){if(n&&n[r]){const o=n[r].indexOf(e);o!==-1&&n[r].splice(o,1)}}class _r{constructor(e,n={}){Ge(this,n),this.type=e}}class or extends _r{constructor(e,n={}){super("error",Ge({error:e},n))}}class Rr{on(e,n){return this._listeners=this._listeners||{},Lr(e,n,this._listeners),this}off(e,n){return Ir(e,n,this._listeners),Ir(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Lr(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new _r(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of c)_.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of f)Ir(o,_,this._oneTimeListeners),_.call(this,e);const g=this._eventedParent;g&&(Ge(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof or&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ee={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ne=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ft(r,e){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return Ne.forEach(o=>{o in e&&(n[o]=e[o])}),n}function ct(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!ct(r[n],e[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const n in r)if(!ct(r[n],e[n]))return!1;return!0}return r===e}function Et(r,e){r.push(e)}function Zt(r,e,n){Et(n,{command:"addSource",args:[r,e[r]]})}function rr(r,e,n){Et(e,{command:"removeSource",args:[r]}),n[r]=!0}function lr(r,e,n,o){rr(r,n,o),Zt(r,e,n)}function Kr(r,e,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!ct(r[n][o],e[n][o]))return!1;for(o in e[n])if(Object.prototype.hasOwnProperty.call(e[n],o)&&o!=="data"&&!ct(r[n][o],e[n][o]))return!1;return!0}function Wt(r,e,n,o,c,f){r=r||{},e=e||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(ct(r[g],e[g])||n.push({command:f,args:[o,g,e[g],c]}));for(const g in e)Object.prototype.hasOwnProperty.call(e,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(ct(r[g],e[g])||n.push({command:f,args:[o,g,e[g],c]}))}function li(r){return r.id}function ci(r,e){return r[e.id]=e,r}class Ze{constructor(e,n,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function Fr(r,...e){for(const n of e)for(const o in n)r[o]=n[o];return r}class br extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Li{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(e){return new Li(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const si={kind:"null"},Je={kind:"number"},Nt={kind:"string"},Vt={kind:"boolean"},ui={kind:"color"},Vi={kind:"object"},Kt={kind:"value"},as={kind:"collator"},os={kind:"formatted"},Ii={kind:"padding"},K={kind:"resolvedImage"},R={kind:"variableAnchorOffsetCollection"};function B(r,e){return{kind:"array",itemType:r,N:e}}function j(r){if(r.kind==="array"){const e=j(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const J=[si,Je,Nt,Vt,ui,os,Vi,B(Kt),Ii,K,R];function he(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!he(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const n of J)if(!he(n,e))return null}}return`Expected ${j(r)} but found ${j(e)} instead.`}function ye(r,e){return e.some(n=>n.kind===r.kind)}function be(r,e){return e.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function le(r,e){return r.kind==="array"&&e.kind==="array"?r.itemType.kind===e.itemType.kind&&typeof r.N=="number":r.kind===e.kind}const Ie=.96422,je=.82521,Fe=4/29,Le=6/29,Lt=3*Le*Le,zt=Le*Le*Le,nr=Math.PI/180,qt=180/Math.PI;function yr(r){return(r%=360)<0&&(r+=360),r}function Nr([r,e,n,o]){let c,f;const g=pi((.2225045*(r=Gr(r))+.7168786*(e=Gr(e))+.0606169*(n=Gr(n)))/1);r===e&&e===n?c=f=g:(c=pi((.4360747*r+.3850649*e+.1430804*n)/Ie),f=pi((.0139322*r+.0971045*e+.7141733*n)/je));const _=116*g-16;return[_<0?0:_,500*(c-g),200*(g-f),o]}function Gr(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function pi(r){return r>zt?Math.pow(r,1/3):r/Lt+Fe}function Xt([r,e,n,o]){let c=(r+16)/116,f=isNaN(e)?c:c+e/500,g=isNaN(n)?c:c-n/200;return c=1*fi(c),f=Ie*fi(f),g=je*fi(g),[ri(3.1338561*f-1.6168667*c-.4906146*g),ri(-.9787684*f+1.9161415*c+.033454*g),ri(.0719453*f-.2289914*c+1.4052427*g),o]}function ri(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function fi(r){return r>Le?r*r*r:Lt*(r-Fe)}function an(r){return parseInt(r.padEnd(2,r),16)/255}function on(r,e){return xi(e?r/100:r,0,1)}function xi(r,e,n){return Math.min(Math.max(e,r),n)}function ba(r){return!r.some(Number.isNaN)}const ru={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Br{constructor(e,n,o,c=1,f=!0){this.r=e,this.g=n,this.b=o,this.a=c,f||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[e,n,o,c]))}static parse(e){if(e instanceof Br)return e;if(typeof e!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=ru[o];if(c){const[g,_,b]=c;return[g/255,_/255,b/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let _=1;return[an(o.slice(_,_+=g)),an(o.slice(_,_+=g)),an(o.slice(_,_+=g)),an(o.slice(_,_+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,b,T,P,A,L,F,$,q,W,se,Se]=g,ue=[P||" ",F||" ",W].join("");if(ue==="  "||ue==="  /"||ue===",,"||ue===",,,"){const xe=[T,L,q].join(""),Be=xe==="%%%"?100:xe===""?255:0;if(Be){const $e=[xi(+b/Be,0,1),xi(+A/Be,0,1),xi(+$/Be,0,1),se?on(+se,Se):1];if(ba($e))return $e}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[g,_,b,T,P,A,L,F,$]=f,q=[b||" ",P||" ",L].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const W=[+_,xi(+T,0,100),xi(+A,0,100),F?on(+F,$):1];if(ba(W))return function([se,Se,ue,xe]){function Be($e){const vt=($e+se/30)%12,Tt=Se*Math.min(ue,1-ue);return ue-Tt*Math.max(-1,Math.min(vt-3,9-vt,1))}return se=yr(se),Se/=100,ue/=100,[Be(0),Be(8),Be(4),xe]}(W)}}}(e);return n?new Br(...n,!1):void 0}get rgb(){const{r:e,g:n,b:o,a:c}=this,f=c||1/0;return this.overwriteGetter("rgb",[e/f,n/f,o/f,c])}get hcl(){return this.overwriteGetter("hcl",function(e){const[n,o,c,f]=Nr(e),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?yr(Math.atan2(c,o)*qt):NaN,g,n,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Nr(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,o,c]=this.rgb;return`rgba(${[e,n,o].map(f=>Math.round(255*f)).join(",")},${c})`}}Br.black=new Br(0,0,0,1),Br.white=new Br(1,1,1,1),Br.transparent=new Br(0,0,0,0),Br.red=new Br(1,0,0,1);class tc{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class rc{constructor(e,n,o,c,f){this.text=e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=f}}class gn{constructor(e){this.sections=e}static fromString(e){return new gn([new rc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof gn?e:gn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class ln{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ln)return e;if(typeof e=="number")return new ln([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ln(e)}}toString(){return JSON.stringify(this.values)}}const eo=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ui{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ui)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const o=e[n],c=e[n+1];if(typeof o!="string"||!eo.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Ui(e)}}toString(){return JSON.stringify(this.values)}}class Ri{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Ri({name:e,available:!1}):null}}function $o(r,e,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,e,n,o]:[r,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cn(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Br||r instanceof tc||r instanceof gn||r instanceof ln||r instanceof Ui||r instanceof Ri)return!0;if(Array.isArray(r)){for(const e of r)if(!cn(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!cn(r[e]))return!1;return!0}return!1}function mi(r){if(r===null)return si;if(typeof r=="string")return Nt;if(typeof r=="boolean")return Vt;if(typeof r=="number")return Je;if(r instanceof Br)return ui;if(r instanceof tc)return as;if(r instanceof gn)return os;if(r instanceof ln)return Ii;if(r instanceof Ui)return R;if(r instanceof Ri)return K;if(Array.isArray(r)){const e=r.length;let n;for(const o of r){const c=mi(o);if(n){if(n===c)continue;n=Kt;break}n=c}return B(n||Kt,e)}return Vi}function to(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Br||r instanceof gn||r instanceof ln||r instanceof Ui||r instanceof Ri?r.toString():JSON.stringify(r)}class Ws{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!cn(e[1]))return n.error("invalid value");const o=e[1];let c=mi(o);const f=n.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new Ws(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ai{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ks={string:Nt,number:Je,boolean:Vt,object:Vi};class An{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1;const f=e[0];if(f==="array"){let _,b;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Ks)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=Ks[T],c++}else _=Kt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=e[2],c++}o=B(_,b)}else{if(!Ks[f])throw new Error(`Types doesn't contain name = ${f}`);o=Ks[f]}const g=[];for(;c<e.length;c++){const _=n.parse(e[c],c,Kt);if(!_)return null;g.push(_)}return new An(o,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!he(this.type,mi(o)))return o;if(n===this.args.length-1)throw new ai(`Expected value to be of type ${j(this.type)}, but found ${j(mi(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ro={"to-boolean":Vt,"to-color":ui,"to-number":Je,"to-string":Nt};class Kn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if(!ro[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=ro[o],f=[];for(let g=1;g<e.length;g++){const _=n.parse(e[g],g,Kt);if(!_)return null;f.push(_)}return new Kn(c,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(e),o=null,n instanceof Br)return n;if(typeof n=="string"){const f=e.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:$o(n[0],n[1],n[2],n[3]),!o))return new Br(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ai(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(e);const c=ln.parse(n);if(c)return c}throw new ai(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(e);const c=Ui.parse(n);if(c)return c}throw new ai(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new ai(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return gn.fromString(to(this.args[0].evaluate(e)));case"resolvedImage":return Ri.fromString(to(this.args[0].evaluate(e)));default:return to(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const ic=["Unknown","Point","LineString","Polygon"];class wa{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ic[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Br.parse(e)),n}}class Er{constructor(e,n,o=[],c,f=new Li,g=[]){this.registry=e,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=f,this.errors=g,this.expectedType=c,this._isConstant=n}parse(e,n,o,c,f={}){return n?this.concat(n,o,c)._parse(e,f):this._parse(e,f)}_parse(e,n){function o(c,f,g){return g==="assert"?new An(f,[c]):g==="coerce"?new Kn(f,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[c];if(f){let g=f.parse(e,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,b=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||b.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(_.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||b.kind!=="value"&&b.kind!=="array"){if(this.checkSubtype(_,b))return null}else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"assert")}if(!(g instanceof Ws)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const _=new wa;try{g=new Ws(g.type,g.evaluate(_))}catch(b){return this.error(b.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const c=typeof e=="number"?this.path.concat(e):this.path,f=o?this.scope.concat(o):this.scope;return new Er(this.registry,this._isConstant,c,n||null,f,this.errors)}error(e,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new br(o,e))}checkSubtype(e,n){const o=he(e,n);return o&&this.error(o),o}}class io{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const _=n.parse(e[f+1],f+1);if(!_)return null;o.push([g,_])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new io(o,c):null}outputDefined(){return this.result.outputDefined()}}class Xs{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new Xs(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class nc{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Je),c=n.parse(e[2],2,B(n.expectedType||Kt));return o&&c?new nc(c.type.itemType,o,c):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new ai(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new ai(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new ai(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class jo{constructor(e,n){this.type=Vt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Kt),c=n.parse(e[2],2,Kt);return o&&c?ye(o.type,[Vt,Nt,Je,si,Kt])?new jo(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!be(n,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${j(mi(n))} instead.`);if(!be(o,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${j(mi(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class no{constructor(e,n,o){this.type=Je,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Kt),c=n.parse(e[2],2,Kt);if(!o||!c)return null;if(!ye(o.type,[Vt,Nt,Je,si,Kt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${j(o.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,Je);return f?new no(o,c,f):null}return new no(o,c)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!be(n,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${j(mi(n))} instead.`);if(!be(o,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${j(mi(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class sc{constructor(e,n,o,c,f,g){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=f,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const f={},g=[];for(let T=2;T<e.length-1;T+=2){let P=e[T];const A=e[T+1];Array.isArray(P)||(P=[P]);const L=n.concat(T);if(P.length===0)return L.error("Expected at least one branch label.");for(const $ of P){if(typeof $!="number"&&typeof $!="string")return L.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return L.error("Numeric branch labels must be integer values.");if(o){if(L.checkSubtype(o,mi($)))return null}else o=mi($);if(f[String($)]!==void 0)return L.error("Branch labels must be unique.");f[String($)]=g.length}const F=n.parse(A,T,c);if(!F)return null;c=c||F.type,g.push(F)}const _=n.parse(e[1],1,Kt);if(!_)return null;const b=n.parse(e[e.length-1],e.length-1,c);return b?_.type.kind!=="value"&&n.concat(1).checkSubtype(o,_.type)?null:new sc(o,c,_,f,g,b):null}evaluate(e){const n=this.input.evaluate(e);return(mi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Vo{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const _=n.parse(e[g],g,Vt);if(!_)return null;const b=n.parse(e[g+1],g+1,o);if(!b)return null;c.push([_,b]),o=o||b.type}const f=n.parse(e[e.length-1],e.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new Vo(o,c,f)}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class so{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Kt),c=n.parse(e[2],2,Je);if(!o||!c)return null;if(!ye(o.type,[B(Kt),Nt,Kt]))return n.error(`Expected first argument to be of type array or string, but found ${j(o.type)} instead`);if(e.length===4){const f=n.parse(e[3],3,Je);return f?new so(o.type,o,c,f):null}return new so(o.type,o,c)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!be(n,["string","array"]))throw new ai(`Expected first argument to be of type array or string, but found ${j(mi(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Uo(r,e){const n=r.length-1;let o,c,f=0,g=n,_=0;for(;f<=g;)if(_=Math.floor((f+g)/2),o=r[_],c=r[_+1],o<=e){if(_===n||e<c)return _;f=_+1}else{if(!(o>e))throw new ai("Input is not a number.");g=_-1}return 0}class ao{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,f]of o)this.labels.push(c),this.outputs.push(f)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,Je);if(!o)return null;const c=[];let f=null;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);for(let g=1;g<e.length;g+=2){const _=g===1?-1/0:e[g],b=e[g+1],T=g,P=g+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(c.length&&c[c.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const A=n.parse(b,P,f);if(!A)return null;f=f||A.type,c.push([_,A])}return new ao(f,o,c)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const f=n.length;return c>=n[f-1]?o[f-1].evaluate(e):o[Uo(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function vh(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var xh=ac;function ac(r,e,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=n,this.p2y=o}ac.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<e)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=c/f}var g=0,_=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<e));o++)r>c?g=n:_=n,n=.5*(_-g)+g;return n},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var iu=vh(xh);function Ys(r,e,n){return r+n*(e-r)}function oo(r,e,n){return r.map((o,c)=>Ys(o,e[c],n))}const qi={number:Ys,color:function(r,e,n,o="rgb"){switch(o){case"rgb":{const[c,f,g,_]=oo(r.rgb,e.rgb,n);return new Br(c,f,g,_,!1)}case"hcl":{const[c,f,g,_]=r.hcl,[b,T,P,A]=e.hcl;let L,F;if(isNaN(c)||isNaN(b))isNaN(c)?isNaN(b)?L=NaN:(L=b,g!==1&&g!==0||(F=T)):(L=c,P!==1&&P!==0||(F=f));else{let Se=b-c;b>c&&Se>180?Se-=360:b<c&&c-b>180&&(Se+=360),L=c+n*Se}const[$,q,W,se]=function([Se,ue,xe,Be]){return Se=isNaN(Se)?0:Se*nr,Xt([xe,Math.cos(Se)*ue,Math.sin(Se)*ue,Be])}([L,F??Ys(f,T,n),Ys(g,P,n),Ys(_,A,n)]);return new Br($,q,W,se,!1)}case"lab":{const[c,f,g,_]=Xt(oo(r.lab,e.lab,n));return new Br(c,f,g,_,!1)}}},array:oo,padding:function(r,e,n){return new ln(oo(r.values,e.values,n))},variableAnchorOffsetCollection:function(r,e,n){const o=r.values,c=e.values;if(o.length!==c.length)throw new ai(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${e.toString()}`);const f=[];for(let g=0;g<o.length;g+=2){if(o[g]!==c[g])throw new ai(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${c[g]}`);f.push(o[g]);const[_,b]=o[g+1],[T,P]=c[g+1];f.push([Ys(_,T,n),Ys(b,P,n)])}return new Ui(f)}};class yn{constructor(e,n,o,c,f){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,_]of f)this.labels.push(g),this.outputs.push(_)}static interpolationFactor(e,n,o,c){let f=0;if(e.name==="exponential")f=Sa(n,e.base,o,c);else if(e.name==="linear")f=Sa(n,1,o,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;f=new iu(g[0],g[1],g[2],g[3]).solve(Sa(n,1,o,c))}return f}static parse(e,n){let[o,c,f,...g]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const T=c[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:T}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const T=c.slice(1);if(T.length!==4||T.some(P=>typeof P!="number"||P<0||P>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,Je),!f)return null;const _=[];let b=null;o==="interpolate-hcl"||o==="interpolate-lab"?b=ui:n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType);for(let T=0;T<g.length;T+=2){const P=g[T],A=g[T+1],L=T+3,F=T+4;if(typeof P!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(_.length&&_[_.length-1][0]>=P)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const $=n.parse(A,F,b);if(!$)return null;b=b||$.type,_.push([P,$])}return le(b,Je)||le(b,ui)||le(b,Ii)||le(b,R)||le(b,B(Je))?new yn(b,o,c,f,_):n.error(`Type ${j(b)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const f=n.length;if(c>=n[f-1])return o[f-1].evaluate(e);const g=Uo(n,c),_=yn.interpolationFactor(this.interpolation,c,n[g],n[g+1]),b=o[g].evaluate(e),T=o[g+1].evaluate(e);switch(this.operator){case"interpolate":return qi[this.type.kind](b,T,_);case"interpolate-hcl":return qi.color(b,T,_,"hcl");case"interpolate-lab":return qi.color(b,T,_,"lab")}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Sa(r,e,n,o){const c=o-n,f=r-n;return c===0?0:e===1?f/c:(Math.pow(e,f)-1)/(Math.pow(e,c)-1)}class ls{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const f=[];for(const _ of e.slice(1)){const b=n.parse(_,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!b)return null;o=o||b.type,f.push(b)}if(!o)throw new Error("No output type");const g=c&&f.some(_=>he(c,_.type));return new ls(g?Kt:o,f)}evaluate(e){let n,o=null,c=0;for(const f of this.args)if(c++,o=f.evaluate(e),o&&o instanceof Ri&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}function oc(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function qo(r,e,n,o){return o.compare(e,n)===0}function ka(r,e,n){const o=r!=="=="&&r!=="!=";return class Dx{constructor(f,g,_){this.type=Vt,this.lhs=f,this.rhs=g,this.collator=_,this.hasUntypedArgument=f.type.kind==="value"||g.type.kind==="value"}static parse(f,g){if(f.length!==3&&f.length!==4)return g.error("Expected two or three arguments.");const _=f[0];let b=g.parse(f[1],1,Kt);if(!b)return null;if(!oc(_,b.type))return g.concat(1).error(`"${_}" comparisons are not supported for type '${j(b.type)}'.`);let T=g.parse(f[2],2,Kt);if(!T)return null;if(!oc(_,T.type))return g.concat(2).error(`"${_}" comparisons are not supported for type '${j(T.type)}'.`);if(b.type.kind!==T.type.kind&&b.type.kind!=="value"&&T.type.kind!=="value")return g.error(`Cannot compare types '${j(b.type)}' and '${j(T.type)}'.`);o&&(b.type.kind==="value"&&T.type.kind!=="value"?b=new An(T.type,[b]):b.type.kind!=="value"&&T.type.kind==="value"&&(T=new An(b.type,[T])));let P=null;if(f.length===4){if(b.type.kind!=="string"&&T.type.kind!=="string"&&b.type.kind!=="value"&&T.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(P=g.parse(f[3],3,as),!P)return null}return new Dx(b,T,P)}evaluate(f){const g=this.lhs.evaluate(f),_=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const b=mi(g),T=mi(_);if(b.kind!==T.kind||b.kind!=="string"&&b.kind!=="number")throw new ai(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const b=mi(g),T=mi(_);if(b.kind!=="string"||T.kind!=="string")return e(f,g,_)}return this.collator?n(f,g,_,this.collator.evaluate(f)):e(f,g,_)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const lc=ka("==",function(r,e,n){return e===n},qo),Go=ka("!=",function(r,e,n){return e!==n},function(r,e,n,o){return!qo(0,e,n,o)}),nu=ka("<",function(r,e,n){return e<n},function(r,e,n,o){return o.compare(e,n)<0}),su=ka(">",function(r,e,n){return e>n},function(r,e,n,o){return o.compare(e,n)>0}),Ca=ka("<=",function(r,e,n){return e<=n},function(r,e,n,o){return o.compare(e,n)<=0}),bh=ka(">=",function(r,e,n){return e>=n},function(r,e,n,o){return o.compare(e,n)>=0});class Zo{constructor(e,n,o){this.type=as,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Vt);if(!c)return null;const f=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Vt);if(!f)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,Nt),!g)?null:new Zo(c,f,g)}evaluate(e){return new tc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class cc{constructor(e,n,o,c,f){this.type=Nt,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Je);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=n.parse(c.locale,1,Nt),!f))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,Nt),!g))return null;let _=null;if(c["min-fraction-digits"]&&(_=n.parse(c["min-fraction-digits"],1,Je),!_))return null;let b=null;return c["max-fraction-digits"]&&(b=n.parse(c["max-fraction-digits"],1,Je),!b)?null:new cc(o,f,g,_,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ta{constructor(e){this.type=os,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let f=!1;for(let g=1;g<=e.length-1;++g){const _=e[g];if(f&&typeof _=="object"&&!Array.isArray(_)){f=!1;let b=null;if(_["font-scale"]&&(b=n.parse(_["font-scale"],1,Je),!b))return null;let T=null;if(_["text-font"]&&(T=n.parse(_["text-font"],1,B(Nt)),!T))return null;let P=null;if(_["text-color"]&&(P=n.parse(_["text-color"],1,ui),!P))return null;const A=c[c.length-1];A.scale=b,A.font=T,A.textColor=P}else{const b=n.parse(e[g],1,Kt);if(!b)return null;const T=b.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:b,scale:null,font:null,textColor:null})}}return new Ta(c)}evaluate(e){return new gn(this.sections.map(n=>{const o=n.content.evaluate(e);return mi(o)===K?new rc("",o,null,null,null):new rc(to(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}}class lo{constructor(e){this.type=K,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Nt);return o?new lo(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=Ri.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ia{constructor(e){this.type=Je,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${j(o.type)} instead.`):new Ia(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new ai(`Expected value to be of type string or array, but found ${j(mi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const _n=8192;function Pr(r,e){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*_n),Math.round(o*c*_n)]}function uc(r,e){const n=Math.pow(2,e.z);return[(c=(r[0]/_n+e.x)/n,360*c-180),(o=(r[1]/_n+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function Ea(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Pa(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function wh(r,e,n){const o=r[0]-e[0],c=r[1]-e[1],f=r[0]-n[0],g=r[1]-n[1];return o*g-f*c==0&&o*f<=0&&c*g<=0}function Ho(r,e,n,o){return(c=[o[0]-n[0],o[1]-n[1]])[0]*(f=[e[0]-r[0],e[1]-r[1]])[1]-c[1]*f[0]!=0&&!(!hc(r,e,n,o)||!hc(n,o,r,e));var c,f}function Sh(r,e,n){for(const o of n)for(let c=0;c<o.length-1;++c)if(Ho(r,e,o[c],o[c+1]))return!0;return!1}function Aa(r,e,n=!1){let o=!1;for(const _ of e)for(let b=0;b<_.length-1;b++){if(wh(r,_[b],_[b+1]))return n;(f=_[b])[1]>(c=r)[1]!=(g=_[b+1])[1]>c[1]&&c[0]<(g[0]-f[0])*(c[1]-f[1])/(g[1]-f[1])+f[0]&&(o=!o)}var c,f,g;return o}function kh(r,e){for(const n of e)if(Aa(r,n))return!0;return!1}function au(r,e){for(const n of r)if(!Aa(n,e))return!1;for(let n=0;n<r.length-1;++n)if(Sh(r[n],r[n+1],e))return!1;return!0}function Ch(r,e){for(const n of e)if(au(r,n))return!0;return!1}function hc(r,e,n,o){const c=o[0]-n[0],f=o[1]-n[1],g=(r[0]-n[0])*f-c*(r[1]-n[1]),_=(e[0]-n[0])*f-c*(e[1]-n[1]);return g>0&&_<0||g<0&&_>0}function dc(r,e,n){const o=[];for(let c=0;c<r.length;c++){const f=[];for(let g=0;g<r[c].length;g++){const _=Pr(r[c][g],n);Ea(e,_),f.push(_)}o.push(f)}return o}function ou(r,e,n){const o=[];for(let c=0;c<r.length;c++){const f=dc(r[c],e,n);o.push(f)}return o}function lu(r,e,n,o){if(r[0]<n[0]||r[0]>n[2]){const c=.5*o;let f=r[0]-n[0]>c?-o:n[0]-r[0]>c?o:0;f===0&&(f=r[0]-n[2]>c?-o:n[2]-r[0]>c?o:0),r[0]+=f}Ea(e,r)}function cu(r,e,n,o){const c=Math.pow(2,o.z)*_n,f=[o.x*_n,o.y*_n],g=[];for(const _ of r)for(const b of _){const T=[b.x+f[0],b.y+f[1]];lu(T,e,n,c),g.push(T)}return g}function uu(r,e,n,o){const c=Math.pow(2,o.z)*_n,f=[o.x*_n,o.y*_n],g=[];for(const b of r){const T=[];for(const P of b){const A=[P.x+f[0],P.y+f[1]];Ea(e,A),T.push(A)}g.push(T)}if(e[2]-e[0]<=c/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const b of g)for(const T of b)lu(T,e,n,c)}var _;return g}class Js{constructor(e,n){this.type=Vt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(cn(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const c=[];for(const f of o.features){const{type:g,coordinates:_}=f.geometry;g==="Polygon"&&c.push(_),g==="MultiPolygon"&&c.push(..._)}if(c.length)return new Js(o,{type:"MultiPolygon",coordinates:c})}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Js(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Js(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const _=dc(o.coordinates,f,g),b=cu(n.geometry(),c,f,g);if(!Pa(c,f))return!1;for(const T of b)if(!Aa(T,_))return!1}if(o.type==="MultiPolygon"){const _=ou(o.coordinates,f,g),b=cu(n.geometry(),c,f,g);if(!Pa(c,f))return!1;for(const T of b)if(!kh(T,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const _=dc(o.coordinates,f,g),b=uu(n.geometry(),c,f,g);if(!Pa(c,f))return!1;for(const T of b)if(!au(T,_))return!1}if(o.type==="MultiPolygon"){const _=ou(o.coordinates,f,g),b=uu(n.geometry(),c,f,g);if(!Pa(c,f))return!1;for(const T of b)if(!Ch(T,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let hu=class{constructor(r=[],e=Th){if(this.data=r,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:e,compare:n}=this,o=e[r];for(;r>0;){const c=r-1>>1,f=e[c];if(n(o,f)>=0)break;e[r]=f,r=c}e[r]=o}_down(r){const{data:e,compare:n}=this,o=this.length>>1,c=e[r];for(;r<o;){let f=1+(r<<1),g=e[f];const _=f+1;if(_<this.length&&n(e[_],g)<0&&(f=_,g=e[_]),n(g,c)>=0)break;e[r]=g,r=f}e[r]=c}};function Th(r,e){return r<e?-1:r>e?1:0}function Ih(r,e,n,o,c){du(r,e,n,o||r.length-1,c||Eh)}function du(r,e,n,o,c){for(;o>n;){if(o-n>600){var f=o-n+1,g=e-n+1,_=Math.log(f),b=.5*Math.exp(2*_/3),T=.5*Math.sqrt(_*b*(f-b)/f)*(g-f/2<0?-1:1);du(r,e,Math.max(n,Math.floor(e-g*b/f+T)),Math.min(o,Math.floor(e+(f-g)*b/f+T)),c)}var P=r[e],A=n,L=o;for(Ma(r,n,e),c(r[o],P)>0&&Ma(r,n,o);A<L;){for(Ma(r,A,L),A++,L--;c(r[A],P)<0;)A++;for(;c(r[L],P)>0;)L--}c(r[n],P)===0?Ma(r,n,L):Ma(r,++L,o),L<=e&&(n=L+1),e<=L&&(o=L-1)}}function Ma(r,e,n){var o=r[e];r[e]=r[n],r[n]=o}function Eh(r,e){return r<e?-1:r>e?1:0}function Wo(r,e){if(r.length<=1)return[r];const n=[];let o,c;for(const f of r){const g=Ah(f);g!==0&&(f.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(o&&n.push(o),o=[f]):o.push(f))}if(o&&n.push(o),e>1)for(let f=0;f<n.length;f++)n[f].length<=e||(Ih(n[f],e,1,n[f].length-1,Ph),n[f]=n[f].slice(0,e));return n}function Ph(r,e){return e.area-r.area}function Ah(r){let e=0;for(let n,o,c=0,f=r.length,g=f-1;c<f;g=c++)n=r[c],o=r[g],e+=(o.x-n.x)*(n.y+o.y);return e}const pc=1/298.257223563,pu=pc*(2-pc),fu=Math.PI/180;class fc{constructor(e){const n=6378.137*fu*1e3,o=Math.cos(e*fu),c=1/(1-pu*(1-o*o)),f=Math.sqrt(c);this.kx=n*f*o,this.ky=n*f*c*(1-pu)}distance(e,n){const o=this.wrap(e[0]-n[0])*this.kx,c=(e[1]-n[1])*this.ky;return Math.sqrt(o*o+c*c)}pointOnLine(e,n){let o,c,f,g,_=1/0;for(let b=0;b<e.length-1;b++){let T=e[b][0],P=e[b][1],A=this.wrap(e[b+1][0]-T)*this.kx,L=(e[b+1][1]-P)*this.ky,F=0;A===0&&L===0||(F=(this.wrap(n[0]-T)*this.kx*A+(n[1]-P)*this.ky*L)/(A*A+L*L),F>1?(T=e[b+1][0],P=e[b+1][1]):F>0&&(T+=A/this.kx*F,P+=L/this.ky*F)),A=this.wrap(n[0]-T)*this.kx,L=(n[1]-P)*this.ky;const $=A*A+L*L;$<_&&(_=$,o=T,c=P,f=b,g=F)}return{point:[o,c],index:f,t:Math.max(0,Math.min(1,g))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function mu(r,e){return e[0]-r[0]}function za(r){return r[1]-r[0]+1}function cs(r,e){return r[1]>=r[0]&&r[1]<e}function Ko(r,e){if(r[0]>r[1])return[null,null];const n=za(r);if(e){if(n===2)return[r,null];const c=Math.floor(n/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(n===1)return[r,null];const o=Math.floor(n/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function Da(r,e){if(!cs(e,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Ea(n,r[o]);return n}function co(r){const e=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const o of n)Ea(e,o);return e}function ii(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function mc(r,e,n){if(!ii(r)||!ii(e))return NaN;let o=0,c=0;return r[2]<e[0]&&(o=e[0]-r[2]),r[0]>e[2]&&(o=r[0]-e[2]),r[1]>e[3]&&(c=r[1]-e[3]),r[3]<e[1]&&(c=e[1]-r[3]),n.distance([0,0],[o,c])}function ir(r,e,n){const o=n.pointOnLine(e,r);return n.distance(r,o.point)}function uo(r,e,n,o,c){const f=Math.min(ir(r,[n,o],c),ir(e,[n,o],c)),g=Math.min(ir(n,[r,e],c),ir(o,[r,e],c));return Math.min(f,g)}function Xr(r,e,n,o,c){if(!cs(e,r.length)||!cs(o,n.length))return 1/0;let f=1/0;for(let g=e[0];g<e[1];++g){const _=r[g],b=r[g+1];for(let T=o[0];T<o[1];++T){const P=n[T],A=n[T+1];if(Ho(_,b,P,A))return 0;f=Math.min(f,uo(_,b,P,A,c))}}return f}function Yr(r,e,n,o,c){if(!cs(e,r.length)||!cs(o,n.length))return NaN;let f=1/0;for(let g=e[0];g<=e[1];++g)for(let _=o[0];_<=o[1];++_)if(f=Math.min(f,c.distance(r[g],n[_])),f===0)return f;return f}function Es(r,e,n){if(Aa(r,e,!0))return 0;let o=1/0;for(const c of e){const f=c[0],g=c[c.length-1];if(f!==g&&(o=Math.min(o,ir(r,[g,f],n)),o===0))return o;const _=n.pointOnLine(c,r);if(o=Math.min(o,n.distance(r,_.point)),o===0)return o}return o}function gu(r,e,n,o){if(!cs(e,r.length))return NaN;for(let f=e[0];f<=e[1];++f)if(Aa(r[f],n,!0))return 0;let c=1/0;for(let f=e[0];f<e[1];++f){const g=r[f],_=r[f+1];for(const b of n)for(let T=0,P=b.length,A=P-1;T<P;A=T++){const L=b[A],F=b[T];if(Ho(g,_,L,F))return 0;c=Math.min(c,uo(g,_,L,F,o))}}return c}function gc(r,e){for(const n of r)for(const o of n)if(Aa(o,e,!0))return!0;return!1}function Mh(r,e,n,o=1/0){const c=co(r),f=co(e);if(o!==1/0&&mc(c,f,n)>=o)return o;if(Pa(c,f)){if(gc(r,e))return 0}else if(gc(e,r))return 0;let g=1/0;for(const _ of r)for(let b=0,T=_.length,P=T-1;b<T;P=b++){const A=_[P],L=_[b];for(const F of e)for(let $=0,q=F.length,W=q-1;$<q;W=$++){const se=F[W],Se=F[$];if(Ho(A,L,se,Se))return 0;g=Math.min(g,uo(A,L,se,Se,n))}}return g}function yu(r,e,n,o,c,f){if(!f)return;const g=mc(Da(o,f),c,n);g<e&&r.push([g,f,[0,0]])}function Xo(r,e,n,o,c,f,g){if(!f||!g)return;const _=mc(Da(o,f),Da(c,g),n);_<e&&r.push([_,f,g])}function Yo(r,e,n,o,c=1/0){let f=Math.min(o.distance(r[0],n[0][0]),c);if(f===0)return f;const g=new hu([[0,[0,r.length-1],[0,0]]],mu),_=co(n);for(;g.length>0;){const b=g.pop();if(b[0]>=f)continue;const T=b[1],P=e?50:100;if(za(T)<=P){if(!cs(T,r.length))return NaN;if(e){const A=gu(r,T,n,o);if(isNaN(A)||A===0)return A;f=Math.min(f,A)}else for(let A=T[0];A<=T[1];++A){const L=Es(r[A],n,o);if(f=Math.min(f,L),f===0)return 0}}else{const A=Ko(T,e);yu(g,f,o,r,_,A[0]),yu(g,f,o,r,_,A[1])}}return f}function ho(r,e,n,o,c,f=1/0){let g=Math.min(f,c.distance(r[0],n[0]));if(g===0)return g;const _=new hu([[0,[0,r.length-1],[0,n.length-1]]],mu);for(;_.length>0;){const b=_.pop();if(b[0]>=g)continue;const T=b[1],P=b[2],A=e?50:100,L=o?50:100;if(za(T)<=A&&za(P)<=L){if(!cs(T,r.length)&&cs(P,n.length))return NaN;let F;if(e&&o)F=Xr(r,T,n,P,c),g=Math.min(g,F);else if(e&&!o){const $=r.slice(T[0],T[1]+1);for(let q=P[0];q<=P[1];++q)if(F=ir(n[q],$,c),g=Math.min(g,F),g===0)return g}else if(!e&&o){const $=n.slice(P[0],P[1]+1);for(let q=T[0];q<=T[1];++q)if(F=ir(r[q],$,c),g=Math.min(g,F),g===0)return g}else F=Yr(r,T,n,P,c),g=Math.min(g,F)}else{const F=Ko(T,e),$=Ko(P,o);Xo(_,g,c,r,n,F[0],$[0]),Xo(_,g,c,r,n,F[0],$[1]),Xo(_,g,c,r,n,F[1],$[0]),Xo(_,g,c,r,n,F[1],$[1])}}return g}function Jo(r){return r.type==="MultiPolygon"?r.coordinates.map(e=>({type:"Polygon",coordinates:e})):r.type==="MultiLineString"?r.coordinates.map(e=>({type:"LineString",coordinates:e})):r.type==="MultiPoint"?r.coordinates.map(e=>({type:"Point",coordinates:e})):[r]}class Ps{constructor(e,n){this.type=Je,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(cn(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new Ps(o,o.features.map(c=>Jo(c.geometry)).flat());if(o.type==="Feature")return new Ps(o,Jo(o.geometry));if("type"in o&&"coordinates"in o)return new Ps(o,Jo(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=n.geometry(),f=c.flat().map(b=>uc([b.x,b.y],n.canonical));if(c.length===0)return NaN;const g=new fc(f[0][1]);let _=1/0;for(const b of o){switch(b.type){case"Point":_=Math.min(_,ho(f,!1,[b.coordinates],!1,g,_));break;case"LineString":_=Math.min(_,ho(f,!1,b.coordinates,!0,g,_));break;case"Polygon":_=Math.min(_,Yo(f,!1,b.coordinates,g,_))}if(_===0)return _}return _}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=n.geometry(),f=c.flat().map(b=>uc([b.x,b.y],n.canonical));if(c.length===0)return NaN;const g=new fc(f[0][1]);let _=1/0;for(const b of o){switch(b.type){case"Point":_=Math.min(_,ho(f,!0,[b.coordinates],!1,g,_));break;case"LineString":_=Math.min(_,ho(f,!0,b.coordinates,!0,g,_));break;case"Polygon":_=Math.min(_,Yo(f,!0,b.coordinates,g,_))}if(_===0)return _}return _}(e,this.geometries);if(e.geometryType()==="Polygon")return function(n,o){const c=n.geometry();if(c.length===0||c[0].length===0)return NaN;const f=Wo(c,0).map(b=>b.map(T=>T.map(P=>uc([P.x,P.y],n.canonical)))),g=new fc(f[0][0][0][1]);let _=1/0;for(const b of o)for(const T of f){switch(b.type){case"Point":_=Math.min(_,Yo([b.coordinates],!1,T,g,_));break;case"LineString":_=Math.min(_,Yo(b.coordinates,!0,T,g,_));break;case"Polygon":_=Math.min(_,Mh(T,b.coordinates,g,_))}if(_===0)return _}return _}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const As={"==":lc,"!=":Go,">":su,"<":nu,">=":bh,"<=":Ca,array:An,at:nc,boolean:An,case:Vo,coalesce:ls,collator:Zo,format:Ta,image:lo,in:jo,"index-of":no,interpolate:yn,"interpolate-hcl":yn,"interpolate-lab":yn,length:Ia,let:io,literal:Ws,match:sc,number:An,"number-format":cc,object:An,slice:so,step:ao,string:An,"to-boolean":Kn,"to-color":Kn,"to-number":Kn,"to-string":Kn,var:Xs,within:Js,distance:Ps};class Ji{constructor(e,n,o,c){this.name=e,this.type=n,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const o=e[0],c=Ji.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=g.filter(([T])=>!Array.isArray(T)||T.length===e.length-1);let b=null;for(const[T,P]of _){b=new Er(n.registry,po,n.path,null,n.scope);const A=[];let L=!1;for(let F=1;F<e.length;F++){const $=e[F],q=Array.isArray(T)?T[F-1]:T.type,W=b.parse($,1+A.length,q);if(!W){L=!0;break}A.push(W)}if(!L)if(Array.isArray(T)&&T.length!==A.length)b.error(`Expected ${T.length} arguments, but found ${A.length} instead.`);else{for(let F=0;F<A.length;F++){const $=Array.isArray(T)?T[F]:T.type,q=A[F];b.concat(F+1).checkSubtype($,q.type)}if(b.errors.length===0)return new Ji(o,f,P,A)}}if(_.length===1)n.errors.push(...b.errors);else{const T=(_.length?_:g).map(([A])=>{return L=A,Array.isArray(L)?`(${L.map(j).join(", ")})`:`(${j(L.type)}...)`;var L}).join(" | "),P=[];for(let A=1;A<e.length;A++){const L=n.parse(e[A],1+P.length);if(!L)return null;P.push(j(L.type))}n.error(`Expected arguments of type ${T}, but found (${P.join(", ")}) instead.`)}return null}static register(e,n){Ji.definitions=n;for(const o in n)e[o]=Ji}}function _u(r,[e,n,o,c]){e=e.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const f=c?c.evaluate(r):1,g=$o(e,n,o,f);if(g)throw new ai(g);return new Br(e/255,n/255,o/255,f,!1)}function vu(r,e){return r in e}function yc(r,e){const n=e[r];return n===void 0?null:n}function us(r){return{type:r}}function po(r){if(r instanceof Xs)return po(r.boundExpression);if(r instanceof Ji&&r.name==="error"||r instanceof Zo||r instanceof Js||r instanceof Ps)return!1;const e=r instanceof Kn||r instanceof An;let n=!0;return r.eachChild(o=>{n=e?n&&po(o):n&&o instanceof Ws}),!!n&&fo(r)&&mo(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function fo(r){if(r instanceof Ji&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Js||r instanceof Ps)return!1;let e=!0;return r.eachChild(n=>{e&&!fo(n)&&(e=!1)}),e}function La(r){if(r instanceof Ji&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(n=>{e&&!La(n)&&(e=!1)}),e}function mo(r,e){if(r instanceof Ji&&e.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(o=>{n&&!mo(o,e)&&(n=!1)}),n}function Ra(r){return{result:"success",value:r}}function Qs(r){return{result:"error",value:r}}function Xn(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function xu(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Qo(r){return!!r.expression&&r.expression.interpolated}function kr(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Fa(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function el(r){return r}function ea(r,e){const n=e.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",c=o||!(o||r.property!==void 0),f=r.type||(Qo(e)?"exponential":"interval");if(n||e.type==="padding"){const P=n?Br.parse:ln.parse;(r=Fr({},r)).stops&&(r.stops=r.stops.map(A=>[A[0],P(A[1])])),r.default=P(r.default?r.default:e.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let _,b,T;if(f==="exponential")_=_c;else if(f==="interval")_=bu;else if(f==="categorical"){_=go,b=Object.create(null);for(const P of r.stops)b[P[0]]=P[1];T=typeof r.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);_=Ba}if(o){const P={},A=[];for(let $=0;$<r.stops.length;$++){const q=r.stops[$],W=q[0].zoom;P[W]===void 0&&(P[W]={zoom:W,type:r.type,property:r.property,default:r.default,stops:[]},A.push(W)),P[W].stops.push([q[0].value,q[1]])}const L=[];for(const $ of A)L.push([P[$].zoom,ea(P[$],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:yn.interpolationFactor.bind(void 0,F),zoomStops:L.map($=>$[0]),evaluate:({zoom:$},q)=>_c({stops:L,base:r.base},e,$).evaluate($,q)}}if(c){const P=f==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:yn.interpolationFactor.bind(void 0,P),zoomStops:r.stops.map(A=>A[0]),evaluate:({zoom:A})=>_(r,e,A,b,T)}}return{kind:"source",evaluate(P,A){const L=A&&A.properties?A.properties[r.property]:void 0;return L===void 0?hs(r.default,e.default):_(r,e,L,b,T)}}}function hs(r,e,n){return r!==void 0?r:e!==void 0?e:n!==void 0?n:void 0}function go(r,e,n,o,c){return hs(typeof n===c?o[n]:void 0,r.default,e.default)}function bu(r,e,n){if(kr(n)!=="number")return hs(r.default,e.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const c=Uo(r.stops.map(f=>f[0]),n);return r.stops[c][1]}function _c(r,e,n){const o=r.base!==void 0?r.base:1;if(kr(n)!=="number")return hs(r.default,e.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const f=Uo(r.stops.map(P=>P[0]),n),g=function(P,A,L,F){const $=F-L,q=P-L;return $===0?0:A===1?q/$:(Math.pow(A,q)-1)/(Math.pow(A,$)-1)}(n,o,r.stops[f][0],r.stops[f+1][0]),_=r.stops[f][1],b=r.stops[f+1][1],T=qi[e.type]||el;return typeof _.evaluate=="function"?{evaluate(...P){const A=_.evaluate.apply(void 0,P),L=b.evaluate.apply(void 0,P);if(A!==void 0&&L!==void 0)return T(A,L,g,r.colorSpace)}}:T(_,b,g,r.colorSpace)}function Ba(r,e,n){switch(e.type){case"color":n=Br.parse(n);break;case"formatted":n=gn.fromString(n.toString());break;case"resolvedImage":n=Ri.fromString(n.toString());break;case"padding":n=ln.parse(n);break;default:kr(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return hs(n,r.default,e.default)}Ji.register(As,{error:[{kind:"error"},[Nt],(r,[e])=>{throw new ai(e.evaluate(r))}],typeof:[Nt,[Kt],(r,[e])=>j(mi(e.evaluate(r)))],"to-rgba":[B(Je,4),[ui],(r,[e])=>{const[n,o,c,f]=e.evaluate(r).rgb;return[255*n,255*o,255*c,f]}],rgb:[ui,[Je,Je,Je],_u],rgba:[ui,[Je,Je,Je,Je],_u],has:{type:Vt,overloads:[[[Nt],(r,[e])=>vu(e.evaluate(r),r.properties())],[[Nt,Vi],(r,[e,n])=>vu(e.evaluate(r),n.evaluate(r))]]},get:{type:Kt,overloads:[[[Nt],(r,[e])=>yc(e.evaluate(r),r.properties())],[[Nt,Vi],(r,[e,n])=>yc(e.evaluate(r),n.evaluate(r))]]},"feature-state":[Kt,[Nt],(r,[e])=>yc(e.evaluate(r),r.featureState||{})],properties:[Vi,[],r=>r.properties()],"geometry-type":[Nt,[],r=>r.geometryType()],id:[Kt,[],r=>r.id()],zoom:[Je,[],r=>r.globals.zoom],"heatmap-density":[Je,[],r=>r.globals.heatmapDensity||0],"line-progress":[Je,[],r=>r.globals.lineProgress||0],accumulated:[Kt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Je,us(Je),(r,e)=>{let n=0;for(const o of e)n+=o.evaluate(r);return n}],"*":[Je,us(Je),(r,e)=>{let n=1;for(const o of e)n*=o.evaluate(r);return n}],"-":{type:Je,overloads:[[[Je,Je],(r,[e,n])=>e.evaluate(r)-n.evaluate(r)],[[Je],(r,[e])=>-e.evaluate(r)]]},"/":[Je,[Je,Je],(r,[e,n])=>e.evaluate(r)/n.evaluate(r)],"%":[Je,[Je,Je],(r,[e,n])=>e.evaluate(r)%n.evaluate(r)],ln2:[Je,[],()=>Math.LN2],pi:[Je,[],()=>Math.PI],e:[Je,[],()=>Math.E],"^":[Je,[Je,Je],(r,[e,n])=>Math.pow(e.evaluate(r),n.evaluate(r))],sqrt:[Je,[Je],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Je,[Je],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Je,[Je],(r,[e])=>Math.log(e.evaluate(r))],log2:[Je,[Je],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Je,[Je],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Je,[Je],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Je,[Je],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Je,[Je],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Je,[Je],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Je,[Je],(r,[e])=>Math.atan(e.evaluate(r))],min:[Je,us(Je),(r,e)=>Math.min(...e.map(n=>n.evaluate(r)))],max:[Je,us(Je),(r,e)=>Math.max(...e.map(n=>n.evaluate(r)))],abs:[Je,[Je],(r,[e])=>Math.abs(e.evaluate(r))],round:[Je,[Je],(r,[e])=>{const n=e.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Je,[Je],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Je,[Je],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Vt,[Nt,Kt],(r,[e,n])=>r.properties()[e.value]===n.value],"filter-id-==":[Vt,[Kt],(r,[e])=>r.id()===e.value],"filter-type-==":[Vt,[Nt],(r,[e])=>r.geometryType()===e.value],"filter-<":[Vt,[Nt,Kt],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[Vt,[Kt],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[Vt,[Nt,Kt],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[Vt,[Kt],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[Vt,[Nt,Kt],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[Vt,[Kt],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[Vt,[Nt,Kt],(r,[e,n])=>{const o=r.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[Vt,[Kt],(r,[e])=>{const n=r.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[Vt,[Kt],(r,[e])=>e.value in r.properties()],"filter-has-id":[Vt,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Vt,[B(Nt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Vt,[B(Kt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Vt,[Nt,B(Kt)],(r,[e,n])=>n.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Vt,[Nt,B(Kt)],(r,[e,n])=>function(o,c,f,g){for(;f<=g;){const _=f+g>>1;if(c[_]===o)return!0;c[_]>o?g=_-1:f=_+1}return!1}(r.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Vt,overloads:[[[Vt,Vt],(r,[e,n])=>e.evaluate(r)&&n.evaluate(r)],[us(Vt),(r,e)=>{for(const n of e)if(!n.evaluate(r))return!1;return!0}]]},any:{type:Vt,overloads:[[[Vt,Vt],(r,[e,n])=>e.evaluate(r)||n.evaluate(r)],[us(Vt),(r,e)=>{for(const n of e)if(n.evaluate(r))return!0;return!1}]]},"!":[Vt,[Vt],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Vt,[Nt],(r,[e])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(e.evaluate(r))}],upcase:[Nt,[Nt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Nt,[Nt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Nt,us(Kt),(r,e)=>e.map(n=>to(n.evaluate(r))).join("")],"resolved-locale":[Nt,[as],(r,[e])=>e.evaluate(r).resolvedLocale()]});class vc{constructor(e,n){var o;this.expression=e,this._warningHistory={},this._evaluator=new wa,this._defaultValue=n?(o=n).type==="color"&&Fa(o.default)?new Br(0,0,0,0):o.type==="color"?Br.parse(o.default)||null:o.type==="padding"?ln.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Ui.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,f,g){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,f,g){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new ai(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function tl(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in As}function rl(r,e){const n=new Er(As,po,[],e?function(c){const f={color:ui,string:Nt,number:Je,enum:Nt,boolean:Vt,formatted:os,padding:Ii,resolvedImage:K,variableAnchorOffsetCollection:R};return c.type==="array"?B(f[c.value]||Kt,c.length):f[c.type]}(e):void 0),o=n.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Ra(new vc(o,e)):Qs(n.errors)}class il{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!La(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,f,g)}evaluate(e,n,o,c,f,g){return this._styleExpression.evaluate(e,n,o,c,f,g)}}class yo{constructor(e,n,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!La(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,f,g)}evaluate(e,n,o,c,f,g){return this._styleExpression.evaluate(e,n,o,c,f,g)}interpolationFactor(e,n,o){return this.interpolationType?yn.interpolationFactor(this.interpolationType,e,n,o):0}}function _o(r,e){const n=rl(r,e);if(n.result==="error")return n;const o=n.value.expression,c=fo(o);if(!c&&!Xn(e))return Qs([new br("","data expressions not supported")]);const f=mo(o,["zoom"]);if(!f&&!xu(e))return Qs([new br("","zoom expressions not supported")]);const g=Gi(o);return g||f?g instanceof br?Qs([g]):g instanceof yn&&!Qo(e)?Qs([new br("",'"interpolate" expressions cannot be used with this property')]):Ra(g?new yo(c?"camera":"composite",n.value,g.labels,g instanceof yn?g.interpolation:void 0):new il(c?"constant":"source",n.value)):Qs([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yn{constructor(e,n){this._parameters=e,this._specification=n,Fr(this,ea(this._parameters,this._specification))}static deserialize(e){return new Yn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Gi(r){let e=null;if(r instanceof io)e=Gi(r.result);else if(r instanceof ls){for(const n of r.args)if(e=Gi(n),e)break}else(r instanceof ao||r instanceof yn)&&r.input instanceof Ji&&r.input.name==="zoom"&&(e=r);return e instanceof br||r.eachChild(n=>{const o=Gi(n);o instanceof br?e=o:!e&&o?e=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ta(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!ta(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const xc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function vo(r){if(r==null)return{filter:()=>!0,needGeometry:!1};ta(r)||(r=xo(r));const e=rl(r,xc);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,c)=>e.value.evaluate(n,o,{},c),needGeometry:Na(r)}}function zh(r,e){return r<e?-1:r>e?1:0}function Na(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Na(r[e]))return!0;return!1}function xo(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Oa(r[1],r[2],"=="):e==="!="?sl(Oa(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Oa(r[1],r[2],e):e==="any"?(n=r.slice(1),["any"].concat(n.map(xo))):e==="all"?["all"].concat(r.slice(1).map(xo)):e==="none"?["all"].concat(r.slice(1).map(xo).map(sl)):e==="in"?bc(r[1],r.slice(2)):e==="!in"?sl(bc(r[1],r.slice(2))):e==="has"?nl(r[1]):e!=="!has"||sl(nl(r[1]));var n}function Oa(r,e,n){switch(r){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,r,e]}}function bc(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",r,["literal",e.sort(zh)]]:["filter-in-small",r,["literal",e]]}}function nl(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function sl(r){return["!",r]}function ra(r){const e=typeof r;if(e==="number"||e==="boolean"||e==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const f of r)c+=`${ra(f)},`;return`${c}]`}const n=Object.keys(r).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${ra(r[n[c]])},`;return`${o}}`}function Dh(r){let e="";for(const n of Ne)e+=`/${ra(r[n])}`;return e}function al(r){const e=r.value;return e?[new Ze(r.key,e,"constants have been deprecated as of v8")]:[]}function ni(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ds(r){if(Array.isArray(r))return r.map(ds);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const n in r)e[n]=ds(r[n]);return e}return ni(r)}function vn(r){const e=r.key,n=r.value,o=r.valueSpec||{},c=r.objectElementValidators||{},f=r.style,g=r.styleSpec,_=r.validateSpec;let b=[];const T=kr(n);if(T!=="object")return[new Ze(e,n,`object expected, ${T} found`)];for(const P in n){const A=P.split(".")[0],L=o[A]||o["*"];let F;if(c[A])F=c[A];else if(o[A])F=_;else if(c["*"])F=c["*"];else{if(!o["*"]){b.push(new Ze(e,n[P],`unknown property "${P}"`));continue}F=_}b=b.concat(F({key:(e&&`${e}.`)+P,value:n[P],valueSpec:L,style:f,styleSpec:g,object:n,objectKey:P,validateSpec:_},n))}for(const P in o)c[P]||o[P].required&&o[P].default===void 0&&n[P]===void 0&&b.push(new Ze(e,n,`missing required property "${P}"`));return b}function ol(r){const e=r.value,n=r.valueSpec,o=r.style,c=r.styleSpec,f=r.key,g=r.arrayElementValidator||r.validateSpec;if(kr(e)!=="array")return[new Ze(f,e,`array expected, ${kr(e)} found`)];if(n.length&&e.length!==n.length)return[new Ze(f,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Ze(f,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let _={type:n.value,values:n.values};c.$version<7&&(_.function=n.function),kr(n.value)==="object"&&(_=n.value);let b=[];for(let T=0;T<e.length;T++)b=b.concat(g({array:e,arrayIndex:T,value:e[T],valueSpec:_,validateSpec:r.validateSpec,style:o,styleSpec:c,key:`${f}[${T}]`}));return b}function wc(r){const e=r.key,n=r.value,o=r.valueSpec;let c=kr(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Ze(e,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new Ze(e,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ze(e,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function ll(r){const e=r.valueSpec,n=ni(r.value.type);let o,c,f,g={};const _=n!=="categorical"&&r.value.property===void 0,b=!_,T=kr(r.value.stops)==="array"&&kr(r.value.stops[0])==="array"&&kr(r.value.stops[0][0])==="object",P=vn({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(F){if(n==="identity")return[new Ze(F.key,F.value,'identity function may not have a "stops" property')];let $=[];const q=F.value;return $=$.concat(ol({key:F.key,value:q,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:A})),kr(q)==="array"&&q.length===0&&$.push(new Ze(F.key,q,"array must have at least one stop")),$},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return n==="identity"&&_&&P.push(new Ze(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||P.push(new Ze(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!Qo(r.valueSpec)&&P.push(new Ze(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(b&&!Xn(r.valueSpec)?P.push(new Ze(r.key,r.value,"property functions not supported")):_&&!xu(r.valueSpec)&&P.push(new Ze(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!T||r.value.property!==void 0||P.push(new Ze(r.key,r.value,'"property" property is required')),P;function A(F){let $=[];const q=F.value,W=F.key;if(kr(q)!=="array")return[new Ze(W,q,`array expected, ${kr(q)} found`)];if(q.length!==2)return[new Ze(W,q,`array length 2 expected, length ${q.length} found`)];if(T){if(kr(q[0])!=="object")return[new Ze(W,q,`object expected, ${kr(q[0])} found`)];if(q[0].zoom===void 0)return[new Ze(W,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Ze(W,q,"object stop key must have value")];if(f&&f>ni(q[0].zoom))return[new Ze(W,q[0].zoom,"stop zoom values must appear in ascending order")];ni(q[0].zoom)!==f&&(f=ni(q[0].zoom),c=void 0,g={}),$=$.concat(vn({key:`${W}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:wc,value:L}}))}else $=$.concat(L({key:`${W}[0]`,value:q[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},q));return tl(ds(q[1]))?$.concat([new Ze(`${W}[1]`,q[1],"expressions are not allowed in function stops.")]):$.concat(F.validateSpec({key:`${W}[1]`,value:q[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function L(F,$){const q=kr(F.value),W=ni(F.value),se=F.value!==null?F.value:$;if(o){if(q!==o)return[new Ze(F.key,se,`${q} stop domain type must match previous stop domain type ${o}`)]}else o=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Ze(F.key,se,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&n!=="categorical"){let Se=`number expected, ${q} found`;return Xn(e)&&n===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ze(F.key,se,Se)]}return n!=="categorical"||q!=="number"||isFinite(W)&&Math.floor(W)===W?n!=="categorical"&&q==="number"&&c!==void 0&&W<c?[new Ze(F.key,se,"stop domain values must appear in ascending order")]:(c=W,n==="categorical"&&W in g?[new Ze(F.key,se,"stop domain values must be unique")]:(g[W]=!0,[])):[new Ze(F.key,se,`integer expected, found ${W}`)]}}function ps(r){const e=(r.expressionContext==="property"?_o:rl)(ds(r.value),r.valueSpec);if(e.result==="error")return e.value.map(o=>new Ze(`${r.key}${o.key}`,r.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Ze(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!La(n))return[new Ze(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!La(n))return[new Ze(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!mo(n,["zoom","feature-state"]))return[new Ze(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!fo(n))return[new Ze(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $a(r){const e=r.key,n=r.value,o=r.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(ni(n))===-1&&c.push(new Ze(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(ni(n))===-1&&c.push(new Ze(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function cl(r){return ta(ds(r.value))?ps(Fr({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ul(r)}function ul(r){const e=r.value,n=r.key;if(kr(e)!=="array")return[new Ze(n,e,`array expected, ${kr(e)} found`)];const o=r.styleSpec;let c,f=[];if(e.length<1)return[new Ze(n,e,"filter array must have at least 1 element")];switch(f=f.concat($a({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),ni(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ni(e[1])==="$type"&&f.push(new Ze(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new Ze(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=kr(e[1]),c!=="string"&&f.push(new Ze(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let g=2;g<e.length;g++)c=kr(e[g]),ni(e[1])==="$type"?f=f.concat($a({key:`${n}[${g}]`,value:e[g],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&f.push(new Ze(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)f=f.concat(ul({key:`${n}[${g}]`,value:e[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=kr(e[1]),e.length!==2?f.push(new Ze(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&f.push(new Ze(`${n}[1]`,e[1],`string expected, ${c} found`))}return f}function hl(r,e){const n=r.key,o=r.validateSpec,c=r.style,f=r.styleSpec,g=r.value,_=r.objectKey,b=f[`${e}_${r.layerType}`];if(!b)return[];const T=_.match(/^(.*)-transition$/);if(e==="paint"&&T&&b[T[1]]&&b[T[1]].transition)return o({key:n,value:g,valueSpec:f.transition,style:c,styleSpec:f});const P=r.valueSpec||b[_];if(!P)return[new Ze(n,g,`unknown property "${_}"`)];let A;if(kr(g)==="string"&&Xn(P)&&!P.tokens&&(A=/^{([^}]+)}$/.exec(g)))return[new Ze(n,g,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const L=[];return r.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&L.push(new Ze(n,g,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Fa(ds(g))&&ni(g.type)==="identity"&&L.push(new Ze(n,g,'"text-font" does not support identity functions'))),L.concat(o({key:r.key,value:g,valueSpec:P,style:c,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:_}))}function dl(r){return hl(r,"paint")}function pl(r){return hl(r,"layout")}function wu(r){let e=[];const n=r.value,o=r.key,c=r.style,f=r.styleSpec;n.type||n.ref||e.push(new Ze(o,n,'either "type" or "ref" is required'));let g=ni(n.type);const _=ni(n.ref);if(n.id){const b=ni(n.id);for(let T=0;T<r.arrayIndex;T++){const P=c.layers[T];ni(P.id)===b&&e.push(new Ze(o,n.id,`duplicate layer id "${n.id}", previously used at line ${P.id.__line__}`))}}if("ref"in n){let b;["type","source","source-layer","filter","layout"].forEach(T=>{T in n&&e.push(new Ze(o,n[T],`"${T}" is prohibited for ref layers`))}),c.layers.forEach(T=>{ni(T.id)===_&&(b=T)}),b?b.ref?e.push(new Ze(o,n.ref,"ref cannot reference another ref layer")):g=ni(b.type):e.push(new Ze(o,n.ref,`ref layer "${_}" not found`))}else if(g!=="background")if(n.source){const b=c.sources&&c.sources[n.source],T=b&&ni(b.type);b?T==="vector"&&g==="raster"?e.push(new Ze(o,n.source,`layer "${n.id}" requires a raster source`)):T!=="raster-dem"&&g==="hillshade"?e.push(new Ze(o,n.source,`layer "${n.id}" requires a raster-dem source`)):T==="raster"&&g!=="raster"?e.push(new Ze(o,n.source,`layer "${n.id}" requires a vector source`)):T!=="vector"||n["source-layer"]?T==="raster-dem"&&g!=="hillshade"?e.push(new Ze(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||T==="geojson"&&b.lineMetrics||e.push(new Ze(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ze(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Ze(o,n.source,`source "${n.source}" not found`))}else e.push(new Ze(o,n,'missing required property "source"'));return e=e.concat(vn({key:o,value:n,valueSpec:f.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:f.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:cl,layout:b=>vn({layer:n,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":T=>pl(Fr({layerType:g},T))}}),paint:b=>vn({layer:n,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,validateSpec:b.validateSpec,objectElementValidators:{"*":T=>dl(Fr({layerType:g},T))}})}})),e}function Ms(r){const e=r.value,n=r.key,o=kr(e);return o!=="string"?[new Ze(n,e,`string expected, ${o} found`)]:[]}const zs={promoteId:function({key:r,value:e}){if(kr(e)==="string")return Ms({key:r,value:e});{const n=[];for(const o in e)n.push(...Ms({key:`${r}.${o}`,value:e[o]}));return n}}};function Sc(r){const e=r.value,n=r.key,o=r.styleSpec,c=r.style,f=r.validateSpec;if(!e.type)return[new Ze(n,e,'"type" is required')];const g=ni(e.type);let _;switch(g){case"vector":case"raster":return _=vn({key:n,value:e,valueSpec:o[`source_${g.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:zs,validateSpec:f}),_;case"raster-dem":return _=function(b){var T;const P=(T=b.sourceName)!==null&&T!==void 0?T:"",A=b.value,L=b.styleSpec,F=L.source_raster_dem,$=b.style;let q=[];const W=kr(A);if(A===void 0)return q;if(W!=="object")return q.push(new Ze("source_raster_dem",A,`object expected, ${W} found`)),q;const se=ni(A.encoding)==="custom",Se=["redFactor","greenFactor","blueFactor","baseShift"],ue=b.value.encoding?`"${b.value.encoding}"`:"Default";for(const xe in A)!se&&Se.includes(xe)?q.push(new Ze(xe,A[xe],`In "${P}": "${xe}" is only valid when "encoding" is set to "custom". ${ue} encoding found`)):F[xe]?q=q.concat(b.validateSpec({key:xe,value:A[xe],valueSpec:F[xe],validateSpec:b.validateSpec,style:$,styleSpec:L})):q.push(new Ze(xe,A[xe],`unknown property "${xe}"`));return q}({sourceName:n,value:e,style:r.style,styleSpec:o,validateSpec:f}),_;case"geojson":if(_=vn({key:n,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:f,objectElementValidators:zs}),e.cluster)for(const b in e.clusterProperties){const[T,P]=e.clusterProperties[b],A=typeof T=="string"?[T,["accumulated"],["get",b]]:T;_.push(...ps({key:`${n}.${b}.map`,value:P,validateSpec:f,expressionContext:"cluster-map"})),_.push(...ps({key:`${n}.${b}.reduce`,value:A,validateSpec:f,expressionContext:"cluster-reduce"}))}return _;case"video":return vn({key:n,value:e,valueSpec:o.source_video,style:c,validateSpec:f,styleSpec:o});case"image":return vn({key:n,value:e,valueSpec:o.source_image,style:c,validateSpec:f,styleSpec:o});case"canvas":return[new Ze(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $a({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:f,styleSpec:o})}}function kc(r){const e=r.value,n=r.styleSpec,o=n.light,c=r.style;let f=[];const g=kr(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new Ze("light",e,`object expected, ${g} found`)]),f;for(const _ in e){const b=_.match(/^(.*)-transition$/);f=f.concat(b&&o[b[1]]&&o[b[1]].transition?r.validateSpec({key:_,value:e[_],valueSpec:n.transition,validateSpec:r.validateSpec,style:c,styleSpec:n}):o[_]?r.validateSpec({key:_,value:e[_],valueSpec:o[_],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ze(_,e[_],`unknown property "${_}"`)])}return f}function Ds(r){const e=r.value,n=r.styleSpec,o=n.sky,c=r.style,f=kr(e);if(e===void 0)return[];if(f!=="object")return[new Ze("sky",e,`object expected, ${f} found`)];let g=[];for(const _ in e)g=g.concat(o[_]?r.validateSpec({key:_,value:e[_],valueSpec:o[_],style:c,styleSpec:n}):[new Ze(_,e[_],`unknown property "${_}"`)]);return g}function Su(r){const e=r.value,n=r.styleSpec,o=n.terrain,c=r.style;let f=[];const g=kr(e);if(e===void 0)return f;if(g!=="object")return f=f.concat([new Ze("terrain",e,`object expected, ${g} found`)]),f;for(const _ in e)f=f.concat(o[_]?r.validateSpec({key:_,value:e[_],valueSpec:o[_],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ze(_,e[_],`unknown property "${_}"`)]);return f}function ku(r){let e=[];const n=r.value,o=r.key;if(Array.isArray(n)){const c=[],f=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&e.push(new Ze(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&f.includes(n[g].url)&&e.push(new Ze(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),f.push(n[g].url),e=e.concat(vn({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return e}return Ms({key:o,value:n})}const Cc={"*":()=>[],array:ol,boolean:function(r){const e=r.value,n=r.key,o=kr(e);return o!=="boolean"?[new Ze(n,e,`boolean expected, ${o} found`)]:[]},number:wc,color:function(r){const e=r.key,n=r.value,o=kr(n);return o!=="string"?[new Ze(e,n,`color expected, ${o} found`)]:Br.parse(String(n))?[]:[new Ze(e,n,`color expected, "${n}" found`)]},constants:al,enum:$a,filter:cl,function:ll,layer:wu,object:vn,source:Sc,light:kc,sky:Ds,terrain:Su,string:Ms,formatted:function(r){return Ms(r).length===0?[]:ps(r)},resolvedImage:function(r){return Ms(r).length===0?[]:ps(r)},padding:function(r){const e=r.key,n=r.value;if(kr(n)==="array"){if(n.length<1||n.length>4)return[new Ze(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let f=0;f<n.length;f++)c=c.concat(r.validateSpec({key:`${e}[${f}]`,value:n[f],validateSpec:r.validateSpec,valueSpec:o}));return c}return wc({key:e,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const e=r.key,n=r.value,o=kr(n),c=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Ze(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let g=0;g<n.length;g+=2)f=f.concat($a({key:`${e}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),f=f.concat(ol({key:`${e}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return f},sprite:ku};function ja(r){const e=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=ja,n.expression&&Fa(ni(e))?ll(r):n.expression&&tl(ds(e))?ps(r):n.type&&Cc[n.type]?Cc[n.type](r):vn(Fr({},r,{valueSpec:n.type?o[n.type]:n}))}function Tc(r){const e=r.value,n=r.key,o=Ms(r);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Ze(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Ze(n,e,'"glyphs" url must include a "{range}" token'))),o}function un(r,e=Ee){let n=[];return n=n.concat(ja({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,validateSpec:ja,objectElementValidators:{glyphs:Tc,"*":()=>[]}})),r.constants&&(n=n.concat(al({key:"constants",value:r.constants,style:r,styleSpec:e,validateSpec:ja}))),Ic(n)}function Jr(r){return function(e){return r({...e,validateSpec:ja})}}function Ic(r){return[].concat(r).sort((e,n)=>e.line-n.line)}function xn(r){return function(...e){return Ic(r.apply(this,e))}}un.source=xn(Jr(Sc)),un.sprite=xn(Jr(ku)),un.glyphs=xn(Jr(Tc)),un.light=xn(Jr(kc)),un.sky=xn(Jr(Ds)),un.terrain=xn(Jr(Su)),un.layer=xn(Jr(wu)),un.filter=xn(Jr(cl)),un.paintProperty=xn(Jr(dl)),un.layoutProperty=xn(Jr(pl));const Ls=un,Cu=Ls.light,Ec=Ls.paintProperty,Tu=Ls.layoutProperty;function fl(r,e){let n=!1;if(e&&e.length)for(const o of e)r.fire(new or(new Error(o.message))),n=!0;return n}class ia{constructor(e,n,o){const c=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let b=0;b<this.d*this.d;b++){const T=g[3+b],P=g[3+b+1];c.push(T===P?null:g.subarray(T,P))}const _=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],_),this.bboxes=g.subarray(_),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=o,this.scale=n/e,this.uid=0;const f=o/n*e;this.min=-f,this.max=e+f}insert(e,n,o,c,f){this._forEachCell(n,o,c,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,o,c,f,g){this.cells[f].push(g)}query(e,n,o,c,f){const g=this.min,_=this.max;if(e<=g&&n<=g&&_<=o&&_<=c&&!f)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(e,n,o,c,this._queryCell,b,{},f),b}}_queryCell(e,n,o,c,f,g,_,b){const T=this.cells[f];if(T!==null){const P=this.keys,A=this.bboxes;for(let L=0;L<T.length;L++){const F=T[L];if(_[F]===void 0){const $=4*F;(b?b(A[$+0],A[$+1],A[$+2],A[$+3]):e<=A[$+2]&&n<=A[$+3]&&o>=A[$+0]&&c>=A[$+1])?(_[F]=!0,g.push(P[F])):_[F]=!1}}}}_forEachCell(e,n,o,c,f,g,_,b){const T=this._convertToCellCoord(e),P=this._convertToCellCoord(n),A=this._convertToCellCoord(o),L=this._convertToCellCoord(c);for(let F=T;F<=A;F++)for(let $=P;$<=L;$++){const q=this.d*$+F;if((!b||b(this._convertFromCellCoord(F),this._convertFromCellCoord($),this._convertFromCellCoord(F+1),this._convertFromCellCoord($+1)))&&f.call(this,e,n,o,c,q,g,_,b))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let f=n;for(let g=0;g<e.length;g++){const _=e[g];c[3+g]=f,c.set(_,f),f+=_.length}return c[3+e.length]=f,c.set(this.keys,f),f+=this.keys.length,c[3+e.length+1]=f,c.set(this.bboxes,f),f+=this.bboxes.length,c.buffer}static serialize(e,n){const o=e.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(e){return new ia(e.buffer)}}const Rs={};function bt(r,e,n={}){if(Rs[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),Rs[r]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}bt("Object",Object),bt("TransferableGridIndex",ia),bt("Color",Br),bt("Error",Error),bt("AJAXError",ar),bt("ResolvedImage",Ri),bt("StylePropertyFunction",Yn),bt("StyleExpression",vc,{omit:["_evaluator"]}),bt("ZoomDependentExpression",yo),bt("ZoomConstantExpression",il),bt("CompoundExpression",Ji,{omit:["_evaluate"]});for(const r in As)As[r]._classRegistryKey||bt(`Expression_${r}`,As[r]);function Pc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function bo(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error)return r;if(Pc(r)||pt(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const n=r;return e&&e.push(n.buffer),n}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const n=[];for(const o of r)n.push(bo(o,e));return n}if(typeof r=="object"){const n=r.constructor,o=n._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${n.name}`);if(!Rs[o])throw new Error(`${o} is not registered.`);const c=n.serialize?n.serialize(r,e):{};if(n.serialize){if(e&&c===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in r){if(!r.hasOwnProperty(f)||Rs[o].omit.indexOf(f)>=0)continue;const g=r[f];c[f]=Rs[o].shallow.indexOf(f)>=0?g:bo(g,e)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof r)}function Jn(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||Pc(r)||pt(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Jn);if(typeof r=="object"){const e=r.$name||"Object";if(!Rs[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Rs[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const f=r[c];o[c]=Rs[e].shallow.indexOf(c)>=0?f:Jn(f)}return o}throw new Error("can't deserialize object of type "+typeof r)}class Iu{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const ft={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Fs(r){for(const e of r)if(Ac(e.charCodeAt(0)))return!0;return!1}function Lh(r){for(const e of r)if(!Eu(e.charCodeAt(0)))return!1;return!0}function Eu(r){return!(ft.Arabic(r)||ft["Arabic Supplement"](r)||ft["Arabic Extended-A"](r)||ft["Arabic Presentation Forms-A"](r)||ft["Arabic Presentation Forms-B"](r))}function Ac(r){return!(r!==746&&r!==747&&(r<4352||!(ft["Bopomofo Extended"](r)||ft.Bopomofo(r)||ft["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||ft["CJK Compatibility Ideographs"](r)||ft["CJK Compatibility"](r)||ft["CJK Radicals Supplement"](r)||ft["CJK Strokes"](r)||!(!ft["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||ft["CJK Unified Ideographs Extension A"](r)||ft["CJK Unified Ideographs"](r)||ft["Enclosed CJK Letters and Months"](r)||ft["Hangul Compatibility Jamo"](r)||ft["Hangul Jamo Extended-A"](r)||ft["Hangul Jamo Extended-B"](r)||ft["Hangul Jamo"](r)||ft["Hangul Syllables"](r)||ft.Hiragana(r)||ft["Ideographic Description Characters"](r)||ft.Kanbun(r)||ft["Kangxi Radicals"](r)||ft["Katakana Phonetic Extensions"](r)||ft.Katakana(r)&&r!==12540||!(!ft["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!ft["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||ft["Unified Canadian Aboriginal Syllabics"](r)||ft["Unified Canadian Aboriginal Syllabics Extended"](r)||ft["Vertical Forms"](r)||ft["Yijing Hexagram Symbols"](r)||ft["Yi Syllables"](r)||ft["Yi Radicals"](r))))}function Mc(r){return!(Ac(r)||function(e){return!!(ft["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ft["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ft["Letterlike Symbols"](e)||ft["Number Forms"](e)||ft["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ft["Control Pictures"](e)&&e!==9251||ft["Optical Character Recognition"](e)||ft["Enclosed Alphanumerics"](e)||ft["Geometric Shapes"](e)||ft["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ft["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ft["CJK Symbols and Punctuation"](e)||ft.Katakana(e)||ft["Private Use Area"](e)||ft["CJK Compatibility Forms"](e)||ft["Small Form Variants"](e)||ft["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function bn(r){return r>=1424&&r<=2303||ft["Arabic Presentation Forms-A"](r)||ft["Arabic Presentation Forms-B"](r)}function Pu(r,e){return!(!e&&bn(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||ft.Khmer(r))}function ml(r){for(const e of r)if(bn(e.charCodeAt(0)))return!0;return!1}const Bs=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class jr{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Iu,this.transition={})}isSupportedScript(e){return function(n,o){for(const c of n)if(!Pu(c.charCodeAt(0),o))return!1;return!0}(e,Bs.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class gl{constructor(e,n){this.property=e,this.value=n,this.expression=function(o,c){if(Fa(o))return new Yn(o,c);if(tl(o)){const f=_o(o,c);if(f.result==="error")throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=o;return c.type==="color"&&typeof o=="string"?f=Br.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(f=Ui.parse(o)):f=ln.parse(o),{kind:"constant",evaluate:()=>f}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class Va{constructor(e){this.property=e,this.value=new gl(e,void 0)}transitioned(e,n){return new Au(this.property,this.value,n,Ge({},e.transition,this.transition),e.now)}untransitioned(){return new Au(this.property,this.value,null,{},0)}}class Ua{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Me(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Va(this._values[e].property)),this._values[e].value=new gl(this._values[e].property,n===null?void 0:Me(n))}getTransition(e){return Me(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Va(this._values[e].property)),this._values[e].transition=Me(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const o=new zc(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){const e=new zc(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Au{constructor(e,n,o,c,f){this.property=e,this.value=n,this.begin=f+c.delay||0,this.end=this.begin+c.duration||0,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const c=e.now||0,f=this.value.possiblyEvaluate(e,n,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return g.possiblyEvaluate(e,n,o);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,o),f,function(b){if(b<=0)return 0;if(b>=1)return 1;const T=b*b,P=T*b;return 4*(b<.5?P:3*(b-T)+P-.75)}(_))}}return f}}class zc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const c=new yl(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,n,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class wo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Me(this._values[e].value)}setValue(e,n){this._values[e]=new gl(this._values[e].property,n===null?void 0:Me(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const c=new yl(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,n,o);return c}}class Qn{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class yl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Pt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,o){const c=qi[this.specification.type];return c?c(e,n,o):e}}class jt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new Qn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Qn(this,{kind:"constant",value:void 0},e.parameters);const c=qi[this.specification.type];if(c){const f=c(e.value.value,n.value.value,o);return new Qn(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,n,o,c,f,g){return e.kind==="constant"?e.value:e.evaluate(n,o,c,f,g)}}class p extends jt{possiblyEvaluate(e,n,o,c){if(e.value===void 0)return new Qn(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const f=e.expression.evaluate(n,null,{},o,c),g=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,_=this._calculate(g,g,g,n);return new Qn(this,{kind:"constant",value:_},n)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Qn(this,{kind:"constant",value:f},n)}return new Qn(this,e.expression,n)}evaluate(e,n,o,c,f,g){if(e.kind==="source"){const _=e.evaluate(n,o,c,f,g);return this._calculate(_,_,_,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,c),e.evaluate({zoom:Math.floor(n.zoom)},o,c),e.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):e.value}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class t{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(n,null,{},o,c);return this._calculate(f,f,f,n)}return this._calculate(e.expression.evaluate(new jr(Math.floor(n.zoom-1),n)),e.expression.evaluate(new jr(Math.floor(n.zoom),n)),e.expression.evaluate(new jr(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class a{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class l{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new gl(o,void 0),f=this.defaultTransitionablePropertyValues[n]=new Va(o);this.defaultTransitioningPropertyValues[n]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}bt("DataDrivenProperty",jt),bt("DataConstantProperty",Pt),bt("CrossFadedDataDrivenProperty",p),bt("CrossFadedProperty",t),bt("ColorRampProperty",a);const h="-transition";class m extends Rr{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new wo(n.layout)),n.paint)){this._transitionablePaint=new Ua(n.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new yl(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){n!=null&&this._validate(Tu,`layers.${this.id}.layout.${e}`,e,n,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(h)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(Ec,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(e.endsWith(h))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[e],f=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),_=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||g||f||this._handleOverridablePaintPropertyUpdate(e,_,b)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),fe(e,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(e,n,o,c,f={}){return(!f||f.validate!==!1)&&fl(this,e.call(Ls,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:Ee,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Qn&&Xn(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const v={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class w{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class k{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function E(r,e=1){let n=0,o=0;return{members:r.map(c=>{const f=v[c.type].BYTES_PER_ELEMENT,g=n=D(n,Math.max(e,f)),_=c.components||1;return o=Math.max(o,f),n+=f*_,{name:c.name,type:c.type,components:_,offset:g}}),size:D(n,Math.max(o,e)),alignment:e}}function D(r,e){return Math.ceil(r/e)*e}class z extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}z.prototype.bytesPerElement=4,bt("StructArrayLayout2i4",z);class N extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const f=3*e;return this.int16[f+0]=n,this.int16[f+1]=o,this.int16[f+2]=c,e}}N.prototype.bytesPerElement=6,bt("StructArrayLayout3i6",N);class U extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,c)}emplace(e,n,o,c,f){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=f,e}}U.prototype.bytesPerElement=8,bt("StructArrayLayout4i8",U);class Z extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,f,g)}emplace(e,n,o,c,f,g,_){const b=6*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=c,this.int16[b+3]=f,this.int16[b+4]=g,this.int16[b+5]=_,e}}Z.prototype.bytesPerElement=12,bt("StructArrayLayout2i4i12",Z);class Q extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,f,g)}emplace(e,n,o,c,f,g,_){const b=4*e,T=8*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.uint8[T+4]=c,this.uint8[T+5]=f,this.uint8[T+6]=g,this.uint8[T+7]=_,e}}Q.prototype.bytesPerElement=8,bt("StructArrayLayout2i4ub8",Q);class H extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}H.prototype.bytesPerElement=8,bt("StructArrayLayout2f8",H);class ae extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g,_,b,T,P){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,o,c,f,g,_,b,T,P)}emplace(e,n,o,c,f,g,_,b,T,P,A){const L=10*e;return this.uint16[L+0]=n,this.uint16[L+1]=o,this.uint16[L+2]=c,this.uint16[L+3]=f,this.uint16[L+4]=g,this.uint16[L+5]=_,this.uint16[L+6]=b,this.uint16[L+7]=T,this.uint16[L+8]=P,this.uint16[L+9]=A,e}}ae.prototype.bytesPerElement=20,bt("StructArrayLayout10ui20",ae);class ge extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g,_,b,T,P,A,L){const F=this.length;return this.resize(F+1),this.emplace(F,e,n,o,c,f,g,_,b,T,P,A,L)}emplace(e,n,o,c,f,g,_,b,T,P,A,L,F){const $=12*e;return this.int16[$+0]=n,this.int16[$+1]=o,this.int16[$+2]=c,this.int16[$+3]=f,this.uint16[$+4]=g,this.uint16[$+5]=_,this.uint16[$+6]=b,this.uint16[$+7]=T,this.int16[$+8]=P,this.int16[$+9]=A,this.int16[$+10]=L,this.int16[$+11]=F,e}}ge.prototype.bytesPerElement=24,bt("StructArrayLayout4i4ui4i24",ge);class Y extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const f=3*e;return this.float32[f+0]=n,this.float32[f+1]=o,this.float32[f+2]=c,e}}Y.prototype.bytesPerElement=12,bt("StructArrayLayout3f12",Y);class _e extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}_e.prototype.bytesPerElement=4,bt("StructArrayLayout1ul4",_e);class Ce extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g,_,b,T){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,o,c,f,g,_,b,T)}emplace(e,n,o,c,f,g,_,b,T,P){const A=10*e,L=5*e;return this.int16[A+0]=n,this.int16[A+1]=o,this.int16[A+2]=c,this.int16[A+3]=f,this.int16[A+4]=g,this.int16[A+5]=_,this.uint32[L+3]=b,this.uint16[A+8]=T,this.uint16[A+9]=P,e}}Ce.prototype.bytesPerElement=20,bt("StructArrayLayout6i1ul2ui20",Ce);class Pe extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,f,g)}emplace(e,n,o,c,f,g,_){const b=6*e;return this.int16[b+0]=n,this.int16[b+1]=o,this.int16[b+2]=c,this.int16[b+3]=f,this.int16[b+4]=g,this.int16[b+5]=_,e}}Pe.prototype.bytesPerElement=12,bt("StructArrayLayout2i2i2i12",Pe);class Re extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,o,c,f)}emplace(e,n,o,c,f,g){const _=4*e,b=8*e;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=c,this.int16[b+6]=f,this.int16[b+7]=g,e}}Re.prototype.bytesPerElement=16,bt("StructArrayLayout2f1f2i16",Re);class We extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,o,c,f,g)}emplace(e,n,o,c,f,g,_){const b=16*e,T=4*e,P=8*e;return this.uint8[b+0]=n,this.uint8[b+1]=o,this.float32[T+1]=c,this.float32[T+2]=f,this.int16[P+6]=g,this.int16[P+7]=_,e}}We.prototype.bytesPerElement=16,bt("StructArrayLayout2ub2f2i16",We);class lt extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const f=3*e;return this.uint16[f+0]=n,this.uint16[f+1]=o,this.uint16[f+2]=c,e}}lt.prototype.bytesPerElement=6,bt("StructArrayLayout3ui6",lt);class _t extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g,_,b,T,P,A,L,F,$,q,W,se){const Se=this.length;return this.resize(Se+1),this.emplace(Se,e,n,o,c,f,g,_,b,T,P,A,L,F,$,q,W,se)}emplace(e,n,o,c,f,g,_,b,T,P,A,L,F,$,q,W,se,Se){const ue=24*e,xe=12*e,Be=48*e;return this.int16[ue+0]=n,this.int16[ue+1]=o,this.uint16[ue+2]=c,this.uint16[ue+3]=f,this.uint32[xe+2]=g,this.uint32[xe+3]=_,this.uint32[xe+4]=b,this.uint16[ue+10]=T,this.uint16[ue+11]=P,this.uint16[ue+12]=A,this.float32[xe+7]=L,this.float32[xe+8]=F,this.uint8[Be+36]=$,this.uint8[Be+37]=q,this.uint8[Be+38]=W,this.uint32[xe+10]=se,this.int16[ue+22]=Se,e}}_t.prototype.bytesPerElement=48,bt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_t);class et extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,f,g,_,b,T,P,A,L,F,$,q,W,se,Se,ue,xe,Be,$e,vt,Tt,gt,ut,St,Dt){const yt=this.length;return this.resize(yt+1),this.emplace(yt,e,n,o,c,f,g,_,b,T,P,A,L,F,$,q,W,se,Se,ue,xe,Be,$e,vt,Tt,gt,ut,St,Dt)}emplace(e,n,o,c,f,g,_,b,T,P,A,L,F,$,q,W,se,Se,ue,xe,Be,$e,vt,Tt,gt,ut,St,Dt,yt){const Ve=32*e,Ct=16*e;return this.int16[Ve+0]=n,this.int16[Ve+1]=o,this.int16[Ve+2]=c,this.int16[Ve+3]=f,this.int16[Ve+4]=g,this.int16[Ve+5]=_,this.int16[Ve+6]=b,this.int16[Ve+7]=T,this.uint16[Ve+8]=P,this.uint16[Ve+9]=A,this.uint16[Ve+10]=L,this.uint16[Ve+11]=F,this.uint16[Ve+12]=$,this.uint16[Ve+13]=q,this.uint16[Ve+14]=W,this.uint16[Ve+15]=se,this.uint16[Ve+16]=Se,this.uint16[Ve+17]=ue,this.uint16[Ve+18]=xe,this.uint16[Ve+19]=Be,this.uint16[Ve+20]=$e,this.uint16[Ve+21]=vt,this.uint16[Ve+22]=Tt,this.uint32[Ct+12]=gt,this.float32[Ct+13]=ut,this.float32[Ct+14]=St,this.uint16[Ve+30]=Dt,this.uint16[Ve+31]=yt,e}}et.prototype.bytesPerElement=64,bt("StructArrayLayout8i15ui1ul2f2ui64",et);class st extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}st.prototype.bytesPerElement=4,bt("StructArrayLayout1f4",st);class wt extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const f=3*e;return this.uint16[6*e+0]=n,this.float32[f+1]=o,this.float32[f+2]=c,e}}wt.prototype.bytesPerElement=12,bt("StructArrayLayout1ui2f12",wt);class Gt extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const f=4*e;return this.uint32[2*e+0]=n,this.uint16[f+2]=o,this.uint16[f+3]=c,e}}Gt.prototype.bytesPerElement=8,bt("StructArrayLayout1ul2ui8",Gt);class ot extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}ot.prototype.bytesPerElement=4,bt("StructArrayLayout2ui4",ot);class mt extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}mt.prototype.bytesPerElement=2,bt("StructArrayLayout1ui2",mt);class Ut extends k{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,o,c)}emplace(e,n,o,c,f){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=f,e}}Ut.prototype.bytesPerElement=16,bt("StructArrayLayout4f16",Ut);class Zr extends w{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ie(this.anchorPointX,this.anchorPointY)}}Zr.prototype.size=20;class Yt extends Ce{get(e){return new Zr(this,e)}}bt("CollisionBoxArray",Yt);class fr extends w{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}fr.prototype.size=48;class Hr extends _t{get(e){return new fr(this,e)}}bt("PlacedSymbolArray",Hr);class Zi extends w{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Zi.prototype.size=64;class Nn extends et{get(e){return new Zi(this,e)}}bt("SymbolInstanceArray",Nn);class Wr extends st{getoffsetX(e){return this.float32[1*e+0]}}bt("GlyphOffsetArray",Wr);class Qi extends N{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}bt("SymbolLineVertexArray",Qi);class en extends w{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}en.prototype.size=12;class Hi extends wt{get(e){return new en(this,e)}}bt("TextAnchorOffsetArray",Hi);class Wi extends w{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Wi.prototype.size=8;class On extends Gt{get(e){return new Wi(this,e)}}bt("FeatureIndexArray",On);class na extends z{}class _l extends z{}class Ns extends z{}class Os extends Z{}class vl extends Q{}class Dc extends H{}class Fi extends ae{}class Mn extends ge{}class fs extends Y{}class sa extends _e{}class Bi extends Pe{}class Ki extends We{}class bi extends lt{}class Ar extends ot{}const Qr=E([{name:"a_pos",components:2,type:"Int16"}],4),{members:Lc}=Qr;class wi{constructor(e=[]){this.segments=e}prepareSegment(e,n,o,c){let f=this.segments[this.segments.length-1];return e>wi.MAX_VERTEX_ARRAY_LENGTH&&tt(`Max vertices per segment is ${wi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>wi.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(f.sortKey=c),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new wi([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function Rc(r,e){return 256*(r=Ue(Math.floor(r),0,255))+Ue(Math.floor(e),0,255)}wi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,bt("SegmentVector",wi);const So=E([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var aa={exports:{}},ms={exports:{}};ms.exports=function(r,e){var n,o,c,f,g,_,b,T;for(o=r.length-(n=3&r.length),c=e,g=3432918353,_=461845907,T=0;T<o;)b=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24,++T,c=27492+(65535&(f=5*(65535&(c=(c^=b=(65535&(b=(b=(65535&b)*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*_+(((b>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(b=0,n){case 3:b^=(255&r.charCodeAt(T+2))<<16;case 2:b^=(255&r.charCodeAt(T+1))<<8;case 1:c^=b=(65535&(b=(b=(65535&(b^=255&r.charCodeAt(T)))*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*_+(((b>>>16)*_&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Mu=ms.exports,xl={exports:{}};xl.exports=function(r,e){for(var n,o=r.length,c=e^o,f=0;o>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(f)|(255&r.charCodeAt(++f))<<8|(255&r.charCodeAt(++f))<<16|(255&r.charCodeAt(++f))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++f;switch(o){case 3:c^=(255&r.charCodeAt(f+2))<<16;case 2:c^=(255&r.charCodeAt(f+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(f)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Fc=Mu,bl=xl.exports;aa.exports=Fc,aa.exports.murmur3=Fc,aa.exports.murmur2=bl;var wl=V(aa.exports);class qa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push(Ud(e)),this.positions.push(n,o,c)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Ud(e);let o=0,c=this.ids.length-1;for(;o<c;){const g=o+c>>1;this.ids[g]>=n?c=g:o=g+1}const f=[];for(;this.ids[o]===n;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(e,n){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return zu(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const n=new qa;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Ud(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:wl(String(r))}function zu(r,e,n,o){for(;n<o;){const c=r[n+o>>1];let f=n-1,g=o+1;for(;;){do f++;while(r[f]<c);do g--;while(r[g]>c);if(f>=g)break;Bc(r,f,g),Bc(e,3*f,3*g),Bc(e,3*f+1,3*g+1),Bc(e,3*f+2,3*g+2)}g-n<o-g?(zu(r,e,n,g),n=g+1):(zu(r,e,g+1,o),o=g)}}function Bc(r,e,n){const o=r[e];r[e]=r[n],r[n]=o}bt("FeaturePositionMap",qa);class ko{constructor(e,n){this.gl=e.gl,this.location=n}}class Co extends ko{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Du extends ko{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Rh extends ko{constructor(e,n){super(e,n),this.current=Br.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const qd=new Float32Array(16);function Fh(r){return[Rc(255*r.r,255*r.g),Rc(255*r.b,255*r.a)]}class gi{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new Rh(e,n):new Co(e,n)}}class Sl{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setUniform(e,n,o,c){const f=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&e.set(f)}getBinding(e,n,o){return o.substr(0,9)==="u_pattern"?new Du(e,n):new Co(e,n)}}class I{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,f){const g=this.paintVertexArray.length,_=this.expression.evaluate(new jr(0),n,{},c,[],f);this.paintVertexArray.resize(e),this._setPaintValue(g,e,_)}updatePaintArray(e,n,o,c){const f=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(e,n,f)}_setPaintValue(e,n,o){if(this.type==="color"){const c=Fh(o);for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class M{constructor(e,n,o,c,f,g){this.expression=e,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,n,o,c,f){const g=this.expression.evaluate(new jr(this.zoom),n,{},c,[],f),_=this.expression.evaluate(new jr(this.zoom+1),n,{},c,[],f),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,g,_)}updatePaintArray(e,n,o,c){const f=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(e,n,f,g)}_setPaintValue(e,n,o,c){if(this.type==="color"){const f=Fh(o),g=Fh(c);for(let _=e;_<n;_++)this.paintVertexArray.emplace(_,f[0],f[1],g[0],g[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Ue(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,o){return new Co(e,n)}}class O{constructor(e,n,o,c,f,g){this.expression=e,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,f){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],f)}_setPaintValues(e,n,o,c){if(!c||!o)return;const{min:f,mid:g,max:_}=o,b=c[f],T=c[g],P=c[_];if(b&&T&&P)for(let A=e;A<n;A++)this.zoomInPaintVertexArray.emplace(A,T.tl[0],T.tl[1],T.br[0],T.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],T.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(A,T.tl[0],T.tl[1],T.br[0],T.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],T.pixelRatio,P.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,So.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,So.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class X{constructor(e,n,o){this.binders={},this._buffers=[];const c=[];for(const f in e.paint._values){if(!o(f))continue;const g=e.paint.get(f);if(!(g instanceof Qn&&Xn(g.property.specification)))continue;const _=ve(f,e.type),b=g.value,T=g.property.specification.type,P=g.property.useIntegerZoom,A=g.property.specification["property-type"],L=A==="cross-faded"||A==="cross-faded-data-driven";if(b.kind==="constant")this.binders[f]=L?new Sl(b.value,_):new gi(b.value,_,T),c.push(`/u_${f}`);else if(b.kind==="source"||L){const F=ce(f,T,"source");this.binders[f]=L?new O(b,T,P,n,F,e.id):new I(b,_,T,F),c.push(`/a_${f}`)}else{const F=ce(f,T,"composite");this.binders[f]=new M(b,_,T,P,n,F),c.push(`/z_${f}`)}}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof I||n instanceof M?n.maxValue:0}populatePaintArrays(e,n,o,c,f){for(const g in this.binders){const _=this.binders[g];(_ instanceof I||_ instanceof M||_ instanceof O)&&_.populatePaintArray(e,n,o,c,f)}}setConstantPatternPositions(e,n){for(const o in this.binders){const c=this.binders[o];c instanceof Sl&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,o,c,f){let g=!1;for(const _ in e){const b=n.getPositions(_);for(const T of b){const P=o.feature(T.index);for(const A in this.binders){const L=this.binders[A];if((L instanceof I||L instanceof M||L instanceof O)&&L.expression.isStateDependent===!0){const F=c.paint.get(A);L.expression=F.value,L.updatePaintArray(T.start,T.end,P,e[_],f),g=!0}}}}return g}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof gi||o instanceof Sl)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof I||o instanceof M)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name);else if(o instanceof O)for(let c=0;c<So.members.length;c++)e.push(So.members[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof gi||o instanceof Sl||o instanceof M)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof gi||f instanceof Sl||f instanceof M){for(const g of f.uniformNames)if(n[g]){const _=f.getBinding(e,n[g],g);o.push({name:g,property:c,binding:_})}}}return o}setUniforms(e,n,o,c){for(const{name:f,property:g,binding:_}of n)this.binders[g].setUniform(_,c,o.get(g),f)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof O){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof I||o instanceof M)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof I||o instanceof M||o instanceof O)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof I||n instanceof M||n instanceof O)&&n.destroy()}}}class de{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new X(c,n,o);this.needsUpload=!1,this._featureMap=new qa,this._bufferOffset=0}populatePaintArrays(e,n,o,c,f,g){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(e,n,c,f,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,n,f,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function ve(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function ce(r,e,n){const o={color:{source:H,composite:Ut},number:{source:st,composite:H}},c=function(f){return{"line-pattern":{source:Fi,composite:Fi},"fill-pattern":{source:Fi,composite:Fi},"fill-extrusion-pattern":{source:Fi,composite:Fi}}[f]}(r);return c&&c[n]||o[e][n]}bt("ConstantBinder",gi),bt("CrossFadedConstantBinder",Sl),bt("SourceExpressionBinder",I),bt("CrossFadedCompositeBinder",O),bt("CompositeExpressionBinder",M),bt("ProgramConfiguration",X,{omit:["_buffers"]}),bt("ProgramConfigurationSet",de);const we=8192,Ae=Math.pow(2,14)-1,qe=-Ae-1;function Ye(r){const e=we/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let f=0;f<c.length;f++){const g=c[f],_=Math.round(g.x*e),b=Math.round(g.y*e);g.x=Ue(_,qe,Ae),g.y=Ue(b,qe,Ae),(_<g.x||_>g.x+1||b<g.y||b>g.y+1)&&tt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function xt(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Ye(r):[]}}function it(r,e,n,o,c){r.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}class At{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new _l,this.indexArray=new bi,this.segments=new wi,this.programConfigurations=new de(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){const c=this.layers[0],f=[];let g=null,_=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),_=!g.isConstant());for(const{feature:b,id:T,index:P,sourceLayerIndex:A}of e){const L=this.layers[0]._featureFilter.needGeometry,F=xt(b,L);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom),F,o))continue;const $=_?g.evaluate(F,{},o):void 0,q={id:T,properties:b.properties,type:b.type,sourceLayerIndex:A,index:P,geometry:L?F.geometry:Ye(b),patterns:{},sortKey:$};f.push(q)}_&&f.sort((b,T)=>b.sortKey-T.sortKey);for(const b of f){const{geometry:T,index:P,sourceLayerIndex:A}=b,L=e[P].feature;this.addFeature(b,T,P,o),n.featureIndex.insert(L,T,P,A,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c){for(const f of n)for(const g of f){const _=g.x,b=g.y;if(_<0||_>=we||b<0||b>=we)continue;const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=T.vertexLength;it(this.layoutVertexArray,_,b,-1,-1),it(this.layoutVertexArray,_,b,1,-1),it(this.layoutVertexArray,_,b,1,1),it(this.layoutVertexArray,_,b,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c)}}function Mt(r,e){for(let n=0;n<r.length;n++)if(rt(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(rt(r,e[n]))return!0;return!!Dr(r,e)}function vr(r,e,n){return!!rt(r,e)||!!Ei(e,r,n)}function xr(r,e){if(r.length===1)return wr(e,r[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let c=0;c<o.length;c++)if(rt(r,o[c]))return!0}for(let n=0;n<r.length;n++)if(wr(e,r[n]))return!0;for(let n=0;n<e.length;n++)if(Dr(r,e[n]))return!0;return!1}function Mr(r,e,n){if(r.length>1){if(Dr(r,e))return!0;for(let o=0;o<e.length;o++)if(Ei(e[o],r,n))return!0}for(let o=0;o<r.length;o++)if(Ei(r[o],e,n))return!0;return!1}function Dr(r,e){if(r.length===0||e.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],c=r[n+1];for(let f=0;f<e.length-1;f++)if(tn(o,c,e[f],e[f+1]))return!0}return!1}function tn(r,e,n,o){return dt(r,n,o)!==dt(e,n,o)&&dt(r,e,n)!==dt(r,e,o)}function Ei(r,e,n){const o=n*n;if(e.length===1)return r.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(wn(r,e[c-1],e[c])<o)return!0;return!1}function wn(r,e,n){const o=e.distSqr(n);if(o===0)return r.distSqr(e);const c=((r.x-e.x)*(n.x-e.x)+(r.y-e.y)*(n.y-e.y))/o;return r.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function wr(r,e){let n,o,c,f=!1;for(let g=0;g<r.length;g++){n=r[g];for(let _=0,b=n.length-1;_<n.length;b=_++)o=n[_],c=n[b],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(f=!f)}return f}function rt(r,e){let n=!1;for(let o=0,c=r.length-1;o<r.length;c=o++){const f=r[o],g=r[c];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(n=!n)}return n}function Ht(r,e,n){const o=n[0],c=n[2];if(r.x<o.x&&e.x<o.x||r.x>c.x&&e.x>c.x||r.y<o.y&&e.y<o.y||r.y>c.y&&e.y>c.y)return!1;const f=dt(r,e,n[0]);return f!==dt(r,e,n[1])||f!==dt(r,e,n[2])||f!==dt(r,e,n[3])}function cr(r,e,n){const o=e.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(r)}function ur(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Pi(r,e,n,o,c){if(!e[0]&&!e[1])return r;const f=ie.convert(e)._mult(c);n==="viewport"&&f._rotate(-o);const g=[];for(let _=0;_<r.length;_++)g.push(r[_].sub(f));return g}let ei,Cr;bt("CircleBucket",At,{omit:["layers"]});var $r={get paint(){return Cr=Cr||new l({"circle-radius":new jt(Ee.paint_circle["circle-radius"]),"circle-color":new jt(Ee.paint_circle["circle-color"]),"circle-blur":new jt(Ee.paint_circle["circle-blur"]),"circle-opacity":new jt(Ee.paint_circle["circle-opacity"]),"circle-translate":new Pt(Ee.paint_circle["circle-translate"]),"circle-translate-anchor":new Pt(Ee.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pt(Ee.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pt(Ee.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new jt(Ee.paint_circle["circle-stroke-width"]),"circle-stroke-color":new jt(Ee.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new jt(Ee.paint_circle["circle-stroke-opacity"])})},get layout(){return ei=ei||new l({"circle-sort-key":new jt(Ee.layout_circle["circle-sort-key"])})}},sr=1e-6,zr=typeof Float32Array<"u"?Float32Array:Array;function $n(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function oa(r,e,n){var o=e[0],c=e[1],f=e[2],g=e[3],_=e[4],b=e[5],T=e[6],P=e[7],A=e[8],L=e[9],F=e[10],$=e[11],q=e[12],W=e[13],se=e[14],Se=e[15],ue=n[0],xe=n[1],Be=n[2],$e=n[3];return r[0]=ue*o+xe*_+Be*A+$e*q,r[1]=ue*c+xe*b+Be*L+$e*W,r[2]=ue*f+xe*T+Be*F+$e*se,r[3]=ue*g+xe*P+Be*$+$e*Se,r[4]=(ue=n[4])*o+(xe=n[5])*_+(Be=n[6])*A+($e=n[7])*q,r[5]=ue*c+xe*b+Be*L+$e*W,r[6]=ue*f+xe*T+Be*F+$e*se,r[7]=ue*g+xe*P+Be*$+$e*Se,r[8]=(ue=n[8])*o+(xe=n[9])*_+(Be=n[10])*A+($e=n[11])*q,r[9]=ue*c+xe*b+Be*L+$e*W,r[10]=ue*f+xe*T+Be*F+$e*se,r[11]=ue*g+xe*P+Be*$+$e*Se,r[12]=(ue=n[12])*o+(xe=n[13])*_+(Be=n[14])*A+($e=n[15])*q,r[13]=ue*c+xe*b+Be*L+$e*W,r[14]=ue*f+xe*T+Be*F+$e*se,r[15]=ue*g+xe*P+Be*$+$e*Se,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var es,kl=oa;function la(r,e,n){var o=e[0],c=e[1],f=e[2],g=e[3];return r[0]=n[0]*o+n[4]*c+n[8]*f+n[12]*g,r[1]=n[1]*o+n[5]*c+n[9]*f+n[13]*g,r[2]=n[2]*o+n[6]*c+n[10]*f+n[14]*g,r[3]=n[3]*o+n[7]*c+n[11]*f+n[15]*g,r}es=new zr(4),zr!=Float32Array&&(es[0]=0,es[1]=0,es[2]=0,es[3]=0);class ca extends m{constructor(e){super(e,$r)}createBucket(e){return new At(e)}queryRadius(e){const n=e;return cr("circle-radius",this,n)+cr("circle-stroke-width",this,n)+ur(this.paint.get("circle-translate"))}queryIntersectsFeature(e,n,o,c,f,g,_,b){const T=Pi(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,_),P=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),A=this.paint.get("circle-pitch-alignment")==="map",L=A?T:function($,q){return $.map(W=>Ga(W,q))}(T,b),F=A?P*_:P;for(const $ of c)for(const q of $){const W=A?q:Ga(q,b);let se=F;const Se=la([],[q.x,q.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?se*=Se[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(se*=g.cameraToCenterDistance/Se[3]),vr(L,W,se))return!0}return!1}}function Ga(r,e){const n=la([],[r.x,r.y,0,1],e);return new ie(n[0]/n[3],n[1]/n[3])}class Cl extends At{}let Za;bt("HeatmapBucket",Cl,{omit:["layers"]});var Bh={get paint(){return Za=Za||new l({"heatmap-radius":new jt(Ee.paint_heatmap["heatmap-radius"]),"heatmap-weight":new jt(Ee.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pt(Ee.paint_heatmap["heatmap-intensity"]),"heatmap-color":new a(Ee.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pt(Ee.paint_heatmap["heatmap-opacity"])})}};function Nc(r,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${e*n*o}`)}else c=new Uint8Array(e*n*o);return r.width=e,r.height=n,r.data=c,r}function Cy(r,{width:e,height:n},o){if(e===r.width&&n===r.height)return;const c=Nc({},{width:e,height:n},o);Ef(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,n)},o),r.width=e,r.height=n,r.data=c.data}function Ef(r,e,n,o,c,f){if(c.width===0||c.height===0)return e;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,_=e.data;if(g===_)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<c.height;b++){const T=((n.y+b)*r.width+n.x)*f,P=((o.y+b)*e.width+o.x)*f;for(let A=0;A<c.width*f;A++)_[P+A]=g[T+A]}return e}class Nh{constructor(e,n){Nc(this,e,1,n)}resize(e){Cy(this,e,1)}clone(){return new Nh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,f){Ef(e,n,o,c,f,1)}}class gs{constructor(e,n){Nc(this,e,4,n)}resize(e){Cy(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new gs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,f){Ef(e,n,o,c,f,4)}}function Ty(r){const e={},n=r.resolution||256,o=r.clips?r.clips.length:1,c=r.image||new gs({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const f=(g,_,b)=>{e[r.evaluationKey]=b;const T=r.expression.evaluate(e);c.data[g+_+0]=Math.floor(255*T.r/T.a),c.data[g+_+1]=Math.floor(255*T.g/T.a),c.data[g+_+2]=Math.floor(255*T.b/T.a),c.data[g+_+3]=Math.floor(255*T.a)};if(r.clips)for(let g=0,_=0;g<o;++g,_+=4*n)for(let b=0,T=0;b<n;b++,T+=4){const P=b/(n-1),{start:A,end:L}=r.clips[g];f(_,T,A*(1-P)+L*P)}else for(let g=0,_=0;g<n;g++,_+=4)f(0,_,g/(n-1));return c}bt("AlphaImage",Nh),bt("RGBAImage",gs);class Ox extends m{createBucket(e){return new Cl(e)}constructor(e){super(e,Bh),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ty({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Iy;var $x={get paint(){return Iy=Iy||new l({"hillshade-illumination-direction":new Pt(Ee.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pt(Ee.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pt(Ee.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pt(Ee.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pt(Ee.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pt(Ee.paint_hillshade["hillshade-accent-color"])})}};class jx extends m{constructor(e){super(e,$x)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Vx=E([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ux}=Vx;var Pf={exports:{}};function Gd(r,e,n){n=n||2;var o,c,f,g,_,b,T,P=e&&e.length,A=P?e[0]*n:r.length,L=Ey(r,0,A,n,!0),F=[];if(!L||L.next===L.prev)return F;if(P&&(L=function(q,W,se,Se){var ue,xe,Be,$e=[];for(ue=0,xe=W.length;ue<xe;ue++)(Be=Ey(q,W[ue]*Se,ue<xe-1?W[ue+1]*Se:q.length,Se,!1))===Be.next&&(Be.steiner=!0),$e.push(Yx(Be));for($e.sort(Wx),ue=0;ue<$e.length;ue++)se=Kx($e[ue],se);return se}(r,e,L,n)),r.length>80*n){o=f=r[0],c=g=r[1];for(var $=n;$<A;$+=n)(_=r[$])<o&&(o=_),(b=r[$+1])<c&&(c=b),_>f&&(f=_),b>g&&(g=b);T=(T=Math.max(f-o,g-c))!==0?32767/T:0}return Oh(L,F,n,o,c,T,0),F}function Ey(r,e,n,o,c){var f,g;if(c===zf(r,e,n,o)>0)for(f=e;f<n;f+=o)g=My(f,r[f],r[f+1],g);else for(f=n-o;f>=e;f-=o)g=My(f,r[f],r[f+1],g);return g&&Zd(g,g.next)&&(jh(g),g=g.next),g}function Oc(r,e){if(!r)return r;e||(e=r);var n,o=r;do if(n=!1,o.steiner||!Zd(o,o.next)&&Si(o.prev,o,o.next)!==0)o=o.next;else{if(jh(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function Oh(r,e,n,o,c,f,g){if(r){!g&&f&&function(P,A,L,F){var $=P;do $.z===0&&($.z=Af($.x,$.y,A,L,F)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next;while($!==P);$.prevZ.nextZ=null,$.prevZ=null,function(q){var W,se,Se,ue,xe,Be,$e,vt,Tt=1;do{for(se=q,q=null,xe=null,Be=0;se;){for(Be++,Se=se,$e=0,W=0;W<Tt&&($e++,Se=Se.nextZ);W++);for(vt=Tt;$e>0||vt>0&&Se;)$e!==0&&(vt===0||!Se||se.z<=Se.z)?(ue=se,se=se.nextZ,$e--):(ue=Se,Se=Se.nextZ,vt--),xe?xe.nextZ=ue:q=ue,ue.prevZ=xe,xe=ue;se=Se}xe.nextZ=null,Tt*=2}while(Be>1)}($)}(r,o,c,f);for(var _,b,T=r;r.prev!==r.next;)if(_=r.prev,b=r.next,f?Gx(r,o,c,f):qx(r))e.push(_.i/n|0),e.push(r.i/n|0),e.push(b.i/n|0),jh(r),r=b.next,T=b.next;else if((r=b)===T){g?g===1?Oh(r=Zx(Oc(r),e,n),e,n,o,c,f,2):g===2&&Hx(r,e,n,o,c,f):Oh(Oc(r),e,n,o,c,f,1);break}}}function qx(r){var e=r.prev,n=r,o=r.next;if(Si(e,n,o)>=0)return!1;for(var c=e.x,f=n.x,g=o.x,_=e.y,b=n.y,T=o.y,P=c<f?c<g?c:g:f<g?f:g,A=_<b?_<T?_:T:b<T?b:T,L=c>f?c>g?c:g:f>g?f:g,F=_>b?_>T?_:T:b>T?b:T,$=o.next;$!==e;){if($.x>=P&&$.x<=L&&$.y>=A&&$.y<=F&&Lu(c,_,f,b,g,T,$.x,$.y)&&Si($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function Gx(r,e,n,o){var c=r.prev,f=r,g=r.next;if(Si(c,f,g)>=0)return!1;for(var _=c.x,b=f.x,T=g.x,P=c.y,A=f.y,L=g.y,F=_<b?_<T?_:T:b<T?b:T,$=P<A?P<L?P:L:A<L?A:L,q=_>b?_>T?_:T:b>T?b:T,W=P>A?P>L?P:L:A>L?A:L,se=Af(F,$,e,n,o),Se=Af(q,W,e,n,o),ue=r.prevZ,xe=r.nextZ;ue&&ue.z>=se&&xe&&xe.z<=Se;){if(ue.x>=F&&ue.x<=q&&ue.y>=$&&ue.y<=W&&ue!==c&&ue!==g&&Lu(_,P,b,A,T,L,ue.x,ue.y)&&Si(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,xe.x>=F&&xe.x<=q&&xe.y>=$&&xe.y<=W&&xe!==c&&xe!==g&&Lu(_,P,b,A,T,L,xe.x,xe.y)&&Si(xe.prev,xe,xe.next)>=0))return!1;xe=xe.nextZ}for(;ue&&ue.z>=se;){if(ue.x>=F&&ue.x<=q&&ue.y>=$&&ue.y<=W&&ue!==c&&ue!==g&&Lu(_,P,b,A,T,L,ue.x,ue.y)&&Si(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;xe&&xe.z<=Se;){if(xe.x>=F&&xe.x<=q&&xe.y>=$&&xe.y<=W&&xe!==c&&xe!==g&&Lu(_,P,b,A,T,L,xe.x,xe.y)&&Si(xe.prev,xe,xe.next)>=0)return!1;xe=xe.nextZ}return!0}function Zx(r,e,n){var o=r;do{var c=o.prev,f=o.next.next;!Zd(c,f)&&Py(c,o,o.next,f)&&$h(c,f)&&$h(f,c)&&(e.push(c.i/n|0),e.push(o.i/n|0),e.push(f.i/n|0),jh(o),jh(o.next),o=r=f),o=o.next}while(o!==r);return Oc(o)}function Hx(r,e,n,o,c,f){var g=r;do{for(var _=g.next.next;_!==g.prev;){if(g.i!==_.i&&Jx(g,_)){var b=Ay(g,_);return g=Oc(g,g.next),b=Oc(b,b.next),Oh(g,e,n,o,c,f,0),void Oh(b,e,n,o,c,f,0)}_=_.next}g=g.next}while(g!==r)}function Wx(r,e){return r.x-e.x}function Kx(r,e){var n=function(c,f){var g,_=f,b=c.x,T=c.y,P=-1/0;do{if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){var A=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(A<=b&&A>P&&(P=A,g=_.x<_.next.x?_:_.next,A===b))return g}_=_.next}while(_!==f);if(!g)return null;var L,F=g,$=g.x,q=g.y,W=1/0;_=g;do b>=_.x&&_.x>=$&&b!==_.x&&Lu(T<q?b:P,T,$,q,T<q?P:b,T,_.x,_.y)&&(L=Math.abs(T-_.y)/(b-_.x),$h(_,c)&&(L<W||L===W&&(_.x>g.x||_.x===g.x&&Xx(g,_)))&&(g=_,W=L)),_=_.next;while(_!==F);return g}(r,e);if(!n)return e;var o=Ay(n,r);return Oc(o,o.next),Oc(n,n.next)}function Xx(r,e){return Si(r.prev,r,e.prev)<0&&Si(e.next,r,r.next)<0}function Af(r,e,n,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Yx(r){var e=r,n=r;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==r);return n}function Lu(r,e,n,o,c,f,g,_){return(c-g)*(e-_)>=(r-g)*(f-_)&&(r-g)*(o-_)>=(n-g)*(e-_)&&(n-g)*(f-_)>=(c-g)*(o-_)}function Jx(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&Py(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(r,e)&&($h(r,e)&&$h(e,r)&&function(n,o){var c=n,f=!1,g=(n.x+o.x)/2,_=(n.y+o.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&g<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==n);return f}(r,e)&&(Si(r.prev,r,e.prev)||Si(r,e.prev,e))||Zd(r,e)&&Si(r.prev,r,r.next)>0&&Si(e.prev,e,e.next)>0)}function Si(r,e,n){return(e.y-r.y)*(n.x-e.x)-(e.x-r.x)*(n.y-e.y)}function Zd(r,e){return r.x===e.x&&r.y===e.y}function Py(r,e,n,o){var c=Wd(Si(r,e,n)),f=Wd(Si(r,e,o)),g=Wd(Si(n,o,r)),_=Wd(Si(n,o,e));return c!==f&&g!==_||!(c!==0||!Hd(r,n,e))||!(f!==0||!Hd(r,o,e))||!(g!==0||!Hd(n,r,o))||!(_!==0||!Hd(n,e,o))}function Hd(r,e,n){return e.x<=Math.max(r.x,n.x)&&e.x>=Math.min(r.x,n.x)&&e.y<=Math.max(r.y,n.y)&&e.y>=Math.min(r.y,n.y)}function Wd(r){return r>0?1:r<0?-1:0}function $h(r,e){return Si(r.prev,r,r.next)<0?Si(r,e,r.next)>=0&&Si(r,r.prev,e)>=0:Si(r,e,r.prev)<0||Si(r,r.next,e)<0}function Ay(r,e){var n=new Mf(r.i,r.x,r.y),o=new Mf(e.i,e.x,e.y),c=r.next,f=e.prev;return r.next=e,e.prev=r,n.next=c,c.prev=n,o.next=n,n.prev=o,f.next=o,o.prev=f,o}function My(r,e,n,o){var c=new Mf(r,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function jh(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Mf(r,e,n){this.i=r,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zf(r,e,n,o){for(var c=0,f=e,g=n-o;f<n;f+=o)c+=(r[g]-r[f])*(r[f+1]+r[g+1]),g=f;return c}Pf.exports=Gd,Pf.exports.default=Gd,Gd.deviation=function(r,e,n,o){var c=e&&e.length,f=Math.abs(zf(r,0,c?e[0]*n:r.length,n));if(c)for(var g=0,_=e.length;g<_;g++)f-=Math.abs(zf(r,e[g]*n,g<_-1?e[g+1]*n:r.length,n));var b=0;for(g=0;g<o.length;g+=3){var T=o[g]*n,P=o[g+1]*n,A=o[g+2]*n;b+=Math.abs((r[T]-r[A])*(r[P+1]-r[T+1])-(r[T]-r[P])*(r[A+1]-r[T+1]))}return f===0&&b===0?0:Math.abs((b-f)/f)},Gd.flatten=function(r){for(var e=r[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<r.length;c++){for(var f=0;f<r[c].length;f++)for(var g=0;g<e;g++)n.vertices.push(r[c][f][g]);c>0&&n.holes.push(o+=r[c-1].length)}return n};var zy=V(Pf.exports);function Df(r,e,n){const o=n.patternDependencies;let c=!1;for(const f of e){const g=f.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const _=g.constantOr(null);_&&(c=!0,o[_.to]=!0,o[_.from]=!0)}return c}function Lf(r,e,n,o,c){const f=c.patternDependencies;for(const g of e){const _=g.paint.get(`${r}-pattern`).value;if(_.kind!=="constant"){let b=_.evaluate({zoom:o-1},n,{},c.availableImages),T=_.evaluate({zoom:o},n,{},c.availableImages),P=_.evaluate({zoom:o+1},n,{},c.availableImages);b=b&&b.name?b.name:b,T=T&&T.name?T.name:T,P=P&&P.name?P.name:P,f[b]=!0,f[T]=!0,f[P]=!0,n.patterns[g.id]={min:b,mid:T,max:P}}}return n}class Rf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ns,this.indexArray=new bi,this.indexArray2=new Ar,this.programConfigurations=new de(e.layers,e.zoom),this.segments=new wi,this.segments2=new wi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=Df("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),f=!c.isConstant(),g=[];for(const{feature:_,id:b,index:T,sourceLayerIndex:P}of e){const A=this.layers[0]._featureFilter.needGeometry,L=xt(_,A);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom),L,o))continue;const F=f?c.evaluate(L,{},o,n.availableImages):void 0,$={id:b,properties:_.properties,type:_.type,sourceLayerIndex:P,index:T,geometry:A?L.geometry:Ye(_),patterns:{},sortKey:F};g.push($)}f&&g.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of g){const{geometry:b,index:T,sourceLayerIndex:P}=_;if(this.hasPattern){const A=Lf("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(A)}else this.addFeature(_,b,T,o,{});n.featureIndex.insert(e[T].feature,b,T,P,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ux),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,f){for(const g of Wo(n,500)){let _=0;for(const F of g)_+=F.length;const b=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),T=b.vertexLength,P=[],A=[];for(const F of g){if(F.length===0)continue;F!==g[0]&&A.push(P.length/2);const $=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),q=$.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(q+F.length-1,q),P.push(F[0].x),P.push(F[0].y);for(let W=1;W<F.length;W++)this.layoutVertexArray.emplaceBack(F[W].x,F[W].y),this.indexArray2.emplaceBack(q+W-1,q+W),P.push(F[W].x),P.push(F[W].y);$.vertexLength+=F.length,$.primitiveLength+=F.length}const L=zy(P,A);for(let F=0;F<L.length;F+=3)this.indexArray.emplaceBack(T+L[F],T+L[F+1],T+L[F+2]);b.vertexLength+=_,b.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,c)}}let Dy,Ly;bt("FillBucket",Rf,{omit:["layers","patternFeatures"]});var Qx={get paint(){return Ly=Ly||new l({"fill-antialias":new Pt(Ee.paint_fill["fill-antialias"]),"fill-opacity":new jt(Ee.paint_fill["fill-opacity"]),"fill-color":new jt(Ee.paint_fill["fill-color"]),"fill-outline-color":new jt(Ee.paint_fill["fill-outline-color"]),"fill-translate":new Pt(Ee.paint_fill["fill-translate"]),"fill-translate-anchor":new Pt(Ee.paint_fill["fill-translate-anchor"]),"fill-pattern":new p(Ee.paint_fill["fill-pattern"])})},get layout(){return Dy=Dy||new l({"fill-sort-key":new jt(Ee.layout_fill["fill-sort-key"])})}};class eb extends m{constructor(e){super(e,Qx)}recalculate(e,n){super.recalculate(e,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Rf(e)}queryRadius(){return ur(this.paint.get("fill-translate"))}queryIntersectsFeature(e,n,o,c,f,g,_){return xr(Pi(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,_),c)}isTileClipped(){return!0}}const tb=E([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),rb=E([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ib}=tb;var Tl={},nb=ee,Ry=Ru;function Ru(r,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=c,r.readFields(sb,this,e)}function sb(r,e,n){r==1?e.id=n.readVarint():r==2?function(o,c){for(var f=o.readVarint()+o.pos;o.pos<f;){var g=c._keys[o.readVarint()],_=c._values[o.readVarint()];c.properties[g]=_}}(n,e):r==3?e.type=n.readVarint():r==4&&(e._geometry=n.pos)}function ab(r){for(var e,n,o=0,c=0,f=r.length,g=f-1;c<f;g=c++)o+=((n=r[g]).x-(e=r[c]).x)*(e.y+n.y);return o}Ru.types=["Unknown","Point","LineString","Polygon"],Ru.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,n=r.readVarint()+r.pos,o=1,c=0,f=0,g=0,_=[];r.pos<n;){if(c<=0){var b=r.readVarint();o=7&b,c=b>>3}if(c--,o===1||o===2)f+=r.readSVarint(),g+=r.readSVarint(),o===1&&(e&&_.push(e),e=[]),e.push(new nb(f,g));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&_.push(e),_},Ru.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,n=1,o=0,c=0,f=0,g=1/0,_=-1/0,b=1/0,T=-1/0;r.pos<e;){if(o<=0){var P=r.readVarint();n=7&P,o=P>>3}if(o--,n===1||n===2)(c+=r.readSVarint())<g&&(g=c),c>_&&(_=c),(f+=r.readSVarint())<b&&(b=f),f>T&&(T=f);else if(n!==7)throw new Error("unknown command "+n)}return[g,b,_,T]},Ru.prototype.toGeoJSON=function(r,e,n){var o,c,f=this.extent*Math.pow(2,n),g=this.extent*r,_=this.extent*e,b=this.loadGeometry(),T=Ru.types[this.type];function P(F){for(var $=0;$<F.length;$++){var q=F[$];F[$]=[360*(q.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+_)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(o=0;o<b.length;o++)A[o]=b[o][0];P(b=A);break;case 2:for(o=0;o<b.length;o++)P(b[o]);break;case 3:for(b=function(F){var $=F.length;if($<=1)return[F];for(var q,W,se=[],Se=0;Se<$;Se++){var ue=ab(F[Se]);ue!==0&&(W===void 0&&(W=ue<0),W===ue<0?(q&&se.push(q),q=[F[Se]]):q.push(F[Se]))}return q&&se.push(q),se}(b),o=0;o<b.length;o++)for(c=0;c<b[o].length;c++)P(b[o][c])}b.length===1?b=b[0]:T="Multi"+T;var L={type:"Feature",geometry:{type:T,coordinates:b},properties:this.properties};return"id"in this&&(L.id=this.id),L};var ob=Ry,Fy=By;function By(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(lb,this,e),this.length=this._features.length}function lb(r,e,n){r===15?e.version=n.readVarint():r===1?e.name=n.readString():r===5?e.extent=n.readVarint():r===2?e._features.push(n.pos):r===3?e._keys.push(n.readString()):r===4&&e._values.push(function(o){for(var c=null,f=o.readVarint()+o.pos;o.pos<f;){var g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return c}(n))}By.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new ob(this._pbf,e,this.extent,this._keys,this._values)};var cb=Fy;function ub(r,e,n){if(r===3){var o=new cb(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}Tl.VectorTile=function(r,e){this.layers=r.readFields(ub,{},e)},Tl.VectorTileFeature=Ry,Tl.VectorTileLayer=Fy;const hb=Tl.VectorTileFeature.types,Ff=Math.pow(2,13);function Vh(r,e,n,o,c,f,g,_){r.emplaceBack(e,n,2*Math.floor(o*Ff)+g,c*Ff*2,f*Ff*2,Math.round(_))}class Bf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Os,this.centroidVertexArray=new na,this.indexArray=new bi,this.programConfigurations=new de(e.layers,e.zoom),this.segments=new wi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.features=[],this.hasPattern=Df("fill-extrusion",this.layers,n);for(const{feature:c,id:f,index:g,sourceLayerIndex:_}of e){const b=this.layers[0]._featureFilter.needGeometry,T=xt(c,b);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom),T,o))continue;const P={id:f,sourceLayerIndex:_,index:g,geometry:b?T.geometry:Ye(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Lf("fill-extrusion",this.layers,P,this.zoom,n)):this.addFeature(P,P.geometry,g,o,{}),n.featureIndex.insert(c,P.geometry,g,_,this.index,!0)}}addFeatures(e,n,o){for(const c of this.features){const{geometry:f}=c;this.addFeature(c,f,c.index,n,o)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ib),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,rb.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,o,c,f){const g={x:0,y:0,vertexCount:0};for(const _ of Wo(n,500)){let b=0;for(const $ of _)b+=$.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const $ of _){if($.length===0||pb($))continue;let q=0;for(let W=0;W<$.length;W++){const se=$[W];if(W>=1){const Se=$[W-1];if(!db(se,Se)){T.vertexLength+4>wi.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ue=se.sub(Se)._perp()._unit(),xe=Se.dist(se);q+xe>32768&&(q=0),Vh(this.layoutVertexArray,se.x,se.y,ue.x,ue.y,0,0,q),Vh(this.layoutVertexArray,se.x,se.y,ue.x,ue.y,0,1,q),g.x+=2*se.x,g.y+=2*se.y,g.vertexCount+=2,q+=xe,Vh(this.layoutVertexArray,Se.x,Se.y,ue.x,ue.y,0,0,q),Vh(this.layoutVertexArray,Se.x,Se.y,ue.x,ue.y,0,1,q),g.x+=2*Se.x,g.y+=2*Se.y,g.vertexCount+=2;const Be=T.vertexLength;this.indexArray.emplaceBack(Be,Be+2,Be+1),this.indexArray.emplaceBack(Be+1,Be+2,Be+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+b>wi.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),hb[e.type]!=="Polygon")continue;const P=[],A=[],L=T.vertexLength;for(const $ of _)if($.length!==0){$!==_[0]&&A.push(P.length/2);for(let q=0;q<$.length;q++){const W=$[q];Vh(this.layoutVertexArray,W.x,W.y,0,0,1,1,0),g.x+=W.x,g.y+=W.y,g.vertexCount+=1,P.push(W.x),P.push(W.y)}}const F=zy(P,A);for(let $=0;$<F.length;$+=3)this.indexArray.emplaceBack(L+F[$],L+F[$+2],L+F[$+1]);T.primitiveLength+=F.length/3,T.vertexLength+=b}for(let _=0;_<g.vertexCount;_++)this.centroidVertexArray.emplaceBack(Math.floor(g.x/g.vertexCount),Math.floor(g.y/g.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,c)}}function db(r,e){return r.x===e.x&&(r.x<0||r.x>we)||r.y===e.y&&(r.y<0||r.y>we)}function pb(r){return r.every(e=>e.x<0)||r.every(e=>e.x>we)||r.every(e=>e.y<0)||r.every(e=>e.y>we)}let Ny;bt("FillExtrusionBucket",Bf,{omit:["layers","features"]});var fb={get paint(){return Ny=Ny||new l({"fill-extrusion-opacity":new Pt(Ee["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new jt(Ee["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pt(Ee["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pt(Ee["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new p(Ee["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new jt(Ee["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new jt(Ee["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pt(Ee["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class mb extends m{constructor(e){super(e,fb)}createBucket(e){return new Bf(e)}queryRadius(){return ur(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,n,o,c,f,g,_,b){const T=Pi(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,_),P=this.paint.get("fill-extrusion-height").evaluate(n,o),A=this.paint.get("fill-extrusion-base").evaluate(n,o),L=function($,q,W,se){const Se=[];for(const ue of $){const xe=[ue.x,ue.y,0,1];la(xe,xe,q),Se.push(new ie(xe[0]/xe[3],xe[1]/xe[3]))}return Se}(T,b),F=function($,q,W,se){const Se=[],ue=[],xe=se[8]*q,Be=se[9]*q,$e=se[10]*q,vt=se[11]*q,Tt=se[8]*W,gt=se[9]*W,ut=se[10]*W,St=se[11]*W;for(const Dt of $){const yt=[],Ve=[];for(const Ct of Dt){const kt=Ct.x,Qt=Ct.y,Ur=se[0]*kt+se[4]*Qt+se[12],qr=se[1]*kt+se[5]*Qt+se[13],Ai=se[2]*kt+se[6]*Qt+se[14],_s=se[3]*kt+se[7]*Qt+se[15],Sn=Ai+$e,Oi=_s+vt,rn=Ur+Tt,kn=qr+gt,zn=Ai+ut,Cn=_s+St,Mi=new ie((Ur+xe)/Oi,(qr+Be)/Oi);Mi.z=Sn/Oi,yt.push(Mi);const Xi=new ie(rn/Cn,kn/Cn);Xi.z=zn/Cn,Ve.push(Xi)}Se.push(yt),ue.push(Ve)}return[Se,ue]}(c,A,P,b);return function($,q,W){let se=1/0;xr(W,q)&&(se=Oy(W,q[0]));for(let Se=0;Se<q.length;Se++){const ue=q[Se],xe=$[Se];for(let Be=0;Be<ue.length-1;Be++){const $e=ue[Be],vt=[$e,ue[Be+1],xe[Be+1],xe[Be],$e];Mt(W,vt)&&(se=Math.min(se,Oy(W,vt)))}}return se!==1/0&&se}(F[0],F[1],L)}}function Uh(r,e){return r.x*e.x+r.y*e.y}function Oy(r,e){if(r.length===1){let n=0;const o=e[n++];let c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const f=e[n],g=r[0],_=c.sub(o),b=f.sub(o),T=g.sub(o),P=Uh(_,_),A=Uh(_,b),L=Uh(b,b),F=Uh(T,_),$=Uh(T,b),q=P*L-A*A,W=(L*F-A*$)/q,se=(P*$-A*F)/q,Se=o.z*(1-W-se)+c.z*W+f.z*se;if(isFinite(Se))return Se}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}const gb=E([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:yb}=gb,_b=E([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:vb}=_b,xb=Tl.VectorTileFeature.types,bb=Math.cos(Math.PI/180*37.5),$y=Math.pow(2,14)/.5;class Nf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new vl,this.layoutVertexArray2=new Dc,this.indexArray=new bi,this.programConfigurations=new de(e.layers,e.zoom),this.segments=new wi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=Df("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),f=!c.isConstant(),g=[];for(const{feature:_,id:b,index:T,sourceLayerIndex:P}of e){const A=this.layers[0]._featureFilter.needGeometry,L=xt(_,A);if(!this.layers[0]._featureFilter.filter(new jr(this.zoom),L,o))continue;const F=f?c.evaluate(L,{},o):void 0,$={id:b,properties:_.properties,type:_.type,sourceLayerIndex:P,index:T,geometry:A?L.geometry:Ye(_),patterns:{},sortKey:F};g.push($)}f&&g.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of g){const{geometry:b,index:T,sourceLayerIndex:P}=_;if(this.hasPattern){const A=Lf("line",this.layers,_,this.zoom,n);this.patternFeatures.push(A)}else this.addFeature(_,b,T,o,{});n.featureIndex.insert(e[T].feature,b,T,P,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,vb)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,f){const g=this.layers[0].layout,_=g.get("line-join").evaluate(e,{}),b=g.get("line-cap"),T=g.get("line-miter-limit"),P=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const A of n)this.addLine(A,e,_,b,T,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,c)}addLine(e,n,o,c,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<e.length-1;se++)this.totalDistance+=e[se].dist(e[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=xb[n.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let T=0;for(;T<b-1&&e[T].equals(e[T+1]);)T++;if(b<(_?3:2))return;o==="bevel"&&(f=1.05);const P=this.overscaling<=16?15*we/(512*this.overscaling):0,A=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let L,F,$,q,W;this.e1=this.e2=-1,_&&(L=e[b-2],W=e[T].sub(L)._unit()._perp());for(let se=T;se<b;se++){if($=se===b-1?_?e[T+1]:void 0:e[se+1],$&&e[se].equals($))continue;W&&(q=W),L&&(F=L),L=e[se],W=$?$.sub(L)._unit()._perp():q,q=q||W;let Se=q.add(W);Se.x===0&&Se.y===0||Se._unit();const ue=q.x*W.x+q.y*W.y,xe=Se.x*W.x+Se.y*W.y,Be=xe!==0?1/xe:1/0,$e=2*Math.sqrt(2-2*xe),vt=xe<bb&&F&&$,Tt=q.x*W.y-q.y*W.x>0;if(vt&&se>T){const St=L.dist(F);if(St>2*P){const Dt=L.sub(L.sub(F)._mult(P/St)._round());this.updateDistance(F,Dt),this.addCurrentVertex(Dt,q,0,0,A),F=Dt}}const gt=F&&$;let ut=gt?o:_?"butt":c;if(gt&&ut==="round"&&(Be<g?ut="miter":Be<=2&&(ut="fakeround")),ut==="miter"&&Be>f&&(ut="bevel"),ut==="bevel"&&(Be>2&&(ut="flipbevel"),Be<f&&(ut="miter")),F&&this.updateDistance(F,L),ut==="miter")Se._mult(Be),this.addCurrentVertex(L,Se,0,0,A);else if(ut==="flipbevel"){if(Be>100)Se=W.mult(-1);else{const St=Be*q.add(W).mag()/q.sub(W).mag();Se._perp()._mult(St*(Tt?-1:1))}this.addCurrentVertex(L,Se,0,0,A),this.addCurrentVertex(L,Se.mult(-1),0,0,A)}else if(ut==="bevel"||ut==="fakeround"){const St=-Math.sqrt(Be*Be-1),Dt=Tt?St:0,yt=Tt?0:St;if(F&&this.addCurrentVertex(L,q,Dt,yt,A),ut==="fakeround"){const Ve=Math.round(180*$e/Math.PI/20);for(let Ct=1;Ct<Ve;Ct++){let kt=Ct/Ve;if(kt!==.5){const Ur=kt-.5;kt+=kt*Ur*(kt-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*Ur*Ur+(.848013+ue*(.215638*ue-1.06021)))}const Qt=W.sub(q)._mult(kt)._add(q)._unit()._mult(Tt?-1:1);this.addHalfVertex(L,Qt.x,Qt.y,!1,Tt,0,A)}}$&&this.addCurrentVertex(L,W,-Dt,-yt,A)}else if(ut==="butt")this.addCurrentVertex(L,Se,0,0,A);else if(ut==="square"){const St=F?1:-1;this.addCurrentVertex(L,Se,St,St,A)}else ut==="round"&&(F&&(this.addCurrentVertex(L,q,0,0,A),this.addCurrentVertex(L,q,1,1,A,!0)),$&&(this.addCurrentVertex(L,W,-1,-1,A,!0),this.addCurrentVertex(L,W,0,0,A)));if(vt&&se<b-1){const St=L.dist($);if(St>2*P){const Dt=L.add($.sub(L)._mult(P/St)._round());this.updateDistance(L,Dt),this.addCurrentVertex(Dt,W,0,0,A),L=Dt}}}}addCurrentVertex(e,n,o,c,f,g=!1){const _=n.y*c-n.x,b=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,g,!1,o,f),this.addHalfVertex(e,_,b,g,!0,-c,f),this.distance>$y/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,o,c,f,g))}addHalfVertex({x:e,y:n},o,c,f,g,_,b){const T=.5*(this.lineClips?this.scaledDistance*($y-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),b.primitiveLength++),g?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}let jy,Vy;bt("LineBucket",Nf,{omit:["layers","patternFeatures"]});var Uy={get paint(){return Vy=Vy||new l({"line-opacity":new jt(Ee.paint_line["line-opacity"]),"line-color":new jt(Ee.paint_line["line-color"]),"line-translate":new Pt(Ee.paint_line["line-translate"]),"line-translate-anchor":new Pt(Ee.paint_line["line-translate-anchor"]),"line-width":new jt(Ee.paint_line["line-width"]),"line-gap-width":new jt(Ee.paint_line["line-gap-width"]),"line-offset":new jt(Ee.paint_line["line-offset"]),"line-blur":new jt(Ee.paint_line["line-blur"]),"line-dasharray":new t(Ee.paint_line["line-dasharray"]),"line-pattern":new p(Ee.paint_line["line-pattern"]),"line-gradient":new a(Ee.paint_line["line-gradient"])})},get layout(){return jy=jy||new l({"line-cap":new Pt(Ee.layout_line["line-cap"]),"line-join":new jt(Ee.layout_line["line-join"]),"line-miter-limit":new Pt(Ee.layout_line["line-miter-limit"]),"line-round-limit":new Pt(Ee.layout_line["line-round-limit"]),"line-sort-key":new jt(Ee.layout_line["line-sort-key"])})}};class wb extends jt{possiblyEvaluate(e,n){return n=new jr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,o,c){return n=Ge({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,o,c)}}let Kd;class Sb extends m{constructor(e){super(e,Uy),this.gradientVersion=0,Kd||(Kd=new wb(Uy.paint.properties["line-width"].specification),Kd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof ao,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Kd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Nf(e)}queryRadius(e){const n=e,o=qy(cr("line-width",this,n),cr("line-gap-width",this,n)),c=cr("line-offset",this,n);return o/2+Math.abs(c)+ur(this.paint.get("line-translate"))}queryIntersectsFeature(e,n,o,c,f,g,_){const b=Pi(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,_),T=_/2*qy(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),P=this.paint.get("line-offset").evaluate(n,o);return P&&(c=function(A,L){const F=[];for(let $=0;$<A.length;$++){const q=A[$],W=[];for(let se=0;se<q.length;se++){const Se=q[se-1],ue=q[se],xe=q[se+1],Be=se===0?new ie(0,0):ue.sub(Se)._unit()._perp(),$e=se===q.length-1?new ie(0,0):xe.sub(ue)._unit()._perp(),vt=Be._add($e)._unit(),Tt=vt.x*$e.x+vt.y*$e.y;Tt!==0&&vt._mult(1/Tt),W.push(vt._mult(L)._add(ue))}F.push(W)}return F}(c,P*_)),function(A,L,F){for(let $=0;$<L.length;$++){const q=L[$];if(A.length>=3){for(let W=0;W<q.length;W++)if(rt(A,q[W]))return!0}if(Mr(A,q,F))return!0}return!1}(b,c,T)}isTileClipped(){return!0}}function qy(r,e){return e>0?e+2*r:r}const kb=E([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cb=E([{name:"a_projected_pos",components:3,type:"Float32"}],4);E([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Tb=E([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);E([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gy=E([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ib=E([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Eb(r,e,n){return r.sections.forEach(o=>{o.text=function(c,f,g){const _=f.layout.get("text-transform").evaluate(g,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),Bs.applyArabicShaping&&(c=Bs.applyArabicShaping(c)),c}(o.text,e,n)}),r}E([{name:"triangle",components:3,type:"Uint16"}]),E([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),E([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),E([{type:"Float32",name:"offsetX"}]),E([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),E([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const qh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ni=24,Zy=Vr,Hy=function(r,e,n,o,c){var f,g,_=8*c-o-1,b=(1<<_)-1,T=b>>1,P=-7,A=c-1,L=-1,F=r[e+A];for(A+=L,f=F&(1<<-P)-1,F>>=-P,P+=_;P>0;f=256*f+r[e+A],A+=L,P-=8);for(g=f&(1<<-P)-1,f>>=-P,P+=o;P>0;g=256*g+r[e+A],A+=L,P-=8);if(f===0)f=1-T;else{if(f===b)return g?NaN:1/0*(F?-1:1);g+=Math.pow(2,o),f-=T}return(F?-1:1)*g*Math.pow(2,f-o)},Wy=function(r,e,n,o,c,f){var g,_,b,T=8*f-c-1,P=(1<<T)-1,A=P>>1,L=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=0,$=1,q=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,g=P):(g=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-g))<1&&(g--,b*=2),(e+=g+A>=1?L/b:L*Math.pow(2,1-A))*b>=2&&(g++,b/=2),g+A>=P?(_=0,g=P):g+A>=1?(_=(e*b-1)*Math.pow(2,c),g+=A):(_=e*Math.pow(2,A-1)*Math.pow(2,c),g=0));c>=8;r[n+F]=255&_,F+=$,_/=256,c-=8);for(g=g<<c|_,T+=c;T>0;r[n+F]=255&g,F+=$,g/=256,T-=8);r[n+F-$]|=128*q};function Vr(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Vr.Varint=0,Vr.Fixed64=1,Vr.Bytes=2,Vr.Fixed32=5;var Of=4294967296,Ky=1/Of,Xy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function To(r){return r.type===Vr.Bytes?r.readVarint()+r.pos:r.pos+1}function Fu(r,e,n){return n?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Yy(r,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=r;c--)n.buf[c+o]=n.buf[c]}function Pb(r,e){for(var n=0;n<r.length;n++)e.writeVarint(r[n])}function Ab(r,e){for(var n=0;n<r.length;n++)e.writeSVarint(r[n])}function Mb(r,e){for(var n=0;n<r.length;n++)e.writeFloat(r[n])}function zb(r,e){for(var n=0;n<r.length;n++)e.writeDouble(r[n])}function Db(r,e){for(var n=0;n<r.length;n++)e.writeBoolean(r[n])}function Lb(r,e){for(var n=0;n<r.length;n++)e.writeFixed32(r[n])}function Rb(r,e){for(var n=0;n<r.length;n++)e.writeSFixed32(r[n])}function Fb(r,e){for(var n=0;n<r.length;n++)e.writeFixed64(r[n])}function Bb(r,e){for(var n=0;n<r.length;n++)e.writeSFixed64(r[n])}function Xd(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function Bu(r,e,n){r[n]=e,r[n+1]=e>>>8,r[n+2]=e>>>16,r[n+3]=e>>>24}function Jy(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Vr.prototype={destroy:function(){this.buf=null},readFields:function(r,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,f=this.pos;this.type=7&o,r(c,e,this),this.pos===f&&this.skip(o)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=Xd(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Jy(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Xd(this.buf,this.pos)+Xd(this.buf,this.pos+4)*Of;return this.pos+=8,r},readSFixed64:function(){var r=Xd(this.buf,this.pos)+Jy(this.buf,this.pos+4)*Of;return this.pos+=8,r},readFloat:function(){var r=Hy(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Hy(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,f,g){var _,b,T=g.buf;if(_=(112&(b=T[g.pos++]))>>4,b<128||(_|=(127&(b=T[g.pos++]))<<3,b<128)||(_|=(127&(b=T[g.pos++]))<<10,b<128)||(_|=(127&(b=T[g.pos++]))<<17,b<128)||(_|=(127&(b=T[g.pos++]))<<24,b<128)||(_|=(1&(b=T[g.pos++]))<<31,b<128))return Fu(c,_,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Xy?function(n,o,c){return Xy.decode(n.subarray(o,c))}(this.buf,e,r):function(n,o,c){for(var f="",g=o;g<c;){var _,b,T,P=n[g],A=null,L=P>239?4:P>223?3:P>191?2:1;if(g+L>c)break;L===1?P<128&&(A=P):L===2?(192&(_=n[g+1]))==128&&(A=(31&P)<<6|63&_)<=127&&(A=null):L===3?(b=n[g+2],(192&(_=n[g+1]))==128&&(192&b)==128&&((A=(15&P)<<12|(63&_)<<6|63&b)<=2047||A>=55296&&A<=57343)&&(A=null)):L===4&&(b=n[g+2],T=n[g+3],(192&(_=n[g+1]))==128&&(192&b)==128&&(192&T)==128&&((A=(15&P)<<18|(63&_)<<12|(63&b)<<6|63&T)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,L=1):A>65535&&(A-=65536,f+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),f+=String.fromCharCode(A),g+=L}return f}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Vr.Bytes)return r.push(this.readVarint(e));var n=To(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Vr.Bytes)return r.push(this.readSVarint());var e=To(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Vr.Bytes)return r.push(this.readBoolean());var e=To(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Vr.Bytes)return r.push(this.readFloat());var e=To(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Vr.Bytes)return r.push(this.readDouble());var e=To(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Vr.Bytes)return r.push(this.readFixed32());var e=To(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Vr.Bytes)return r.push(this.readSFixed32());var e=To(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Vr.Bytes)return r.push(this.readFixed64());var e=To(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Vr.Bytes)return r.push(this.readSFixed64());var e=To(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Vr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Vr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Vr.Fixed32)this.pos+=4;else{if(e!==Vr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Bu(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Bu(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Bu(this.buf,-1&r,this.pos),Bu(this.buf,Math.floor(r*Ky),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Bu(this.buf,-1&r,this.pos),Bu(this.buf,Math.floor(r*Ky),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(f,g,_){_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,_.buf[_.pos]=127&(f>>>=7)}(o,0,n),function(f,g){var _=(7&f)<<4;g.buf[g.pos++]|=_|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(c,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(o,c,f){for(var g,_,b=0;b<c.length;b++){if((g=c.charCodeAt(b))>55295&&g<57344){if(!_){g>56319||b+1===c.length?(o[f++]=239,o[f++]=191,o[f++]=189):_=g;continue}if(g<56320){o[f++]=239,o[f++]=191,o[f++]=189,_=g;continue}g=_-55296<<10|g-56320|65536,_=null}else _&&(o[f++]=239,o[f++]=191,o[f++]=189,_=null);g<128?o[f++]=g:(g<2048?o[f++]=g>>6|192:(g<65536?o[f++]=g>>12|224:(o[f++]=g>>18|240,o[f++]=g>>12&63|128),o[f++]=g>>6&63|128),o[f++]=63&g|128)}return f}(this.buf,r,this.pos);var n=this.pos-e;n>=128&&Yy(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),Wy(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Wy(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,e){this.pos++;var n=this.pos;r(e,this);var o=this.pos-n;o>=128&&Yy(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,e,n){this.writeTag(r,Vr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,Pb,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,Ab,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,Db,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,Mb,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,zb,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,Lb,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,Rb,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,Fb,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,Bb,e)},writeBytesField:function(r,e){this.writeTag(r,Vr.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Vr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Vr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Vr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Vr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Vr.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Vr.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Vr.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Vr.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Vr.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var $f=V(Zy);const jf=3;function Nb(r,e,n){r===1&&n.readMessage(Ob,e)}function Ob(r,e,n){if(r===3){const{id:o,bitmap:c,width:f,height:g,left:_,top:b,advance:T}=n.readMessage($b,{});e.push({id:o,bitmap:new Nh({width:f+2*jf,height:g+2*jf},c),metrics:{width:f,height:g,left:_,top:b,advance:T}})}}function $b(r,e,n){r===1?e.id=n.readVarint():r===2?e.bitmap=n.readBytes():r===3?e.width=n.readVarint():r===4?e.height=n.readVarint():r===5?e.left=n.readSVarint():r===6?e.top=n.readSVarint():r===7&&(e.advance=n.readVarint())}const Qy=jf;function e_(r){let e=0,n=0;for(const g of r)e+=g.w*g.h,n=Math.max(n,g.w);r.sort((g,_)=>_.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,f=0;for(const g of r)for(let _=o.length-1;_>=0;_--){const b=o[_];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,f=Math.max(f,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===b.w&&g.h===b.h){const T=o.pop();_<o.length&&(o[_]=T)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(o.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:c,h:f,fill:e/(c*f)||0}}const jn=1;class Vf{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:f,content:g,textFitWidth:_,textFitHeight:b}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=f,this.content=g,this.version=o,this.textFitWidth=_,this.textFitHeight=b}get tl(){return[this.paddedRect.x+jn,this.paddedRect.y+jn]}get br(){return[this.paddedRect.x+this.paddedRect.w-jn,this.paddedRect.y+this.paddedRect.h-jn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*jn)/this.pixelRatio,(this.paddedRect.h-2*jn)/this.pixelRatio]}}class t_{constructor(e,n){const o={},c={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,o,f),this.addImages(n,c,f);const{w:g,h:_}=e_(f),b=new gs({width:g||1,height:_||1});for(const T in e){const P=e[T],A=o[T].paddedRect;gs.copy(P.data,b,{x:0,y:0},{x:A.x+jn,y:A.y+jn},P.data)}for(const T in n){const P=n[T],A=c[T].paddedRect,L=A.x+jn,F=A.y+jn,$=P.data.width,q=P.data.height;gs.copy(P.data,b,{x:0,y:0},{x:L,y:F},P.data),gs.copy(P.data,b,{x:0,y:q-1},{x:L,y:F-1},{width:$,height:1}),gs.copy(P.data,b,{x:0,y:0},{x:L,y:F+q},{width:$,height:1}),gs.copy(P.data,b,{x:$-1,y:0},{x:L-1,y:F},{width:1,height:q}),gs.copy(P.data,b,{x:0,y:0},{x:L+$,y:F},{width:1,height:q})}this.image=b,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(const c in e){const f=e[c],g={x:0,y:0,w:f.data.width+2*jn,h:f.data.height+2*jn};o.push(g),n[c]=new Vf(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,f]=e.tl;o.update(n.data,void 0,{x:c,y:f})}}var Il;bt("ImagePosition",Vf),bt("ImageAtlas",t_),S.ah=void 0,(Il=S.ah||(S.ah={}))[Il.none=0]="none",Il[Il.horizontal=1]="horizontal",Il[Il.vertical=2]="vertical",Il[Il.horizontalOnly=3]="horizontalOnly";const Gh=-17;class Zh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const o=new Zh;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new Zh;return n.imageName=e,n}}class Nu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const o=new Nu;for(let c=0;c<e.sections.length;c++){const f=e.sections[c];f.image?o.addImageSection(f):o.addTextSection(f,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let n="";for(let o=0;o<e.length;o++){const c=e.charCodeAt(o+1)||null,f=e.charCodeAt(o-1)||null;n+=c&&Mc(c)&&!qh[e[o+1]]||f&&Mc(f)&&!qh[e[o-1]]||!qh[e[o]]?e[o]:qh[e[o]]}return n}(this.text)}trim(){let e=0;for(let o=0;o<this.text.length&&Jd[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Jd[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new Nu;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Zh.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void tt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Zh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):tt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yd(r,e,n,o,c,f,g,_,b,T,P,A,L,F,$,q){const W=Nu.fromFeature(r,c);let se;A===S.ah.vertical&&W.verticalizePunctuation();const{processBidirectionalText:Se,processStyledBidirectionalText:ue}=Bs;if(Se&&W.sections.length===1){se=[];const $e=Se(W.toString(),Uf(W,T,f,e,o,F,$));for(const vt of $e){const Tt=new Nu;Tt.text=vt,Tt.sections=W.sections;for(let gt=0;gt<vt.length;gt++)Tt.sectionIndex.push(0);se.push(Tt)}}else if(ue){se=[];const $e=ue(W.text,W.sectionIndex,Uf(W,T,f,e,o,F,$));for(const vt of $e){const Tt=new Nu;Tt.text=vt[0],Tt.sectionIndex=vt[1],Tt.sections=W.sections,se.push(Tt)}}else se=function($e,vt){const Tt=[],gt=$e.text;let ut=0;for(const St of vt)Tt.push($e.substring(ut,St)),ut=St;return ut<gt.length&&Tt.push($e.substring(ut,gt.length)),Tt}(W,Uf(W,T,f,e,o,F,$));const xe=[],Be={positionedLines:xe,text:W.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:A,iconsInText:!1,verticalizable:!1};return function($e,vt,Tt,gt,ut,St,Dt,yt,Ve,Ct,kt,Qt){let Ur=0,qr=Gh,Ai=0,_s=0;const Sn=yt==="right"?1:yt==="left"?0:.5;let Oi=0;for(const Mi of ut){Mi.trim();const Xi=Mi.getMaxScale(),Dn=(Xi-1)*Ni,Vn={positionedGlyphs:[],lineOffset:0};$e.positionedLines[Oi]=Vn;const dn=Vn.positionedGlyphs;let Un=0;if(!Mi.length()){qr+=St,++Oi;continue}for(let yi=0;yi<Mi.length();yi++){const hr=Mi.getSection(yi),zi=Mi.getSectionIndex(yi),pn=Mi.getCharCode(yi);let $i=0,$s=null,ua=null,ha=null,Io=Ni;const js=!(Ve===S.ah.horizontal||!kt&&!Ac(pn)||kt&&(Jd[pn]||(rn=pn,ft.Arabic(rn)||ft["Arabic Supplement"](rn)||ft["Arabic Extended-A"](rn)||ft["Arabic Presentation Forms-A"](rn)||ft["Arabic Presentation Forms-B"](rn))));if(hr.imageName){const xs=gt[hr.imageName];if(!xs)continue;ha=hr.imageName,$e.iconsInText=$e.iconsInText||!0,ua=xs.paddedRect;const qn=xs.displaySize;hr.scale=hr.scale*Ni/Qt,$s={width:qn[0],height:qn[1],left:jn,top:-Qy,advance:js?qn[1]:qn[0]},$i=Dn+(Ni-qn[1]*hr.scale),Io=$s.advance;const Eo=js?qn[0]*hr.scale-Ni*Xi:qn[1]*hr.scale-Ni*Xi;Eo>0&&Eo>Un&&(Un=Eo)}else{const xs=Tt[hr.fontStack],qn=xs&&xs[pn];if(qn&&qn.rect)ua=qn.rect,$s=qn.metrics;else{const Eo=vt[hr.fontStack],Yh=Eo&&Eo[pn];if(!Yh)continue;$s=Yh.metrics}$i=(Xi-hr.scale)*Ni}js?($e.verticalizable=!0,dn.push({glyph:pn,imageName:ha,x:Ur,y:qr+$i,vertical:js,scale:hr.scale,fontStack:hr.fontStack,sectionIndex:zi,metrics:$s,rect:ua}),Ur+=Io*hr.scale+Ct):(dn.push({glyph:pn,imageName:ha,x:Ur,y:qr+$i,vertical:js,scale:hr.scale,fontStack:hr.fontStack,sectionIndex:zi,metrics:$s,rect:ua}),Ur+=$s.advance*hr.scale+Ct)}dn.length!==0&&(Ai=Math.max(Ur-Ct,Ai),Ub(dn,0,dn.length-1,Sn,Un)),Ur=0;const vs=St*Xi+Un;Vn.lineOffset=Math.max(Un,Dn),qr+=vs,_s=Math.max(vs,_s),++Oi}var rn;const kn=qr-Gh,{horizontalAlign:zn,verticalAlign:Cn}=qf(Dt);(function(Mi,Xi,Dn,Vn,dn,Un,vs,yi,hr){const zi=(Xi-Dn)*dn;let pn=0;pn=Un!==vs?-yi*Vn-Gh:(-Vn*hr+.5)*vs;for(const $i of Mi)for(const $s of $i.positionedGlyphs)$s.x+=zi,$s.y+=pn})($e.positionedLines,Sn,zn,Cn,Ai,_s,St,kn,ut.length),$e.top+=-Cn*kn,$e.bottom=$e.top+kn,$e.left+=-zn*Ai,$e.right=$e.left+Ai}(Be,e,n,o,se,g,_,b,A,T,L,q),!function($e){for(const vt of $e)if(vt.positionedGlyphs.length!==0)return!1;return!0}(xe)&&Be}const Jd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function r_(r,e,n,o,c,f){if(e.imageName){const g=o[e.imageName];return g?g.displaySize[0]*e.scale*Ni/f+c:0}{const g=n[e.fontStack],_=g&&g[r];return _?_.metrics.advance*e.scale+c:0}}function i_(r,e,n,o){const c=Math.pow(r-e,2);return o?r<e?c/2:2*c:c+Math.abs(n)*n}function Vb(r,e,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function n_(r,e,n,o,c,f){let g=null,_=i_(e,n,c,f);for(const b of o){const T=i_(e-b.x,n,c,f)+b.badness;T<=_&&(g=b,_=T)}return{index:r,x:e,priorBreak:g,badness:_}}function s_(r){return r?s_(r.priorBreak).concat(r.index):[]}function Uf(r,e,n,o,c,f,g){if(f!=="point")return[];if(!r)return[];const _=[],b=function(L,F,$,q,W,se){let Se=0;for(let ue=0;ue<L.length();ue++){const xe=L.getSection(ue);Se+=r_(L.getCharCode(ue),xe,q,W,F,se)}return Se/Math.max(1,Math.ceil(Se/$))}(r,e,n,o,c,g),T=r.text.indexOf("")>=0;let P=0;for(let L=0;L<r.length();L++){const F=r.getSection(L),$=r.getCharCode(L);if(Jd[$]||(P+=r_($,F,o,c,e,g)),L<r.length()-1){const q=!((A=$)<11904||!(ft["Bopomofo Extended"](A)||ft.Bopomofo(A)||ft["CJK Compatibility Forms"](A)||ft["CJK Compatibility Ideographs"](A)||ft["CJK Compatibility"](A)||ft["CJK Radicals Supplement"](A)||ft["CJK Strokes"](A)||ft["CJK Symbols and Punctuation"](A)||ft["CJK Unified Ideographs Extension A"](A)||ft["CJK Unified Ideographs"](A)||ft["Enclosed CJK Letters and Months"](A)||ft["Halfwidth and Fullwidth Forms"](A)||ft.Hiragana(A)||ft["Ideographic Description Characters"](A)||ft["Kangxi Radicals"](A)||ft["Katakana Phonetic Extensions"](A)||ft.Katakana(A)||ft["Vertical Forms"](A)||ft["Yi Radicals"](A)||ft["Yi Syllables"](A)));(jb[$]||q||F.imageName)&&_.push(n_(L+1,P,b,_,Vb($,r.getCharCode(L+1),q&&T),!1))}}var A;return s_(n_(r.length(),P,b,_,0,!0))}function qf(r){let e=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Ub(r,e,n,o,c){if(!o&&!c)return;const f=r[n],g=(r[n].x+f.metrics.advance*f.scale)*o;for(let _=e;_<=n;_++)r[_].x-=g,r[_].y+=c}function qb(r,e,n){const{horizontalAlign:o,verticalAlign:c}=qf(n),f=e[0]-r.displaySize[0]*o,g=e[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:f,right:f+r.displaySize[0]}}function a_(r){var e,n;let o=r.left,c=r.top,f=r.right-o,g=r.bottom-c;const _=(e=r.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",b=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",T=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(b==="proportional"){if(_==="stretchOnly"&&f/g<T||_==="proportional"){const P=Math.ceil(g*T);o*=P/f,f=P}}else if(_==="proportional"&&b==="stretchOnly"&&T!==0&&f/g>T){const P=Math.ceil(f/T);c*=P/g,g=P}return{x1:o,y1:c,x2:o+f,y2:c+g}}function o_(r,e,n,o,c,f){const g=r.image;let _;if(g.content){const W=g.content,se=g.pixelRatio||1;_=[W[0]/se,W[1]/se,g.displaySize[0]-W[2]/se,g.displaySize[1]-W[3]/se]}const b=e.left*f,T=e.right*f;let P,A,L,F;n==="width"||n==="both"?(F=c[0]+b-o[3],A=c[0]+T+o[1]):(F=c[0]+(b+T-g.displaySize[0])/2,A=F+g.displaySize[0]);const $=e.top*f,q=e.bottom*f;return n==="height"||n==="both"?(P=c[1]+$-o[0],L=c[1]+q+o[2]):(P=c[1]+($+q-g.displaySize[1])/2,L=P+g.displaySize[1]),{image:g,top:P,right:A,bottom:L,left:F,collisionPadding:_}}const Hh=255,Ha=128,El=Hh*Ha;function l_(r,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new jr(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let f=0;for(;f<o.length&&o[f]<=r;)f++;f=Math.max(0,f-1);let g=f;for(;g<o.length&&o[g]<r+1;)g++;g=Math.min(o.length-1,g);const _=o[f],b=o[g];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:b,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:b,minSize:n.evaluate(new jr(_)),maxSize:n.evaluate(new jr(b)),interpolationType:c}}}function Gf(r,e,n){let o="never";const c=r.get(e);return c?o=c:r.get(n)&&(o="always"),o}const Gb=Tl.VectorTileFeature.types,Zb=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qd(r,e,n,o,c,f,g,_,b,T,P,A,L){const F=_?Math.min(El,Math.round(_[0])):0,$=_?Math.min(El,Math.round(_[1])):0;r.emplaceBack(e,n,Math.round(32*o),Math.round(32*c),f,g,(F<<1)+(b?1:0),$,16*T,16*P,256*A,256*L)}function Zf(r,e,n){r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n),r.emplaceBack(e.x,e.y,n)}function Hb(r){for(const e of r.sections)if(ml(e.text))return!0;return!1}class Hf{constructor(e){this.layoutVertexArray=new Mn,this.indexArray=new bi,this.programConfigurations=e,this.segments=new wi,this.dynamicLayoutVertexArray=new fs,this.opacityVertexArray=new sa,this.hasVisibleVertices=!1,this.placedSymbolArray=new Hr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Cb.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Zb,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}bt("SymbolBuffers",Hf);class Wf{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new wi,this.collisionVertexArray=new Ki}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Tb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}bt("CollisionBuffers",Wf);class Ou{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=$n([]),this.placementViewportMatrix=$n([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=l_(this.zoom,n["text-size"]),this.iconSizeData=l_(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=Gf(o,"text-overlap","text-allow-overlap")!=="never"||Gf(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>S.ah[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID}createArrays(){this.text=new Hf(new de(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Hf(new de(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Wr,this.lineVertexArray=new Qi,this.symbolInstances=new Nn,this.textAnchorOffsets=new Hi}calculateGlyphDependencies(e,n,o,c,f){for(let g=0;g<e.length;g++)if(n[e.charCodeAt(g)]=!0,(o||c)&&f){const _=qh[e.charAt(g)];_&&(n[_.charCodeAt(0)]=!0)}}populate(e,n,o){const c=this.layers[0],f=c.layout,g=f.get("text-font"),_=f.get("text-field"),b=f.get("icon-image"),T=(_.value.kind!=="constant"||_.value.value instanceof gn&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),P=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,A=f.get("symbol-sort-key");if(this.features=[],!T&&!P)return;const L=n.iconDependencies,F=n.glyphDependencies,$=n.availableImages,q=new jr(this.zoom);for(const{feature:W,id:se,index:Se,sourceLayerIndex:ue}of e){const xe=c._featureFilter.needGeometry,Be=xt(W,xe);if(!c._featureFilter.filter(q,Be,o))continue;let $e,vt;if(xe||(Be.geometry=Ye(W)),T){const gt=c.getValueAndResolveTokens("text-field",Be,o,$),ut=gn.factory(gt),St=this.hasRTLText=this.hasRTLText||Hb(ut);(!St||Bs.getRTLTextPluginStatus()==="unavailable"||St&&Bs.isParsed())&&($e=Eb(ut,c,Be))}if(P){const gt=c.getValueAndResolveTokens("icon-image",Be,o,$);vt=gt instanceof Ri?gt:Ri.fromString(gt)}if(!$e&&!vt)continue;const Tt=this.sortFeaturesByKey?A.evaluate(Be,{},o):void 0;if(this.features.push({id:se,text:$e,icon:vt,index:Se,sourceLayerIndex:ue,geometry:Be.geometry,properties:W.properties,type:Gb[W.type],sortKey:Tt}),vt&&(L[vt.name]=!0),$e){const gt=g.evaluate(Be,{},o).join(","),ut=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const St of $e.sections)if(St.image)L[St.image.name]=!0;else{const Dt=Fs($e.toString()),yt=St.fontStack||gt,Ve=F[yt]=F[yt]||{};this.calculateGlyphDependencies(St.text,Ve,ut,this.allowVerticalPlacement,Dt)}}}f.get("symbol-placement")==="line"&&(this.features=function(W){const se={},Se={},ue=[];let xe=0;function Be(gt){ue.push(W[gt]),xe++}function $e(gt,ut,St){const Dt=Se[gt];return delete Se[gt],Se[ut]=Dt,ue[Dt].geometry[0].pop(),ue[Dt].geometry[0]=ue[Dt].geometry[0].concat(St[0]),Dt}function vt(gt,ut,St){const Dt=se[ut];return delete se[ut],se[gt]=Dt,ue[Dt].geometry[0].shift(),ue[Dt].geometry[0]=St[0].concat(ue[Dt].geometry[0]),Dt}function Tt(gt,ut,St){const Dt=St?ut[0][ut[0].length-1]:ut[0][0];return`${gt}:${Dt.x}:${Dt.y}`}for(let gt=0;gt<W.length;gt++){const ut=W[gt],St=ut.geometry,Dt=ut.text?ut.text.toString():null;if(!Dt){Be(gt);continue}const yt=Tt(Dt,St),Ve=Tt(Dt,St,!0);if(yt in Se&&Ve in se&&Se[yt]!==se[Ve]){const Ct=vt(yt,Ve,St),kt=$e(yt,Ve,ue[Ct].geometry);delete se[yt],delete Se[Ve],Se[Tt(Dt,ue[kt].geometry,!0)]=kt,ue[Ct].geometry=null}else yt in Se?$e(yt,Ve,St):Ve in se?vt(yt,Ve,St):(Be(gt),se[yt]=xe-1,Se[Ve]=xe-1)}return ue.filter(gt=>gt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,se)=>W.sortKey-se.sortKey)}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(n[e.segment+1]),f=e.dist(n[e.segment]);const g={};for(let _=e.segment+1;_<n.length;_++)g[_]={x:n[_].x,y:n[_].y,tileUnitDistanceFromAnchor:c},_<n.length-1&&(c+=n[_+1].dist(n[_]));for(let _=e.segment||0;_>=0;_--)g[_]={x:n[_].x,y:n[_].y,tileUnitDistanceFromAnchor:f},_>0&&(f+=n[_-1].dist(n[_]));for(let _=0;_<n.length;_++){const b=g[_];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,f,g,_,b,T,P,A,L){const F=e.indexArray,$=e.layoutVertexArray,q=e.segments.prepareSegment(4*n.length,$,F,this.canOverlap?g.sortKey:void 0),W=this.glyphOffsetArray.length,se=q.vertexLength,Se=this.allowVerticalPlacement&&_===S.ah.vertical?Math.PI/2:0,ue=g.text&&g.text.sections;for(let xe=0;xe<n.length;xe++){const{tl:Be,tr:$e,bl:vt,br:Tt,tex:gt,pixelOffsetTL:ut,pixelOffsetBR:St,minFontScaleX:Dt,minFontScaleY:yt,glyphOffset:Ve,isSDF:Ct,sectionIndex:kt}=n[xe],Qt=q.vertexLength,Ur=Ve[1];Qd($,b.x,b.y,Be.x,Ur+Be.y,gt.x,gt.y,o,Ct,ut.x,ut.y,Dt,yt),Qd($,b.x,b.y,$e.x,Ur+$e.y,gt.x+gt.w,gt.y,o,Ct,St.x,ut.y,Dt,yt),Qd($,b.x,b.y,vt.x,Ur+vt.y,gt.x,gt.y+gt.h,o,Ct,ut.x,St.y,Dt,yt),Qd($,b.x,b.y,Tt.x,Ur+Tt.y,gt.x+gt.w,gt.y+gt.h,o,Ct,St.x,St.y,Dt,yt),Zf(e.dynamicLayoutVertexArray,b,Se),F.emplaceBack(Qt,Qt+1,Qt+2),F.emplaceBack(Qt+1,Qt+2,Qt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ve[0]),xe!==n.length-1&&kt===n[xe+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,g,g.index,{},L,ue&&ue[kt])}e.placedSymbolArray.emplaceBack(b.x,b.y,W,this.glyphOffsetArray.length-W,se,T,P,b.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],_,0,!1,0,A)}_addCollisionDebugVertex(e,n,o,c,f,g){return n.emplaceBack(0,0),e.emplaceBack(o.x,o.y,c,f,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(e,n,o,c,f,g,_){const b=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),T=b.vertexLength,P=f.layoutVertexArray,A=f.collisionVertexArray,L=_.anchorX,F=_.anchorY;this._addCollisionDebugVertex(P,A,g,L,F,new ie(e,n)),this._addCollisionDebugVertex(P,A,g,L,F,new ie(o,n)),this._addCollisionDebugVertex(P,A,g,L,F,new ie(o,c)),this._addCollisionDebugVertex(P,A,g,L,F,new ie(e,c)),b.vertexLength+=4;const $=f.indexArray;$.emplaceBack(T,T+1),$.emplaceBack(T+1,T+2),$.emplaceBack(T+2,T+3),$.emplaceBack(T+3,T),b.primitiveLength+=4}addDebugCollisionBoxes(e,n,o,c){for(let f=e;f<n;f++){const g=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wf(Bi,Gy.members,Ar),this.iconCollisionBox=new Wf(Bi,Gy.members,Ar);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,o,c,f,g,_,b,T){const P={};for(let A=n;A<o;A++){const L=e.get(A);P.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},P.textFeatureIndex=L.featureIndex;break}for(let A=c;A<f;A++){const L=e.get(A);P.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},P.verticalTextFeatureIndex=L.featureIndex;break}for(let A=g;A<_;A++){const L=e.get(A);P.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},P.iconFeatureIndex=L.featureIndex;break}for(let A=b;A<T;A++){const L=e.get(A);P.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},P.verticalIconFeatureIndex=L.featureIndex;break}return P}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<c;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),c=[],f=[],g=[];for(let _=0;_<this.symbolInstances.length;++_){g.push(_);const b=this.symbolInstances.get(_);c.push(0|Math.round(n*b.anchorX+o*b.anchorY)),f.push(b.featureIndex)}return g.sort((_,b)=>c[_]-c[b]||f[b]-f[_]),g}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,f,g)=>{c>=0&&g.indexOf(c)===f&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let c_,u_;bt("SymbolBucket",Ou,{omit:["layers","collisionBoxArray","features","compareText"]}),Ou.MAX_GLYPHS=65535,Ou.addDynamicAttributes=Zf;var Kf={get paint(){return u_=u_||new l({"icon-opacity":new jt(Ee.paint_symbol["icon-opacity"]),"icon-color":new jt(Ee.paint_symbol["icon-color"]),"icon-halo-color":new jt(Ee.paint_symbol["icon-halo-color"]),"icon-halo-width":new jt(Ee.paint_symbol["icon-halo-width"]),"icon-halo-blur":new jt(Ee.paint_symbol["icon-halo-blur"]),"icon-translate":new Pt(Ee.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pt(Ee.paint_symbol["icon-translate-anchor"]),"text-opacity":new jt(Ee.paint_symbol["text-opacity"]),"text-color":new jt(Ee.paint_symbol["text-color"],{runtimeType:ui,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new jt(Ee.paint_symbol["text-halo-color"]),"text-halo-width":new jt(Ee.paint_symbol["text-halo-width"]),"text-halo-blur":new jt(Ee.paint_symbol["text-halo-blur"]),"text-translate":new Pt(Ee.paint_symbol["text-translate"]),"text-translate-anchor":new Pt(Ee.paint_symbol["text-translate-anchor"])})},get layout(){return c_=c_||new l({"symbol-placement":new Pt(Ee.layout_symbol["symbol-placement"]),"symbol-spacing":new Pt(Ee.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pt(Ee.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new jt(Ee.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pt(Ee.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Pt(Ee.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Pt(Ee.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Pt(Ee.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pt(Ee.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pt(Ee.layout_symbol["icon-rotation-alignment"]),"icon-size":new jt(Ee.layout_symbol["icon-size"]),"icon-text-fit":new Pt(Ee.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pt(Ee.layout_symbol["icon-text-fit-padding"]),"icon-image":new jt(Ee.layout_symbol["icon-image"]),"icon-rotate":new jt(Ee.layout_symbol["icon-rotate"]),"icon-padding":new jt(Ee.layout_symbol["icon-padding"]),"icon-keep-upright":new Pt(Ee.layout_symbol["icon-keep-upright"]),"icon-offset":new jt(Ee.layout_symbol["icon-offset"]),"icon-anchor":new jt(Ee.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pt(Ee.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pt(Ee.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pt(Ee.layout_symbol["text-rotation-alignment"]),"text-field":new jt(Ee.layout_symbol["text-field"]),"text-font":new jt(Ee.layout_symbol["text-font"]),"text-size":new jt(Ee.layout_symbol["text-size"]),"text-max-width":new jt(Ee.layout_symbol["text-max-width"]),"text-line-height":new Pt(Ee.layout_symbol["text-line-height"]),"text-letter-spacing":new jt(Ee.layout_symbol["text-letter-spacing"]),"text-justify":new jt(Ee.layout_symbol["text-justify"]),"text-radial-offset":new jt(Ee.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pt(Ee.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new jt(Ee.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new jt(Ee.layout_symbol["text-anchor"]),"text-max-angle":new Pt(Ee.layout_symbol["text-max-angle"]),"text-writing-mode":new Pt(Ee.layout_symbol["text-writing-mode"]),"text-rotate":new jt(Ee.layout_symbol["text-rotate"]),"text-padding":new Pt(Ee.layout_symbol["text-padding"]),"text-keep-upright":new Pt(Ee.layout_symbol["text-keep-upright"]),"text-transform":new jt(Ee.layout_symbol["text-transform"]),"text-offset":new jt(Ee.layout_symbol["text-offset"]),"text-allow-overlap":new Pt(Ee.layout_symbol["text-allow-overlap"]),"text-overlap":new Pt(Ee.layout_symbol["text-overlap"]),"text-ignore-placement":new Pt(Ee.layout_symbol["text-ignore-placement"]),"text-optional":new Pt(Ee.layout_symbol["text-optional"])})}};class h_{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:si,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}bt("FormatSectionOverride",h_,{omit:["defaultValue"]});class ep extends m{constructor(e){super(e,Kf)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const f of o)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,c){const f=this.layout.get(e).evaluate(n,{},o,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||tl(g.value)||!f?f:function(_,b){return b.replace(/{([^{}]+)}/g,(T,P)=>_&&P in _?String(_[P]):"")}(n.properties,f)}createBucket(e){return new Ou(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Kf.paint.overridableProperties){if(!ep.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new h_(n),c=new vc(o,n.property.specification);let f=null;f=n.value.kind==="constant"||n.value.kind==="source"?new il("source",c):new yo("composite",c,n.value.zoomStops),this.paint._values[e]=new Qn(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&ep.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),c=Kf.paint.properties[n];let f=!1;const g=_=>{for(const b of _)if(c.overrides&&c.overrides.hasOverride(b))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof gn)g(o.value.value.sections);else if(o.value.kind==="source"){const _=T=>{f||(T instanceof Ws&&mi(T.value)===os?g(T.value.sections):T instanceof Ta?g(T.sections):T.eachChild(_))},b=o.value;b._styleExpression&&_(b._styleExpression.expression)}return f}}let d_;var Wb={get paint(){return d_=d_||new l({"background-color":new Pt(Ee.paint_background["background-color"]),"background-pattern":new t(Ee.paint_background["background-pattern"]),"background-opacity":new Pt(Ee.paint_background["background-opacity"])})}};class Kb extends m{constructor(e){super(e,Wb)}}let p_;var Xb={get paint(){return p_=p_||new l({"raster-opacity":new Pt(Ee.paint_raster["raster-opacity"]),"raster-hue-rotate":new Pt(Ee.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pt(Ee.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pt(Ee.paint_raster["raster-brightness-max"]),"raster-saturation":new Pt(Ee.paint_raster["raster-saturation"]),"raster-contrast":new Pt(Ee.paint_raster["raster-contrast"]),"raster-resampling":new Pt(Ee.paint_raster["raster-resampling"]),"raster-fade-duration":new Pt(Ee.paint_raster["raster-fade-duration"])})}};class Yb extends m{constructor(e){super(e,Xb)}}class Jb extends m{constructor(e){super(e,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Qb{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Xf=63710088e-1;class Pl{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Pl(ze(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,c=e.lat*n,f=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Xf*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof Pl)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Pl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Pl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const f_=2*Math.PI*Xf;function m_(r){return f_*Math.cos(r*Math.PI/180)}function g_(r){return(180+r)/360}function y_(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function __(r,e){return r/m_(e)}function Yf(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class tp{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=Pl.convert(e);return new tp(g_(o.lng),y_(o.lat),__(n,o.lat))}toLngLat(){return new Pl(360*this.x-180,Yf(this.y))}toAltitude(){return this.z*m_(Yf(this.y))}meterInMercatorCoordinateUnits(){return 1/f_*(e=Yf(this.y),1/Math.cos(e*Math.PI/180));var e}}function v_(r,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class Jf{constructor(e,n,o){if(e<0||e>25||o<0||o>=Math.pow(2,e)||n<0||n>=Math.pow(2,e))throw new Error(`x=${n}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=o,this.key=Wh(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,o){const c=(g=this.y,_=this.z,b=v_(256*(f=this.x),256*(g=Math.pow(2,_)-g-1),_),T=v_(256*(f+1),256*(g+1),_),b[0]+","+b[1]+","+T[0]+","+T[1]);var f,g,_,b,T;const P=function(A,L,F){let $,q="";for(let W=A;W>0;W--)$=1<<W-1,q+=(L&$?1:0)+(F&$?2:0);return q}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,c)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new ie((e.x*n-this.x)*we,(e.y*n-this.y)*we)}toString(){return`${this.z}/${this.x}/${this.y}`}}class x_{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Wh(e,n.z,n.z,n.x,n.y)}}class ys{constructor(e,n,o,c,f){if(e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=n,this.canonical=new Jf(o,+c,+f),this.key=Wh(n,e,o,c,f)}clone(){return new ys(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new ys(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ys(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Wh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Wh(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ys(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new ys(n,this.wrap,n,o,c),new ys(n,this.wrap,n,o+1,c),new ys(n,this.wrap,n,o,c+1),new ys(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ys(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ys(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new x_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new tp(e.x-this.wrap,e.y))}}function Wh(r,e,n,o,c){(r*=2)<0&&(r=-1*r-1);const f=1<<n;return(f*f*r+f*c+o).toString(36)+n.toString(36)+e.toString(36)}bt("CanonicalTileID",Jf),bt("OverscaledTileID",ys,{omit:["posMatrix"]});class b_{constructor(e,n,o,c=1,f=1,g=1,_=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void tt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const b=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=f,this.blueFactor=g,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<b;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(b,T)]=this.data[this._idx(b-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,b)]=this.data[this._idx(T,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<b;T++)for(let P=0;P<b;P++){const A=this.get(T,P);A>this.max&&(this.max=A),A<this.min&&(this.min=A)}}get(e,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(e,n);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,o){return e*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new gs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,f=n*this.dim+this.dim,g=o*this.dim,_=o*this.dim+this.dim;switch(n){case-1:c=f-1;break;case 1:f=c+1}switch(o){case-1:g=_-1;break;case 1:_=g+1}const b=-n*this.dim,T=-o*this.dim;for(let P=g;P<_;P++)for(let A=c;A<f;A++)this.data[this._idx(A,P)]=e.data[this._idx(A+b,P+T)]}}bt("DEMData",b_);class w_{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class S_{constructor(e,n,o,c,f){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=o,e._y=c,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}class k_{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ia(we,16,0),this.grid3D=new ia(we,16,0),this.featureIndexArray=new On,this.promoteId=n}insert(e,n,o,c,f,g){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,f);const b=g?this.grid3D:this.grid;for(let T=0;T<n.length;T++){const P=n[T],A=[1/0,1/0,-1/0,-1/0];for(let L=0;L<P.length;L++){const F=P[L];A[0]=Math.min(A[0],F.x),A[1]=Math.min(A[1],F.y),A[2]=Math.max(A[2],F.x),A[3]=Math.max(A[3],F.y)}A[0]<we&&A[1]<we&&A[2]>=0&&A[3]>=0&&b.insert(_,A[0],A[1],A[2],A[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Tl.VectorTile(new $f(this.rawTileData)).layers,this.sourceLayerCoder=new w_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,o,c){this.loadVTLayers();const f=e.params||{},g=we/e.tileSize/e.scale,_=vo(f.filter),b=e.queryGeometry,T=e.queryPadding*g,P=T_(b),A=this.grid.query(P.minX-T,P.minY-T,P.maxX+T,P.maxY+T),L=T_(e.cameraQueryGeometry),F=this.grid3D.query(L.minX-T,L.minY-T,L.maxX+T,L.maxY+T,(W,se,Se,ue)=>function(xe,Be,$e,vt,Tt){for(const ut of xe)if(Be<=ut.x&&$e<=ut.y&&vt>=ut.x&&Tt>=ut.y)return!0;const gt=[new ie(Be,$e),new ie(Be,Tt),new ie(vt,Tt),new ie(vt,$e)];if(xe.length>2){for(const ut of gt)if(rt(xe,ut))return!0}for(let ut=0;ut<xe.length-1;ut++)if(Ht(xe[ut],xe[ut+1],gt))return!0;return!1}(e.cameraQueryGeometry,W-T,se-T,Se+T,ue+T));for(const W of F)A.push(W);A.sort(ew);const $={};let q;for(let W=0;W<A.length;W++){const se=A[W];if(se===q)continue;q=se;const Se=this.featureIndexArray.get(se);let ue=null;this.loadMatchingFeature($,Se.bucketIndex,Se.sourceLayerIndex,Se.featureIndex,_,f.layers,f.availableImages,n,o,c,(xe,Be,$e)=>(ue||(ue=Ye(xe)),Be.queryIntersectsFeature(b,xe,$e,ue,this.z,e.transform,g,e.pixelPosMatrix)))}return $}loadMatchingFeature(e,n,o,c,f,g,_,b,T,P,A){const L=this.bucketLayerIDs[n];if(g&&!function(W,se){for(let Se=0;Se<W.length;Se++)if(se.indexOf(W[Se])>=0)return!0;return!1}(g,L))return;const F=this.sourceLayerCoder.decode(o),$=this.vtLayers[F].feature(c);if(f.needGeometry){const W=xt($,!0);if(!f.filter(new jr(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!f.filter(new jr(this.tileID.overscaledZ),$))return;const q=this.getId($,F);for(let W=0;W<L.length;W++){const se=L[W];if(g&&g.indexOf(se)<0)continue;const Se=b[se];if(!Se)continue;let ue={};q&&P&&(ue=P.getState(Se.sourceLayer||"_geojsonTileLayer",q));const xe=Ge({},T[se]);xe.paint=C_(xe.paint,Se.paint,$,ue,_),xe.layout=C_(xe.layout,Se.layout,$,ue,_);const Be=!A||A($,Se,ue);if(!Be)continue;const $e=new S_($,this.z,this.x,this.y,q);$e.layer=xe;let vt=e[se];vt===void 0&&(vt=e[se]=[]),vt.push({featureIndex:c,feature:$e,intersectionZ:Be})}}lookupSymbolFeatures(e,n,o,c,f,g,_,b){const T={};this.loadVTLayers();const P=vo(f);for(const A of e)this.loadMatchingFeature(T,o,c,A,P,g,_,b,n);return T}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function C_(r,e,n,o,c){return ne(r,(f,g)=>{const _=e instanceof yl?e.get(g):null;return _&&_.evaluate?_.evaluate(n,o,c):_})}function T_(r){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const f of r)e=Math.min(e,f.x),n=Math.min(n,f.y),o=Math.max(o,f.x),c=Math.max(c,f.y);return{minX:e,minY:n,maxX:o,maxY:c}}function ew(r,e){return e-r}function I_(r,e,n,o,c){const f=[];for(let g=0;g<r.length;g++){const _=r[g];let b;for(let T=0;T<_.length-1;T++){let P=_[T],A=_[T+1];P.x<e&&A.x<e||(P.x<e?P=new ie(e,P.y+(e-P.x)/(A.x-P.x)*(A.y-P.y))._round():A.x<e&&(A=new ie(e,P.y+(e-P.x)/(A.x-P.x)*(A.y-P.y))._round()),P.y<n&&A.y<n||(P.y<n?P=new ie(P.x+(n-P.y)/(A.y-P.y)*(A.x-P.x),n)._round():A.y<n&&(A=new ie(P.x+(n-P.y)/(A.y-P.y)*(A.x-P.x),n)._round()),P.x>=o&&A.x>=o||(P.x>=o?P=new ie(o,P.y+(o-P.x)/(A.x-P.x)*(A.y-P.y))._round():A.x>=o&&(A=new ie(o,P.y+(o-P.x)/(A.x-P.x)*(A.y-P.y))._round()),P.y>=c&&A.y>=c||(P.y>=c?P=new ie(P.x+(c-P.y)/(A.y-P.y)*(A.x-P.x),c)._round():A.y>=c&&(A=new ie(P.x+(c-P.y)/(A.y-P.y)*(A.x-P.x),c)._round()),b&&P.equals(b[b.length-1])||(b=[P],f.push(b)),b.push(A)))))}}return f}bt("FeatureIndex",k_,{omit:["rawTileData","sourceLayerCoder"]});class Al extends ie{constructor(e,n,o,c){super(e,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new Al(this.x,this.y,this.angle,this.segment)}}function E_(r,e,n,o,c){if(e.segment===void 0||n===0)return!0;let f=e,g=e.segment+1,_=0;for(;_>-n/2;){if(g--,g<0)return!1;_-=r[g].dist(f),f=r[g]}_+=r[g].dist(r[g+1]),g++;const b=[];let T=0;for(;_<n/2;){const P=r[g],A=r[g+1];if(!A)return!1;let L=r[g-1].angleTo(P)-P.angleTo(A);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:_,angleDelta:L}),T+=L;_-b[0].distance>o;)T-=b.shift().angleDelta;if(T>c)return!1;g++,_+=P.dist(A)}return!0}function P_(r){let e=0;for(let n=0;n<r.length-1;n++)e+=r[n].dist(r[n+1]);return e}function A_(r,e,n){return r?.6*e*n:0}function M_(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function tw(r,e,n,o,c,f){const g=A_(n,c,f),_=M_(n,o)*f;let b=0;const T=P_(r)/2;for(let P=0;P<r.length-1;P++){const A=r[P],L=r[P+1],F=A.dist(L);if(b+F>T){const $=(T-b)/F,q=qi.number(A.x,L.x,$),W=qi.number(A.y,L.y,$),se=new Al(q,W,L.angleTo(A),P);return se._round(),!g||E_(r,se,_,g,e)?se:void 0}b+=F}}function rw(r,e,n,o,c,f,g,_,b){const T=A_(o,f,g),P=M_(o,c),A=P*g,L=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return e-A<e/4&&(e=A+e/4),z_(r,L?e/2*_%e:(P/2+2*f)*g*_%e,e,T,n,A,L,!1,b)}function z_(r,e,n,o,c,f,g,_,b){const T=f/2,P=P_(r);let A=0,L=e-n,F=[];for(let $=0;$<r.length-1;$++){const q=r[$],W=r[$+1],se=q.dist(W),Se=W.angleTo(q);for(;L+n<A+se;){L+=n;const ue=(L-A)/se,xe=qi.number(q.x,W.x,ue),Be=qi.number(q.y,W.y,ue);if(xe>=0&&xe<b&&Be>=0&&Be<b&&L-T>=0&&L+T<=P){const $e=new Al(xe,Be,Se,$);$e._round(),o&&!E_(r,$e,f,o,c)||F.push($e)}}A+=se}return _||F.length||g||(F=z_(r,A/2,n,o,c,f,g,!0,b)),F}bt("Anchor",Al);const $u=jn;function D_(r,e,n,o){const c=[],f=r.image,g=f.pixelRatio,_=f.paddedRect.w-2*$u,b=f.paddedRect.h-2*$u;let T={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const P=f.stretchX||[[0,_]],A=f.stretchY||[[0,b]],L=(Ve,Ct)=>Ve+Ct[1]-Ct[0],F=P.reduce(L,0),$=A.reduce(L,0),q=_-F,W=b-$;let se=0,Se=F,ue=0,xe=$,Be=0,$e=q,vt=0,Tt=W;if(f.content&&o){const Ve=f.content,Ct=Ve[2]-Ve[0],kt=Ve[3]-Ve[1];(f.textFitWidth||f.textFitHeight)&&(T=a_(r)),se=rp(P,0,Ve[0]),ue=rp(A,0,Ve[1]),Se=rp(P,Ve[0],Ve[2]),xe=rp(A,Ve[1],Ve[3]),Be=Ve[0]-se,vt=Ve[1]-ue,$e=Ct-Se,Tt=kt-xe}const gt=T.x1,ut=T.y1,St=T.x2-gt,Dt=T.y2-ut,yt=(Ve,Ct,kt,Qt)=>{const Ur=ip(Ve.stretch-se,Se,St,gt),qr=np(Ve.fixed-Be,$e,Ve.stretch,F),Ai=ip(Ct.stretch-ue,xe,Dt,ut),_s=np(Ct.fixed-vt,Tt,Ct.stretch,$),Sn=ip(kt.stretch-se,Se,St,gt),Oi=np(kt.fixed-Be,$e,kt.stretch,F),rn=ip(Qt.stretch-ue,xe,Dt,ut),kn=np(Qt.fixed-vt,Tt,Qt.stretch,$),zn=new ie(Ur,Ai),Cn=new ie(Sn,Ai),Mi=new ie(Sn,rn),Xi=new ie(Ur,rn),Dn=new ie(qr/g,_s/g),Vn=new ie(Oi/g,kn/g),dn=e*Math.PI/180;if(dn){const yi=Math.sin(dn),hr=Math.cos(dn),zi=[hr,-yi,yi,hr];zn._matMult(zi),Cn._matMult(zi),Xi._matMult(zi),Mi._matMult(zi)}const Un=Ve.stretch+Ve.fixed,vs=Ct.stretch+Ct.fixed;return{tl:zn,tr:Cn,bl:Xi,br:Mi,tex:{x:f.paddedRect.x+$u+Un,y:f.paddedRect.y+$u+vs,w:kt.stretch+kt.fixed-Un,h:Qt.stretch+Qt.fixed-vs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Dn,pixelOffsetBR:Vn,minFontScaleX:$e/g/St,minFontScaleY:Tt/g/Dt,isSDF:n}};if(o&&(f.stretchX||f.stretchY)){const Ve=L_(P,q,F),Ct=L_(A,W,$);for(let kt=0;kt<Ve.length-1;kt++){const Qt=Ve[kt],Ur=Ve[kt+1];for(let qr=0;qr<Ct.length-1;qr++)c.push(yt(Qt,Ct[qr],Ur,Ct[qr+1]))}}else c.push(yt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:b+1}));return c}function rp(r,e,n){let o=0;for(const c of r)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function L_(r,e,n){const o=[{fixed:-$u,stretch:0}];for(const[c,f]of r){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(f-c)})}return o.push({fixed:e+$u,stretch:n}),o}function ip(r,e,n,o){return r/e*n+o}function np(r,e,n,o){return r-e*n/o}class sp{constructor(e,n,o,c,f,g,_,b,T,P){var A;if(this.boxStartIndex=e.length,T){let L=g.top,F=g.bottom;const $=g.collisionPadding;$&&(L-=$[1],F+=$[3]);let q=F-L;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const L=!((A=g.image)===null||A===void 0)&&A.content&&(g.image.textFitWidth||g.image.textFitHeight)?a_(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};L.y1=L.y1*_-b[0],L.y2=L.y2*_+b[2],L.x1=L.x1*_-b[3],L.x2=L.x2*_+b[1];const F=g.collisionPadding;if(F&&(L.x1-=F[0]*_,L.y1-=F[1]*_,L.x2+=F[2]*_,L.y2+=F[3]*_),P){const $=new ie(L.x1,L.y1),q=new ie(L.x2,L.y1),W=new ie(L.x1,L.y2),se=new ie(L.x2,L.y2),Se=P*Math.PI/180;$._rotate(Se),q._rotate(Se),W._rotate(Se),se._rotate(Se),L.x1=Math.min($.x,q.x,W.x,se.x),L.x2=Math.max($.x,q.x,W.x,se.x),L.y1=Math.min($.y,q.y,W.y,se.y),L.y2=Math.max($.y,q.y,W.y,se.y)}e.emplaceBack(n.x,n.y,L.x1,L.y1,L.x2,L.y2,o,c,f)}this.boxEndIndex=e.length}}class iw{constructor(e=[],n=nw){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,c=n[e];for(;e>0;){const f=e-1>>1,g=n[f];if(o(c,g)>=0)break;n[e]=g,e=f}n[e]=c}_down(e){const{data:n,compare:o}=this,c=this.length>>1,f=n[e];for(;e<c;){let g=1+(e<<1),_=n[g];const b=g+1;if(b<this.length&&o(n[b],_)<0&&(g=b,_=n[b]),o(_,f)>=0)break;n[e]=_,e=g}n[e]=f}}function nw(r,e){return r<e?-1:r>e?1:0}function sw(r,e=1,n=!1){let o=1/0,c=1/0,f=-1/0,g=-1/0;const _=r[0];for(let F=0;F<_.length;F++){const $=_[F];(!F||$.x<o)&&(o=$.x),(!F||$.y<c)&&(c=$.y),(!F||$.x>f)&&(f=$.x),(!F||$.y>g)&&(g=$.y)}const b=Math.min(f-o,g-c);let T=b/2;const P=new iw([],aw);if(b===0)return new ie(o,c);for(let F=o;F<f;F+=b)for(let $=c;$<g;$+=b)P.push(new ju(F+T,$+T,T,r));let A=function(F){let $=0,q=0,W=0;const se=F[0];for(let Se=0,ue=se.length,xe=ue-1;Se<ue;xe=Se++){const Be=se[Se],$e=se[xe],vt=Be.x*$e.y-$e.x*Be.y;q+=(Be.x+$e.x)*vt,W+=(Be.y+$e.y)*vt,$+=3*vt}return new ju(q/$,W/$,0,F)}(r),L=P.length;for(;P.length;){const F=P.pop();(F.d>A.d||!A.d)&&(A=F,n&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,L)),F.max-A.d<=e||(T=F.h/2,P.push(new ju(F.p.x-T,F.p.y-T,T,r)),P.push(new ju(F.p.x+T,F.p.y-T,T,r)),P.push(new ju(F.p.x-T,F.p.y+T,T,r)),P.push(new ju(F.p.x+T,F.p.y+T,T,r)),L+=4)}return n&&(console.log(`num probes: ${L}`),console.log(`best distance: ${A.d}`)),A.p}function aw(r,e){return e.max-r.max}function ju(r,e,n,o){this.p=new ie(r,e),this.h=n,this.d=function(c,f){let g=!1,_=1/0;for(let b=0;b<f.length;b++){const T=f[b];for(let P=0,A=T.length,L=A-1;P<A;L=P++){const F=T[P],$=T[L];F.y>c.y!=$.y>c.y&&c.x<($.x-F.x)*(c.y-F.y)/($.y-F.y)+F.x&&(g=!g),_=Math.min(_,wn(c,F,$))}}return(g?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var hn;S.aq=void 0,(hn=S.aq||(S.aq={}))[hn.center=1]="center",hn[hn.left=2]="left",hn[hn.right=3]="right",hn[hn.top=4]="top",hn[hn.bottom=5]="bottom",hn[hn["top-left"]=6]="top-left",hn[hn["top-right"]=7]="top-right",hn[hn["bottom-left"]=8]="bottom-left",hn[hn["bottom-right"]=9]="bottom-right";const Ml=7,Qf=Number.POSITIVE_INFINITY;function R_(r,e){return e[1]!==Qf?function(n,o,c){let f=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-Ml;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+Ml}switch(n){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,g]}(r,e[0],e[1]):function(n,o){let c=0,f=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":f=g-Ml;break;case"bottom-right":case"bottom-left":f=-g+Ml;break;case"bottom":f=-o+Ml;break;case"top":f=o-Ml}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,f]}(r,e[0])}function F_(r,e,n){var o;const c=r.layout,f=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},n);if(f){const _=f.values,b=[];for(let T=0;T<_.length;T+=2){const P=b[T]=_[T],A=_[T+1].map(L=>L*Ni);P.startsWith("top")?A[1]-=Ml:P.startsWith("bottom")&&(A[1]+=Ml),b[T+1]=A}return new Ui(b)}const g=c.get("text-variable-anchor");if(g){let _;_=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(e,{},n)*Ni,Qf]:c.get("text-offset").evaluate(e,{},n).map(T=>T*Ni);const b=[];for(const T of g)b.push(T,R_(T,_));return new Ui(b)}return null}function em(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ow(r,e,n,o,c,f,g,_,b,T,P){let A=f.textMaxSize.evaluate(e,{});A===void 0&&(A=g);const L=r.layers[0].layout,F=L.get("icon-offset").evaluate(e,{},P),$=N_(n.horizontal),q=g/24,W=r.tilePixelRatio*q,se=r.tilePixelRatio*A/24,Se=r.tilePixelRatio*_,ue=r.tilePixelRatio*L.get("symbol-spacing"),xe=L.get("text-padding")*r.tilePixelRatio,Be=function(Ve,Ct,kt,Qt=1){const Ur=Ve.get("icon-padding").evaluate(Ct,{},kt),qr=Ur&&Ur.values;return[qr[0]*Qt,qr[1]*Qt,qr[2]*Qt,qr[3]*Qt]}(L,e,P,r.tilePixelRatio),$e=L.get("text-max-angle")/180*Math.PI,vt=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",Tt=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",gt=L.get("symbol-placement"),ut=ue/2,St=L.get("icon-text-fit");let Dt;o&&St!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(Dt=o_(o,n.vertical,St,L.get("icon-text-fit-padding"),F,q)),$&&(o=o_(o,$,St,L.get("icon-text-fit-padding"),F,q)));const yt=(Ve,Ct)=>{Ct.x<0||Ct.x>=we||Ct.y<0||Ct.y>=we||function(kt,Qt,Ur,qr,Ai,_s,Sn,Oi,rn,kn,zn,Cn,Mi,Xi,Dn,Vn,dn,Un,vs,yi,hr,zi,pn,$i,$s){const ua=kt.addToLineVertexArray(Qt,Ur);let ha,Io,js,xs,qn=0,Eo=0,Yh=0,V_=0,lm=-1,cm=-1;const Po={};let U_=wl("");if(kt.allowVerticalPlacement&&qr.vertical){const Tn=Oi.layout.get("text-rotate").evaluate(hr,{},$i)+90;js=new sp(rn,Qt,kn,zn,Cn,qr.vertical,Mi,Xi,Dn,Tn),Sn&&(xs=new sp(rn,Qt,kn,zn,Cn,Sn,dn,Un,Dn,Tn))}if(Ai){const Tn=Oi.layout.get("icon-rotate").evaluate(hr,{}),bs=Oi.layout.get("icon-text-fit")!=="none",$c=D_(Ai,Tn,pn,bs),pa=Sn?D_(Sn,Tn,pn,bs):void 0;Io=new sp(rn,Qt,kn,zn,Cn,Ai,dn,Un,!1,Tn),qn=4*$c.length;const jc=kt.iconSizeData;let Wa=null;jc.kind==="source"?(Wa=[Ha*Oi.layout.get("icon-size").evaluate(hr,{})],Wa[0]>El&&tt(`${kt.layerIds[0]}: Value for "icon-size" is >= ${Hh}. Reduce your "icon-size".`)):jc.kind==="composite"&&(Wa=[Ha*zi.compositeIconSizes[0].evaluate(hr,{},$i),Ha*zi.compositeIconSizes[1].evaluate(hr,{},$i)],(Wa[0]>El||Wa[1]>El)&&tt(`${kt.layerIds[0]}: Value for "icon-size" is >= ${Hh}. Reduce your "icon-size".`)),kt.addSymbols(kt.icon,$c,Wa,yi,vs,hr,S.ah.none,Qt,ua.lineStartIndex,ua.lineLength,-1,$i),lm=kt.icon.placedSymbolArray.length-1,pa&&(Eo=4*pa.length,kt.addSymbols(kt.icon,pa,Wa,yi,vs,hr,S.ah.vertical,Qt,ua.lineStartIndex,ua.lineLength,-1,$i),cm=kt.icon.placedSymbolArray.length-1)}const q_=Object.keys(qr.horizontal);for(const Tn of q_){const bs=qr.horizontal[Tn];if(!ha){U_=wl(bs.text);const pa=Oi.layout.get("text-rotate").evaluate(hr,{},$i);ha=new sp(rn,Qt,kn,zn,Cn,bs,Mi,Xi,Dn,pa)}const $c=bs.positionedLines.length===1;if(Yh+=B_(kt,Qt,bs,_s,Oi,Dn,hr,Vn,ua,qr.vertical?S.ah.horizontal:S.ah.horizontalOnly,$c?q_:[Tn],Po,lm,zi,$i),$c)break}qr.vertical&&(V_+=B_(kt,Qt,qr.vertical,_s,Oi,Dn,hr,Vn,ua,S.ah.vertical,["vertical"],Po,cm,zi,$i));const uw=ha?ha.boxStartIndex:kt.collisionBoxArray.length,hw=ha?ha.boxEndIndex:kt.collisionBoxArray.length,dw=js?js.boxStartIndex:kt.collisionBoxArray.length,pw=js?js.boxEndIndex:kt.collisionBoxArray.length,fw=Io?Io.boxStartIndex:kt.collisionBoxArray.length,mw=Io?Io.boxEndIndex:kt.collisionBoxArray.length,gw=xs?xs.boxStartIndex:kt.collisionBoxArray.length,yw=xs?xs.boxEndIndex:kt.collisionBoxArray.length;let da=-1;const op=(Tn,bs)=>Tn&&Tn.circleDiameter?Math.max(Tn.circleDiameter,bs):bs;da=op(ha,da),da=op(js,da),da=op(Io,da),da=op(xs,da);const G_=da>-1?1:0;G_&&(da*=$s/Ni),kt.glyphOffsetArray.length>=Ou.MAX_GLYPHS&&tt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hr.sortKey!==void 0&&kt.addToSortKeyRanges(kt.symbolInstances.length,hr.sortKey);const _w=F_(Oi,hr,$i),[vw,xw]=function(Tn,bs){const $c=Tn.length,pa=bs==null?void 0:bs.values;if((pa==null?void 0:pa.length)>0)for(let jc=0;jc<pa.length;jc+=2){const Wa=pa[jc+1];Tn.emplaceBack(S.aq[pa[jc]],Wa[0],Wa[1])}return[$c,Tn.length]}(kt.textAnchorOffsets,_w);kt.symbolInstances.emplaceBack(Qt.x,Qt.y,Po.right>=0?Po.right:-1,Po.center>=0?Po.center:-1,Po.left>=0?Po.left:-1,Po.vertical||-1,lm,cm,U_,uw,hw,dw,pw,fw,mw,gw,yw,kn,Yh,V_,qn,Eo,G_,0,Mi,da,vw,xw)}(r,Ct,Ve,n,o,c,Dt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,W,[xe,xe,xe,xe],vt,b,Se,Be,Tt,F,e,f,T,P,g)};if(gt==="line")for(const Ve of I_(e.geometry,0,0,we,we)){const Ct=rw(Ve,ue,$e,n.vertical||$,o,24,se,r.overscaling,we);for(const kt of Ct)$&&lw(r,$.text,ut,kt)||yt(Ve,kt)}else if(gt==="line-center"){for(const Ve of e.geometry)if(Ve.length>1){const Ct=tw(Ve,$e,n.vertical||$,o,24,se);Ct&&yt(Ve,Ct)}}else if(e.type==="Polygon")for(const Ve of Wo(e.geometry,0)){const Ct=sw(Ve,16);yt(Ve[0],new Al(Ct.x,Ct.y,0))}else if(e.type==="LineString")for(const Ve of e.geometry)yt(Ve,new Al(Ve[0].x,Ve[0].y,0));else if(e.type==="Point")for(const Ve of e.geometry)for(const Ct of Ve)yt([Ct],new Al(Ct.x,Ct.y,0))}function B_(r,e,n,o,c,f,g,_,b,T,P,A,L,F,$){const q=function(Se,ue,xe,Be,$e,vt,Tt,gt){const ut=Be.layout.get("text-rotate").evaluate(vt,{})*Math.PI/180,St=[];for(const Dt of ue.positionedLines)for(const yt of Dt.positionedGlyphs){if(!yt.rect)continue;const Ve=yt.rect||{};let Ct=Qy+1,kt=!0,Qt=1,Ur=0;const qr=($e||gt)&&yt.vertical,Ai=yt.metrics.advance*yt.scale/2;if(gt&&ue.verticalizable&&(Ur=Dt.lineOffset/2-(yt.imageName?-(Ni-yt.metrics.width*yt.scale)/2:(yt.scale-1)*Ni)),yt.imageName){const yi=Tt[yt.imageName];kt=yi.sdf,Qt=yi.pixelRatio,Ct=jn/Qt}const _s=$e?[yt.x+Ai,yt.y]:[0,0];let Sn=$e?[0,0]:[yt.x+Ai+xe[0],yt.y+xe[1]-Ur],Oi=[0,0];qr&&(Oi=Sn,Sn=[0,0]);const rn=yt.metrics.isDoubleResolution?2:1,kn=(yt.metrics.left-Ct)*yt.scale-Ai+Sn[0],zn=(-yt.metrics.top-Ct)*yt.scale+Sn[1],Cn=kn+Ve.w/rn*yt.scale/Qt,Mi=zn+Ve.h/rn*yt.scale/Qt,Xi=new ie(kn,zn),Dn=new ie(Cn,zn),Vn=new ie(kn,Mi),dn=new ie(Cn,Mi);if(qr){const yi=new ie(-Ai,Ai-Gh),hr=-Math.PI/2,zi=Ni/2-Ai,pn=new ie(5-Gh-zi,-(yt.imageName?zi:0)),$i=new ie(...Oi);Xi._rotateAround(hr,yi)._add(pn)._add($i),Dn._rotateAround(hr,yi)._add(pn)._add($i),Vn._rotateAround(hr,yi)._add(pn)._add($i),dn._rotateAround(hr,yi)._add(pn)._add($i)}if(ut){const yi=Math.sin(ut),hr=Math.cos(ut),zi=[hr,-yi,yi,hr];Xi._matMult(zi),Dn._matMult(zi),Vn._matMult(zi),dn._matMult(zi)}const Un=new ie(0,0),vs=new ie(0,0);St.push({tl:Xi,tr:Dn,bl:Vn,br:dn,tex:Ve,writingMode:ue.writingMode,glyphOffset:_s,sectionIndex:yt.sectionIndex,isSDF:kt,pixelOffsetTL:Un,pixelOffsetBR:vs,minFontScaleX:0,minFontScaleY:0})}return St}(0,n,_,c,f,g,o,r.allowVerticalPlacement),W=r.textSizeData;let se=null;W.kind==="source"?(se=[Ha*c.layout.get("text-size").evaluate(g,{})],se[0]>El&&tt(`${r.layerIds[0]}: Value for "text-size" is >= ${Hh}. Reduce your "text-size".`)):W.kind==="composite"&&(se=[Ha*F.compositeTextSizes[0].evaluate(g,{},$),Ha*F.compositeTextSizes[1].evaluate(g,{},$)],(se[0]>El||se[1]>El)&&tt(`${r.layerIds[0]}: Value for "text-size" is >= ${Hh}. Reduce your "text-size".`)),r.addSymbols(r.text,q,se,_,f,g,T,e,b.lineStartIndex,b.lineLength,L,$);for(const Se of P)A[Se]=r.text.placedSymbolArray.length-1;return 4*q.length}function N_(r){for(const e in r)return r[e];return null}function lw(r,e,n,o){const c=r.compareText;if(e in c){const f=c[e];for(let g=f.length-1;g>=0;g--)if(o.dist(f[g])<n)return!0}else c[e]=[];return c[e].push(o),!1}const O_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class tm{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const f=O_[15&o];if(!f)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new tm(_,g,f,e)}constructor(e,n=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=O_.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-_%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+_+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=n,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return rm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:_}=this,b=[0,f.length-1,0],T=[];for(;b.length;){const P=b.pop()||0,A=b.pop()||0,L=b.pop()||0;if(A-L<=_){for(let W=L;W<=A;W++){const se=g[2*W],Se=g[2*W+1];se>=e&&se<=o&&Se>=n&&Se<=c&&T.push(f[W])}continue}const F=L+A>>1,$=g[2*F],q=g[2*F+1];$>=e&&$<=o&&q>=n&&q<=c&&T.push(f[F]),(P===0?e<=$:n<=q)&&(b.push(L),b.push(F-1),b.push(1-P)),(P===0?o>=$:c>=q)&&(b.push(F+1),b.push(A),b.push(1-P))}return T}within(e,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:g}=this,_=[0,c.length-1,0],b=[],T=o*o;for(;_.length;){const P=_.pop()||0,A=_.pop()||0,L=_.pop()||0;if(A-L<=g){for(let W=L;W<=A;W++)j_(f[2*W],f[2*W+1],e,n)<=T&&b.push(c[W]);continue}const F=L+A>>1,$=f[2*F],q=f[2*F+1];j_($,q,e,n)<=T&&b.push(c[F]),(P===0?e-o<=$:n-o<=q)&&(_.push(L),_.push(F-1),_.push(1-P)),(P===0?e+o>=$:n+o>=q)&&(_.push(F+1),_.push(A),_.push(1-P))}return b}}function rm(r,e,n,o,c,f){if(c-o<=n)return;const g=o+c>>1;$_(r,e,g,o,c,f),rm(r,e,n,o,g-1,1-f),rm(r,e,n,g+1,c,1-f)}function $_(r,e,n,o,c,f){for(;c>o;){if(c-o>600){const T=c-o+1,P=n-o+1,A=Math.log(T),L=.5*Math.exp(2*A/3),F=.5*Math.sqrt(A*L*(T-L)/T)*(P-T/2<0?-1:1);$_(r,e,n,Math.max(o,Math.floor(n-P*L/T+F)),Math.min(c,Math.floor(n+(T-P)*L/T+F)),f)}const g=e[2*n+f];let _=o,b=c;for(Kh(r,e,o,n),e[2*c+f]>g&&Kh(r,e,o,c);_<b;){for(Kh(r,e,_,b),_++,b--;e[2*_+f]<g;)_++;for(;e[2*b+f]>g;)b--}e[2*o+f]===g?Kh(r,e,o,b):(b++,Kh(r,e,b,c)),b<=n&&(o=b+1),n<=b&&(c=b-1)}}function Kh(r,e,n,o){im(r,n,o),im(e,2*n,2*o),im(e,2*n+1,2*o+1)}function im(r,e,n){const o=r[e];r[e]=r[n],r[n]=o}function j_(r,e,n,o){const c=r-n,f=e-o;return c*c+f*f}var nm;S.be=void 0,(nm=S.be||(S.be={})).create="create",nm.load="load",nm.fullLoad="fullLoad";let ap=null,Xh=[];const sm=1e3/60,am="loadTime",om="fullLoadTime",cw={mark(r){performance.mark(r)},frame(r){const e=r;ap!=null&&Xh.push(e-ap),ap=e},clearMetrics(){ap=null,Xh=[],performance.clearMeasures(am),performance.clearMeasures(om);for(const r in S.be)performance.clearMarks(S.be[r])},getPerformanceMetrics(){performance.measure(am,S.be.create,S.be.load),performance.measure(om,S.be.create,S.be.fullLoad);const r=performance.getEntriesByName(am)[0].duration,e=performance.getEntriesByName(om)[0].duration,n=Xh.length,o=1/(Xh.reduce((f,g)=>f+g,0)/n/1e3),c=Xh.filter(f=>f>sm).reduce((f,g)=>f+(g-sm)/sm,0);return{loadTime:r,fullLoadTime:e,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};S.$=wi,S.A=zr,S.B=function(r){if(Jt==null){const e=r.navigator?r.navigator.userAgent:null;Jt=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Jt},S.C=class{constructor(r,e){this.target=r,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Qb(()=>this.process()),this.subscription=function(n,o,c,f){return n.addEventListener(o,c,!1),{unsubscribe:()=>{n.removeEventListener(o,c,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=dr(self)?r:window}registerMessageHandler(r,e){this.messageHandlers[r]=e}sendAsync(r,e){return new Promise((n,o)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:n,reject:o},e&&e.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const _={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const f=[],g=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:bo(r.data,f)});this.target.postMessage(g,{transfer:f})})}receive(r){const e=r.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(dr(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){return d(this,void 0,void 0,function*(){if(e.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(e.error?c.reject(Jn(e.error)):c.resolve(Jn(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=Jn(e.data),o=new AbortController;this.abortControllers[r]=o;try{const c=yield this.messageHandlers[e.type](e.sourceMapId,n,o);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}})}completeTask(r,e,n){const o=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?bo(e):null,data:bo(n,o)};this.target.postMessage(c,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.D=Pt,S.E=Rr,S.F=function(){var r=new zr(16);return zr!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},S.G=tr,S.H=function(r,e,n){var o,c,f,g,_,b,T,P,A,L,F,$,q=n[0],W=n[1],se=n[2];return e===r?(r[12]=e[0]*q+e[4]*W+e[8]*se+e[12],r[13]=e[1]*q+e[5]*W+e[9]*se+e[13],r[14]=e[2]*q+e[6]*W+e[10]*se+e[14],r[15]=e[3]*q+e[7]*W+e[11]*se+e[15]):(c=e[1],f=e[2],g=e[3],_=e[4],b=e[5],T=e[6],P=e[7],A=e[8],L=e[9],F=e[10],$=e[11],r[0]=o=e[0],r[1]=c,r[2]=f,r[3]=g,r[4]=_,r[5]=b,r[6]=T,r[7]=P,r[8]=A,r[9]=L,r[10]=F,r[11]=$,r[12]=o*q+_*W+A*se+e[12],r[13]=c*q+b*W+L*se+e[13],r[14]=f*q+T*W+F*se+e[14],r[15]=g*q+P*W+$*se+e[15]),r},S.I=Vf,S.J=function(r,e,n){var o=n[0],c=n[1],f=n[2];return r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r[3]=e[3]*o,r[4]=e[4]*c,r[5]=e[5]*c,r[6]=e[6]*c,r[7]=e[7]*c,r[8]=e[8]*f,r[9]=e[9]*f,r[10]=e[10]*f,r[11]=e[11]*f,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},S.K=oa,S.L=function(r,e){const n={};for(let o=0;o<e.length;o++){const c=e[o];c in r&&(n[c]=r[c])}return n},S.M=Pl,S.N=g_,S.O=y_,S.P=ie,S.Q=ys,S.R=gs,S.S=pe,S.T=Ua,S.U=oe,S.V=Xe,S.W=we,S.X=E,S.Y=tp,S.Z=class extends U{},S._=d,S.a=mr,S.a$=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},S.a0=Jf,S.a1=Ze,S.a2=r=>{const e=window.document.createElement("video");return e.muted=!0,new Promise(n=>{e.onloadstart=()=>{n(e)};for(const o of r){const c=window.document.createElement("source");gr(o)||(e.crossOrigin="Anonymous"),c.src=o,e.appendChild(c)}})},S.a3=function(){return re++},S.a4=Yt,S.a5=Ou,S.a6=vo,S.a7=xt,S.a8=jr,S.a9=S_,S.aA=function(r){if(r.type==="custom")return new Jb(r);switch(r.type){case"background":return new Kb(r);case"circle":return new ca(r);case"fill":return new eb(r);case"fill-extrusion":return new mb(r);case"heatmap":return new Ox(r);case"hillshade":return new jx(r);case"line":return new Sb(r);case"raster":return new Yb(r);case"symbol":return new ep(r)}},S.aB=Me,S.aC=function(r,e){if(!r)return[{command:"setStyle",args:[e]}];let n=[];try{if(!ct(r.version,e.version))return[{command:"setStyle",args:[e]}];ct(r.center,e.center)||n.push({command:"setCenter",args:[e.center]}),ct(r.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),ct(r.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),ct(r.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),ct(r.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),ct(r.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),ct(r.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),ct(r.light,e.light)||n.push({command:"setLight",args:[e.light]}),ct(r.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),ct(r.sky,e.sky)||n.push({command:"setSky",args:[e.sky]});const o={},c=[];(function(g,_,b,T){let P;for(P in _=_||{},g=g||{})Object.prototype.hasOwnProperty.call(g,P)&&(Object.prototype.hasOwnProperty.call(_,P)||rr(P,b,T));for(P in _)Object.prototype.hasOwnProperty.call(_,P)&&(Object.prototype.hasOwnProperty.call(g,P)?ct(g[P],_[P])||(g[P].type==="geojson"&&_[P].type==="geojson"&&Kr(g,_,P)?Et(b,{command:"setGeoJSONSourceData",args:[P,_[P].data]}):lr(P,_,b,T)):Zt(P,_,b))})(r.sources,e.sources,c,o);const f=[];r.layers&&r.layers.forEach(g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):f.push(g)}),n=n.concat(c),function(g,_,b){_=_||[];const T=(g=g||[]).map(li),P=_.map(li),A=g.reduce(ci,{}),L=_.reduce(ci,{}),F=T.slice(),$=Object.create(null);let q,W,se,Se,ue;for(let xe=0,Be=0;xe<T.length;xe++)q=T[xe],Object.prototype.hasOwnProperty.call(L,q)?Be++:(Et(b,{command:"removeLayer",args:[q]}),F.splice(F.indexOf(q,Be),1));for(let xe=0,Be=0;xe<P.length;xe++)q=P[P.length-1-xe],F[F.length-1-xe]!==q&&(Object.prototype.hasOwnProperty.call(A,q)?(Et(b,{command:"removeLayer",args:[q]}),F.splice(F.lastIndexOf(q,F.length-Be),1)):Be++,Se=F[F.length-xe],Et(b,{command:"addLayer",args:[L[q],Se]}),F.splice(F.length-xe,0,q),$[q]=!0);for(let xe=0;xe<P.length;xe++)if(q=P[xe],W=A[q],se=L[q],!$[q]&&!ct(W,se))if(ct(W.source,se.source)&&ct(W["source-layer"],se["source-layer"])&&ct(W.type,se.type)){for(ue in Wt(W.layout,se.layout,b,q,null,"setLayoutProperty"),Wt(W.paint,se.paint,b,q,null,"setPaintProperty"),ct(W.filter,se.filter)||Et(b,{command:"setFilter",args:[q,se.filter]}),ct(W.minzoom,se.minzoom)&&ct(W.maxzoom,se.maxzoom)||Et(b,{command:"setLayerZoomRange",args:[q,se.minzoom,se.maxzoom]}),W)Object.prototype.hasOwnProperty.call(W,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Wt(W[ue],se[ue],b,q,ue.slice(6),"setPaintProperty"):ct(W[ue],se[ue])||Et(b,{command:"setLayerProperty",args:[q,ue,se[ue]]}));for(ue in se)Object.prototype.hasOwnProperty.call(se,ue)&&!Object.prototype.hasOwnProperty.call(W,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?Wt(W[ue],se[ue],b,q,ue.slice(6),"setPaintProperty"):ct(W[ue],se[ue])||Et(b,{command:"setLayerProperty",args:[q,ue,se[ue]]}))}else Et(b,{command:"removeLayer",args:[q]}),Se=F[F.lastIndexOf(q)+1],Et(b,{command:"addLayer",args:[se,Se]})}(f,e.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[e]}]}return n},S.aD=function(r){const e=[],n=r.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},S.aE=function r(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let o=0;o<e.length;o++)if(!r(e[o],n[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const o in e)if(!r(e[o],n[o]))return!1;return!0}return e===n},S.aF=ne,S.aG=fe,S.aH=class extends ko{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},S.aI=Co,S.aJ=class extends ko{constructor(r,e){super(r,e),this.current=qd}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},S.aK=Du,S.aL=class extends ko{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},S.aM=class extends ko{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},S.aN=Rh,S.aO=function(r,e,n,o,c,f,g){var _=1/(e-n),b=1/(o-c),T=1/(f-g);return r[0]=-2*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*T,r[11]=0,r[12]=(e+n)*_,r[13]=(c+o)*b,r[14]=(g+f)*T,r[15]=1,r},S.aP=Br,S.aQ=kl,S.aR=class extends Re{},S.aS=Ib,S.aT=class extends lt{},S.aU=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},S.aV=Ty,S.aW=na,S.aX=class extends mt{},S.aY=bi,S.aZ=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]},S.a_=function(r,e){var n=r[0],o=r[1],c=r[2],f=r[3],g=r[4],_=r[5],b=r[6],T=r[7],P=r[8],A=r[9],L=r[10],F=r[11],$=r[12],q=r[13],W=r[14],se=r[15],Se=e[0],ue=e[1],xe=e[2],Be=e[3],$e=e[4],vt=e[5],Tt=e[6],gt=e[7],ut=e[8],St=e[9],Dt=e[10],yt=e[11],Ve=e[12],Ct=e[13],kt=e[14],Qt=e[15];return Math.abs(n-Se)<=sr*Math.max(1,Math.abs(n),Math.abs(Se))&&Math.abs(o-ue)<=sr*Math.max(1,Math.abs(o),Math.abs(ue))&&Math.abs(c-xe)<=sr*Math.max(1,Math.abs(c),Math.abs(xe))&&Math.abs(f-Be)<=sr*Math.max(1,Math.abs(f),Math.abs(Be))&&Math.abs(g-$e)<=sr*Math.max(1,Math.abs(g),Math.abs($e))&&Math.abs(_-vt)<=sr*Math.max(1,Math.abs(_),Math.abs(vt))&&Math.abs(b-Tt)<=sr*Math.max(1,Math.abs(b),Math.abs(Tt))&&Math.abs(T-gt)<=sr*Math.max(1,Math.abs(T),Math.abs(gt))&&Math.abs(P-ut)<=sr*Math.max(1,Math.abs(P),Math.abs(ut))&&Math.abs(A-St)<=sr*Math.max(1,Math.abs(A),Math.abs(St))&&Math.abs(L-Dt)<=sr*Math.max(1,Math.abs(L),Math.abs(Dt))&&Math.abs(F-yt)<=sr*Math.max(1,Math.abs(F),Math.abs(yt))&&Math.abs($-Ve)<=sr*Math.max(1,Math.abs($),Math.abs(Ve))&&Math.abs(q-Ct)<=sr*Math.max(1,Math.abs(q),Math.abs(Ct))&&Math.abs(W-kt)<=sr*Math.max(1,Math.abs(W),Math.abs(kt))&&Math.abs(se-Qt)<=sr*Math.max(1,Math.abs(se),Math.abs(Qt))},S.aa=function(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,f)=>{const g=c||f;return e[o]=!g||g.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},S.ab=function(r,e){const n=[];for(const o in r)o in e||n.push(o);return n},S.ac=Ue,S.ad=function(r,e,n){var o=Math.sin(n),c=Math.cos(n),f=e[0],g=e[1],_=e[2],b=e[3],T=e[4],P=e[5],A=e[6],L=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*c+T*o,r[1]=g*c+P*o,r[2]=_*c+A*o,r[3]=b*c+L*o,r[4]=T*c-f*o,r[5]=P*c-g*o,r[6]=A*c-_*o,r[7]=L*c-b*o,r},S.ae=function(r){var e=new zr(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},S.af=la,S.ag=function(r,e){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:g}=r,_=c?Ue(yn.interpolationFactor(c,e,f,g),0,1):0;r.kind==="camera"?o=qi.number(r.minSize,r.maxSize,_):n=_}return{uSizeT:n,uSize:o}},S.ai=function(r,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return r.kind==="source"?o/Ha:r.kind==="composite"?qi.number(o/Ha,c/Ha,n):e},S.aj=Zf,S.ak=function(r,e,n,o){const c=e.y-r.y,f=e.x-r.x,g=o.y-n.y,_=o.x-n.x,b=g*f-_*c;if(b===0)return null;const T=(_*(r.y-n.y)-g*(r.x-n.x))/b;return new ie(r.x+T*f,r.y+T*c)},S.al=I_,S.am=Mt,S.an=$n,S.ao=function(r){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const f of r)e=Math.min(e,f.x),n=Math.min(n,f.y),o=Math.max(o,f.x),c=Math.max(c,f.y);return[e,n,o,c]},S.ap=Ni,S.ar=Gf,S.as=function(r,e){var n=e[0],o=e[1],c=e[2],f=e[3],g=e[4],_=e[5],b=e[6],T=e[7],P=e[8],A=e[9],L=e[10],F=e[11],$=e[12],q=e[13],W=e[14],se=e[15],Se=n*_-o*g,ue=n*b-c*g,xe=n*T-f*g,Be=o*b-c*_,$e=o*T-f*_,vt=c*T-f*b,Tt=P*q-A*$,gt=P*W-L*$,ut=P*se-F*$,St=A*W-L*q,Dt=A*se-F*q,yt=L*se-F*W,Ve=Se*yt-ue*Dt+xe*St+Be*ut-$e*gt+vt*Tt;return Ve?(r[0]=(_*yt-b*Dt+T*St)*(Ve=1/Ve),r[1]=(c*Dt-o*yt-f*St)*Ve,r[2]=(q*vt-W*$e+se*Be)*Ve,r[3]=(L*$e-A*vt-F*Be)*Ve,r[4]=(b*ut-g*yt-T*gt)*Ve,r[5]=(n*yt-c*ut+f*gt)*Ve,r[6]=(W*xe-$*vt-se*ue)*Ve,r[7]=(P*vt-L*xe+F*ue)*Ve,r[8]=(g*Dt-_*ut+T*Tt)*Ve,r[9]=(o*ut-n*Dt-f*Tt)*Ve,r[10]=($*$e-q*xe+se*Se)*Ve,r[11]=(A*xe-P*$e-F*Se)*Ve,r[12]=(_*gt-g*St-b*Tt)*Ve,r[13]=(n*St-o*gt+c*Tt)*Ve,r[14]=(q*ue-$*Be-W*Se)*Ve,r[15]=(P*Be-A*ue+L*Se)*Ve,r):null},S.at=em,S.au=qf,S.av=tm,S.aw=function(){const r={},e=Ee.$version;for(const n in Ee.$root){const o=Ee.$root[n];if(o.required){let c=null;c=n==="version"?e:o.type==="array"?[]:{},c!=null&&(r[n]=c)}}return r},S.ax=Iu,S.ay=Sr,S.az=function(r){r=r.slice();const e=Object.create(null);for(let n=0;n<r.length;n++)e[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=Ft(r[n],e[r[n].ref]));return r},S.b=pt,S.b0=function(r,e,n){return r[0]=e[0]*n[0],r[1]=e[1]*n[1],r[2]=e[2]*n[2],r[3]=e[3]*n[3],r},S.b1=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},S.b2=ze,S.b3=x_,S.b4=__,S.b5=function(r,e,n,o,c){var f,g=1/Math.tan(e/2);return r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+o)*(f=1/(o-c)),r[14]=2*c*o*f):(r[10]=-1,r[14]=-2*o),r},S.b6=function(r,e,n){var o=Math.sin(n),c=Math.cos(n),f=e[4],g=e[5],_=e[6],b=e[7],T=e[8],P=e[9],A=e[10],L=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=f*c+T*o,r[5]=g*c+P*o,r[6]=_*c+A*o,r[7]=b*c+L*o,r[8]=T*c-f*o,r[9]=P*c-g*o,r[10]=A*c-_*o,r[11]=L*c-b*o,r},S.b7=me,S.b8=De,S.b9=function(r){return r*Math.PI/180},S.bA=rl,S.bB=Bs,S.ba=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},S.bb=class extends N{},S.bc=Xf,S.bd=cw,S.bf=ar,S.bg=function(r,e){mr.REGISTERED_PROTOCOLS[r]=e},S.bh=function(r){delete mr.REGISTERED_PROTOCOLS[r]},S.bi=function(r,e){const n={};for(let c=0;c<r.length;c++){const f=e&&e[r[c].id]||Dh(r[c]);e&&(e[r[c].id]=f);let g=n[f];g||(g=n[f]=[]),g.push(r[c])}const o=[];for(const c in n)o.push(n[c]);return o},S.bj=bt,S.bk=w_,S.bl=k_,S.bm=t_,S.bn=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=we/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0],n=e.layout,o=e._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new jr(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new jr(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new jr(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:P}=r.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new jr(T),r.canonical),o["text-size"].possiblyEvaluate(new jr(P),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:P}=r.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new jr(T),r.canonical),o["icon-size"].possiblyEvaluate(new jr(P),r.canonical)]}const f=n.get("text-line-height")*Ni,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",_=n.get("text-keep-upright"),b=n.get("text-size");for(const T of r.bucket.features){const P=n.get("text-font").evaluate(T,{},r.canonical).join(","),A=b.evaluate(T,{},r.canonical),L=c.layoutTextSize.evaluate(T,{},r.canonical),F=c.layoutIconSize.evaluate(T,{},r.canonical),$={horizontal:{},vertical:void 0},q=T.text;let W,se=[0,0];if(q){const xe=q.toString(),Be=n.get("text-letter-spacing").evaluate(T,{},r.canonical)*Ni,$e=Lh(xe)?Be:0,vt=n.get("text-anchor").evaluate(T,{},r.canonical),Tt=F_(e,T,r.canonical);if(!Tt){const yt=n.get("text-radial-offset").evaluate(T,{},r.canonical);se=yt?R_(vt,[yt*Ni,Qf]):n.get("text-offset").evaluate(T,{},r.canonical).map(Ve=>Ve*Ni)}let gt=g?"center":n.get("text-justify").evaluate(T,{},r.canonical);const ut=n.get("symbol-placement"),St=ut==="point"?n.get("text-max-width").evaluate(T,{},r.canonical)*Ni:0,Dt=()=>{r.bucket.allowVerticalPlacement&&Fs(xe)&&($.vertical=Yd(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,St,f,vt,"left",$e,se,S.ah.vertical,!0,ut,L,A))};if(!g&&Tt){const yt=new Set;if(gt==="auto")for(let Ct=0;Ct<Tt.values.length;Ct+=2)yt.add(em(Tt.values[Ct]));else yt.add(gt);let Ve=!1;for(const Ct of yt)if(!$.horizontal[Ct])if(Ve)$.horizontal[Ct]=$.horizontal[0];else{const kt=Yd(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,St,f,"center",Ct,$e,se,S.ah.horizontal,!1,ut,L,A);kt&&($.horizontal[Ct]=kt,Ve=kt.positionedLines.length===1)}Dt()}else{gt==="auto"&&(gt=em(vt));const yt=Yd(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,St,f,vt,gt,$e,se,S.ah.horizontal,!1,ut,L,A);yt&&($.horizontal[gt]=yt),Dt(),Fs(xe)&&g&&_&&($.vertical=Yd(q,r.glyphMap,r.glyphPositions,r.imagePositions,P,St,f,vt,gt,$e,se,S.ah.vertical,!1,ut,L,A))}}let Se=!1;if(T.icon&&T.icon.name){const xe=r.imageMap[T.icon.name];xe&&(W=qb(r.imagePositions[T.icon.name],n.get("icon-offset").evaluate(T,{},r.canonical),n.get("icon-anchor").evaluate(T,{},r.canonical)),Se=!!xe.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=Se:r.bucket.sdfIcons!==Se&&tt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xe.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ue=N_($.horizontal)||$.vertical;r.bucket.iconsInText=!!ue&&ue.iconsInText,(ue||W)&&ow(r.bucket,T,$,W,r.imageMap,c,L,F,se,Se,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},S.bo=Nf,S.bp=Rf,S.bq=Bf,S.br=Tl,S.bs=$f,S.bt=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},S.bu=function(r,e,n,o,c){return d(this,void 0,void 0,function*(){if(oe())try{return yield Xe(r,e,n,o,c)}catch{}return function(f,g,_,b,T){const P=f.width,A=f.height;It&&$t||(It=new OffscreenCanvas(P,A),$t=It.getContext("2d",{willReadFrequently:!0})),It.width=P,It.height=A,$t.drawImage(f,0,0,P,A);const L=$t.getImageData(g,_,b,T);return $t.clearRect(0,0,P,A),L.data}(r,e,n,o,c)})},S.bv=b_,S.bw=V,S.bx=ee,S.by=Zy,S.bz=function(r){return r.message===nt},S.c=er,S.d=r=>d(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=Ge,S.f=r=>new Promise((e,n)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=Qe})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(c):Qe}),S.g=pr,S.h=(r,e)=>Bt(Ge(r,{type:"json"}),e),S.i=dr,S.j=or,S.k=_r,S.l=(r,e)=>Bt(Ge(r,{type:"arrayBuffer"}),e),S.m=Bt,S.n=function(r){return new $f(r).readFields(Nb,[])},S.o=Nh,S.p=e_,S.q=l,S.r=Cu,S.s=gr,S.t=fl,S.u=ft,S.v=Ee,S.w=tt,S.x=Ls,S.y=function([r,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(n),y:r*Math.sin(e)*Math.sin(n),z:r*Math.cos(n)}},S.z=qi}),x("worker",["./shared"],function(S){class d{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,B){for(const J of R){this._layerConfigs[J.id]=J;const he=this._layers[J.id]=S.aA(J);he._featureFilter=S.a6(he.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of B)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const j=S.bi(Object.values(this._layerConfigs),this.keyCache);for(const J of j){const he=J.map(Fe=>this._layers[Fe.id]),ye=he[0];if(ye.visibility==="none")continue;const be=ye.source||"";let le=this.familiesBySource[be];le||(le=this.familiesBySource[be]={});const Ie=ye.sourceLayer||"_geojsonTileLayer";let je=le[Ie];je||(je=le[Ie]=[]),je.push(he)}}}class V{constructor(R){const B={},j=[];for(const be in R){const le=R[be],Ie=B[be]={};for(const je in le){const Fe=le[+je];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const Le={x:0,y:0,w:Fe.bitmap.width+2,h:Fe.bitmap.height+2};j.push(Le),Ie[je]={rect:Le,metrics:Fe.metrics}}}const{w:J,h:he}=S.p(j),ye=new S.o({width:J||1,height:he||1});for(const be in R){const le=R[be];for(const Ie in le){const je=le[+Ie];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const Fe=B[be][Ie].rect;S.o.copy(je.bitmap,ye,{x:0,y:0},{x:Fe.x+1,y:Fe.y+1},je.bitmap)}}this.image=ye,this.positions=B}}S.bj("GlyphAtlas",V);class ee{constructor(R){this.tileID=new S.Q(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId,this.inFlightDependencies=[]}parse(R,B,j,J){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=R,this.collisionBoxArray=new S.a4;const he=new S.bk(Object.keys(R.layers).sort()),ye=new S.bl(this.tileID,this.promoteId);ye.bucketLayerIDs=[];const be={},le={featureIndex:ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},Ie=B.familiesBySource[this.source];for(const Xt in Ie){const ri=R.layers[Xt];if(!ri)continue;ri.version===1&&S.w(`Vector tile source "${this.source}" layer "${Xt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const fi=he.encode(Xt),an=[];for(let on=0;on<ri.length;on++){const xi=ri.feature(on),ba=ye.getId(xi,Xt);an.push({feature:xi,id:ba,index:on,sourceLayerIndex:fi})}for(const on of Ie[Xt]){const xi=on[0];xi.source!==this.source&&S.w(`layer.source = ${xi.source} does not equal this.source = ${this.source}`),xi.minzoom&&this.zoom<Math.floor(xi.minzoom)||xi.maxzoom&&this.zoom>=xi.maxzoom||xi.visibility!=="none"&&(Te(on,this.zoom,j),(be[xi.id]=xi.createBucket({index:ye.bucketLayerIDs.length,layers:on,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:fi,sourceID:this.source})).populate(an,le,this.tileID.canonical),ye.bucketLayerIDs.push(on.map(ba=>ba.id)))}}const je=S.aF(le.glyphDependencies,Xt=>Object.keys(Xt).map(Number));this.inFlightDependencies.forEach(Xt=>Xt==null?void 0:Xt.abort()),this.inFlightDependencies=[];let Fe=Promise.resolve({});if(Object.keys(je).length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),Fe=J.sendAsync({type:"GG",data:{stacks:je,source:this.source,tileID:this.tileID,type:"glyphs"}},Xt)}const Le=Object.keys(le.iconDependencies);let Lt=Promise.resolve({});if(Le.length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),Lt=J.sendAsync({type:"GI",data:{icons:Le,source:this.source,tileID:this.tileID,type:"icons"}},Xt)}const zt=Object.keys(le.patternDependencies);let nr=Promise.resolve({});if(zt.length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),nr=J.sendAsync({type:"GI",data:{icons:zt,source:this.source,tileID:this.tileID,type:"patterns"}},Xt)}const[qt,yr,Nr]=yield Promise.all([Fe,Lt,nr]),Gr=new V(qt),pi=new S.bm(yr,Nr);for(const Xt in be){const ri=be[Xt];ri instanceof S.a5?(Te(ri.layers,this.zoom,j),S.bn({bucket:ri,glyphMap:qt,glyphPositions:Gr.positions,imageMap:yr,imagePositions:pi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ri.hasPattern&&(ri instanceof S.bo||ri instanceof S.bp||ri instanceof S.bq)&&(Te(ri.layers,this.zoom,j),ri.addFeatures(le,this.tileID.canonical,pi.patternPositions))}return this.status="done",{buckets:Object.values(be).filter(Xt=>!Xt.isEmpty()),featureIndex:ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gr.image,imageAtlas:pi,glyphMap:this.returnDependencies?qt:null,iconMap:this.returnDependencies?yr:null,glyphPositions:this.returnDependencies?Gr.positions:null}})}}function Te(K,R,B){const j=new S.a8(R);for(const J of K)J.recalculate(j,B)}class ie{constructor(R,B,j){this.actor=R,this.layerIndex=B,this.availableImages=j,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(R,B){return S._(this,void 0,void 0,function*(){const j=yield S.l(R.request,B);try{return{vectorTile:new S.br.VectorTile(new S.bs(j.data)),rawData:j.data,cacheControl:j.cacheControl,expires:j.expires}}catch(J){const he=new Uint8Array(j.data);let ye=`Unable to parse the tile at ${R.request.url}, `;throw ye+=he[0]===31&&he[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${J.messge}`,new Error(ye)}})}loadTile(R){return S._(this,void 0,void 0,function*(){const B=R.uid,j=!!(R&&R.request&&R.request.collectResourceTiming)&&new S.bt(R.request),J=new ee(R);this.loading[B]=J;const he=new AbortController;J.abort=he;try{const ye=yield this.loadVectorTile(R,he);if(delete this.loading[B],!ye)return null;const be=ye.rawData,le={};ye.expires&&(le.expires=ye.expires),ye.cacheControl&&(le.cacheControl=ye.cacheControl);const Ie={};if(j){const Fe=j.finish();Fe&&(Ie.resourceTiming=JSON.parse(JSON.stringify(Fe)))}J.vectorTile=ye.vectorTile;const je=J.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[B]=J,this.fetching[B]={rawTileData:be,cacheControl:le,resourceTiming:Ie};try{const Fe=yield je;return S.e({rawTileData:be.slice(0)},Fe,le,Ie)}finally{delete this.fetching[B]}}catch(ye){throw delete this.loading[B],J.status="done",this.loaded[B]=J,ye}})}reloadTile(R){return S._(this,void 0,void 0,function*(){const B=R.uid;if(!this.loaded||!this.loaded[B])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const j=this.loaded[B];if(j.showCollisionBoxes=R.showCollisionBoxes,j.status==="parsing"){const J=yield j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor);let he;if(this.fetching[B]){const{rawTileData:ye,cacheControl:be,resourceTiming:le}=this.fetching[B];delete this.fetching[B],he=S.e({rawTileData:ye.slice(0)},J,be,le)}else he=J;return he}if(j.status==="done"&&j.vectorTile)return j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(R){return S._(this,void 0,void 0,function*(){const B=this.loading,j=R.uid;B&&B[j]&&B[j].abort&&(B[j].abort.abort(),delete B[j])})}removeTile(R){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[R.uid]&&delete this.loaded[R.uid]})}}class G{constructor(){this.loaded={}}loadTile(R){return S._(this,void 0,void 0,function*(){const{uid:B,encoding:j,rawImageData:J,redFactor:he,greenFactor:ye,blueFactor:be,baseShift:le}=R,Ie=J.width+2,je=J.height+2,Fe=S.b(J)?new S.R({width:Ie,height:je},yield S.bu(J,-1,-1,Ie,je)):J,Le=new S.bv(B,Fe,j,he,ye,be,le);return this.loaded=this.loaded||{},this.loaded[B]=Le,Le})}removeTile(R){const B=this.loaded,j=R.uid;B&&B[j]&&delete B[j]}}function He(K,R){if(K.length!==0){Ke(K[0],R);for(var B=1;B<K.length;B++)Ke(K[B],!R)}}function Ke(K,R){for(var B=0,j=0,J=0,he=K.length,ye=he-1;J<he;ye=J++){var be=(K[J][0]-K[ye][0])*(K[ye][1]+K[J][1]),le=B+be;j+=Math.abs(B)>=Math.abs(be)?B-le+be:be-le+B,B=le}B+j>=0!=!!R&&K.reverse()}var ke=S.bw(function K(R,B){var j,J=R&&R.type;if(J==="FeatureCollection")for(j=0;j<R.features.length;j++)K(R.features[j],B);else if(J==="GeometryCollection")for(j=0;j<R.geometries.length;j++)K(R.geometries[j],B);else if(J==="Feature")K(R.geometry,B);else if(J==="Polygon")He(R.coordinates,B);else if(J==="MultiPolygon")for(j=0;j<R.coordinates.length;j++)He(R.coordinates[j],B);return R});const ht=S.br.VectorTileFeature.prototype.toGeoJSON;var pe={exports:{}},oe=S.bx,me=S.br.VectorTileFeature,De=Ue;function Ue(K,R){this.options=R||{},this.features=K,this.length=K.length}function ze(K,R){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=R||4096}Ue.prototype.feature=function(K){return new ze(this.features[K],this.options.extent)},ze.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var R=0;R<K.length;R++){for(var B=K[R],j=[],J=0;J<B.length;J++)j.push(new oe(B[J][0],B[J][1]));this.geometry.push(j)}return this.geometry},ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,R=1/0,B=-1/0,j=1/0,J=-1/0,he=0;he<K.length;he++)for(var ye=K[he],be=0;be<ye.length;be++){var le=ye[be];R=Math.min(R,le.x),B=Math.max(B,le.x),j=Math.min(j,le.y),J=Math.max(J,le.y)}return[R,j,B,J]},ze.prototype.toGeoJSON=me.prototype.toGeoJSON;var Ge=S.by,re=De;function ne(K){var R=new Ge;return function(B,j){for(var J in B.layers)j.writeMessage(3,fe,B.layers[J])}(K,R),R.finish()}function fe(K,R){var B;R.writeVarintField(15,K.version||1),R.writeStringField(1,K.name||""),R.writeVarintField(5,K.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<K.length;B++)j.feature=K.feature(B),R.writeMessage(2,Me,j);var J=j.keys;for(B=0;B<J.length;B++)R.writeStringField(3,J[B]);var he=j.values;for(B=0;B<he.length;B++)R.writeMessage(4,Jt,he[B])}function Me(K,R){var B=K.feature;B.id!==void 0&&R.writeVarintField(1,B.id),R.writeMessage(2,Oe,K),R.writeVarintField(3,B.type),R.writeMessage(4,dr,B)}function Oe(K,R){var B=K.feature,j=K.keys,J=K.values,he=K.keycache,ye=K.valuecache;for(var be in B.properties){var le=B.properties[be],Ie=he[be];if(le!==null){Ie===void 0&&(j.push(be),he[be]=Ie=j.length-1),R.writeVarint(Ie);var je=typeof le;je!=="string"&&je!=="boolean"&&je!=="number"&&(le=JSON.stringify(le));var Fe=je+":"+le,Le=ye[Fe];Le===void 0&&(J.push(le),ye[Fe]=Le=J.length-1),R.writeVarint(Le)}}}function tt(K,R){return(R<<3)+(7&K)}function dt(K){return K<<1^K>>31}function dr(K,R){for(var B=K.loadGeometry(),j=K.type,J=0,he=0,ye=B.length,be=0;be<ye;be++){var le=B[be],Ie=1;j===1&&(Ie=le.length),R.writeVarint(tt(1,Ie));for(var je=j===3?le.length-1:le.length,Fe=0;Fe<je;Fe++){Fe===1&&j!==1&&R.writeVarint(tt(2,je-1));var Le=le[Fe].x-J,Lt=le[Fe].y-he;R.writeVarint(dt(Le)),R.writeVarint(dt(Lt)),J+=Le,he+=Lt}j===3&&R.writeVarint(tt(7,1))}}function Jt(K,R){var B=typeof K;B==="string"?R.writeStringField(1,K):B==="boolean"?R.writeBooleanField(7,K):B==="number"&&(K%1!=0?R.writeDoubleField(3,K):K<0?R.writeSVarintField(6,K):R.writeVarintField(5,K))}pe.exports=ne,pe.exports.fromVectorTileJs=ne,pe.exports.fromGeojsonVt=function(K,R){R=R||{};var B={};for(var j in K)B[j]=new re(K[j].features,R),B[j].name=j,B[j].version=R.version,B[j].extent=R.extent;return ne({layers:B})},pe.exports.GeoJSONWrapper=re;var pt=S.bw(pe.exports);const Qe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Xe=Math.fround||(It=new Float32Array(1),K=>(It[0]=+K,It[0]));var It;const $t=3,nt=5,er=6;class mr{constructor(R){this.options=Object.assign(Object.create(Qe),R),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(R){const{log:B,minZoom:j,maxZoom:J}=this.options;B&&console.time("total time");const he=`prepare ${R.length} points`;B&&console.time(he),this.points=R;const ye=[];for(let le=0;le<R.length;le++){const Ie=R[le];if(!Ie.geometry)continue;const[je,Fe]=Ie.geometry.coordinates,Le=Xe(ar(je)),Lt=Xe(Sr(Fe));ye.push(Le,Lt,1/0,le,-1,1),this.options.reduce&&ye.push(0)}let be=this.trees[J+1]=this._createTree(ye);B&&console.timeEnd(he);for(let le=J;le>=j;le--){const Ie=+Date.now();be=this.trees[le]=this._createTree(this._cluster(be,le)),B&&console.log("z%d: %d clusters in %dms",le,be.numItems,+Date.now()-Ie)}return B&&console.timeEnd("total time"),this}getClusters(R,B){let j=((R[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,R[1]));let he=R[2]===180?180:((R[2]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)j=-180,he=180;else if(j>he){const Fe=this.getClusters([j,J,180,ye],B),Le=this.getClusters([-180,J,he,ye],B);return Fe.concat(Le)}const be=this.trees[this._limitZoom(B)],le=be.range(ar(j),Sr(ye),ar(he),Sr(J)),Ie=be.data,je=[];for(const Fe of le){const Le=this.stride*Fe;je.push(Ie[Le+nt]>1?pr(Ie,Le,this.clusterProps):this.points[Ie[Le+$t]])}return je}getChildren(R){const B=this._getOriginId(R),j=this._getOriginZoom(R),J="No cluster with the specified id.",he=this.trees[j];if(!he)throw new Error(J);const ye=he.data;if(B*this.stride>=ye.length)throw new Error(J);const be=this.options.radius/(this.options.extent*Math.pow(2,j-1)),le=he.within(ye[B*this.stride],ye[B*this.stride+1],be),Ie=[];for(const je of le){const Fe=je*this.stride;ye[Fe+4]===R&&Ie.push(ye[Fe+nt]>1?pr(ye,Fe,this.clusterProps):this.points[ye[Fe+$t]])}if(Ie.length===0)throw new Error(J);return Ie}getLeaves(R,B,j){const J=[];return this._appendLeaves(J,R,B=B||10,j=j||0,0),J}getTile(R,B,j){const J=this.trees[this._limitZoom(R)],he=Math.pow(2,R),{extent:ye,radius:be}=this.options,le=be/ye,Ie=(j-le)/he,je=(j+1+le)/he,Fe={features:[]};return this._addTileFeatures(J.range((B-le)/he,Ie,(B+1+le)/he,je),J.data,B,j,he,Fe),B===0&&this._addTileFeatures(J.range(1-le/he,Ie,1,je),J.data,he,j,he,Fe),B===he-1&&this._addTileFeatures(J.range(0,Ie,le/he,je),J.data,-1,j,he,Fe),Fe.features.length?Fe:null}getClusterExpansionZoom(R){let B=this._getOriginZoom(R)-1;for(;B<=this.options.maxZoom;){const j=this.getChildren(R);if(B++,j.length!==1)break;R=j[0].properties.cluster_id}return B}_appendLeaves(R,B,j,J,he){const ye=this.getChildren(B);for(const be of ye){const le=be.properties;if(le&&le.cluster?he+le.point_count<=J?he+=le.point_count:he=this._appendLeaves(R,le.cluster_id,j,J,he):he<J?he++:R.push(be),R.length===j)break}return he}_createTree(R){const B=new S.av(R.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<R.length;j+=this.stride)B.add(R[j],R[j+1]);return B.finish(),B.data=R,B}_addTileFeatures(R,B,j,J,he,ye){for(const be of R){const le=be*this.stride,Ie=B[le+nt]>1;let je,Fe,Le;if(Ie)je=tr(B,le,this.clusterProps),Fe=B[le],Le=B[le+1];else{const nr=this.points[B[le+$t]];je=nr.properties;const[qt,yr]=nr.geometry.coordinates;Fe=ar(qt),Le=Sr(yr)}const Lt={type:1,geometry:[[Math.round(this.options.extent*(Fe*he-j)),Math.round(this.options.extent*(Le*he-J))]],tags:je};let zt;zt=Ie||this.options.generateId?B[le+$t]:this.points[B[le+$t]].id,zt!==void 0&&(Lt.id=zt),ye.features.push(Lt)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,B){const{radius:j,extent:J,reduce:he,minPoints:ye}=this.options,be=j/(J*Math.pow(2,B)),le=R.data,Ie=[],je=this.stride;for(let Fe=0;Fe<le.length;Fe+=je){if(le[Fe+2]<=B)continue;le[Fe+2]=B;const Le=le[Fe],Lt=le[Fe+1],zt=R.within(le[Fe],le[Fe+1],be),nr=le[Fe+nt];let qt=nr;for(const yr of zt){const Nr=yr*je;le[Nr+2]>B&&(qt+=le[Nr+nt])}if(qt>nr&&qt>=ye){let yr,Nr=Le*nr,Gr=Lt*nr,pi=-1;const Xt=((Fe/je|0)<<5)+(B+1)+this.points.length;for(const ri of zt){const fi=ri*je;if(le[fi+2]<=B)continue;le[fi+2]=B;const an=le[fi+nt];Nr+=le[fi]*an,Gr+=le[fi+1]*an,le[fi+4]=Xt,he&&(yr||(yr=this._map(le,Fe,!0),pi=this.clusterProps.length,this.clusterProps.push(yr)),he(yr,this._map(le,fi)))}le[Fe+4]=Xt,Ie.push(Nr/qt,Gr/qt,1/0,Xt,-1,qt),he&&Ie.push(pi)}else{for(let yr=0;yr<je;yr++)Ie.push(le[Fe+yr]);if(qt>1)for(const yr of zt){const Nr=yr*je;if(!(le[Nr+2]<=B)){le[Nr+2]=B;for(let Gr=0;Gr<je;Gr++)Ie.push(le[Nr+Gr])}}}}return Ie}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,B,j){if(R[B+nt]>1){const ye=this.clusterProps[R[B+er]];return j?Object.assign({},ye):ye}const J=this.points[R[B+$t]].properties,he=this.options.map(J);return j&&he===J?Object.assign({},he):he}}function pr(K,R,B){return{type:"Feature",id:K[R+$t],properties:tr(K,R,B),geometry:{type:"Point",coordinates:[(j=K[R],360*(j-.5)),Bt(K[R+1])]}};var j}function tr(K,R,B){const j=K[R+nt],J=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,he=K[R+er],ye=he===-1?{}:Object.assign({},B[he]);return Object.assign(ye,{cluster:!0,cluster_id:K[R+$t],point_count:j,point_count_abbreviated:J})}function ar(K){return K/360+.5}function Sr(K){const R=Math.sin(K*Math.PI/180),B=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return B<0?0:B>1?1:B}function Bt(K){const R=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function gr(K,R,B,j){for(var J,he=j,ye=B-R>>1,be=B-R,le=K[R],Ie=K[R+1],je=K[B],Fe=K[B+1],Le=R+3;Le<B;Le+=3){var Lt=Lr(K[Le],K[Le+1],le,Ie,je,Fe);if(Lt>he)J=Le,he=Lt;else if(Lt===he){var zt=Math.abs(Le-ye);zt<be&&(J=Le,be=zt)}}he>j&&(J-R>3&&gr(K,R,J,j),K[J+2]=he,B-J>3&&gr(K,J,B,j))}function Lr(K,R,B,j,J,he){var ye=J-B,be=he-j;if(ye!==0||be!==0){var le=((K-B)*ye+(R-j)*be)/(ye*ye+be*be);le>1?(B=J,j=he):le>0&&(B+=ye*le,j+=be*le)}return(ye=K-B)*ye+(be=R-j)*be}function Ir(K,R,B,j){var J={id:K===void 0?null:K,type:R,geometry:B,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(he){var ye=he.geometry,be=he.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")_r(he,ye);else if(be==="Polygon"||be==="MultiLineString")for(var le=0;le<ye.length;le++)_r(he,ye[le]);else if(be==="MultiPolygon")for(le=0;le<ye.length;le++)for(var Ie=0;Ie<ye[le].length;Ie++)_r(he,ye[le][Ie])}(J),J}function _r(K,R){for(var B=0;B<R.length;B+=3)K.minX=Math.min(K.minX,R[B]),K.minY=Math.min(K.minY,R[B+1]),K.maxX=Math.max(K.maxX,R[B]),K.maxY=Math.max(K.maxY,R[B+1])}function or(K,R,B,j){if(R.geometry){var J=R.geometry.coordinates,he=R.geometry.type,ye=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),be=[],le=R.id;if(B.promoteId?le=R.properties[B.promoteId]:B.generateId&&(le=j||0),he==="Point")Rr(J,be);else if(he==="MultiPoint")for(var Ie=0;Ie<J.length;Ie++)Rr(J[Ie],be);else if(he==="LineString")Ee(J,be,ye,!1);else if(he==="MultiLineString"){if(B.lineMetrics){for(Ie=0;Ie<J.length;Ie++)Ee(J[Ie],be=[],ye,!1),K.push(Ir(le,"LineString",be,R.properties));return}Ne(J,be,ye,!1)}else if(he==="Polygon")Ne(J,be,ye,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(Ie=0;Ie<R.geometry.geometries.length;Ie++)or(K,{id:le,geometry:R.geometry.geometries[Ie],properties:R.properties},B,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ie=0;Ie<J.length;Ie++){var je=[];Ne(J[Ie],je,ye,!0),be.push(je)}}K.push(Ir(le,he,be,R.properties))}}function Rr(K,R){R.push(Ft(K[0])),R.push(ct(K[1])),R.push(0)}function Ee(K,R,B,j){for(var J,he,ye=0,be=0;be<K.length;be++){var le=Ft(K[be][0]),Ie=ct(K[be][1]);R.push(le),R.push(Ie),R.push(0),be>0&&(ye+=j?(J*Ie-le*he)/2:Math.sqrt(Math.pow(le-J,2)+Math.pow(Ie-he,2))),J=le,he=Ie}var je=R.length-3;R[2]=1,gr(R,0,je,B),R[je+2]=1,R.size=Math.abs(ye),R.start=0,R.end=R.size}function Ne(K,R,B,j){for(var J=0;J<K.length;J++){var he=[];Ee(K[J],he,B,j),R.push(he)}}function Ft(K){return K/360+.5}function ct(K){var R=Math.sin(K*Math.PI/180),B=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return B<0?0:B>1?1:B}function Et(K,R,B,j,J,he,ye,be){if(j/=R,he>=(B/=R)&&ye<j)return K;if(ye<B||he>=j)return null;for(var le=[],Ie=0;Ie<K.length;Ie++){var je=K[Ie],Fe=je.geometry,Le=je.type,Lt=J===0?je.minX:je.minY,zt=J===0?je.maxX:je.maxY;if(Lt>=B&&zt<j)le.push(je);else if(!(zt<B||Lt>=j)){var nr=[];if(Le==="Point"||Le==="MultiPoint")Zt(Fe,nr,B,j,J);else if(Le==="LineString")rr(Fe,nr,B,j,J,!1,be.lineMetrics);else if(Le==="MultiLineString")Kr(Fe,nr,B,j,J,!1);else if(Le==="Polygon")Kr(Fe,nr,B,j,J,!0);else if(Le==="MultiPolygon")for(var qt=0;qt<Fe.length;qt++){var yr=[];Kr(Fe[qt],yr,B,j,J,!0),yr.length&&nr.push(yr)}if(nr.length){if(be.lineMetrics&&Le==="LineString"){for(qt=0;qt<nr.length;qt++)le.push(Ir(je.id,Le,nr[qt],je.tags));continue}Le!=="LineString"&&Le!=="MultiLineString"||(nr.length===1?(Le="LineString",nr=nr[0]):Le="MultiLineString"),Le!=="Point"&&Le!=="MultiPoint"||(Le=nr.length===3?"Point":"MultiPoint"),le.push(Ir(je.id,Le,nr,je.tags))}}}return le.length?le:null}function Zt(K,R,B,j,J){for(var he=0;he<K.length;he+=3){var ye=K[he+J];ye>=B&&ye<=j&&(R.push(K[he]),R.push(K[he+1]),R.push(K[he+2]))}}function rr(K,R,B,j,J,he,ye){for(var be,le,Ie=lr(K),je=J===0?li:ci,Fe=K.start,Le=0;Le<K.length-3;Le+=3){var Lt=K[Le],zt=K[Le+1],nr=K[Le+2],qt=K[Le+3],yr=K[Le+4],Nr=J===0?Lt:zt,Gr=J===0?qt:yr,pi=!1;ye&&(be=Math.sqrt(Math.pow(Lt-qt,2)+Math.pow(zt-yr,2))),Nr<B?Gr>B&&(le=je(Ie,Lt,zt,qt,yr,B),ye&&(Ie.start=Fe+be*le)):Nr>j?Gr<j&&(le=je(Ie,Lt,zt,qt,yr,j),ye&&(Ie.start=Fe+be*le)):Wt(Ie,Lt,zt,nr),Gr<B&&Nr>=B&&(le=je(Ie,Lt,zt,qt,yr,B),pi=!0),Gr>j&&Nr<=j&&(le=je(Ie,Lt,zt,qt,yr,j),pi=!0),!he&&pi&&(ye&&(Ie.end=Fe+be*le),R.push(Ie),Ie=lr(K)),ye&&(Fe+=be)}var Xt=K.length-3;Lt=K[Xt],zt=K[Xt+1],nr=K[Xt+2],(Nr=J===0?Lt:zt)>=B&&Nr<=j&&Wt(Ie,Lt,zt,nr),Xt=Ie.length-3,he&&Xt>=3&&(Ie[Xt]!==Ie[0]||Ie[Xt+1]!==Ie[1])&&Wt(Ie,Ie[0],Ie[1],Ie[2]),Ie.length&&R.push(Ie)}function lr(K){var R=[];return R.size=K.size,R.start=K.start,R.end=K.end,R}function Kr(K,R,B,j,J,he){for(var ye=0;ye<K.length;ye++)rr(K[ye],R,B,j,J,he,!1)}function Wt(K,R,B,j){K.push(R),K.push(B),K.push(j)}function li(K,R,B,j,J,he){var ye=(he-R)/(j-R);return K.push(he),K.push(B+(J-B)*ye),K.push(1),ye}function ci(K,R,B,j,J,he){var ye=(he-B)/(J-B);return K.push(R+(j-R)*ye),K.push(he),K.push(1),ye}function Ze(K,R){for(var B=[],j=0;j<K.length;j++){var J,he=K[j],ye=he.type;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")J=Fr(he.geometry,R);else if(ye==="MultiLineString"||ye==="Polygon"){J=[];for(var be=0;be<he.geometry.length;be++)J.push(Fr(he.geometry[be],R))}else if(ye==="MultiPolygon")for(J=[],be=0;be<he.geometry.length;be++){for(var le=[],Ie=0;Ie<he.geometry[be].length;Ie++)le.push(Fr(he.geometry[be][Ie],R));J.push(le)}B.push(Ir(he.id,ye,J,he.tags))}return B}function Fr(K,R){var B=[];B.size=K.size,K.start!==void 0&&(B.start=K.start,B.end=K.end);for(var j=0;j<K.length;j+=3)B.push(K[j]+R,K[j+1],K[j+2]);return B}function br(K,R){if(K.transformed)return K;var B,j,J,he=1<<K.z,ye=K.x,be=K.y;for(B=0;B<K.features.length;B++){var le=K.features[B],Ie=le.geometry,je=le.type;if(le.geometry=[],je===1)for(j=0;j<Ie.length;j+=2)le.geometry.push(Li(Ie[j],Ie[j+1],R,he,ye,be));else for(j=0;j<Ie.length;j++){var Fe=[];for(J=0;J<Ie[j].length;J+=2)Fe.push(Li(Ie[j][J],Ie[j][J+1],R,he,ye,be));le.geometry.push(Fe)}}return K.transformed=!0,K}function Li(K,R,B,j,J,he){return[Math.round(B*(K*j-J)),Math.round(B*(R*j-he))]}function si(K,R,B,j,J){for(var he=R===J.maxZoom?0:J.tolerance/((1<<R)*J.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:j,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<K.length;be++){ye.numFeatures++,Je(ye,K[be],he,J);var le=K[be].minX,Ie=K[be].minY,je=K[be].maxX,Fe=K[be].maxY;le<ye.minX&&(ye.minX=le),Ie<ye.minY&&(ye.minY=Ie),je>ye.maxX&&(ye.maxX=je),Fe>ye.maxY&&(ye.maxY=Fe)}return ye}function Je(K,R,B,j){var J=R.geometry,he=R.type,ye=[];if(he==="Point"||he==="MultiPoint")for(var be=0;be<J.length;be+=3)ye.push(J[be]),ye.push(J[be+1]),K.numPoints++,K.numSimplified++;else if(he==="LineString")Nt(ye,J,K,B,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(be=0;be<J.length;be++)Nt(ye,J[be],K,B,he==="Polygon",be===0);else if(he==="MultiPolygon")for(var le=0;le<J.length;le++){var Ie=J[le];for(be=0;be<Ie.length;be++)Nt(ye,Ie[be],K,B,!0,be===0)}if(ye.length){var je=R.tags||null;if(he==="LineString"&&j.lineMetrics){for(var Fe in je={},R.tags)je[Fe]=R.tags[Fe];je.mapbox_clip_start=J.start/J.size,je.mapbox_clip_end=J.end/J.size}var Le={geometry:ye,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:je};R.id!==null&&(Le.id=R.id),K.features.push(Le)}}function Nt(K,R,B,j,J,he){var ye=j*j;if(j>0&&R.size<(J?ye:j))B.numPoints+=R.length/3;else{for(var be=[],le=0;le<R.length;le+=3)(j===0||R[le+2]>ye)&&(B.numSimplified++,be.push(R[le]),be.push(R[le+1])),B.numPoints++;J&&function(Ie,je){for(var Fe=0,Le=0,Lt=Ie.length,zt=Lt-2;Le<Lt;zt=Le,Le+=2)Fe+=(Ie[Le]-Ie[zt])*(Ie[Le+1]+Ie[zt+1]);if(Fe>0===je)for(Le=0,Lt=Ie.length;Le<Lt/2;Le+=2){var nr=Ie[Le],qt=Ie[Le+1];Ie[Le]=Ie[Lt-2-Le],Ie[Le+1]=Ie[Lt-1-Le],Ie[Lt-2-Le]=nr,Ie[Lt-1-Le]=qt}}(be,he),K.push(be)}}function Vt(K,R){var B=(R=this.options=function(J,he){for(var ye in he)J[ye]=he[ye];return J}(Object.create(this.options),R)).debug;if(B&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(J,he){var ye=[];if(J.type==="FeatureCollection")for(var be=0;be<J.features.length;be++)or(ye,J.features[be],he,be);else or(ye,J.type==="Feature"?J:{geometry:J},he);return ye}(K,R);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(J,he){var ye=he.buffer/he.extent,be=J,le=Et(J,1,-1-ye,ye,0,-1,2,he),Ie=Et(J,1,1-ye,2+ye,0,-1,2,he);return(le||Ie)&&(be=Et(J,1,-ye,1+ye,0,-1,2,he)||[],le&&(be=Ze(le,1).concat(be)),Ie&&(be=be.concat(Ze(Ie,-1)))),be}(j,R),j.length&&this.splitTile(j,0,0,0),B&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ui(K,R,B){return 32*((1<<K)*B+R)+K}function Vi(K,R){return R?K.properties[R]:K.id}function Kt(K,R){if(K==null)return!0;if(K.type==="Feature")return Vi(K,R)!=null;if(K.type==="FeatureCollection"){const B=new Set;for(const j of K.features){const J=Vi(j,R);if(J==null||B.has(J))return!1;B.add(J)}return!0}return!1}function as(K,R){const B=new Map;if(K!=null)if(K.type==="Feature")B.set(Vi(K,R),K);else for(const j of K.features)B.set(Vi(j,R),j);return B}Vt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Vt.prototype.splitTile=function(K,R,B,j,J,he,ye){for(var be=[K,R,B,j],le=this.options,Ie=le.debug;be.length;){j=be.pop(),B=be.pop(),R=be.pop(),K=be.pop();var je=1<<R,Fe=ui(R,B,j),Le=this.tiles[Fe];if(!Le&&(Ie>1&&console.time("creation"),Le=this.tiles[Fe]=si(K,R,B,j,le),this.tileCoords.push({z:R,x:B,y:j}),Ie)){Ie>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,B,j,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));var Lt="z"+R;this.stats[Lt]=(this.stats[Lt]||0)+1,this.total++}if(Le.source=K,J){if(R===le.maxZoom||R===J)continue;var zt=1<<J-R;if(B!==Math.floor(he/zt)||j!==Math.floor(ye/zt))continue}else if(R===le.indexMaxZoom||Le.numPoints<=le.indexMaxPoints)continue;if(Le.source=null,K.length!==0){Ie>1&&console.time("clipping");var nr,qt,yr,Nr,Gr,pi,Xt=.5*le.buffer/le.extent,ri=.5-Xt,fi=.5+Xt,an=1+Xt;nr=qt=yr=Nr=null,Gr=Et(K,je,B-Xt,B+fi,0,Le.minX,Le.maxX,le),pi=Et(K,je,B+ri,B+an,0,Le.minX,Le.maxX,le),K=null,Gr&&(nr=Et(Gr,je,j-Xt,j+fi,1,Le.minY,Le.maxY,le),qt=Et(Gr,je,j+ri,j+an,1,Le.minY,Le.maxY,le),Gr=null),pi&&(yr=Et(pi,je,j-Xt,j+fi,1,Le.minY,Le.maxY,le),Nr=Et(pi,je,j+ri,j+an,1,Le.minY,Le.maxY,le),pi=null),Ie>1&&console.timeEnd("clipping"),be.push(nr||[],R+1,2*B,2*j),be.push(qt||[],R+1,2*B,2*j+1),be.push(yr||[],R+1,2*B+1,2*j),be.push(Nr||[],R+1,2*B+1,2*j+1)}}},Vt.prototype.getTile=function(K,R,B){var j=this.options,J=j.extent,he=j.debug;if(K<0||K>24)return null;var ye=1<<K,be=ui(K,R=(R%ye+ye)%ye,B);if(this.tiles[be])return br(this.tiles[be],J);he>1&&console.log("drilling down to z%d-%d-%d",K,R,B);for(var le,Ie=K,je=R,Fe=B;!le&&Ie>0;)Ie--,je=Math.floor(je/2),Fe=Math.floor(Fe/2),le=this.tiles[ui(Ie,je,Fe)];return le&&le.source?(he>1&&console.log("found parent tile z%d-%d-%d",Ie,je,Fe),he>1&&console.time("drilling down"),this.splitTile(le.source,Ie,je,Fe,K,R,B),he>1&&console.timeEnd("drilling down"),this.tiles[be]?br(this.tiles[be],J):null):null};class os extends ie{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(R,B){return S._(this,void 0,void 0,function*(){const j=R.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const J=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!J)return null;const he=new class{constructor(be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.W,this.length=be.length,this._features=be}feature(be){return new class{constructor(le){this._feature=le,this.extent=S.W,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const Ie of this._feature.geometry)le.push([new S.P(Ie[0],Ie[1])]);return le}{const le=[];for(const Ie of this._feature.geometry){const je=[];for(const Fe of Ie)je.push(new S.P(Fe[0],Fe[1]));le.push(je)}return le}}toGeoJSON(le,Ie,je){return ht.call(this,le,Ie,je)}}(this._features[be])}}(J.features);let ye=pt(he);return ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),{vectorTile:he,rawData:ye.buffer}})}loadData(R){return S._(this,void 0,void 0,function*(){var B;(B=this._pendingRequest)===null||B===void 0||B.abort();const j=!!(R&&R.request&&R.request.collectResourceTiming)&&new S.bt(R.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(R,this._pendingRequest),this._geoJSONIndex=R.cluster?new mr(function({superclusterOptions:he,clusterProperties:ye}){if(!ye||!he)return he;const be={},le={},Ie={accumulated:null,zoom:0},je={properties:null},Fe=Object.keys(ye);for(const Le of Fe){const[Lt,zt]=ye[Le],nr=S.bA(zt),qt=S.bA(typeof Lt=="string"?[Lt,["accumulated"],["get",Le]]:Lt);be[Le]=nr.value,le[Le]=qt.value}return he.map=Le=>{je.properties=Le;const Lt={};for(const zt of Fe)Lt[zt]=be[zt].evaluate(Ie,je);return Lt},he.reduce=(Le,Lt)=>{je.properties=Lt;for(const zt of Fe)Ie.accumulated=Le[zt],Le[zt]=le[zt].evaluate(Ie,je)},he}(R)).load((yield this._pendingData).features):new Vt(yield this._pendingData,R.geojsonVtOptions),this.loaded={};const J={};if(j){const he=j.finish();he&&(J.resourceTiming={},J.resourceTiming[R.source]=JSON.parse(JSON.stringify(he)))}return J}catch(J){if(delete this._pendingRequest,S.bz(J))return{abandoned:!0};throw J}})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(R){const B=this.loaded;return B&&B[R.uid]?super.reloadTile(R):this.loadTile(R)}loadAndProcessGeoJSON(R,B){return S._(this,void 0,void 0,function*(){let j=yield this.loadGeoJSON(R,B);if(delete this._pendingRequest,typeof j!="object")throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);if(ke(j,!0),R.filter){const J=S.bA(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(J.result==="error")throw new Error(J.value.map(ye=>`${ye.key}: ${ye.message}`).join(", "));j={type:"FeatureCollection",features:j.features.filter(ye=>J.value.evaluate({zoom:0},ye))}}return j})}loadGeoJSON(R,B){return S._(this,void 0,void 0,function*(){const{promoteId:j}=R;if(R.request){const J=yield S.h(R.request,B);return this._dataUpdateable=Kt(J.data,j)?as(J.data,j):void 0,J.data}if(typeof R.data=="string")try{const J=JSON.parse(R.data);return this._dataUpdateable=Kt(J,j)?as(J,j):void 0,J}catch{throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`)}if(!R.dataDiff)throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${R.source}`);return function(J,he,ye){var be,le,Ie,je;if(he.removeAll&&J.clear(),he.remove)for(const Fe of he.remove)J.delete(Fe);if(he.add)for(const Fe of he.add){const Le=Vi(Fe,ye);Le!=null&&J.set(Le,Fe)}if(he.update)for(const Fe of he.update){let Le=J.get(Fe.id);if(Le==null)continue;const Lt=!Fe.removeAllProperties&&(((be=Fe.removeProperties)===null||be===void 0?void 0:be.length)>0||((le=Fe.addOrUpdateProperties)===null||le===void 0?void 0:le.length)>0);if((Fe.newGeometry||Fe.removeAllProperties||Lt)&&(Le=Object.assign({},Le),J.set(Fe.id,Le),Lt&&(Le.properties=Object.assign({},Le.properties))),Fe.newGeometry&&(Le.geometry=Fe.newGeometry),Fe.removeAllProperties)Le.properties={};else if(((Ie=Fe.removeProperties)===null||Ie===void 0?void 0:Ie.length)>0)for(const zt of Fe.removeProperties)Object.prototype.hasOwnProperty.call(Le.properties,zt)&&delete Le.properties[zt];if(((je=Fe.addOrUpdateProperties)===null||je===void 0?void 0:je.length)>0)for(const{key:zt,value:nr}of Fe.addOrUpdateProperties)Le.properties[zt]=nr}}(this._dataUpdateable,R.dataDiff,j),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(R){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(R){return this._geoJSONIndex.getClusterExpansionZoom(R.clusterId)}getClusterChildren(R){return this._geoJSONIndex.getChildren(R.clusterId)}getClusterLeaves(R){return this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset)}}class Ii{constructor(R){this.self=R,this.actor=new S.C(R),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(B,j)=>{if(this.externalWorkerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.externalWorkerSourceTypes[B]=j},this.self.addProtocol=S.bg,this.self.removeProtocol=S.bh,this.self.registerRTLTextPlugin=B=>{if(S.bB.isParsed())throw new Error("RTL text plugin already registered.");S.bB.setMethods(B)},this.actor.registerMessageHandler("LDT",(B,j)=>this._getDEMWorkerSource(B,j.source).loadTile(j)),this.actor.registerMessageHandler("RDT",(B,j)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(B,j.source).removeTile(j)})),this.actor.registerMessageHandler("GCEZ",(B,j)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(B,j.type,j.source).getClusterExpansionZoom(j)})),this.actor.registerMessageHandler("GCC",(B,j)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(B,j.type,j.source).getClusterChildren(j)})),this.actor.registerMessageHandler("GCL",(B,j)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(B,j.type,j.source).getClusterLeaves(j)})),this.actor.registerMessageHandler("LD",(B,j)=>this._getWorkerSource(B,j.type,j.source).loadData(j)),this.actor.registerMessageHandler("GD",(B,j)=>this._getWorkerSource(B,j.type,j.source).getData()),this.actor.registerMessageHandler("LT",(B,j)=>this._getWorkerSource(B,j.type,j.source).loadTile(j)),this.actor.registerMessageHandler("RT",(B,j)=>this._getWorkerSource(B,j.type,j.source).reloadTile(j)),this.actor.registerMessageHandler("AT",(B,j)=>this._getWorkerSource(B,j.type,j.source).abortTile(j)),this.actor.registerMessageHandler("RMT",(B,j)=>this._getWorkerSource(B,j.type,j.source).removeTile(j)),this.actor.registerMessageHandler("RS",(B,j)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[B]||!this.workerSources[B][j.type]||!this.workerSources[B][j.type][j.source])return;const J=this.workerSources[B][j.type][j.source];delete this.workerSources[B][j.type][j.source],J.removeSource!==void 0&&J.removeSource(j)})),this.actor.registerMessageHandler("RM",B=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B]})),this.actor.registerMessageHandler("SR",(B,j)=>S._(this,void 0,void 0,function*(){this.referrer=j})),this.actor.registerMessageHandler("SRPS",(B,j)=>this._syncRTLPluginState(B,j)),this.actor.registerMessageHandler("IS",(B,j)=>S._(this,void 0,void 0,function*(){this.self.importScripts(j)})),this.actor.registerMessageHandler("SI",(B,j)=>this._setImages(B,j)),this.actor.registerMessageHandler("UL",(B,j)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(B).update(j.layers,j.removedIds)})),this.actor.registerMessageHandler("SL",(B,j)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(B).replace(j)}))}_setImages(R,B){return S._(this,void 0,void 0,function*(){this.availableImages[R]=B;for(const j in this.workerSources[R]){const J=this.workerSources[R][j];for(const he in J)J[he].availableImages=B}})}_syncRTLPluginState(R,B){return S._(this,void 0,void 0,function*(){if(S.bB.isParsed())return S.bB.getState();if(B.pluginStatus!=="loading")return S.bB.setState(B),B;const j=B.pluginURL;if(this.self.importScripts(j),S.bB.isParsed()){const J={pluginStatus:"loaded",pluginURL:j};return S.bB.setState(J),J}throw S.bB.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${j}`)})}_getAvailableImages(R){let B=this.availableImages[R];return B||(B=[]),B}_getLayerIndex(R){let B=this.layerIndexes[R];return B||(B=this.layerIndexes[R]=new d),B}_getWorkerSource(R,B,j){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][B]||(this.workerSources[R][B]={}),!this.workerSources[R][B][j]){const J={sendAsync:(he,ye)=>(he.targetMapId=R,this.actor.sendAsync(he,ye))};switch(B){case"vector":this.workerSources[R][B][j]=new ie(J,this._getLayerIndex(R),this._getAvailableImages(R));break;case"geojson":this.workerSources[R][B][j]=new os(J,this._getLayerIndex(R),this._getAvailableImages(R));break;default:this.workerSources[R][B][j]=new this.externalWorkerSourceTypes[B](J,this._getLayerIndex(R),this._getAvailableImages(R))}}return this.workerSources[R][B][j]}_getDEMWorkerSource(R,B){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][B]||(this.demWorkerSources[R][B]=new G),this.demWorkerSources[R][B]}}return S.i(self)&&(self.worker=new Ii(self)),Ii}),x("index",["exports","./shared"],function(S,d){var V="4.3.2";let ee,Te;const ie={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((t,a)=>{const l=requestAnimationFrame(t);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),a(d.c())})}),getImageData(p,t=0){return this.getImageCanvasContext(p).getImageData(-t,-t,p.width+2*t,p.height+2*t)},getImageCanvasContext(p){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=p.width,t.height=p.height,a.drawImage(p,0,0,p.width,p.height),a},resolveURL:p=>(ee||(ee=document.createElement("a")),ee.href=p,ee.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Te==null&&(Te=matchMedia("(prefers-reduced-motion: reduce)")),Te.matches)}};class G{static testProp(t){if(!G.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in G.docStyle)return t[a];return t[0]}static create(t,a,l){const h=window.document.createElement(t);return a!==void 0&&(h.className=a),l&&l.appendChild(h),h}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){G.docStyle&&G.selectProp&&(G.userSelect=G.docStyle[G.selectProp],G.docStyle[G.selectProp]="none")}static enableDrag(){G.docStyle&&G.selectProp&&(G.docStyle[G.selectProp]=G.userSelect)}static setTransform(t,a){t.style[G.transformProp]=a}static addEventListener(t,a,l,h={}){t.addEventListener(a,l,"passive"in h?h:h.capture)}static removeEventListener(t,a,l,h={}){t.removeEventListener(a,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",G.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",G.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",G.suppressClickInternal,!0)},0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,l){const h=a.boundingClientRect;return new d.P((l.clientX-h.left)/a.x-t.clientLeft,(l.clientY-h.top)/a.y-t.clientTop)}static mousePos(t,a){const l=G.getScale(t);return G.getPoint(t,l,a)}static touchPos(t,a){const l=[],h=G.getScale(t);for(let m=0;m<a.length;m++)l.push(G.getPoint(t,h,a[m]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}G.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,G.selectProp=G.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),G.transformProp=G.testProp(["transform","WebkitTransform"]);const He={supported:!1,testSupport:function(p){!ht&&ke&&(pe?oe(p):Ke=p)}};let Ke,ke,ht=!1,pe=!1;function oe(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,ke),p.isContextLost())return;He.supported=!0}catch{}p.deleteTexture(t),ht=!0}var me;typeof document<"u"&&(ke=document.createElement("img"),ke.onload=()=>{Ke&&oe(Ke),Ke=null,pe=!0},ke.onerror=()=>{ht=!0,Ke=null},ke.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,a,l,h;p.resetRequestQueue=()=>{t=[],a=0,l=0,h={}},p.addThrottleControl=k=>{const E=l++;return h[E]=k,E},p.removeThrottleControl=k=>{delete h[k],v()},p.getImage=(k,E,D=!0)=>new Promise((z,N)=>{He.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),d.e(k,{type:"image"}),t.push({abortController:E,requestParameters:k,supportImageRefresh:D,state:"queued",onError:U=>{N(U)},onSuccess:U=>{z(U)}}),v()});const m=k=>d._(this,void 0,void 0,function*(){k.state="running";const{requestParameters:E,supportImageRefresh:D,onError:z,onSuccess:N,abortController:U}=k,Z=D===!1&&!d.i(self)&&!d.g(E.url)&&(!E.headers||Object.keys(E.headers).reduce((ae,ge)=>ae&&ge==="accept",!0));a++;const Q=Z?w(E,U):d.m(E,U);try{const ae=yield Q;delete k.abortController,k.state="completed",ae.data instanceof HTMLImageElement||d.b(ae.data)?N(ae):ae.data&&N({data:yield(H=ae.data,typeof createImageBitmap=="function"?d.d(H):d.f(H)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete k.abortController,z(ae)}finally{a--,v()}var H}),v=()=>{const k=(()=>{for(const E of Object.keys(h))if(h[E]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let E=a;E<k&&t.length>0;E++){const D=t.shift();D.abortController.signal.aborted?E--:m(D)}},w=(k,E)=>new Promise((D,z)=>{const N=new Image,U=k.url,Z=k.credentials;Z&&Z==="include"?N.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!d.s(U))&&(N.crossOrigin="anonymous"),E.signal.addEventListener("abort",()=>{N.src="",z(d.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,D({data:N})},N.onerror=()=>{N.onerror=N.onload=null,E.signal.aborted||z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=U})}(me||(me={})),me.resetRequestQueue();class De{constructor(t){this._transformRequestFn=t}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Ue(p){var t=new d.A(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var ze,Ge=function(p,t,a){return p[0]=t[0]-a[0],p[1]=t[1]-a[1],p[2]=t[2]-a[2],p};ze=new d.A(3),d.A!=Float32Array&&(ze[0]=0,ze[1]=0,ze[2]=0);var re=function(p){var t=p[0],a=p[1];return t*t+a*a};function ne(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const a=[];for(const{id:l,url:h}of p){const m=`${l}${h}`;a.indexOf(m)===-1&&(a.push(m),t.push({id:l,url:h}))}}return t}function fe(p,t,a){const l=p.split("?");return l[0]+=`${t}${a}`,l.join("?")}(function(){var p=new d.A(2);d.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Me{constructor(t,a,l,h){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(a,h)}update(t,a,l){const{width:h,height:m}=t,v=!(this.size&&this.size[0]===h&&this.size[1]===m||l),{context:w}=this,{gl:k}=w;if(this.useMipmap=!!(a&&a.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!a||a.premultiply!==!1)),v)this.size=[h,m],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||d.b(t)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,t):k.texImage2D(k.TEXTURE_2D,0,this.format,h,m,0,this.format,k.UNSIGNED_BYTE,t.data);else{const{x:E,y:D}=l||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||d.b(t)?k.texSubImage2D(k.TEXTURE_2D,0,E,D,k.RGBA,k.UNSIGNED_BYTE,t):k.texSubImage2D(k.TEXTURE_2D,0,E,D,h,m,k.RGBA,k.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(t,a,l){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),t!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,t),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||t),this.filter=t),a!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Oe(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class tt extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:l}of this.requestors)l(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const l=a.spriteData;a.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let l=!0;const h=a.data||a.spriteData;return this._validateStretch(a.stretchX,h&&h.width)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(a.stretchY,h&&h.height)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(a.content,a)||(this.fire(new d.j(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,a){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||a<h[1])return!1;l=h[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const l=a.spriteData,h=l&&l.width||a.data.width,m=l&&l.height||a.data.height;return!(t[0]<0||h<t[0]||t[1]<0||m<t[1]||t[2]<0||h<t[2]||t[3]<0||m<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==a.data.width||h.data.height!==a.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=h.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((a,l)=>{let h=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(h=!1);this.isLoaded()||h?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})})}_getImagesForIds(t){const a={};for(const l of t){let h=this.getImage(l);h||(this.fire(new d.k("styleimagemissing",{id:l})),h=this.getImage(l)),h?a[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],l=this.getImage(t);if(!l)return null;if(a&&a.position.version===l.version)return a.position;if(a)a.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new d.I(h,l);this.patterns[t]={bin:h,position:m}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Me(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const m in this.patterns)t.push(this.patterns[m].bin);const{w:a,h:l}=d.p(t),h=this.atlasImage;h.resize({width:a||1,height:l||1});for(const m in this.patterns){const{bin:v}=this.patterns[m],w=v.x+1,k=v.y+1,E=this.getImage(m).data,D=E.width,z=E.height;d.R.copy(E,h,{x:0,y:0},{x:w,y:k},{width:D,height:z}),d.R.copy(E,h,{x:0,y:z-1},{x:w,y:k-1},{width:D,height:1}),d.R.copy(E,h,{x:0,y:0},{x:w,y:k+z},{width:D,height:1}),d.R.copy(E,h,{x:D-1,y:0},{x:w-1,y:k},{width:1,height:z}),d.R.copy(E,h,{x:0,y:0},{x:w+D,y:k},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const l=this.getImage(a);l||d.w(`Image with ID: "${a}" was not found`),Oe(l)&&this.updateImage(a,l)}}}const dt=1e20;function dr(p,t,a,l,h,m,v,w,k){for(let E=t;E<t+l;E++)Jt(p,a*m+E,m,h,v,w,k);for(let E=a;E<a+h;E++)Jt(p,E*m+t,1,l,v,w,k)}function Jt(p,t,a,l,h,m,v){m[0]=0,v[0]=-dt,v[1]=dt,h[0]=p[t];for(let w=1,k=0,E=0;w<l;w++){h[w]=p[t+w*a];const D=w*w;do{const z=m[k];E=(h[w]-h[z]+D-z*z)/(w-z)/2}while(E<=v[k]&&--k>-1);k++,m[k]=w,v[k]=E,v[k+1]=dt}for(let w=0,k=0;w<l;w++){for(;v[k+1]<w;)k++;const E=m[k],D=w-E;p[t+w*a]=h[E]+D*D}}class pt{constructor(t,a){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return d._(this,void 0,void 0,function*(){const a=[];for(const m in t)for(const v of t[m])a.push(this._getAndCacheGlyphsPromise(m,v));const l=yield Promise.all(a),h={};for(const{stack:m,id:v,glyph:w}of l)h[m]||(h[m]={}),h[m][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return h})}_getAndCacheGlyphsPromise(t,a){return d._(this,void 0,void 0,function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[a];if(h!==void 0)return{stack:t,id:a,glyph:h};if(h=this._tinySDF(l,t,a),h)return l.glyphs[a]=h,{stack:t,id:a,glyph:h};const m=Math.floor(a/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[m])return{stack:t,id:a,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[m]){const w=pt.loadGlyphRange(t,m,this.url,this.requestManager);l.requests[m]=w}const v=yield l.requests[m];for(const w in v)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=v[+w]);return l.ranges[m]=!0,{stack:t,id:a,glyph:v[a]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(d.u["CJK Unified Ideographs"](t)||d.u["Hangul Syllables"](t)||d.u.Hiragana(t)||d.u.Katakana(t))}_tinySDF(t,a,l){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let m=t.tinySDF;if(!m){let w="400";/bold/i.test(a)?w="900":/medium/i.test(a)?w="500":/light/i.test(a)&&(w="200"),m=t.tinySDF=new pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:w})}const v=m.draw(String.fromCharCode(l));return{id:l,bitmap:new d.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}pt.loadGlyphRange=function(p,t,a,l){return d._(this,void 0,void 0,function*(){const h=256*t,m=h+255,v=l.transformRequest(a.replace("{fontstack}",p).replace("{range}",`${h}-${m}`),"Glyphs"),w=yield d.l(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${m}`);const k={};for(const E of d.n(w.data))k[E.id]=E;return k})},pt.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:a=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:v="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=a;const w=this.size=p+4*t,k=this._createCanvas(w),E=this.ctx=k.getContext("2d",{willReadFrequently:!0});E.font=`${v} ${m} ${p}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(p),v=Math.ceil(a),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),k=Math.min(this.size-this.buffer,v+Math.ceil(l)),E=w+2*this.buffer,D=k+2*this.buffer,z=Math.max(E*D,0),N=new Uint8ClampedArray(z),U={data:N,width:E,height:D,glyphWidth:w,glyphHeight:k,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(w===0||k===0)return U;const{ctx:Z,buffer:Q,gridInner:H,gridOuter:ae}=this;Z.clearRect(Q,Q,w,k),Z.fillText(p,Q,Q+v);const ge=Z.getImageData(Q,Q,w,k);ae.fill(dt,0,z),H.fill(0,0,z);for(let Y=0;Y<k;Y++)for(let _e=0;_e<w;_e++){const Ce=ge.data[4*(Y*w+_e)+3]/255;if(Ce===0)continue;const Pe=(Y+Q)*E+_e+Q;if(Ce===1)ae[Pe]=0,H[Pe]=dt;else{const Re=.5-Ce;ae[Pe]=Re>0?Re*Re:0,H[Pe]=Re<0?Re*Re:0}}dr(ae,0,0,E,D,E,this.f,this.v,this.z),dr(H,Q,Q,w,k,E,this.f,this.v,this.z);for(let Y=0;Y<z;Y++){const _e=Math.sqrt(ae[Y])-Math.sqrt(H[Y]);N[Y]=Math.round(255-255*(_e/this.radius+this.cutoff))}return U}};class Qe{constructor(){this.specification=d.v.light.position}possiblyEvaluate(t,a){return d.y(t.expression.evaluate(a))}interpolate(t,a,l){return{x:d.z.number(t.x,a.x,l),y:d.z.number(t.y,a.y,l),z:d.z.number(t.z,a.z,l)}}}let Xe;class It extends d.E{constructor(t){super(),Xe=Xe||new d.q({anchor:new d.D(d.v.light.anchor),position:new Qe,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(Xe),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(d.r,t,a))for(const l in t){const h=t[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,l){return(!l||l.validate!==!1)&&d.t(this,t.call(d.x,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}class $t{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const l=t.join(",")+String(a);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,a)),this.dashEntry[l]}getDashRanges(t,a,l){const h=[];let m=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,w=!0;h.push({left:m,right:v,isDash:w,zeroLength:t[0]===0});let k=t[0];for(let E=1;E<t.length;E++){w=!w;const D=t[E];m=k*l,k+=D,v=k*l,h.push({left:m,right:v,isDash:w,zeroLength:D===0})}return h}addRoundDash(t,a,l){const h=a/2;for(let m=-l;m<=l;m++){const v=this.width*(this.nextRow+l+m);let w=0,k=t[w];for(let E=0;E<this.width;E++){E/k.right>1&&(k=t[++w]);const D=Math.abs(E-k.left),z=Math.abs(E-k.right),N=Math.min(D,z);let U;const Z=m/l*(h+1);if(k.isDash){const Q=h-Math.abs(Z);U=Math.sqrt(N*N+Q*Q)}else U=h-Math.sqrt(N*N+Z*Z);this.data[v+E]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const k=t[w],E=t[w+1];k.zeroLength?t.splice(w,1):E&&E.isDash===k.isDash&&(E.left=k.left,t.splice(w,1))}const a=t[0],l=t[t.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const h=this.width*this.nextRow;let m=0,v=t[m];for(let w=0;w<this.width;w++){w/v.right>1&&(v=t[++m]);const k=Math.abs(w-v.left),E=Math.abs(w-v.right),D=Math.min(k,E);this.data[h+w]=Math.max(0,Math.min(255,(v.isDash?D:-D)+128))}}addDash(t,a){const l=a?7:0,h=2*l+1;if(this.nextRow+h>this.height)return d.w("LineAtlas out of space"),null;let m=0;for(let w=0;w<t.length;w++)m+=t[w];if(m!==0){const w=this.width/m,k=this.getDashRanges(t,this.width,w);a?this.addRoundDash(k,w,l):this.addRegularDash(k)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:m};return this.nextRow+=h,this.dirty=!0,v}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const nt="maplibre_preloaded_worker_pool";class er{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<er.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[nt]}numActive(){return Object.keys(this.active).length}}const mr=Math.floor(ie.hardwareConcurrency/2);let pr,tr;function ar(){return pr||(pr=new er),pr}er.workerCount=d.B(globalThis)?Math.max(Math.min(mr,3),1):1;class Sr{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const l=this.workerPool.acquire(a);for(let h=0;h<l.length;h++){const m=new d.C(l[h],a);m.name=`Worker ${h}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:t,data:a}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(a=>{a.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const l of this.actors)l.registerMessageHandler(t,a)}}function Bt(){return tr||(tr=new Sr(ar(),d.G),tr.registerMessageHandler("GR",(p,t,a)=>d.m(t,a))),tr}function gr(p,t){const a=d.F();return d.H(a,a,[1,1,0]),d.J(a,a,[.5*p.width,.5*p.height,1]),d.K(a,a,p.calculatePosMatrix(t.toUnwrapped()))}function Lr(p,t,a,l,h,m){const v=function(z,N,U){if(z)for(const Z of z){const Q=N[Z];if(Q&&Q.source===U&&Q.type==="fill-extrusion")return!0}else for(const Z in N){const Q=N[Z];if(Q.source===U&&Q.type==="fill-extrusion")return!0}return!1}(h&&h.layers,t,p.id),w=m.maxPitchScaleFactor(),k=p.tilesIn(l,w,v);k.sort(Ir);const E=[];for(const z of k)E.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,a,p._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,h,m,w,gr(p.transform,z.tileID))});const D=function(z){const N={},U={};for(const Z of z){const Q=Z.queryResults,H=Z.wrappedTileID,ae=U[H]=U[H]||{};for(const ge in Q){const Y=Q[ge],_e=ae[ge]=ae[ge]||{},Ce=N[ge]=N[ge]||[];for(const Pe of Y)_e[Pe.featureIndex]||(_e[Pe.featureIndex]=!0,Ce.push(Pe))}}return N}(E);for(const z in D)D[z].forEach(N=>{const U=N.feature,Z=p.getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=Z});return D}function Ir(p,t){const a=p.tileID,l=t.tileID;return a.overscaledZ-l.overscaledZ||a.canonical.y-l.canonical.y||a.wrap-l.wrap||a.canonical.x-l.canonical.x}function _r(p,t,a){return d._(this,void 0,void 0,function*(){let l=p;if(p.url?l=(yield d.h(t.transformRequest(p.url,"Source"),a)).data:yield ie.frameAsync(a),!l)return null;const h=d.L(d.e(l,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map(m=>m.id)),h})}class or{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof d.M?new d.M(t.lng,t.lat):d.M.convert(t),this}setSouthWest(t){return this._sw=t instanceof d.M?new d.M(t.lng,t.lat):d.M.convert(t),this}extend(t){const a=this._sw,l=this._ne;let h,m;if(t instanceof d.M)h=t,m=t;else{if(!(t instanceof or))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(or.convert(t)):this.extend(d.M.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(d.M.convert(t)):this;if(h=t._sw,m=t._ne,!h||!m)return this}return a||l?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new d.M(h.lng,h.lat),this._ne=new d.M(m.lng,m.lat)),this}getCenter(){return new d.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.M(this.getWest(),this.getNorth())}getSouthEast(){return new d.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:l}=d.M.convert(t);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(t){return t instanceof or?t:t&&new or(t)}static fromLngLat(t,a=0){const l=360*a/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new or(new d.M(t.lng-h,t.lat-l),new d.M(t.lng+h,t.lat+l))}}class Rr{constructor(t,a,l){this.bounds=or.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),l=Math.floor(d.N(this.bounds.getWest())*a),h=Math.floor(d.O(this.bounds.getNorth())*a),m=Math.ceil(d.N(this.bounds.getEast())*a),v=Math.ceil(d.O(this.bounds.getSouth())*a);return t.x>=l&&t.x<m&&t.y>=h&&t.y<v}}class Ee extends d.E{constructor(t,a,l,h){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.L(a,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield _r(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(d.e(this,t),t.bounds&&(this.tileBounds=new Rr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new d.j(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(t){return d._(this,void 0,void 0,function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((m,v)=>{t.reloadPromise={resolve:m,reject:v}})}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const m=yield t.actor.sendAsync({type:h,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,m)}catch(m){if(delete t.abortController,t.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ne extends d.E{constructor(t,a,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},a),d.e(this,d.L(a,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield _r(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,t&&(d.e(this,t),t.bounds&&(this.tileBounds=new Rr(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new d.j(t))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return d.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return d._(this,void 0,void 0,function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield me.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,m=h.gl,v=l.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new Me(h,v,m.RGBA,{useMipmap:!0}),t.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST),h.extTextureFilterAnisotropic&&m.texParameterf(m.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}})}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Ft extends Ne{constructor(t,a,l,h){super(t,a,l,h),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return d._(this,void 0,void 0,function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield me.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const m=h.data;this.map._refreshExpiredTiles&&h.cacheControl&&h.expires&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const v=d.b(m)&&d.S()?m:yield this.readImageNow(m),w={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const k=yield t.actor.sendAsync({type:"LDT",data:w});t.dem=k,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}})}readImageNow(t){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.U()){const a=t.width+2,l=t.height+2;try{return new d.R({width:a,height:l},yield d.V(t,-1,-1,a,l))}catch{}}return ie.getImageData(t,1)})}_getNeighboringTiles(t){const a=t.canonical,l=Math.pow(2,a.z),h=(a.x-1+l)%l,m=a.x===0?t.wrap-1:t.wrap,v=(a.x+1+l)%l,w=a.x+1===l?t.wrap+1:t.wrap,k={};return k[new d.Q(t.overscaledZ,m,a.z,h,a.y).key]={backfilled:!1},k[new d.Q(t.overscaledZ,w,a.z,v,a.y).key]={backfilled:!1},a.y>0&&(k[new d.Q(t.overscaledZ,m,a.z,h,a.y-1).key]={backfilled:!1},k[new d.Q(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},k[new d.Q(t.overscaledZ,w,a.z,v,a.y-1).key]={backfilled:!1}),a.y+1<l&&(k[new d.Q(t.overscaledZ,m,a.z,h,a.y+1).key]={backfilled:!1},k[new d.Q(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},k[new d.Q(t.overscaledZ,w,a.z,v,a.y+1).key]={backfilled:!1}),k}unloadTile(t){return d._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class ct extends d.E{constructor(t,a,l,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(h),this._data=a.data,this._options=d.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const m=d.W/this.tileSize;this.workerOptions=d.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*m,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*m,extent:d.W,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:d.W,radius:(a.clusterRadius||50)*m,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return d._(this,void 0,void 0,function*(){const t=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:l}})}_updateWorkerData(t){return d._(this,void 0,void 0,function*(){const a=d.e({type:this.type},this.workerOptions);t?a.dataDiff=t:typeof this._data=="string"?(a.request=this.map._requestManager.transformRequest(ie.resolveURL(this._data),"Source"),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:a});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let h=null;l.resourceTiming&&l.resourceTiming[this.id]&&(h=l.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&h&&h.length>0&&d.e(m,{resourceTiming:h}),this.fire(new d.k("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(t){return d._(this,void 0,void 0,function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:a,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,a==="RT")})}abortTile(t){return d._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return d._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Et=d.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Zt extends d.E{constructor(t,a,l,h){super(),this.id=t,this.dispatcher=l,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=a}load(t){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield me.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new d.j(a))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(d.Y.fromLngLat);this.tileID=function(h){let m=1/0,v=1/0,w=-1/0,k=-1/0;for(const N of h)m=Math.min(m,N.x),v=Math.min(v,N.y),w=Math.max(w,N.x),k=Math.max(k,N.y);const E=Math.max(w-m,k-v),D=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),z=Math.pow(2,D);return new d.a0(D,Math.floor((m+w)/2*z),Math.floor((v+k)/2*z))}(a),this.minzoom=this.maxzoom=this.tileID.z;const l=a.map(h=>this.tileID.getTilePoint(h)._round());return this._boundsArray=new d.Z,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,d.W,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,d.W),this._boundsArray.emplaceBack(l[2].x,l[2].y,d.W,d.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Me(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class rr extends Zt{constructor(t,a,l,h){super(t,a,l,h),this.roundZoom=!0,this.type="video",this.options=a}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield d.a2(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new d.j(a))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new d.j(new d.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new Me(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class lr extends Zt{constructor(t,a,l,h){super(t,a,l,h),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(v=>typeof v!="number"))||this.fire(new d.j(new d.a1(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a1(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new d.j(new d.a1(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a1(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a1(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,l=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,Et.members)),this.boundsSegments||(this.boundsSegments=d.$.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Me(a,this.canvas,l.RGBA,{premultiply:!0});let h=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,h=!0)}h&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Kr={},Wt=p=>{switch(p){case"geojson":return ct;case"image":return Zt;case"raster":return Ne;case"raster-dem":return Ft;case"vector":return Ee;case"video":return rr;case"canvas":return lr}return Kr[p]},li="RTLPluginLoaded";class ci extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Bt()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(a=>{throw this.status="error",a})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return d._(this,arguments,void 0,function*(a,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ie.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(li))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ze=null;function Fr(){return Ze||(Ze=new ci),Ze}class br{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=d.a3(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const a=t+this.timeAdded;a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,m){const v={};if(!m)return v;for(const w of h){const k=w.layerIds.map(E=>m.getLayer(E)).filter(Boolean);if(k.length!==0){w.layers=k,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(E=>k.filter(D=>D.id===E)[0]));for(const E of k)v[E.id]=w}}return v}(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof d.a5){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof d.a5&&m.hasRTLText){this.hasRTLText=!0,Fr().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(h).queryRadius(m))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new d.a4}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Me(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Me(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,l,h,m,v,w,k,E,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:m,scale:v,tileSize:this.tileSize,pixelPosMatrix:D,transform:k,params:w,queryPadding:this.queryPadding*E},t,a,l):{}}querySourceFeatures(t,a){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),m=a&&a.sourceLayer?a.sourceLayer:"",v=h._geojsonTileLayer||h[m];if(!v)return;const w=d.a6(a&&a.filter),{z:k,x:E,y:D}=this.tileID.canonical,z={z:k,x:E,y:D};for(let N=0;N<v.length;N++){const U=v.feature(N);if(w.needGeometry){const H=d.a7(U,!0);if(!w.filter(new d.a8(this.tileID.overscaledZ),H,this.tileID.canonical))continue}else if(!w.filter(new d.a8(this.tileID.overscaledZ),U))continue;const Z=l.getId(U,m),Q=new d.a9(U,k,E,D,Z);Q.tile=z,t.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const l=d.aa(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const m=this.expirationTime-a;m?this.expirationTime=l+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!a.style.hasLayer(h))continue;const m=this.buckets[h],v=m.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],k=t[v];if(!w||!k||Object.keys(k).length===0)continue;m.update(k,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const E=a&&a.style&&a.style.getLayer(h);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ie.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ie.now()+t}setDependencies(t,a){const l={};for(const h of a)l[h]=!0;this.dependencies[t]=l}hasDependency(t,a){for(const l of t){const h=this.dependencies[l];if(h){for(const m of a)if(h[m])return!0}}return!1}}class Li{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,l){const h=t.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const m={value:a,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const l=t.wrapped().key,h=a===void 0?0:this.data[l].indexOf(a),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const l in this.data)for(const h of this.data[l])t(h.value)||a.push(h);for(const l of a)this.remove(l.value.tileID,l)}}class si{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,l){const h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},d.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const m in this.state[t])m!==h&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const m in this.state[t][h])l[m]||(this.deletedStates[t][h][m]=null)}else for(const m in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][m]===null&&delete this.deletedStates[t][h][m]}removeFeatureState(t,a,l){if(this.deletedStates[t]===null)return;const h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,a){const l=String(a),h=d.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const m=this.deletedStates[t][a];if(m===null)return{};for(const v in m)delete h[v]}return h}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),d.e(this.state[h][v],this.stateChanges[h][v]),m[v]=this.state[h][v];l[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(this.deletedStates[h]===null)for(const v in this.state[h])m[v]={},this.state[h][v]={};else for(const v in this.deletedStates[h]){if(this.deletedStates[h][v]===null)this.state[h][v]={};else for(const w of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][w];m[v]=this.state[h][v]}l[h]=l[h]||{},d.e(l[h],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in t)t[h].setFeatureState(l,a)}}class Je extends d.E{constructor(t,a,l){super(),this.id=t,this.dispatcher=l,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,m,v,w)=>{const k=new(Wt(m.type))(h,m,v,w);if(k.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${k.id}`);return k})(t,a,l,this),this._tiles={},this._cache=new Li(0,h=>this._unloadTile(h)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new si,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const a=this._tiles[t];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,l){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,l)}catch(h){t.state="errored",h.status!==404?this._source.fire(new d.j(h,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new d.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const l=this._tiles[a];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Nt).map(t=>t.key)}getRenderableIds(t){const a=[];for(const l in this._tiles)this._isIdRenderable(l,t)&&a.push(this._tiles[l]);return t?a.sort((l,h)=>{const m=l.tileID,v=h.tileID,w=new d.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),k=new d.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||k.y-w.y||k.x-w.x}).map(l=>l.tileID.key):a.map(l=>l.tileID).sort(Nt).map(l=>l.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,a){return d._(this,void 0,void 0,function*(){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=a),yield this._loadTile(l,t,a))})}_tileLoaded(t,a,l){t.timeAdded=ie.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const a=this.getRenderableIds();for(let h=0;h<a.length;h++){const m=a[h];if(t.neighboringTiles&&t.neighboringTiles[m]){const v=this.getTileByID(m);l(t,v),l(v,t)}}function l(h,m){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let v=m.tileID.canonical.x-h.tileID.canonical.x;const w=m.tileID.canonical.y-h.tileID.canonical.y,k=Math.pow(2,h.tileID.canonical.z),E=m.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+k)===1?v+=k:Math.abs(v-k)===1&&(v-=k)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,v,w),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,l,h){for(const m in this._tiles){let v=this._tiles[m];if(h[m]||!v.hasData()||v.tileID.overscaledZ<=a||v.tileID.overscaledZ>l)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>a+1;){const E=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[E.key],v&&v.hasData()&&(w=E)}let k=w;for(;k.overscaledZ>a;)if(k=k.scaledTo(k.overscaledZ-1),t[k.key]){h[w.key]=w;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=a?l:null}for(let l=t.overscaledZ-1;l>=a;l--){const h=t.scaledTo(l),m=this._getLoadedTile(h);if(m)return m}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(a*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(m)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const l={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+a),l[m.tileID.key]=m}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}_updateCoveredAndRetainedTiles(t,a,l,h,m,v){const w={},k={},E=Object.keys(t),D=ie.now();for(const z of E){const N=t[z],U=this._tiles[z];if(!U||U.fadeEndTime!==0&&U.fadeEndTime<=D)continue;const Z=this.findLoadedParent(N,a),Q=this.findLoadedSibling(N),H=Z||Q||null;H&&(this._addTile(H.tileID),w[H.tileID.key]=H.tileID),k[z]=N}this._retainLoadedChildren(k,h,l,t);for(const z in w)t[z]||(this._coveredTiles[z]=!0,t[z]=w[z]);if(v){const z={},N={};for(const U of m)this._tiles[U.key].hasData()?z[U.key]=U:N[U.key]=U;for(const U in N){const Z=N[U].children(this._source.maxzoom);this._tiles[Z[0].key]&&this._tiles[Z[1].key]&&this._tiles[Z[2].key]&&this._tiles[Z[3].key]&&(z[Z[0].key]=t[Z[0].key]=Z[0],z[Z[1].key]=t[Z[1].key]=Z[1],z[Z[2].key]=t[Z[2].key]=Z[2],z[Z[3].key]=t[Z[3].key]=Z[3],delete N[U])}for(const U in N){const Z=N[U],Q=this.findLoadedParent(Z,this._source.minzoom),H=this.findLoadedSibling(Z),ae=Q||H||null;if(ae){z[ae.tileID.key]=t[ae.tileID.key]=ae.tileID;for(const ge in z)z[ge].isChildOf(ae.tileID)&&delete z[ge]}}for(const U in this._tiles)z[U]||(this._coveredTiles[U]=!0)}}update(t,a){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new d.Q(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(l=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a}),this._source.hasTile&&(l=l.filter(D=>this._source.hasTile(D)))):l=[];const h=t.coveringZoomLevel(this._source),m=Math.max(h-Je.maxOverzooming,this._source.minzoom),v=Math.max(h+Je.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const D={};for(const z of l)if(z.canonical.z>this._source.minzoom){const N=z.scaledTo(z.canonical.z-1);D[N.key]=N;const U=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));D[U.key]=U}l=l.concat(Object.values(D))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(l,h);Vt(this._source.type)&&this._updateCoveredAndRetainedTiles(k,m,v,h,l,a);for(const D in k)this._tiles[D].clearFadeHold();const E=d.ab(this._tiles,k);for(const D of E){const z=this._tiles[D];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(D)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var l;const h={},m={},v=Math.max(a-Je.maxOverzooming,this._source.minzoom),w=Math.max(a+Je.maxUnderzooming,this._source.minzoom),k={};for(const E of t){const D=this._addTile(E);h[E.key]=E,D.hasData()||a<this._source.maxzoom&&(k[E.key]=E)}this._retainLoadedChildren(k,a,w,h);for(const E of t){let D=this._tiles[E.key];if(D.hasData())continue;if(a+1>this._source.maxzoom){const N=E.children(this._source.maxzoom)[0],U=this.getTile(N);if(U&&U.hasData()){h[N.key]=N;continue}}else{const N=E.children(this._source.maxzoom);if(h[N[0].key]&&h[N[1].key]&&h[N[2].key]&&h[N[3].key])continue}let z=D.wasRequested();for(let N=E.overscaledZ-1;N>=v;--N){const U=E.scaledTo(N);if(m[U.key])break;if(m[U.key]=!0,D=this.getTile(U),!D&&z&&(D=this._addTile(U)),D){const Z=D.hasData();if((Z||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||z)&&(h[U.key]=U),z=D.wasRequested(),Z)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let l,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}a.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;h=m}for(const m of a)this._loadedParentTiles[m]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const a=this._tiles[t].tileID,l=this._getLoadedTile(a);this._loadedSiblingTiles[a.key]=l}}_addTile(t){let a=this._tiles[t.key];if(a)return a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const l=a;return a||(a=new br(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._tiles[t.key]=a,l||this._source.fire(new d.k("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=a.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){const a=t.sourceDataType;t.dataType==="source"&&a==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&a==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,a,l){const h=[],m=this.transform;if(!m)return h;const v=l?m.getCameraQueryGeometry(t):t,w=t.map(Z=>m.pointCoordinate(Z,this.terrain)),k=v.map(Z=>m.pointCoordinate(Z,this.terrain)),E=this.getIds();let D=1/0,z=1/0,N=-1/0,U=-1/0;for(const Z of k)D=Math.min(D,Z.x),z=Math.min(z,Z.y),N=Math.max(N,Z.x),U=Math.max(U,Z.y);for(let Z=0;Z<E.length;Z++){const Q=this._tiles[E[Z]];if(Q.holdingForFade())continue;const H=Q.tileID,ae=Math.pow(2,m.zoom-Q.tileID.overscaledZ),ge=a*Q.queryPadding*d.W/Q.tileSize/ae,Y=[H.getTilePoint(new d.Y(D,z)),H.getTilePoint(new d.Y(N,U))];if(Y[0].x-ge<d.W&&Y[0].y-ge<d.W&&Y[1].x+ge>=0&&Y[1].y+ge>=0){const _e=w.map(Pe=>H.getTilePoint(Pe)),Ce=k.map(Pe=>H.getTilePoint(Pe));h.push({tile:Q,tileID:H,queryGeometry:_e,cameraQueryGeometry:Ce,scale:ae})}}return h}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of a)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Vt(this._source.type)){const t=ie.now();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=t)return!0}return!1}setFeatureState(t,a,l){this._state.updateState(t=t||"_geojsonTileLayer",a,l)}removeFeatureState(t,a,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,l)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,l){const h=this._tiles[t];h&&h.setDependencies(a,l)}reloadTilesForDependencies(t,a){for(const l in this._tiles)this._tiles[l].hasDependency(t,a)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(t,a))}}function Nt(p,t){const a=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||l-a||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function Vt(p){return p==="raster"||p==="image"||p==="video"}Je.maxOverzooming=10,Je.maxUnderzooming=3;class ui{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=d.ac(t,0,1);let a=1,l=this._distances[a];const h=t*this.paddedLength+this.padding;for(;l<h&&a<this._distances.length;)l=this._distances[++a];const m=a-1,v=this._distances[m],w=l-v,k=w>0?(h-v)/w:0;return this.points[m].mult(1-k).add(this.points[a].mult(k))}}function Vi(p,t){let a=!0;return p==="always"||p!=="never"&&t!=="never"||(a=!1),a}class Kt{constructor(t,a,l){const h=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(a/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)h.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,l,h,m){this._forEachCell(a,l,h,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m)}insertCircle(t,a,l,h){this._forEachCell(a-h,l-h,a+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,a,l,h,m,v){this.boxCells[m].push(v)}_insertCircleCell(t,a,l,h,m,v){this.circleCells[m].push(v)}_query(t,a,l,h,m,v,w){if(l<0||t>this.width||h<0||a>this.height)return[];const k=[];if(t<=0&&a<=0&&this.width<=l&&this.height<=h){if(m)return[{key:null,x1:t,y1:a,x2:l,y2:h}];for(let E=0;E<this.boxKeys.length;E++)k.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const D=this.circles[3*E],z=this.circles[3*E+1],N=this.circles[3*E+2];k.push({key:this.circleKeys[E],x1:D-N,y1:z-N,x2:D+N,y2:z+N})}}else this._forEachCell(t,a,l,h,this._queryCell,k,{hitTest:m,overlapMode:v,seenUids:{box:{},circle:{}}},w);return k}query(t,a,l,h){return this._query(t,a,l,h,!1,null)}hitTest(t,a,l,h,m,v){return this._query(t,a,l,h,!0,m,v).length>0}hitTestCircle(t,a,l,h,m){const v=t-l,w=t+l,k=a-l,E=a+l;if(w<0||v>this.width||E<0||k>this.height)return!1;const D=[];return this._forEachCell(v,k,w,E,this._queryCellCircle,D,{hitTest:!0,overlapMode:h,circle:{x:t,y:a,radius:l},seenUids:{box:{},circle:{}}},m),D.length>0}_queryCell(t,a,l,h,m,v,w,k){const{seenUids:E,hitTest:D,overlapMode:z}=w,N=this.boxCells[m];if(N!==null){const Z=this.bboxes;for(const Q of N)if(!E.box[Q]){E.box[Q]=!0;const H=4*Q,ae=this.boxKeys[Q];if(t<=Z[H+2]&&a<=Z[H+3]&&l>=Z[H+0]&&h>=Z[H+1]&&(!k||k(ae))&&(!D||!Vi(z,ae.overlapMode))&&(v.push({key:ae,x1:Z[H],y1:Z[H+1],x2:Z[H+2],y2:Z[H+3]}),D))return!0}}const U=this.circleCells[m];if(U!==null){const Z=this.circles;for(const Q of U)if(!E.circle[Q]){E.circle[Q]=!0;const H=3*Q,ae=this.circleKeys[Q];if(this._circleAndRectCollide(Z[H],Z[H+1],Z[H+2],t,a,l,h)&&(!k||k(ae))&&(!D||!Vi(z,ae.overlapMode))){const ge=Z[H],Y=Z[H+1],_e=Z[H+2];if(v.push({key:ae,x1:ge-_e,y1:Y-_e,x2:ge+_e,y2:Y+_e}),D)return!0}}}return!1}_queryCellCircle(t,a,l,h,m,v,w,k){const{circle:E,seenUids:D,overlapMode:z}=w,N=this.boxCells[m];if(N!==null){const Z=this.bboxes;for(const Q of N)if(!D.box[Q]){D.box[Q]=!0;const H=4*Q,ae=this.boxKeys[Q];if(this._circleAndRectCollide(E.x,E.y,E.radius,Z[H+0],Z[H+1],Z[H+2],Z[H+3])&&(!k||k(ae))&&!Vi(z,ae.overlapMode))return v.push(!0),!0}}const U=this.circleCells[m];if(U!==null){const Z=this.circles;for(const Q of U)if(!D.circle[Q]){D.circle[Q]=!0;const H=3*Q,ae=this.circleKeys[Q];if(this._circlesCollide(Z[H],Z[H+1],Z[H+2],E.x,E.y,E.radius)&&(!k||k(ae))&&!Vi(z,ae.overlapMode))return v.push(!0),!0}}}_forEachCell(t,a,l,h,m,v,w,k){const E=this._convertToXCellCoord(t),D=this._convertToYCellCoord(a),z=this._convertToXCellCoord(l),N=this._convertToYCellCoord(h);for(let U=E;U<=z;U++)for(let Z=D;Z<=N;Z++)if(m.call(this,t,a,l,h,this.xCellCount*Z+U,v,w,k))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,l,h,m,v){const w=h-t,k=m-a,E=l+v;return E*E>w*w+k*k}_circleAndRectCollide(t,a,l,h,m,v,w){const k=(v-h)/2,E=Math.abs(t-(h+k));if(E>k+l)return!1;const D=(w-m)/2,z=Math.abs(a-(m+D));if(z>D+l)return!1;if(E<=k||z<=D)return!0;const N=E-k,U=z-D;return N*N+U*U<=l*l}}function as(p,t,a,l,h){const m=d.F();return t?(d.J(m,m,[1/h,1/h,1]),a||d.ad(m,m,l.angle)):d.K(m,l.labelPlaneMatrix,p),m}function os(p,t,a,l,h){if(t){const m=d.ae(p);return d.J(m,m,[h,h,1]),a||d.ad(m,m,-l.angle),m}return l.glCoordMatrix}function Ii(p,t,a){let l;a?(l=[p.x,p.y,a(p.x,p.y),1],d.af(l,l,t)):(l=[p.x,p.y,0,1],function(m,v,w){const k=v[0],E=v[1];m[0]=w[0]*k+w[4]*E+w[12],m[1]=w[1]*k+w[5]*E+w[13],m[3]=w[3]*k+w[7]*E+w[15]}(l,l,t));const h=l[3];return{point:new d.P(l[0]/h,l[1]/h),signedDistanceFromCamera:h,isOccluded:!1}}function K(p,t){return .5+p/t*.5}function R(p,t){return p.x>=-t[0]&&p.x<=t[0]&&p.y>=-t[1]&&p.y<=t[1]}function B(p,t,a,l,h,m,v,w,k,E,D,z,N,U,Z){const Q=l?p.textSizeData:p.iconSizeData,H=d.ag(Q,a.transform.zoom),ae=[256/a.width*2+1,256/a.height*2+1],ge=l?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ge.clear();const Y=p.lineVertexArray,_e=l?p.text.placedSymbolArray:p.icon.placedSymbolArray,Ce=a.transform.width/a.transform.height;let Pe=!1;for(let Re=0;Re<_e.length;Re++){const We=_e.get(Re);if(We.hidden||We.writingMode===d.ah.vertical&&!Pe){Lt(We.numGlyphs,ge);continue}Pe=!1;const lt=Ii(new d.P(We.anchorX,We.anchorY),t,Z);if(!R(lt.point,ae)){Lt(We.numGlyphs,ge);continue}const _t=K(a.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),et=d.ai(Q,H,We),st=v?et/_t:et*_t,wt={getElevation:Z,labelPlaneMatrix:h,lineVertexArray:Y,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:E,tileAnchorPoint:new d.P(We.anchorX,We.anchorY),unwrappedTileID:D,width:z,height:N,translation:U},Gt=he(wt,We,st,!1,w,t,m,p.glyphOffsetArray,ge,Ce,k);Pe=Gt.useVertical,(Gt.notEnoughRoom||Pe||Gt.needsFlipping&&he(wt,We,st,!0,w,t,m,p.glyphOffsetArray,ge,Ce,k).notEnoughRoom)&&Lt(We.numGlyphs,ge)}l?p.text.dynamicLayoutVertexBuffer.updateData(ge):p.icon.dynamicLayoutVertexBuffer.updateData(ge)}function j(p,t,a,l,h,m,v,w){const k=m.glyphStartIndex+m.numGlyphs,E=m.lineStartIndex,D=m.lineStartIndex+m.lineLength,z=t.getoffsetX(m.glyphStartIndex),N=t.getoffsetX(k-1),U=Fe(p*z,a,l,h,m.segment,E,D,w,v);if(!U)return null;const Z=Fe(p*N,a,l,h,m.segment,E,D,w,v);return Z?w.projectionCache.anyProjectionOccluded?null:{first:U,last:Z}:null}function J(p,t,a,l){return p===d.ah.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*l?{useVertical:!0}:(p===d.ah.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function he(p,t,a,l,h,m,v,w,k,E,D){const z=a/24,N=t.lineOffsetX*z,U=t.lineOffsetY*z;let Z;if(t.numGlyphs>1){const Q=t.glyphStartIndex+t.numGlyphs,H=t.lineStartIndex,ae=t.lineStartIndex+t.lineLength,ge=j(z,w,N,U,l,t,D,p);if(!ge)return{notEnoughRoom:!0};const Y=Ii(ge.first.point,v,p.getElevation).point,_e=Ii(ge.last.point,v,p.getElevation).point;if(h&&!l){const Ce=J(t.writingMode,Y,_e,E);if(Ce)return Ce}Z=[ge.first];for(let Ce=t.glyphStartIndex+1;Ce<Q-1;Ce++)Z.push(Fe(z*w.getoffsetX(Ce),N,U,l,t.segment,H,ae,p,D));Z.push(ge.last)}else{if(h&&!l){const H=Ii(p.tileAnchorPoint,m,p.getElevation).point,ae=t.lineStartIndex+t.segment+1,ge=new d.P(p.lineVertexArray.getx(ae),p.lineVertexArray.gety(ae)),Y=Ii(ge,m,p.getElevation),_e=Y.signedDistanceFromCamera>0?Y.point:function(Pe,Re,We,lt,_t,et){return ye(Pe,Re,We,1,_t,et)}(p.tileAnchorPoint,ge,H,0,m,p),Ce=J(t.writingMode,H,_e,E);if(Ce)return Ce}const Q=Fe(z*w.getoffsetX(t.glyphStartIndex),N,U,l,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,p,D);if(!Q||p.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Z=[Q]}for(const Q of Z)d.aj(k,Q.point,Q.angle);return{}}function ye(p,t,a,l,h,m){const v=p.add(p.sub(t)._unit()),w=h!==void 0?Ii(v,h,m.getElevation).point:le(v.x,v.y,m).point,k=a.sub(w);return a.add(k._mult(l/k.mag()))}function be(p,t,a){const l=t.projectionCache;if(l.projections[p])return l.projections[p];const h=new d.P(t.lineVertexArray.getx(p),t.lineVertexArray.gety(p)),m=le(h.x,h.y,t);if(m.signedDistanceFromCamera>0)return l.projections[p]=m.point,l.anyProjectionOccluded=l.anyProjectionOccluded||m.isOccluded,m.point;const v=p-a.direction;return function(w,k,E,D,z){return ye(w,k,E,D,void 0,z)}(a.distanceFromAnchor===0?t.tileAnchorPoint:new d.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),h,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function le(p,t,a){const l=p+a.translation[0],h=t+a.translation[1];let m;return!a.pitchWithMap&&a.projection.useSpecialProjectionForSymbols?(m=a.projection.projectTileCoordinates(l,h,a.unwrappedTileID,a.getElevation),m.point.x=(.5*m.point.x+.5)*a.width,m.point.y=(.5*-m.point.y+.5)*a.height):(m=Ii(new d.P(l,h),a.labelPlaneMatrix,a.getElevation),m.isOccluded=!1),m}function Ie(p,t,a){return p._unit()._perp()._mult(t*a)}function je(p,t,a,l,h,m,v,w,k){if(w.projectionCache.offsets[p])return w.projectionCache.offsets[p];const E=a.add(t);if(p+k.direction<l||p+k.direction>=h)return w.projectionCache.offsets[p]=E,E;const D=be(p+k.direction,w,k),z=Ie(D.sub(a),v,k.direction),N=a.add(z),U=D.add(z);return w.projectionCache.offsets[p]=d.ak(m,E,N,U)||E,w.projectionCache.offsets[p]}function Fe(p,t,a,l,h,m,v,w,k){const E=l?p-t:p+t;let D=E>0?1:-1,z=0;l&&(D*=-1,z=Math.PI),D<0&&(z+=Math.PI);let N,U=D>0?m+h:m+h+1;w.projectionCache.cachedAnchorPoint?N=w.projectionCache.cachedAnchorPoint:(N=le(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=N);let Z,Q,H=N,ae=N,ge=0,Y=0;const _e=Math.abs(E),Ce=[];let Pe;for(;ge+Y<=_e;){if(U+=D,U<m||U>=v)return null;ge+=Y,ae=H,Q=Z;const lt={absOffsetX:_e,direction:D,distanceFromAnchor:ge,previousVertex:ae};if(H=be(U,w,lt),a===0)Ce.push(ae),Pe=H.sub(ae);else{let _t;const et=H.sub(ae);_t=et.mag()===0?Ie(be(U+D,w,lt).sub(H),a,D):Ie(et,a,D),Q||(Q=ae.add(_t)),Z=je(U,_t,H,m,v,Q,a,w,lt),Ce.push(Q),Pe=Z.sub(Q)}Y=Pe.mag()}const Re=Pe._mult((_e-ge)/Y)._add(Q||ae),We=z+Math.atan2(H.y-ae.y,H.x-ae.x);return Ce.push(Re),{point:Re,angle:k?We:0,path:Ce}}const Le=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Lt(p,t){for(let a=0;a<p;a++){const l=t.length;t.resize(l+4),t.float32.set(Le,3*l)}}const zt=100;class nr{constructor(t,a,l=new Kt(t.width+200,t.height+200,25),h=new Kt(t.width+200,t.height+200,25)){this.transform=t,this.mapProjection=a,this.grid=l,this.ignoredGrid=h,this.pitchFactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+zt,this.screenBottomBoundary=t.height+zt,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,l,h,m,v,w,k,E,D,z){const N=t.anchorPointX+k[0],U=t.anchorPointY+k[1],Z=this.projectAndGetPerspectiveRatio(h,N,U,m,D),Q=this._projectCollisionBox(t,l,h,m,v,w,k,Z,D,z),[H,ae,ge,Y]=Q.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?Q.allPointsOccluded:this.mapProjection.isOccluded(N,U,m))||Z.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(H,ae,ge,Y)||a!=="always"&&this.grid.hitTest(H,ae,ge,Y,a,E)?{box:[H,ae,ge,Y],placeable:!1,offscreen:!1}:{box:[H,ae,ge,Y],placeable:!0,offscreen:this.isOffscreen(H,ae,ge,Y)}}placeCollisionCircles(t,a,l,h,m,v,w,k,E,D,z,N,U,Z,Q,H){const ae=[],ge=new d.P(a.anchorX,a.anchorY),Y=this.getPerspectiveRatio(v,ge.x,ge.y,w,H),_e=(z?m/Y:m*Y)/d.ap,Ce={getElevation:H,labelPlaneMatrix:k,lineVertexArray:l,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ge,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:Q},Pe=j(_e,h,a.lineOffsetX*_e,a.lineOffsetY*_e,!1,a,!1,Ce);let Re=!1,We=!1,lt=!0;if(Pe){const _t=.5*U*Y+Z,et=new d.P(-100,-100),st=new d.P(this.screenRightBoundary,this.screenBottomBoundary),wt=new ui,Gt=Pe.first,ot=Pe.last;let mt=[];for(let Yt=Gt.path.length-1;Yt>=1;Yt--)mt.push(Gt.path[Yt]);for(let Yt=1;Yt<ot.path.length;Yt++)mt.push(ot.path[Yt]);const Ut=2.5*_t;if(E){const Yt=this.projectPathToScreenSpace(mt,Ce,E);mt=Yt.some(fr=>fr.signedDistanceFromCamera<=0)?[]:Yt.map(fr=>fr.point)}let Zr=[];if(mt.length>0){const Yt=mt[0].clone(),fr=mt[0].clone();for(let Hr=1;Hr<mt.length;Hr++)Yt.x=Math.min(Yt.x,mt[Hr].x),Yt.y=Math.min(Yt.y,mt[Hr].y),fr.x=Math.max(fr.x,mt[Hr].x),fr.y=Math.max(fr.y,mt[Hr].y);Zr=Yt.x>=et.x&&fr.x<=st.x&&Yt.y>=et.y&&fr.y<=st.y?[mt]:fr.x<et.x||Yt.x>st.x||fr.y<et.y||Yt.y>st.y?[]:d.al([mt],et.x,et.y,st.x,st.y)}for(const Yt of Zr){wt.reset(Yt,.25*_t);let fr=0;fr=wt.length<=.5*_t?1:Math.ceil(wt.paddedLength/Ut)+1;for(let Hr=0;Hr<fr;Hr++){const Zi=Hr/Math.max(fr-1,1),Nn=wt.lerp(Zi),Wr=Nn.x+zt,Qi=Nn.y+zt;ae.push(Wr,Qi,_t,0);const en=Wr-_t,Hi=Qi-_t,Wi=Wr+_t,On=Qi+_t;if(lt=lt&&this.isOffscreen(en,Hi,Wi,On),We=We||this.isInsideGrid(en,Hi,Wi,On),t!=="always"&&this.grid.hitTestCircle(Wr,Qi,_t,t,N)&&(Re=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Re}}}}return{circles:!D&&Re||!We||Y<this.perspectiveRatioCutoff?[]:ae,offscreen:lt,collisionDetected:Re}}projectPathToScreenSpace(t,a,l){return t.map(h=>Ii(h,l,a.getElevation))}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let l=1/0,h=1/0,m=-1/0,v=-1/0;for(const D of t){const z=new d.P(D.x+zt,D.y+zt);l=Math.min(l,z.x),h=Math.min(h,z.y),m=Math.max(m,z.x),v=Math.max(v,z.y),a.push(z)}const w=this.grid.query(l,h,m,v).concat(this.ignoredGrid.query(l,h,m,v)),k={},E={};for(const D of w){const z=D.key;if(k[z.bucketInstanceId]===void 0&&(k[z.bucketInstanceId]={}),k[z.bucketInstanceId][z.featureIndex])continue;const N=[new d.P(D.x1,D.y1),new d.P(D.x2,D.y1),new d.P(D.x2,D.y2),new d.P(D.x1,D.y2)];d.am(a,N)&&(k[z.bucketInstanceId][z.featureIndex]=!0,E[z.bucketInstanceId]===void 0&&(E[z.bucketInstanceId]=[]),E[z.bucketInstanceId].push(z.featureIndex))}return E}insertCollisionBox(t,a,l,h,m,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:v,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,l,h,m,v){const w=l?this.ignoredGrid:this.grid,k={bucketInstanceId:h,featureIndex:m,collisionGroupID:v,overlapMode:a};for(let E=0;E<t.length;E+=4)w.insertCircle(k,t[E],t[E+1],t[E+2])}projectAndGetPerspectiveRatio(t,a,l,h,m){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(a,l,h,m):Ii(new d.P(a,l),t,m);return{point:new d.P((v.point.x+1)/2*this.transform.width+zt,(1-v.point.y)/2*this.transform.height+zt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}getPerspectiveRatio(t,a,l,h,m){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(a,l,h,m):Ii(new d.P(a,l),t,m);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(t,a,l,h){return l<zt||t>=this.screenRightBoundary||h<zt||a>this.screenBottomBoundary}isInsideGrid(t,a,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=d.an([]);return d.H(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,l,h,m,v,w,k,E,D){const z=a*k.perspectiveRatio;let N=new d.P(1,0),U=new d.P(0,1);const Z=new d.P(t.anchorPointX+w[0],t.anchorPointY+w[1]);if(v&&!m){const _t=this.projectAndGetPerspectiveRatio(l,Z.x+1,Z.y,h,E).point.sub(k.point).unit(),et=Math.atan(_t.y/_t.x)+(_t.x<0?Math.PI:0),st=Math.sin(et),wt=Math.cos(et);N=new d.P(wt,st),U=new d.P(-st,wt)}else if(!v&&m){const _t=-this.transform.angle,et=Math.sin(_t),st=Math.cos(_t);N=new d.P(st,et),U=new d.P(-et,st)}let Q=k.point,H=z;if(m){Q=Z;const _t=this.transform.zoom-Math.floor(this.transform.zoom);H=Math.pow(2,-_t),H*=this.mapProjection.getPitchedTextCorrection(this.transform,Z,h),D||(H*=d.ac(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}D&&(Q=Q.add(N.mult(D.x*H)).add(U.mult(D.y*H)));const ae=t.x1*H,ge=t.x2*H,Y=(ae+ge)/2,_e=t.y1*H,Ce=t.y2*H,Pe=(_e+Ce)/2,Re=[{offsetX:ae,offsetY:_e},{offsetX:Y,offsetY:_e},{offsetX:ge,offsetY:_e},{offsetX:ge,offsetY:Pe},{offsetX:ge,offsetY:Ce},{offsetX:Y,offsetY:Ce},{offsetX:ae,offsetY:Ce},{offsetX:ae,offsetY:Pe}];let We=[];for(const{offsetX:_t,offsetY:et}of Re)We.push(new d.P(Q.x+N.x*_t+U.x*et,Q.y+N.y*_t+U.y*et));let lt=!1;if(m){const _t=We.map(et=>this.projectAndGetPerspectiveRatio(l,et.x,et.y,h,E));lt=_t.some(et=>!et.isOccluded),We=_t.map(et=>et.point)}else lt=!0;return{box:d.ao(We),allPointsOccluded:!lt}}}function qt(p,t,a){return t*(d.W/(p.tileSize*Math.pow(2,a-p.tileID.overscaledZ)))}class yr{constructor(t,a,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Nr{constructor(t,a,l,h,m){this.text=new yr(t?t.text:null,a,l,m),this.icon=new yr(t?t.icon:null,a,h,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gr{constructor(t,a,l){this.text=t,this.icon=a,this.skipFade=l}}class pi{constructor(){this.invProjMatrix=d.F(),this.viewportMatrix=d.F(),this.circles=[]}}class Xt{constructor(t,a,l,h,m){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=m}}class ri{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:l=>l.collisionGroupID===a}}return this.collisionGroups[t]}}function fi(p,t,a,l,h){const{horizontalAlign:m,verticalAlign:v}=d.au(p);return new d.P(-(m-.5)*t+l[0]*h,-(v-.5)*a+l[1]*h)}class an{constructor(t,a,l,h,m,v){this.transform=t.clone(),this.terrain=l,this.collisionIndex=new nr(this.transform,a),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new ri(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(l,h)=>a.getElevation(t,l,h):null}getBucketParts(t,a,l,h){const m=l.getBucket(a),v=l.latestFeatureIndex;if(!m||!v||a.id!==m.layerIds[0])return;const w=l.collisionBoxArray,k=m.layers[0].layout,E=m.layers[0].paint,D=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),z=l.tileSize/d.W,N=l.tileID.toUnwrapped(),U=this.transform.calculatePosMatrix(N),Z=k.get("text-pitch-alignment")==="map",Q=k.get("text-rotation-alignment")==="map",H=qt(l,1,this.transform.zoom),ae=this.collisionIndex.mapProjection.translatePosition(this.transform,l,E.get("text-translate"),E.get("text-translate-anchor")),ge=this.collisionIndex.mapProjection.translatePosition(this.transform,l,E.get("icon-translate"),E.get("icon-translate-anchor")),Y=as(U,Z,Q,this.transform,H);let _e=null;if(Z){const Pe=os(U,Z,Q,this.transform,H);_e=d.K([],this.transform.labelPlaneMatrix,Pe)}this.retainedQueryData[m.bucketInstanceId]=new Xt(m.bucketInstanceId,v,m.sourceLayerIndex,m.index,l.tileID);const Ce={bucket:m,layout:k,translationText:ae,translationIcon:ge,posMatrix:U,unwrappedTileID:N,textLabelPlaneMatrix:Y,labelToScreenMatrix:_e,scale:D,textPixelRatio:z,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.ag(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(h)for(const Pe of m.sortKeyRanges){const{sortKey:Re,symbolInstanceStart:We,symbolInstanceEnd:lt}=Pe;t.push({sortKey:Re,symbolInstanceStart:We,symbolInstanceEnd:lt,parameters:Ce})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(t,a,l,h,m,v,w,k,E,D,z,N,U,Z,Q,H,ae,ge,Y){const _e=d.aq[t.textAnchor],Ce=[t.textOffset0,t.textOffset1],Pe=fi(_e,l,h,Ce,m),Re=this.collisionIndex.placeCollisionBox(a,N,k,E,D,w,v,H,z.predicate,Y,Pe);if((!ge||this.collisionIndex.placeCollisionBox(ge,N,k,E,D,w,v,ae,z.predicate,Y,Pe).placeable)&&Re.placeable){let We;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(We=this.prevPlacement.variableOffsets[U.crossTileID].anchor),U.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:Ce,width:l,height:h,anchor:_e,textBoxScale:m,prevAnchor:We},this.markUsedJustification(Z,_e,U,Q),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,Q,U),this.placedOrientations[U.crossTileID]=Q),{shift:Pe,placedGlyphBoxes:Re}}}placeLayerBucketPart(t,a,l){const{bucket:h,layout:m,translationText:v,translationIcon:w,posMatrix:k,unwrappedTileID:E,textLabelPlaneMatrix:D,labelToScreenMatrix:z,textPixelRatio:N,holdingForFade:U,collisionBoxArray:Z,partiallyEvaluatedTextSize:Q,collisionGroup:H}=t.parameters,ae=m.get("text-optional"),ge=m.get("icon-optional"),Y=d.ar(m,"text-overlap","text-allow-overlap"),_e=Y==="always",Ce=d.ar(m,"icon-overlap","icon-allow-overlap"),Pe=Ce==="always",Re=m.get("text-rotation-alignment")==="map",We=m.get("text-pitch-alignment")==="map",lt=m.get("icon-text-fit")!=="none",_t=m.get("symbol-z-order")==="viewport-y",et=_e&&(Pe||!h.hasIconData()||ge),st=Pe&&(_e||!h.hasTextData()||ae);!h.collisionArrays&&Z&&h.deserializeCollisionBoxes(Z);const wt=this._getTerrainElevationFunc(this.retainedQueryData[h.bucketInstanceId].tileID),Gt=(ot,mt,Ut)=>{var Zr,Yt;if(a[ot.crossTileID])return;if(U)return void(this.placements[ot.crossTileID]=new Gr(!1,!1,!1));let fr=!1,Hr=!1,Zi=!0,Nn=null,Wr={box:null,placeable:!1,offscreen:null},Qi={box:null,placeable:!1,offscreen:null},en=null,Hi=null,Wi=null,On=0,na=0,_l=0;mt.textFeatureIndex?On=mt.textFeatureIndex:ot.useRuntimeCollisionCircles&&(On=ot.featureIndex),mt.verticalTextFeatureIndex&&(na=mt.verticalTextFeatureIndex);const Ns=mt.textBox;if(Ns){const Fi=Bi=>{let Ki=d.ah.horizontal;if(h.allowVerticalPlacement&&!Bi&&this.prevPlacement){const bi=this.prevPlacement.placedOrientations[ot.crossTileID];bi&&(this.placedOrientations[ot.crossTileID]=bi,Ki=bi,this.markUsedOrientation(h,Ki,ot))}return Ki},Mn=(Bi,Ki)=>{if(h.allowVerticalPlacement&&ot.numVerticalGlyphVertices>0&&mt.verticalTextBox){for(const bi of h.writingModes)if(bi===d.ah.vertical?(Wr=Ki(),Qi=Wr):Wr=Bi(),Wr&&Wr.placeable)break}else Wr=Bi()},fs=ot.textAnchorOffsetStartIndex,sa=ot.textAnchorOffsetEndIndex;if(sa===fs){const Bi=(Ki,bi)=>{const Ar=this.collisionIndex.placeCollisionBox(Ki,Y,N,k,E,We,Re,v,H.predicate,wt);return Ar&&Ar.placeable&&(this.markUsedOrientation(h,bi,ot),this.placedOrientations[ot.crossTileID]=bi),Ar};Mn(()=>Bi(Ns,d.ah.horizontal),()=>{const Ki=mt.verticalTextBox;return h.allowVerticalPlacement&&ot.numVerticalGlyphVertices>0&&Ki?Bi(Ki,d.ah.vertical):{box:null,offscreen:null}}),Fi(Wr&&Wr.placeable)}else{let Bi=d.aq[(Yt=(Zr=this.prevPlacement)===null||Zr===void 0?void 0:Zr.variableOffsets[ot.crossTileID])===null||Yt===void 0?void 0:Yt.anchor];const Ki=(Ar,Qr,Lc)=>{const wi=Ar.x2-Ar.x1,Rc=Ar.y2-Ar.y1,So=ot.textBoxScale,aa=lt&&Ce==="never"?Qr:null;let ms=null,Mu=Y==="never"?1:2,xl="never";Bi&&Mu++;for(let Fc=0;Fc<Mu;Fc++){for(let bl=fs;bl<sa;bl++){const wl=h.textAnchorOffsets.get(bl);if(Bi&&wl.textAnchor!==Bi)continue;const qa=this.attemptAnchorPlacement(wl,Ar,wi,Rc,So,Re,We,N,k,E,H,xl,ot,h,Lc,v,w,aa,wt);if(qa&&(ms=qa.placedGlyphBoxes,ms&&ms.placeable))return fr=!0,Nn=qa.shift,ms}Bi?Bi=null:xl=Y}return l&&!ms&&(ms={box:this.collisionIndex.placeCollisionBox(Ns,"always",N,k,E,We,Re,v,H.predicate,wt,new d.P(0,0)).box,offscreen:!1,placeable:!1}),ms};Mn(()=>Ki(Ns,mt.iconBox,d.ah.horizontal),()=>{const Ar=mt.verticalTextBox;return h.allowVerticalPlacement&&(!Wr||!Wr.placeable)&&ot.numVerticalGlyphVertices>0&&Ar?Ki(Ar,mt.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Wr&&(fr=Wr.placeable,Zi=Wr.offscreen);const bi=Fi(Wr&&Wr.placeable);if(!fr&&this.prevPlacement){const Ar=this.prevPlacement.variableOffsets[ot.crossTileID];Ar&&(this.variableOffsets[ot.crossTileID]=Ar,this.markUsedJustification(h,Ar.anchor,ot,bi))}}}if(en=Wr,fr=en&&en.placeable,Zi=en&&en.offscreen,ot.useRuntimeCollisionCircles){const Fi=h.text.placedSymbolArray.get(ot.centerJustifiedTextSymbolIndex),Mn=d.ai(h.textSizeData,Q,Fi),fs=m.get("text-padding");Hi=this.collisionIndex.placeCollisionCircles(Y,Fi,h.lineVertexArray,h.glyphOffsetArray,Mn,k,E,D,z,l,We,H.predicate,ot.collisionCircleDiameter,fs,v,wt),Hi.circles.length&&Hi.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),fr=_e||Hi.circles.length>0&&!Hi.collisionDetected,Zi=Zi&&Hi.offscreen}if(mt.iconFeatureIndex&&(_l=mt.iconFeatureIndex),mt.iconBox){const Fi=Mn=>this.collisionIndex.placeCollisionBox(Mn,Ce,N,k,E,We,Re,w,H.predicate,wt,lt&&Nn?Nn:void 0);Qi&&Qi.placeable&&mt.verticalIconBox?(Wi=Fi(mt.verticalIconBox),Hr=Wi.placeable):(Wi=Fi(mt.iconBox),Hr=Wi.placeable),Zi=Zi&&Wi.offscreen}const Os=ae||ot.numHorizontalGlyphVertices===0&&ot.numVerticalGlyphVertices===0,vl=ge||ot.numIconVertices===0;Os||vl?vl?Os||(Hr=Hr&&fr):fr=Hr&&fr:Hr=fr=Hr&&fr;const Dc=Hr&&Wi.placeable;if(fr&&en.placeable&&this.collisionIndex.insertCollisionBox(en.box,Y,m.get("text-ignore-placement"),h.bucketInstanceId,Qi&&Qi.placeable&&na?na:On,H.ID),Dc&&this.collisionIndex.insertCollisionBox(Wi.box,Ce,m.get("icon-ignore-placement"),h.bucketInstanceId,_l,H.ID),Hi&&fr&&this.collisionIndex.insertCollisionCircles(Hi.circles,Y,m.get("text-ignore-placement"),h.bucketInstanceId,On,H.ID),l&&this.storeCollisionData(h.bucketInstanceId,Ut,mt,en,Wi,Hi),ot.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ot.crossTileID]=new Gr(fr||et,Hr||st,Zi||h.justReloaded),a[ot.crossTileID]=!0};if(_t){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ot=h.getSortedSymbolIndexes(this.transform.angle);for(let mt=ot.length-1;mt>=0;--mt){const Ut=ot[mt];Gt(h.symbolInstances.get(Ut),h.collisionArrays[Ut],Ut)}}else for(let ot=t.symbolInstanceStart;ot<t.symbolInstanceEnd;ot++)Gt(h.symbolInstances.get(ot),h.collisionArrays[ot],ot);if(l&&h.bucketInstanceId in this.collisionCircleArrays){const ot=this.collisionCircleArrays[h.bucketInstanceId];d.as(ot.invProjMatrix,k),ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}h.justReloaded=!1}storeCollisionData(t,a,l,h,m,v){if(l.textBox||l.iconBox){let w,k;this.collisionBoxArrays.has(t)?w=this.collisionBoxArrays.get(t):(w=new Map,this.collisionBoxArrays.set(t,w)),w.has(a)?k=w.get(a):(k={text:null,icon:null},w.set(a,k)),l.textBox&&(k.text=h.box),l.iconBox&&(k.icon=m.box)}if(v){let w=this.collisionCircleArrays[t];w===void 0&&(w=this.collisionCircleArrays[t]=new pi);for(let k=0;k<v.circles.length;k+=4)w.circles.push(v.circles[k+0]),w.circles.push(v.circles[k+1]),w.circles.push(v.circles[k+2]),w.circles.push(v.collisionDetected?1:0)}}markUsedJustification(t,a,l,h){let m;m=h===d.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.at(a)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=m>=0&&w!==m?0:l.crossTileID)}markUsedOrientation(t,a,l){const h=a===d.ah.horizontal||a===d.ah.horizontalOnly?a:0,m=a===d.ah.vertical?a:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)t.text.placedSymbolArray.get(w).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let l=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const h=a?a.symbolFadeChange(t):1,m=a?a.opacities:{},v=a?a.variableOffsets:{},w=a?a.placedOrientations:{};for(const k in this.placements){const E=this.placements[k],D=m[k];D?(this.opacities[k]=new Nr(D,h,E.text,E.icon),l=l||E.text!==D.text.placed||E.icon!==D.icon.placed):(this.opacities[k]=new Nr(null,h,E.text,E.icon,E.skipFade),l=l||E.text||E.icon)}for(const k in m){const E=m[k];if(!this.opacities[k]){const D=new Nr(E,h,!1,!1);D.isHidden()||(this.opacities[k]=D,l=l||E.text.placed||E.icon.placed)}}for(const k in v)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=v[k]);for(const k in w)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=w[k]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const l={};for(const h of a){const m=h.getBucket(t);m&&h.latestFeatureIndex&&t.id===m.layerIds[0]&&this.updateBucketOpacities(m,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(t,a,l,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0],v=m.layout,w=new Nr(null,0,!1,!1,!0),k=v.get("text-allow-overlap"),E=v.get("icon-allow-overlap"),D=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),z=v.get("text-rotation-alignment")==="map",N=v.get("text-pitch-alignment")==="map",U=v.get("icon-text-fit")!=="none",Z=new Nr(null,0,k&&(E||!t.hasIconData()||v.get("icon-optional")),E&&(k||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const Q=(ae,ge,Y)=>{for(let _e=0;_e<ge/4;_e++)ae.opacityVertexArray.emplaceBack(Y);ae.hasVisibleVertices=ae.hasVisibleVertices||Y!==eo},H=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ae=0;ae<t.symbolInstances.length;ae++){const ge=t.symbolInstances.get(ae),{numHorizontalGlyphVertices:Y,numVerticalGlyphVertices:_e,crossTileID:Ce}=ge;let Pe=this.opacities[Ce];l[Ce]?Pe=w:Pe||(Pe=Z,this.opacities[Ce]=Pe),l[Ce]=!0;const Re=ge.numIconVertices>0,We=this.placedOrientations[ge.crossTileID],lt=We===d.ah.vertical,_t=We===d.ah.horizontal||We===d.ah.horizontalOnly;if(Y>0||_e>0){const st=ln(Pe.text);Q(t.text,Y,lt?eo:st),Q(t.text,_e,_t?eo:st);const wt=Pe.text.isHidden();[ge.rightJustifiedTextSymbolIndex,ge.centerJustifiedTextSymbolIndex,ge.leftJustifiedTextSymbolIndex].forEach(mt=>{mt>=0&&(t.text.placedSymbolArray.get(mt).hidden=wt||lt?1:0)}),ge.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(ge.verticalPlacedTextSymbolIndex).hidden=wt||_t?1:0);const Gt=this.variableOffsets[ge.crossTileID];Gt&&this.markUsedJustification(t,Gt.anchor,ge,We);const ot=this.placedOrientations[ge.crossTileID];ot&&(this.markUsedJustification(t,"left",ge,ot),this.markUsedOrientation(t,ot,ge))}if(Re){const st=ln(Pe.icon),wt=!(U&&ge.verticalPlacedIconSymbolIndex&&lt);ge.placedIconSymbolIndex>=0&&(Q(t.icon,ge.numIconVertices,wt?st:eo),t.icon.placedSymbolArray.get(ge.placedIconSymbolIndex).hidden=Pe.icon.isHidden()),ge.verticalPlacedIconSymbolIndex>=0&&(Q(t.icon,ge.numVerticalIconVertices,wt?eo:st),t.icon.placedSymbolArray.get(ge.verticalPlacedIconSymbolIndex).hidden=Pe.icon.isHidden())}const et=H&&H.has(ae)?H.get(ae):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const st=t.collisionArrays[ae];if(st){let wt=new d.P(0,0);if(st.textBox||st.verticalTextBox){let Gt=!0;if(D){const ot=this.variableOffsets[Ce];ot?(wt=fi(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale),z&&wt._rotate(N?this.transform.angle:-this.transform.angle)):Gt=!1}if(st.textBox||st.verticalTextBox){let ot;st.textBox&&(ot=lt),st.verticalTextBox&&(ot=_t),on(t.textCollisionBox.collisionVertexArray,Pe.text.placed,!Gt||ot,et.text,wt.x,wt.y)}}if(st.iconBox||st.verticalIconBox){const Gt=!!(!_t&&st.verticalIconBox);let ot;st.iconBox&&(ot=Gt),st.verticalIconBox&&(ot=!Gt),on(t.iconCollisionBox.collisionVertexArray,Pe.icon.placed,ot,et.icon,U?wt.x:0,U?wt.y:0)}}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const ae=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ae.invProjMatrix,t.placementViewportMatrix=ae.viewportMatrix,t.collisionCircleArray=ae.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const l=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function on(p,t,a,l,h,m){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-zt,w=l[1]-zt,k=l[2]-zt,E=l[3]-zt;p.emplaceBack(t?1:0,a?1:0,h||0,m||0,v,w),p.emplaceBack(t?1:0,a?1:0,h||0,m||0,k,w),p.emplaceBack(t?1:0,a?1:0,h||0,m||0,k,E),p.emplaceBack(t?1:0,a?1:0,h||0,m||0,v,E)}const xi=Math.pow(2,25),ba=Math.pow(2,24),ru=Math.pow(2,17),Br=Math.pow(2,16),tc=Math.pow(2,9),rc=Math.pow(2,8),gn=Math.pow(2,1);function ln(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,a=Math.floor(127*p.opacity);return a*xi+t*ba+a*ru+t*Br+a*tc+t*rc+a*gn+t}const eo=0;function Ui(){return{isOccluded:(p,t,a)=>!1,getPitchedTextCorrection:(p,t,a)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(p,t,a,l){throw new Error("Not implemented.")},translatePosition:(p,t,a,l)=>function(h,m,v,w,k=!1){if(!v[0]&&!v[1])return[0,0];const E=k?w==="map"?h.angle:0:w==="viewport"?-h.angle:0;if(E){const D=Math.sin(E),z=Math.cos(E);v=[v[0]*z-v[1]*D,v[0]*D+v[1]*z]}return[k?v[0]:qt(m,v[0],h.zoom),k?v[1]:qt(m,v[1],h.zoom)]}(p,t,a,l),getCircleRadiusCorrection:p=>1}}class Ri{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,l,h,m){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(v,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((w,k)=>w.sortKey-k.sortKey));this._currentPartIndex<v.length;)if(a.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class $o{constructor(t,a,l,h,m,v,w,k){this.placement=new an(t,Ui(),a,v,w,k),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,a,l){const h=ie.now(),m=()=>!this._forceFullPlacement&&ie.now()-h>2;for(;this._currentPlacementIndex>=0;){const v=a[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Ri(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const cn=512/d.W/2;class mi{constructor(t,a,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let m=0;m<a.length;m++){const v=a.get(m),w=v.key,k=h.get(w);k?k.push(v):h.set(w,[v])}for(const[m,v]of h){const w={positions:v.map(k=>({x:Math.floor(k.anchorX*cn),y:Math.floor(k.anchorY*cn)})),crossTileIDs:v.map(k=>k.crossTileID)};if(w.positions.length>128){const k=new d.av(w.positions.length,16,Uint16Array);for(const{x:E,y:D}of w.positions)k.add(E,D);k.finish(),delete w.positions,w.index=k}this._symbolsByKey[m]=w}}getScaledCoordinates(t,a){const{x:l,y:h,z:m}=this.tileID.canonical,{x:v,y:w,z:k}=a.canonical,E=cn/Math.pow(2,k-m),D=(w*d.W+t.anchorY)*E,z=h*d.W*cn;return{x:Math.floor((v*d.W+t.anchorX)*E-l*d.W*cn),y:Math.floor(D-z)}}findMatches(t,a,l){const h=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let m=0;m<t.length;m++){const v=t.get(m);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const k=this.getScaledCoordinates(v,a);if(w.index){const E=w.index.range(k.x-h,k.y-h,k.x+h,k.y+h).sort();for(const D of E){const z=w.crossTileIDs[D];if(!l[z]){l[z]=!0,v.crossTileID=z;break}}}else if(w.positions)for(let E=0;E<w.positions.length;E++){const D=w.positions[E],z=w.crossTileIDs[E];if(Math.abs(D.x-k.x)<=h&&Math.abs(D.y-k.y)<=h&&!l[z]){l[z]=!0,v.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class to{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ws{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const l in this.indexes){const h=this.indexes[l],m={};for(const v in h){const w=h[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),m[w.tileID.key]=w}this.indexes[l]=m}this.lng=t}addBucket(t,a,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<a.symbolInstances.length;m++)a.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const m in this.indexes){const v=this.indexes[m];if(Number(m)>t.overscaledZ)for(const w in v){const k=v[w];k.tileID.isChildOf(t)&&k.findMatches(a.symbolInstances,t,h)}else{const w=v[t.scaledTo(Number(m)).key];w&&w.findMatches(a.symbolInstances,t,h)}}for(let m=0;m<a.symbolInstances.length;m++){const v=a.symbolInstances.get(m);v.crossTileID||(v.crossTileID=l.generate(),h[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new mi(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const l of a.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let a=!1;for(const l in this.indexes){const h=this.indexes[l];for(const m in h)t[h[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[m]),delete h[m],a=!0)}return a}}class ai{constructor(){this.layerIndexes={},this.crossTileIDs=new to,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new Ws);let m=!1;const v={};h.handleWrapJump(l);for(const w of a){const k=w.getBucket(t);k&&t.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(w.tileID,k,this.crossTileIDs)&&(m=!0),v[k.bucketInstanceId]=!0)}return h.removeStaleBuckets(v)&&(m=!0),m}pruneUnusedLayers(t){const a={};t.forEach(l=>{a[l]=!0});for(const l in this.layerIndexes)a[l]||delete this.layerIndexes[l]}}const Ks=(p,t)=>d.t(p,t&&t.filter(a=>a.identifier!=="source.canvas")),An=d.aw();class ro extends d.E{constructor(t,a={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const h=this.sourceCaches[l].getSource().type;h!=="vector"&&h!=="geojson"||this.sourceCaches[l].reload()}},this.map=t,this.dispatcher=new Sr(ar(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,h)=>this.getGlyphs(l,h)),this.dispatcher.registerMessageHandler("GI",(l,h)=>this.getImages(l,h)),this.imageManager=new tt,this.imageManager.setEventedParent(this),this.glyphManager=new pt(t._requestManager,a.localIdeographFontFamily),this.lineAtlas=new $t(256,512),this.crossTileSymbolIndex=new ai,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),Fr().on(li,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const h=this.sourceCaches[l.sourceId];if(!h)return;const m=h.getSource();if(m&&m.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===m.id&&this._validateLayer(w)}})}loadURL(t,a={},l){this.fire(new d.k("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController,d.h(h,this._loadStyleRequest).then(m=>{this._loadStyleRequest=null,this._load(m.data,a,l)}).catch(m=>{this._loadStyleRequest=null,m&&this.fire(new d.j(m))})}loadJSON(t,a={},l){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ie.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,l)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(An,{validate:!1})}_load(t,a,l){var h;const m=a.transformStyle?a.transformStyle(l,t):t;if(!a.validate||!Ks(this,d.x(m))){this._loaded=!0,this.stylesheet=m;for(const v in m.sources)this.addSource(v,m.sources[v],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new It(this.stylesheet.light),this.map.setTerrain((h=this.stylesheet.terrain)!==null&&h!==void 0?h:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const t=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(a=>a.id),this._layers={},this._serializedLayers=null;for(const a of t){const l=d.aA(a);l.setEventedParent(this,{layer:{id:a.id}}),this._layers[a.id]=l}}_loadSprite(t,a=!1,l=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,v,w,k){return d._(this,void 0,void 0,function*(){const E=ne(m),D=w>1?"@2x":"",z={},N={};for(const{id:U,url:Z}of E){const Q=v.transformRequest(fe(Z,D,".json"),"SpriteJSON");z[U]=d.h(Q,k);const H=v.transformRequest(fe(Z,D,".png"),"SpriteImage");N[U]=me.getImage(H,k)}return yield Promise.all([...Object.values(z),...Object.values(N)]),function(U,Z){return d._(this,void 0,void 0,function*(){const Q={};for(const H in U){Q[H]={};const ae=ie.getImageCanvasContext((yield Z[H]).data),ge=(yield U[H]).data;for(const Y in ge){const{width:_e,height:Ce,x:Pe,y:Re,sdf:We,pixelRatio:lt,stretchX:_t,stretchY:et,content:st,textFitWidth:wt,textFitHeight:Gt}=ge[Y];Q[H][Y]={data:null,pixelRatio:lt,sdf:We,stretchX:_t,stretchY:et,content:st,textFitWidth:wt,textFitHeight:Gt,spriteData:{width:_e,height:Ce,x:Pe,y:Re,context:ae}}}}return Q})}(z,N)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const v in m){this._spritesImagesIds[v]=[];const w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(k=>!(k in m)):[];for(const k of w)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in m[v]){const E=v==="default"?k:`${v}:${k}`;this._spritesImagesIds[v].push(E),E in this.imageManager.images?this.imageManager.updateImage(E,m[v][k],!1):this.imageManager.addImage(E,m[v][k]),a&&(this._changedImages[E]=!0)}}}).catch(m=>{this._spriteRequest=null,h=m,this.fire(new d.j(h))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),l&&l(h)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(t){const a=this.sourceCaches[t.source];if(!a)return;const l=t.sourceLayer;if(!l)return;const h=a.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.j(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const a=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a);const l=[];for(const h of t)a[h]&&l.push(a[h]);return l}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const l of a){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const h=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(h.length||m.length)&&this._updateWorkerLayers(h,m);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.sourceCaches){const m=this.sourceCaches[h];l[h]=m.used,m.used=!1}for(const h of this._order){const m=this._layers[h];m.recalculate(t,this._availableImages),!m.isHidden(t.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const h in l){const m=this.sourceCaches[h];!!l[h]!=!!m.used&&m.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.z=t.zoom,a&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var l;this._checkLoaded();const h=this.serialize();if(t=a.transformStyle?a.transformStyle(h,t):t,((l=a.validate)===null||l===void 0||l)&&Ks(this,d.x(t)))return!1;(t=d.aB(t)).layers=d.az(t.layers);const m=d.aC(h,t),v=this._getOperationsToPerform(m);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],l=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":a.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":a.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":a.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":a.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":a.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":a.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":a.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":a.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":a.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":a.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":a.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":a.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":a.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setTransition":a.push(()=>{});break;default:l.push(h.command)}return{operations:a,unimplemented:l}}addImage(t,a){if(this.getImage(t))return this.fire(new d.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new d.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,l={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(d.x.source,`sources.${t}`,a,null,l))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const h=this.sourceCaches[t]=new Je(t,a,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t})),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new d.j(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const a=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],a.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.sourceCaches[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(a),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,a,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new d.j(new Error(`Layer "${h}" already exists on this map.`)));let m;if(t.type==="custom"){if(Ks(this,d.aD(t)))return;m=d.aA(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=d.aB(t),t=d.e(t,{source:h})),this._validate(d.x.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;m=d.aA(t),this._validateLayer(m),m.setEventedParent(this,{layer:{id:h}})}const v=a?this._order.indexOf(a):this._order.length;if(a&&v===-1)this.fire(new d.j(new Error(`Cannot add layer "${h}" before non-existing layer "${a}".`)));else{if(this._order.splice(v,0,h),this._layerOrderChanged=!0,this._layers[h]=m,this._removedLayers[h]&&m.source&&m.type!=="custom"){const w=this._removedLayers[h];delete this._removedLayers[h],w.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new d.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=a?this._order.indexOf(a):this._order.length;a&&h===-1?this.fire(new d.j(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===a&&h.maxzoom===l||(a!=null&&(h.minzoom=a),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!d.aE(h.filter,a))return a==null?(h.filter=void 0,void this._updateLayer(h)):void(this._validate(d.x.filter,`layers.${h.id}.filter`,a,null,l)||(h.filter=d.aB(a),this._updateLayer(h)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return d.aB(this.getLayer(t).filter)}setLayoutProperty(t,a,l,h={}){this._checkLoaded();const m=this.getLayer(t);m?d.aE(m.getLayoutProperty(a),l)||(m.setLayoutProperty(a,l,h),this._updateLayer(m)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const l=this.getLayer(t);if(l)return l.getLayoutProperty(a);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,l,h={}){this._checkLoaded();const m=this.getLayer(t);m?d.aE(m.getPaintProperty(a),l)||(m.setPaintProperty(a,l,h)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const l=t.source,h=t.sourceLayer,m=this.sourceCaches[l];if(m===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=m.getSource().type;v==="geojson"&&h?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||h?(t.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),m.setFeatureState(h,t.id,a)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const l=t.source,h=this.sourceCaches[l];if(h===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const m=h.getSource().type,v=m==="vector"?t.sourceLayer:void 0;m!=="vector"||v?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(v,t.id,a):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,l=t.sourceLayer,h=this.sourceCaches[a];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=d.aF(this.sourceCaches,m=>m.serialize()),a=this._serializeByIds(this._order),l=this.map.getTerrain()||void 0,h=this.stylesheet;return d.aG({version:h.version,name:h.name,metadata:h.metadata,light:h.light,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,sources:t,layers:a,terrain:l},m=>m!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=v=>this._layers[v].type==="fill-extrusion",l={},h=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(a(w)){l[w]=v;for(const k of t){const E=k[w];if(E)for(const D of E)h.push(D)}}}h.sort((v,w)=>w.intersectionZ-v.intersectionZ);const m=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(a(w))for(let k=h.length-1;k>=0;k--){const E=h[k].feature;if(l[E.layer.id]<v)break;m.push(E),h.pop()}else for(const k of t){const E=k[w];if(E)for(const D of E)m.push(D.feature)}}return m}queryRenderedFeatures(t,a,l){a&&a.filter&&this._validate(d.x.filter,"queryRenderedFeatures.filter",a.filter,null,a);const h={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const w of a.layers){const k=this._layers[w];if(!k)return this.fire(new d.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];h[k.source]=!0}}const m=[];a.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const w in this.sourceCaches)a.layers&&!h[w]||m.push(Lr(this.sourceCaches[w],this._layers,v,t,a,l));return this.placement&&m.push(function(w,k,E,D,z,N,U){const Z={},Q=N.queryRenderedSymbols(D),H=[];for(const ae of Object.keys(Q).map(Number))H.push(U[ae]);H.sort(Ir);for(const ae of H){const ge=ae.featureIndex.lookupSymbolFeatures(Q[ae.bucketInstanceId],k,ae.bucketIndex,ae.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const Y in ge){const _e=Z[Y]=Z[Y]||[],Ce=ge[Y];Ce.sort((Pe,Re)=>{const We=ae.featureSortOrder;if(We){const lt=We.indexOf(Pe.featureIndex);return We.indexOf(Re.featureIndex)-lt}return Re.featureIndex-Pe.featureIndex});for(const Pe of Ce)_e.push(Pe)}}for(const ae in Z)Z[ae].forEach(ge=>{const Y=ge.feature,_e=E[w[ae].source].getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=_e});return Z}(this._layers,v,this.sourceCaches,t,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(t,a){a&&a.filter&&this._validate(d.x.filter,"querySourceFeatures.filter",a.filter,null,a);const l=this.sourceCaches[t];return l?function(h,m){const v=h.getRenderableIds().map(E=>h.getTileByID(E)),w=[],k={};for(let E=0;E<v.length;E++){const D=v[E],z=D.tileID.canonical.key;k[z]||(k[z]=!0,D.querySourceFeatures(w,m))}return w}(l,a):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const v in t)if(!d.aE(t[v],l[v])){h=!0;break}if(!h)return;const m={now:ie.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(m)}_validate(t,a,l,h,m={}){return(!m||m.validate!==!1)&&Ks(this,t.call(d.x,d.e({key:a,style:this.serialize(),value:l,styleSpec:d.v},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Fr().off(li,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const l=this.sourceCaches[a];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const a in this.sourceCaches)this.sourceCaches[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,a,l,h,m=!1){let v=!1,w=!1;const k={};for(const E of this._order){const D=this._layers[E];if(D.type!=="symbol")continue;if(!k[D.source]){const N=this.sourceCaches[D.source];k[D.source]=N.getRenderableIds(!0).map(U=>N.getTileByID(U)).sort((U,Z)=>Z.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(Z.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(D,k[D.source],t.center.lng);v=v||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ie.now(),t.zoom))&&(this.pauseablePlacement=new $o(t,this.map.terrain,this._order,m,a,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ie.now()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const E of this._order){const D=this._layers[E];D.type==="symbol"&&this.placement.updateLayerOpacities(D,k[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ie.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,a){return d._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const h=this.sourceCaches[a.source];return h&&h.setDependencies(a.tileID.key,a.type,a.icons),l})}getGlyphs(t,a){return d._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(a.stacks),h=this.sourceCaches[a.source];return h&&h.setDependencies(a.tileID.key,a.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(d.x.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,a,l={},h){this._checkLoaded();const m=[{id:t,url:a}],v=[...ne(this.stylesheet.sprite),...m];this._validate(d.x.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(m,!0,h))}removeSprite(t){this._checkLoaded();const a=ne(this.stylesheet.sprite);if(a.find(l=>l.id===t)){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;a.splice(a.findIndex(l=>l.id===t),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return ne(this.stylesheet.sprite)}setSprite(t,a={},l){this._checkLoaded(),t&&this._validate(d.x.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}}var Kn=d.X([{name:"a_pos",type:"Int16",components:2}]),ic="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const wa={prelude:Er(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Er(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Er(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Er(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Er("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Er(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Er(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Er("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Er("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Er("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Er(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Er(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Er(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Er(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Er(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Er(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Er(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Er(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Er(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Er(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Er(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Er(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Er(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Er(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Er(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Er(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Er("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ic),terrainDepth:Er("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ic),terrainCoords:Er("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ic)};function Er(p,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/attribute ([\w]+) ([\w]+)/g),h=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=m?m.concat(h):h,w={};return{fragmentSource:p=p.replace(a,(k,E,D,z,N)=>(w[N]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${N}
varying ${D} ${z} ${N};
#else
uniform ${D} ${z} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${D} ${z} ${N} = u_${N};
#endif
`)),vertexSource:t=t.replace(a,(k,E,D,z,N)=>{const U=z==="float"?"vec2":"vec4",Z=N.match(/color/)?"color":U;return w[N]?E==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${D} ${U} a_${N};
varying ${D} ${z} ${N};
#else
uniform ${D} ${z} u_${N};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${D} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${Z}(a_${N}, u_${N}_t);
#else
    ${D} ${z} ${N} = u_${N};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
attribute ${D} ${U} a_${N};
#else
uniform ${D} ${z} u_${N};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${D} ${z} ${N} = a_${N};
#else
    ${D} ${z} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${D} ${z} ${N} = unpack_mix_${Z}(a_${N}, u_${N}_t);
#else
    ${D} ${z} ${N} = u_${N};
#endif
`}),staticAttributes:l,staticUniforms:v}}class io{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,l,h,m,v,w,k,E){this.context=t;let D=this.boundPaintVertexBuffers.length!==h.length;for(let z=0;!D&&z<h.length;z++)this.boundPaintVertexBuffers[z]!==h[z]&&(D=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==l||D||this.boundIndexBuffer!==m||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==E?this.freshBind(a,l,h,m,v,w,k,E):(t.bindVertexArray.set(this.vao),w&&w.bind(),m&&m.dynamicDraw&&m.bind(),k&&k.bind(),E&&E.bind())}freshBind(t,a,l,h,m,v,w,k){const E=t.numAttributes,D=this.context,z=D.gl;this.vao&&this.destroy(),this.vao=D.createVertexArray(),D.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=k,a.enableAttributes(z,t);for(const N of l)N.enableAttributes(z,t);v&&v.enableAttributes(z,t),w&&w.enableAttributes(z,t),k&&k.enableAttributes(z,t),a.bind(),a.setVertexAttribPointers(z,t,m);for(const N of l)N.bind(),N.setVertexAttribPointers(z,t,m);v&&(v.bind(),v.setVertexAttribPointers(z,t,m)),h&&h.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,t,m)),k&&(k.bind(),k.setVertexAttribPointers(z,t,m)),D.currentNumAttributes=E}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Xs(p){const t=[];for(let a=0;a<p.length;a++){if(p[a]===null)continue;const l=p[a].split(" ");t.push(l.pop())}return t}class nc{constructor(t,a,l,h,m,v){const w=t.gl;this.program=w.createProgram();const k=Xs(a.staticAttributes),E=l?l.getBinderAttributes():[],D=k.concat(E),z=wa.prelude.staticUniforms?Xs(wa.prelude.staticUniforms):[],N=a.staticUniforms?Xs(a.staticUniforms):[],U=l?l.getBinderUniforms():[],Z=z.concat(N).concat(U),Q=[];for(const Pe of Z)Q.indexOf(Pe)<0&&Q.push(Pe);const H=l?l.defines():[];m&&H.push("#define OVERDRAW_INSPECTOR;"),v&&H.push("#define TERRAIN3D;");const ae=H.concat(wa.prelude.fragmentSource,a.fragmentSource).join(`
`),ge=H.concat(wa.prelude.vertexSource,a.vertexSource).join(`
`),Y=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(Y,ae),w.compileShader(Y),!w.getShaderParameter(Y,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(Y)}`);w.attachShader(this.program,Y);const _e=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(_e,ge),w.compileShader(_e),!w.getShaderParameter(_e,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(_e)}`);w.attachShader(this.program,_e),this.attributes={};const Ce={};this.numAttributes=D.length;for(let Pe=0;Pe<this.numAttributes;Pe++)D[Pe]&&(w.bindAttribLocation(this.program,Pe,D[Pe]),this.attributes[D[Pe]]=Pe);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(_e),w.deleteShader(Y);for(let Pe=0;Pe<Q.length;Pe++){const Re=Q[Pe];if(Re&&!Ce[Re]){const We=w.getUniformLocation(this.program,Re);We&&(Ce[Re]=We)}}this.fixedUniforms=h(t,Ce),this.terrainUniforms=((Pe,Re)=>({u_depth:new d.aH(Pe,Re.u_depth),u_terrain:new d.aH(Pe,Re.u_terrain),u_terrain_dim:new d.aI(Pe,Re.u_terrain_dim),u_terrain_matrix:new d.aJ(Pe,Re.u_terrain_matrix),u_terrain_unpack:new d.aK(Pe,Re.u_terrain_unpack),u_terrain_exaggeration:new d.aI(Pe,Re.u_terrain_exaggeration)}))(t,Ce),this.binderUniforms=l?l.getUniforms(t,Ce):[]}draw(t,a,l,h,m,v,w,k,E,D,z,N,U,Z,Q,H,ae,ge){const Y=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(m),t.setCullFace(v),k){t.activeTexture.set(Y.TEXTURE2),Y.bindTexture(Y.TEXTURE_2D,k.depthTexture),t.activeTexture.set(Y.TEXTURE3),Y.bindTexture(Y.TEXTURE_2D,k.texture);for(const Ce in this.terrainUniforms)this.terrainUniforms[Ce].set(k[Ce])}for(const Ce in this.fixedUniforms)this.fixedUniforms[Ce].set(w[Ce]);Q&&Q.setUniforms(t,this.binderUniforms,U,{zoom:Z});let _e=0;switch(a){case Y.LINES:_e=2;break;case Y.TRIANGLES:_e=3;break;case Y.LINE_STRIP:_e=1}for(const Ce of N.get()){const Pe=Ce.vaos||(Ce.vaos={});(Pe[E]||(Pe[E]=new io)).bind(t,this,D,Q?Q.getPaintVertexBuffers():[],z,Ce.vertexOffset,H,ae,ge),Y.drawElements(a,Ce.primitiveLength*_e,Y.UNSIGNED_SHORT,Ce.primitiveOffset*_e*2)}}}function jo(p,t,a){const l=1/qt(a,1,t.transform.tileZoom),h=Math.pow(2,a.tileID.overscaledZ),m=a.tileSize*Math.pow(2,t.transform.tileZoom)/h,v=m*(a.tileID.canonical.x+a.tileID.wrap*h),w=m*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const no=(p,t,a,l)=>{const h=t.style.light,m=h.properties.get("position"),v=[m.x,m.y,m.z],w=function(){var E=new d.A(9);return d.A!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[5]=0,E[6]=0,E[7]=0),E[0]=1,E[4]=1,E[8]=1,E}();h.properties.get("anchor")==="viewport"&&function(E,D){var z=Math.sin(D),N=Math.cos(D);E[0]=N,E[1]=z,E[2]=0,E[3]=-z,E[4]=N,E[5]=0,E[6]=0,E[7]=0,E[8]=1}(w,-t.transform.angle),function(E,D,z){var N=D[0],U=D[1],Z=D[2];E[0]=N*z[0]+U*z[3]+Z*z[6],E[1]=N*z[1]+U*z[4]+Z*z[7],E[2]=N*z[2]+U*z[5]+Z*z[8]}(v,v,w);const k=h.properties.get("color");return{u_matrix:p,u_lightpos:v,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+a,u_opacity:l}},sc=(p,t,a,l,h,m,v)=>d.e(no(p,t,a,l),jo(m,t,v),{u_height_factor:-Math.pow(2,h.overscaledZ)/v.tileSize/8}),Vo=p=>({u_matrix:p}),so=(p,t,a,l)=>d.e(Vo(p),jo(a,t,l)),Uo=(p,t)=>({u_matrix:p,u_world:t}),ao=(p,t,a,l,h)=>d.e(so(p,t,a,l),{u_world:h}),vh=(p,t,a,l)=>{const h=p.transform;let m,v;if(l.paint.get("circle-pitch-alignment")==="map"){const w=qt(a,1,h.zoom);m=!0,v=[w,w]}else m=!1,v=h.pixelsToGLUnits;return{u_camera_to_center_distance:h.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,a,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:v}},xh=(p,t,a)=>({u_matrix:p,u_inv_matrix:t,u_camera_to_center_distance:a.cameraToCenterDistance,u_viewport_size:[a.width,a.height]}),ac=(p,t,a=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:a}),iu=p=>({u_matrix:p}),Ys=(p,t,a,l)=>({u_matrix:p,u_extrude_scale:qt(t,1,a),u_intensity:l});function oo(p,t){const a=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new d.Y(0,l/a).toLngLat().lat,new d.Y(0,(l+1)/a).toLngLat().lat]}const qi=(p,t,a,l)=>{const h=p.transform;return{u_matrix:qo(p,t,a,l),u_ratio:1/qt(t,1,h.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},yn=(p,t,a,l,h)=>d.e(qi(p,t,a,h),{u_image:0,u_image_height:l}),Sa=(p,t,a,l,h)=>{const m=p.transform,v=oc(t,m);return{u_matrix:qo(p,t,a,h),u_texsize:t.imageAtlasTexture.size,u_ratio:1/qt(t,1,m.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},ls=(p,t,a,l,h,m)=>{const v=p.lineAtlas,w=oc(t,p.transform),k=a.layout.get("line-cap")==="round",E=v.getDash(l.from,k),D=v.getDash(l.to,k),z=E.width*h.fromScale,N=D.width*h.toScale;return d.e(qi(p,t,a,m),{u_patternscale_a:[w/z,-E.height/2],u_patternscale_b:[w/N,-D.height/2],u_sdfgamma:v.width/(256*Math.min(z,N)*p.pixelRatio)/2,u_image:0,u_tex_y_a:E.y,u_tex_y_b:D.y,u_mix:h.t})};function oc(p,t){return 1/qt(p,1,t.tileZoom)}function qo(p,t,a,l){return p.translatePosMatrix(l?l.posMatrix:t.tileID.posMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const ka=(p,t,a,l,h)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:a,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(v=h.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(m=h.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:lc(h.paint.get("raster-hue-rotate"))};var m,v};function lc(p){p*=Math.PI/180;const t=Math.sin(p),a=Math.cos(p);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Go=(p,t,a,l,h,m,v,w,k,E,D,z,N,U)=>{const Z=v.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:Z.width/Z.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:k,u_coord_matrix:E,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:m,u_texsize:N,u_texture:0,u_translation:D,u_pitched_scale:U}},nu=(p,t,a,l,h,m,v,w,k,E,D,z,N,U,Z)=>{const Q=v.transform;return d.e(Go(p,t,a,l,h,m,v,w,k,E,D,z,N,Z),{u_gamma_scale:l?Math.cos(Q._pitch)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+U})},su=(p,t,a,l,h,m,v,w,k,E,D,z,N,U)=>d.e(nu(p,t,a,l,h,m,v,w,k,E,D,!0,z,!0,U),{u_texsize_icon:N,u_texture_icon:1}),Ca=(p,t,a)=>({u_matrix:p,u_opacity:t,u_color:a}),bh=(p,t,a,l,h,m)=>d.e(function(v,w,k,E){const D=k.imageManager.getPattern(v.from.toString()),z=k.imageManager.getPattern(v.to.toString()),{width:N,height:U}=k.imageManager.getPixelSize(),Z=Math.pow(2,E.tileID.overscaledZ),Q=E.tileSize*Math.pow(2,k.transform.tileZoom)/Z,H=Q*(E.tileID.canonical.x+E.tileID.wrap*Z),ae=Q*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:D.tl,u_pattern_br_a:D.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[N,U],u_mix:w.t,u_pattern_size_a:D.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/qt(E,1,k.transform.tileZoom),u_pixel_coord_upper:[H>>16,ae>>16],u_pixel_coord_lower:[65535&H,65535&ae]}}(l,m,a,h),{u_matrix:p,u_opacity:t}),Zo={fillExtrusion:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_lightpos:new d.aL(p,t.u_lightpos),u_lightintensity:new d.aI(p,t.u_lightintensity),u_lightcolor:new d.aL(p,t.u_lightcolor),u_vertical_gradient:new d.aI(p,t.u_vertical_gradient),u_opacity:new d.aI(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_lightpos:new d.aL(p,t.u_lightpos),u_lightintensity:new d.aI(p,t.u_lightintensity),u_lightcolor:new d.aL(p,t.u_lightcolor),u_vertical_gradient:new d.aI(p,t.u_vertical_gradient),u_height_factor:new d.aI(p,t.u_height_factor),u_image:new d.aH(p,t.u_image),u_texsize:new d.aM(p,t.u_texsize),u_pixel_coord_upper:new d.aM(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(p,t.u_pixel_coord_lower),u_scale:new d.aL(p,t.u_scale),u_fade:new d.aI(p,t.u_fade),u_opacity:new d.aI(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_image:new d.aH(p,t.u_image),u_texsize:new d.aM(p,t.u_texsize),u_pixel_coord_upper:new d.aM(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(p,t.u_pixel_coord_lower),u_scale:new d.aL(p,t.u_scale),u_fade:new d.aI(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_world:new d.aM(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_world:new d.aM(p,t.u_world),u_image:new d.aH(p,t.u_image),u_texsize:new d.aM(p,t.u_texsize),u_pixel_coord_upper:new d.aM(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(p,t.u_pixel_coord_lower),u_scale:new d.aL(p,t.u_scale),u_fade:new d.aI(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new d.aI(p,t.u_camera_to_center_distance),u_scale_with_map:new d.aH(p,t.u_scale_with_map),u_pitch_with_map:new d.aH(p,t.u_pitch_with_map),u_extrude_scale:new d.aM(p,t.u_extrude_scale),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_matrix:new d.aJ(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_pixel_extrude_scale:new d.aM(p,t.u_pixel_extrude_scale)}),collisionCircle:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_inv_matrix:new d.aJ(p,t.u_inv_matrix),u_camera_to_center_distance:new d.aI(p,t.u_camera_to_center_distance),u_viewport_size:new d.aM(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new d.aN(p,t.u_color),u_matrix:new d.aJ(p,t.u_matrix),u_overlay:new d.aH(p,t.u_overlay),u_overlay_scale:new d.aI(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new d.aI(p,t.u_extrude_scale),u_intensity:new d.aI(p,t.u_intensity),u_matrix:new d.aJ(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_world:new d.aM(p,t.u_world),u_image:new d.aH(p,t.u_image),u_color_ramp:new d.aH(p,t.u_color_ramp),u_opacity:new d.aI(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_image:new d.aH(p,t.u_image),u_latrange:new d.aM(p,t.u_latrange),u_light:new d.aM(p,t.u_light),u_shadow:new d.aN(p,t.u_shadow),u_highlight:new d.aN(p,t.u_highlight),u_accent:new d.aN(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_image:new d.aH(p,t.u_image),u_dimension:new d.aM(p,t.u_dimension),u_zoom:new d.aI(p,t.u_zoom),u_unpack:new d.aK(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_ratio:new d.aI(p,t.u_ratio),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aM(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_ratio:new d.aI(p,t.u_ratio),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aM(p,t.u_units_to_pixels),u_image:new d.aH(p,t.u_image),u_image_height:new d.aI(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_texsize:new d.aM(p,t.u_texsize),u_ratio:new d.aI(p,t.u_ratio),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_image:new d.aH(p,t.u_image),u_units_to_pixels:new d.aM(p,t.u_units_to_pixels),u_scale:new d.aL(p,t.u_scale),u_fade:new d.aI(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_ratio:new d.aI(p,t.u_ratio),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_units_to_pixels:new d.aM(p,t.u_units_to_pixels),u_patternscale_a:new d.aM(p,t.u_patternscale_a),u_patternscale_b:new d.aM(p,t.u_patternscale_b),u_sdfgamma:new d.aI(p,t.u_sdfgamma),u_image:new d.aH(p,t.u_image),u_tex_y_a:new d.aI(p,t.u_tex_y_a),u_tex_y_b:new d.aI(p,t.u_tex_y_b),u_mix:new d.aI(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_tl_parent:new d.aM(p,t.u_tl_parent),u_scale_parent:new d.aI(p,t.u_scale_parent),u_buffer_scale:new d.aI(p,t.u_buffer_scale),u_fade_t:new d.aI(p,t.u_fade_t),u_opacity:new d.aI(p,t.u_opacity),u_image0:new d.aH(p,t.u_image0),u_image1:new d.aH(p,t.u_image1),u_brightness_low:new d.aI(p,t.u_brightness_low),u_brightness_high:new d.aI(p,t.u_brightness_high),u_saturation_factor:new d.aI(p,t.u_saturation_factor),u_contrast_factor:new d.aI(p,t.u_contrast_factor),u_spin_weights:new d.aL(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new d.aH(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(p,t.u_is_size_feature_constant),u_size_t:new d.aI(p,t.u_size_t),u_size:new d.aI(p,t.u_size),u_camera_to_center_distance:new d.aI(p,t.u_camera_to_center_distance),u_pitch:new d.aI(p,t.u_pitch),u_rotate_symbol:new d.aH(p,t.u_rotate_symbol),u_aspect_ratio:new d.aI(p,t.u_aspect_ratio),u_fade_change:new d.aI(p,t.u_fade_change),u_matrix:new d.aJ(p,t.u_matrix),u_label_plane_matrix:new d.aJ(p,t.u_label_plane_matrix),u_coord_matrix:new d.aJ(p,t.u_coord_matrix),u_is_text:new d.aH(p,t.u_is_text),u_pitch_with_map:new d.aH(p,t.u_pitch_with_map),u_is_along_line:new d.aH(p,t.u_is_along_line),u_is_variable_anchor:new d.aH(p,t.u_is_variable_anchor),u_texsize:new d.aM(p,t.u_texsize),u_texture:new d.aH(p,t.u_texture),u_translation:new d.aM(p,t.u_translation),u_pitched_scale:new d.aI(p,t.u_pitched_scale)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new d.aH(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(p,t.u_is_size_feature_constant),u_size_t:new d.aI(p,t.u_size_t),u_size:new d.aI(p,t.u_size),u_camera_to_center_distance:new d.aI(p,t.u_camera_to_center_distance),u_pitch:new d.aI(p,t.u_pitch),u_rotate_symbol:new d.aH(p,t.u_rotate_symbol),u_aspect_ratio:new d.aI(p,t.u_aspect_ratio),u_fade_change:new d.aI(p,t.u_fade_change),u_matrix:new d.aJ(p,t.u_matrix),u_label_plane_matrix:new d.aJ(p,t.u_label_plane_matrix),u_coord_matrix:new d.aJ(p,t.u_coord_matrix),u_is_text:new d.aH(p,t.u_is_text),u_pitch_with_map:new d.aH(p,t.u_pitch_with_map),u_is_along_line:new d.aH(p,t.u_is_along_line),u_is_variable_anchor:new d.aH(p,t.u_is_variable_anchor),u_texsize:new d.aM(p,t.u_texsize),u_texture:new d.aH(p,t.u_texture),u_gamma_scale:new d.aI(p,t.u_gamma_scale),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_is_halo:new d.aH(p,t.u_is_halo),u_translation:new d.aM(p,t.u_translation),u_pitched_scale:new d.aI(p,t.u_pitched_scale)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new d.aH(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(p,t.u_is_size_feature_constant),u_size_t:new d.aI(p,t.u_size_t),u_size:new d.aI(p,t.u_size),u_camera_to_center_distance:new d.aI(p,t.u_camera_to_center_distance),u_pitch:new d.aI(p,t.u_pitch),u_rotate_symbol:new d.aH(p,t.u_rotate_symbol),u_aspect_ratio:new d.aI(p,t.u_aspect_ratio),u_fade_change:new d.aI(p,t.u_fade_change),u_matrix:new d.aJ(p,t.u_matrix),u_label_plane_matrix:new d.aJ(p,t.u_label_plane_matrix),u_coord_matrix:new d.aJ(p,t.u_coord_matrix),u_is_text:new d.aH(p,t.u_is_text),u_pitch_with_map:new d.aH(p,t.u_pitch_with_map),u_is_along_line:new d.aH(p,t.u_is_along_line),u_is_variable_anchor:new d.aH(p,t.u_is_variable_anchor),u_texsize:new d.aM(p,t.u_texsize),u_texsize_icon:new d.aM(p,t.u_texsize_icon),u_texture:new d.aH(p,t.u_texture),u_texture_icon:new d.aH(p,t.u_texture_icon),u_gamma_scale:new d.aI(p,t.u_gamma_scale),u_device_pixel_ratio:new d.aI(p,t.u_device_pixel_ratio),u_is_halo:new d.aH(p,t.u_is_halo),u_translation:new d.aM(p,t.u_translation),u_pitched_scale:new d.aI(p,t.u_pitched_scale)}),background:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_opacity:new d.aI(p,t.u_opacity),u_color:new d.aN(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_opacity:new d.aI(p,t.u_opacity),u_image:new d.aH(p,t.u_image),u_pattern_tl_a:new d.aM(p,t.u_pattern_tl_a),u_pattern_br_a:new d.aM(p,t.u_pattern_br_a),u_pattern_tl_b:new d.aM(p,t.u_pattern_tl_b),u_pattern_br_b:new d.aM(p,t.u_pattern_br_b),u_texsize:new d.aM(p,t.u_texsize),u_mix:new d.aI(p,t.u_mix),u_pattern_size_a:new d.aM(p,t.u_pattern_size_a),u_pattern_size_b:new d.aM(p,t.u_pattern_size_b),u_scale_a:new d.aI(p,t.u_scale_a),u_scale_b:new d.aI(p,t.u_scale_b),u_pixel_coord_upper:new d.aM(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.aM(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_texture:new d.aH(p,t.u_texture),u_ele_delta:new d.aI(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_ele_delta:new d.aI(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new d.aJ(p,t.u_matrix),u_texture:new d.aH(p,t.u_texture),u_terrain_coords_id:new d.aI(p,t.u_terrain_coords_id),u_ele_delta:new d.aI(p,t.u_ele_delta)})};class cc{constructor(t,a,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ta={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class lo{constructor(t,a,l,h){this.length=a.length,this.attributes=l,this.itemSize=a.bytesPerElement,this.dynamicDraw=h,this.context=t;const m=t.gl;this.buffer=m.createBuffer(),t.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let l=0;l<this.attributes.length;l++){const h=a.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,a,l){for(let h=0;h<this.attributes.length;h++){const m=this.attributes[h],v=a.attributes[m.name];v!==void 0&&t.vertexAttribPointer(v,m.components,t[Ta[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ia=new WeakMap;function _n(p){var t;if(Ia.has(p))return Ia.get(p);{const a=(t=p.getParameter(p.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Ia.set(p,a),a}}class Pr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class uc extends Pr{getDefault(){return d.aP.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ea extends Pr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Pa extends Pr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class wh extends Pr{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ho extends Pr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Sh extends Pr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Aa extends Pr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class kh extends Pr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class au extends Pr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ch extends Pr{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class hc extends Pr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class dc extends Pr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ou extends Pr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class lu extends Pr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class cu extends Pr{getDefault(){return d.aP.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class uu extends Pr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Js extends Pr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class hu extends Pr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Th extends Pr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ih extends Pr{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class du extends Pr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ma extends Pr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Eh extends Pr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Wo extends Pr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ph extends Pr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ah extends Pr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class pc extends Pr{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class pu extends Pr{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const l=this.gl;_n(l)?l.bindVertexArray(t):(a=l.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class fu extends Pr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class fc extends Pr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class mu extends Pr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class za extends Pr{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class cs extends za{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ko extends za{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Da extends za{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class co{constructor(t,a,l,h,m){this.context=t,this.width=a,this.height=l;const v=t.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new cs(t,w),h)this.depthAttachment=m?new Da(t,w):new Ko(t,w);else if(m)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class ii{constructor(t,a,l){this.blendFunction=t,this.blendColor=a,this.mask=l}}ii.Replace=[1,0],ii.disabled=new ii(ii.Replace,d.aP.transparent,[!1,!1,!1,!1]),ii.unblended=new ii(ii.Replace,d.aP.transparent,[!0,!0,!0,!0]),ii.alphaBlended=new ii([1,771],d.aP.transparent,[!0,!0,!0,!0]);class mc{constructor(t){var a,l;if(this.gl=t,this.clearColor=new uc(this),this.clearDepth=new Ea(this),this.clearStencil=new Pa(this),this.colorMask=new wh(this),this.depthMask=new Ho(this),this.stencilMask=new Sh(this),this.stencilFunc=new Aa(this),this.stencilOp=new kh(this),this.stencilTest=new au(this),this.depthRange=new Ch(this),this.depthTest=new hc(this),this.depthFunc=new dc(this),this.blend=new ou(this),this.blendFunc=new lu(this),this.blendColor=new cu(this),this.blendEquation=new uu(this),this.cullFace=new Js(this),this.cullFaceSide=new hu(this),this.frontFace=new Th(this),this.program=new Ih(this),this.activeTexture=new du(this),this.viewport=new Ma(this),this.bindFramebuffer=new Eh(this),this.bindRenderbuffer=new Wo(this),this.bindTexture=new Ph(this),this.bindVertexBuffer=new Ah(this),this.bindElementBuffer=new pc(this),this.bindVertexArray=new pu(this),this.pixelStoreUnpack=new fu(this),this.pixelStoreUnpackPremultiplyAlpha=new fc(this),this.pixelStoreUnpackFlipY=new mu(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),_n(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:h==null?void 0:h.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h==null?void 0:h.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h==null?void 0:h.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new cc(this,t,a)}createVertexBuffer(t,a,l){return new lo(this,t,a,l)}createRenderbuffer(t,a,l){const h=this.gl,m=h.createRenderbuffer();return this.bindRenderbuffer.set(m),h.renderbufferStorage(h.RENDERBUFFER,t,a,l),this.bindRenderbuffer.set(null),m}createFramebuffer(t,a,l,h){return new co(this,t,a,l,h)}clear({color:t,depth:a,stencil:l}){const h=this.gl;let m=0;t&&(m|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(m|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),l!==void 0&&(m|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(m)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){d.aE(t.blendFunction,ii.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return _n(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return _n(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class ir{constructor(t,a,l){this.func=t,this.mask=a,this.range=l}}ir.ReadOnly=!1,ir.ReadWrite=!0,ir.disabled=new ir(519,ir.ReadOnly,[0,1]);const uo=7680;class Xr{constructor(t,a,l,h,m,v){this.test=t,this.ref=a,this.mask=l,this.fail=h,this.depthFail=m,this.pass=v}}Xr.disabled=new Xr({func:519,mask:0},0,0,uo,uo,uo);class Yr{constructor(t,a,l){this.enable=t,this.mode=a,this.frontFace=l}}let Es;function gu(p,t,a,l,h){const m=p.context,v=m.gl,w=p.useProgram("collisionBox"),k=[];let E=0,D=0;for(let ae=0;ae<l.length;ae++){const ge=l[ae],Y=t.getTile(ge).getBucket(a);if(!Y)continue;const _e=h?Y.textCollisionBox:Y.iconCollisionBox,Ce=Y.collisionCircleArray;if(Ce.length>0){const Pe=d.F();d.aQ(Pe,Y.placementInvProjMatrix,p.transform.glCoordMatrix),d.aQ(Pe,Pe,Y.placementViewportMatrix),k.push({circleArray:Ce,circleOffset:D,transform:ge.posMatrix,invTransform:Pe,coord:ge}),E+=Ce.length/4,D=E}_e&&w.draw(m,v.LINES,ir.disabled,Xr.disabled,p.colorModeForRenderPass(),Yr.disabled,{u_matrix:ge.posMatrix,u_pixel_extrude_scale:[1/(z=p.transform).width,1/z.height]},p.style.map.terrain&&p.style.map.terrain.getTerrainData(ge),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,p.transform.zoom,null,null,_e.collisionVertexBuffer)}var z;if(!h||!k.length)return;const N=p.useProgram("collisionCircle"),U=new d.aR;U.resize(4*E),U._trim();let Z=0;for(const ae of k)for(let ge=0;ge<ae.circleArray.length/4;ge++){const Y=4*ge,_e=ae.circleArray[Y+0],Ce=ae.circleArray[Y+1],Pe=ae.circleArray[Y+2],Re=ae.circleArray[Y+3];U.emplace(Z++,_e,Ce,Pe,Re,0),U.emplace(Z++,_e,Ce,Pe,Re,1),U.emplace(Z++,_e,Ce,Pe,Re,2),U.emplace(Z++,_e,Ce,Pe,Re,3)}(!Es||Es.length<2*E)&&(Es=function(ae){const ge=2*ae,Y=new d.aT;Y.resize(ge),Y._trim();for(let _e=0;_e<ge;_e++){const Ce=6*_e;Y.uint16[Ce+0]=4*_e+0,Y.uint16[Ce+1]=4*_e+1,Y.uint16[Ce+2]=4*_e+2,Y.uint16[Ce+3]=4*_e+2,Y.uint16[Ce+4]=4*_e+3,Y.uint16[Ce+5]=4*_e+0}return Y}(E));const Q=m.createIndexBuffer(Es,!0),H=m.createVertexBuffer(U,d.aS.members,!0);for(const ae of k){const ge=xh(ae.transform,ae.invTransform,p.transform);N.draw(m,v.TRIANGLES,ir.disabled,Xr.disabled,p.colorModeForRenderPass(),Yr.disabled,ge,p.style.map.terrain&&p.style.map.terrain.getTerrainData(ae.coord),a.id,H,Q,d.$.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,p.transform.zoom,null,null,null)}H.destroy(),Q.destroy()}Yr.disabled=new Yr(!1,1029,2305),Yr.backCCW=new Yr(!0,1029,2305);const gc=d.an(new Float32Array(16));function Mh(p,t,a,l,h,m){const{horizontalAlign:v,verticalAlign:w}=d.au(p);return new d.P((-(v-.5)*t/h+l[0])*m,(-(w-.5)*a/h+l[1])*m)}function yu(p,t,a,l,h,m){const v=t.tileAnchorPoint.add(new d.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let w=l.mult(m);return a||(w=w.rotate(-h)),Ii(v.add(w),t.labelPlaneMatrix,t.getElevation).point}if(a){const w=le(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(p),k=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return p.add(l.rotate(k))}return p.add(l)}function Xo(p,t,a,l,h,m,v,w,k,E,D,z,N,U){const Z=p.text.placedSymbolArray,Q=p.text.dynamicLayoutVertexArray,H=p.icon.dynamicLayoutVertexArray,ae={};Q.clear();for(let ge=0;ge<Z.length;ge++){const Y=Z.get(ge),_e=Y.hidden||!Y.crossTileID||p.allowVerticalPlacement&&!Y.placedOrientation?null:l[Y.crossTileID];if(_e){const Ce=new d.P(Y.anchorX,Y.anchorY),Pe={getElevation:U,width:h.width,height:h.height,labelPlaneMatrix:m,lineVertexArray:null,pitchWithMap:a,projection:D,projectionCache:null,tileAnchorPoint:Ce,translation:z,unwrappedTileID:N},Re=a?Ii(Ce,v,U):le(Ce.x,Ce.y,Pe),We=K(h.cameraToCenterDistance,Re.signedDistanceFromCamera);let lt=d.ai(p.textSizeData,k,Y)*We/d.ap;a&&(lt*=p.tilePixelRatio/w);const{width:_t,height:et,anchor:st,textOffset:wt,textBoxScale:Gt}=_e,ot=Mh(st,_t,et,wt,Gt,lt),mt=D.getPitchedTextCorrection(h,Ce.add(new d.P(z[0],z[1])),N),Ut=yu(Re.point,Pe,t,ot,h.angle,mt),Zr=p.allowVerticalPlacement&&Y.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let Yt=0;Yt<Y.numGlyphs;Yt++)d.aj(Q,Ut,Zr);E&&Y.associatedIconIndex>=0&&(ae[Y.associatedIconIndex]={shiftedAnchor:Ut,angle:Zr})}else Lt(Y.numGlyphs,Q)}if(E){H.clear();const ge=p.icon.placedSymbolArray;for(let Y=0;Y<ge.length;Y++){const _e=ge.get(Y);if(_e.hidden)Lt(_e.numGlyphs,H);else{const Ce=ae[Y];if(Ce)for(let Pe=0;Pe<_e.numGlyphs;Pe++)d.aj(H,Ce.shiftedAnchor,Ce.angle);else Lt(_e.numGlyphs,H)}}p.icon.dynamicLayoutVertexBuffer.updateData(H)}p.text.dynamicLayoutVertexBuffer.updateData(Q)}function Yo(p,t,a){return a.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function ho(p,t,a,l,h,m,v,w,k,E,D,z){const N=p.context,U=N.gl,Z=p.transform,Q=Ui(),H=w==="map",ae=k==="map",ge=w!=="viewport"&&a.layout.get("symbol-placement")!=="point",Y=H&&!ae&&!ge,_e=!ae&&ge,Ce=!a.layout.get("symbol-sort-key").isConstant();let Pe=!1;const Re=p.depthModeForSublayer(0,ir.ReadOnly),We=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),lt=[],_t=Q.getCircleRadiusCorrection(Z);for(const et of l){const st=t.getTile(et),wt=st.getBucket(a);if(!wt)continue;const Gt=h?wt.text:wt.icon;if(!Gt||!Gt.segments.get().length||!Gt.hasVisibleVertices)continue;const ot=Gt.programConfigurations.get(a.id),mt=h||wt.sdfIcons,Ut=h?wt.textSizeData:wt.iconSizeData,Zr=ae||Z.pitch!==0,Yt=p.useProgram(Yo(mt,h,wt),ot),fr=d.ag(Ut,Z.zoom),Hr=p.style.map.terrain&&p.style.map.terrain.getTerrainData(et);let Zi,Nn,Wr,Qi,en=[0,0],Hi=null;if(h)Nn=st.glyphAtlasTexture,Wr=U.LINEAR,Zi=st.glyphAtlasTexture.size,wt.iconsInText&&(en=st.imageAtlasTexture.size,Hi=st.imageAtlasTexture,Qi=Zr||p.options.rotating||p.options.zooming||Ut.kind==="composite"||Ut.kind==="camera"?U.LINEAR:U.NEAREST);else{const Ar=a.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear;Nn=st.imageAtlasTexture,Wr=mt||p.options.rotating||p.options.zooming||Ar||Zr?U.LINEAR:U.NEAREST,Zi=st.imageAtlasTexture.size}const Wi=qt(st,1,p.transform.zoom),On=_e?et.posMatrix:gc,na=as(On,ae,H,p.transform,Wi),_l=os(On,ae,H,p.transform,Wi),Ns=os(et.posMatrix,ae,H,p.transform,Wi),Os=Q.translatePosition(p.transform,st,m,v),vl=We&&wt.hasTextData(),Dc=a.layout.get("icon-text-fit")!=="none"&&vl&&wt.hasIconData();if(ge){const Ar=p.style.map.terrain?(Lc,wi)=>p.style.map.terrain.getElevation(et,Lc,wi):null,Qr=a.layout.get("text-rotation-alignment")==="map";B(wt,et.posMatrix,p,h,na,Ns,ae,E,Qr,Q,et.toUnwrapped(),Z.width,Z.height,Os,Ar)}const Fi=et.posMatrix,Mn=h&&We||Dc,fs=ge||Mn?gc:na,sa=_l,Bi=mt&&a.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ki;Ki=mt?wt.iconsInText?su(Ut.kind,fr,Y,ae,ge,Mn,p,Fi,fs,sa,Os,Zi,en,_t):nu(Ut.kind,fr,Y,ae,ge,Mn,p,Fi,fs,sa,Os,h,Zi,!0,_t):Go(Ut.kind,fr,Y,ae,ge,Mn,p,Fi,fs,sa,Os,h,Zi,_t);const bi={program:Yt,buffers:Gt,uniformValues:Ki,atlasTexture:Nn,atlasTextureIcon:Hi,atlasInterpolation:Wr,atlasInterpolationIcon:Qi,isSDF:mt,hasHalo:Bi};if(Ce&&wt.canOverlap){Pe=!0;const Ar=Gt.segments.get();for(const Qr of Ar)lt.push({segments:new d.$([Qr]),sortKey:Qr.sortKey,state:bi,terrainData:Hr})}else lt.push({segments:Gt.segments,sortKey:0,state:bi,terrainData:Hr})}Pe&&lt.sort((et,st)=>et.sortKey-st.sortKey);for(const et of lt){const st=et.state;if(N.activeTexture.set(U.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,U.CLAMP_TO_EDGE),st.atlasTextureIcon&&(N.activeTexture.set(U.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),st.isSDF){const wt=st.uniformValues;st.hasHalo&&(wt.u_is_halo=1,Jo(st.buffers,et.segments,a,p,st.program,Re,D,z,wt,et.terrainData)),wt.u_is_halo=0}Jo(st.buffers,et.segments,a,p,st.program,Re,D,z,st.uniformValues,et.terrainData)}}function Jo(p,t,a,l,h,m,v,w,k,E){const D=l.context;h.draw(D,D.gl.TRIANGLES,m,v,w,Yr.disabled,k,E,a.id,p.layoutVertexBuffer,p.indexBuffer,t,a.paint,l.transform.zoom,p.programConfigurations.get(a.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Ps(p,t,a,l,h){if(!a||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let v=m[a.to.toString()],w=m[a.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const k=h.getPaintProperty(t);v=m[k],w=m[k]}v&&w&&p.setConstantPatternPositions(v,w)}function As(p,t,a,l,h,m,v){const w=p.context.gl,k="fill-pattern",E=a.paint.get(k),D=E&&E.constantOr(1),z=a.getCrossfadeParameters();let N,U,Z,Q,H;v?(U=D&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=w.LINES):(U=D?"fillPattern":"fill",N=w.TRIANGLES);const ae=E.constantOr(null);for(const ge of l){const Y=t.getTile(ge);if(D&&!Y.patternsLoaded())continue;const _e=Y.getBucket(a);if(!_e)continue;const Ce=_e.programConfigurations.get(a.id),Pe=p.useProgram(U,Ce),Re=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ge);D&&(p.context.activeTexture.set(w.TEXTURE0),Y.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),Ce.updatePaintBuffers(z)),Ps(Ce,k,ae,Y,a);const We=Re?ge:null,lt=p.translatePosMatrix(We?We.posMatrix:ge.posMatrix,Y,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(v){Q=_e.indexBuffer2,H=_e.segments2;const _t=[w.drawingBufferWidth,w.drawingBufferHeight];Z=U==="fillOutlinePattern"&&D?ao(lt,p,z,Y,_t):Uo(lt,_t)}else Q=_e.indexBuffer,H=_e.segments,Z=D?so(lt,p,z,Y):Vo(lt);Pe.draw(p.context,N,h,p.stencilModeForClipping(ge),m,Yr.disabled,Z,Re,a.id,_e.layoutVertexBuffer,Q,H,a.paint,p.transform.zoom,Ce)}}function Ji(p,t,a,l,h,m,v){const w=p.context,k=w.gl,E="fill-extrusion-pattern",D=a.paint.get(E),z=D.constantOr(1),N=a.getCrossfadeParameters(),U=a.paint.get("fill-extrusion-opacity"),Z=D.constantOr(null);for(const Q of l){const H=t.getTile(Q),ae=H.getBucket(a);if(!ae)continue;const ge=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Q),Y=ae.programConfigurations.get(a.id),_e=p.useProgram(z?"fillExtrusionPattern":"fillExtrusion",Y);z&&(p.context.activeTexture.set(k.TEXTURE0),H.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Y.updatePaintBuffers(N)),Ps(Y,E,Z,H,a);const Ce=p.translatePosMatrix(Q.posMatrix,H,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Pe=a.paint.get("fill-extrusion-vertical-gradient"),Re=z?sc(Ce,p,Pe,U,Q,N,H):no(Ce,p,Pe,U);_e.draw(w,w.gl.TRIANGLES,h,m,v,Yr.backCCW,Re,ge,a.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,a.paint,p.transform.zoom,Y,p.style.map.terrain&&ae.centroidVertexBuffer)}}function _u(p,t,a,l,h,m,v){const w=p.context,k=w.gl,E=a.fbo;if(!E)return;const D=p.useProgram("hillshade"),z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);w.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,E.colorAttachment.get()),D.draw(w,k.TRIANGLES,h,m,v,Yr.disabled,((N,U,Z,Q)=>{const H=Z.paint.get("hillshade-shadow-color"),ae=Z.paint.get("hillshade-highlight-color"),ge=Z.paint.get("hillshade-accent-color");let Y=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);Z.paint.get("hillshade-illumination-anchor")==="viewport"&&(Y-=N.transform.angle);const _e=!N.options.moving;return{u_matrix:Q?Q.posMatrix:N.transform.calculatePosMatrix(U.tileID.toUnwrapped(),_e),u_image:0,u_latrange:oo(0,U.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),Y],u_shadow:H,u_highlight:ae,u_accent:ge}})(p,a,l,z?t:null),z,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function vu(p,t,a,l,h,m){const v=p.context,w=v.gl,k=t.dem;if(k&&k.data){const E=k.dim,D=k.stride,z=k.getPixels();if(v.activeTexture.set(w.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(D),t.demTexture){const U=t.demTexture;U.update(z,{premultiply:!1}),U.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else t.demTexture=new Me(v,z,w.RGBA,{premultiply:!1}),t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);v.activeTexture.set(w.TEXTURE0);let N=t.fbo;if(!N){const U=new Me(v,{width:E,height:E,data:null},w.RGBA);U.bind(w.LINEAR,w.CLAMP_TO_EDGE),N=t.fbo=v.createFramebuffer(E,E,!0,!1),N.colorAttachment.set(U.texture)}v.bindFramebuffer.set(N.framebuffer),v.viewport.set([0,0,E,E]),p.useProgram("hillshadePrepare").draw(v,w.TRIANGLES,l,h,m,Yr.disabled,((U,Z)=>{const Q=Z.stride,H=d.F();return d.aO(H,0,d.W,-d.W,0,0,1),d.H(H,H,[0,-d.W,0]),{u_matrix:H,u_image:1,u_dimension:[Q,Q],u_zoom:U.overscaledZ,u_unpack:Z.getUnpackVector()}})(t.tileID,k),null,a.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function yc(p,t,a,l,h,m){const v=l.paint.get("raster-fade-duration");if(!m&&v>0){const w=ie.now(),k=(w-p.timeAdded)/v,E=t?(w-t.timeAdded)/v:-1,D=a.getSource(),z=h.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),N=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(p.tileID.overscaledZ-z),U=N&&p.refreshedUponExpiration?1:d.ac(N?k:1-E,0,1);return p.refreshedUponExpiration&&k>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}const us=new d.aP(1,0,0,1),po=new d.aP(0,1,0,1),fo=new d.aP(0,0,1,1),La=new d.aP(1,0,1,1),mo=new d.aP(0,1,1,1);function Ra(p,t,a,l){Xn(p,0,t+a/2,p.transform.width,a,l)}function Qs(p,t,a,l){Xn(p,t-a/2,0,a,p.transform.height,l)}function Xn(p,t,a,l,h,m){const v=p.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*p.pixelRatio,a*p.pixelRatio,l*p.pixelRatio,h*p.pixelRatio),v.clear({color:m}),w.disable(w.SCISSOR_TEST)}function xu(p,t,a){const l=p.context,h=l.gl,m=a.posMatrix,v=p.useProgram("debug"),w=ir.disabled,k=Xr.disabled,E=p.colorModeForRenderPass(),D="$debug",z=p.style.map.terrain&&p.style.map.terrain.getTerrainData(a);l.activeTexture.set(h.TEXTURE0);const N=t.getTileByID(a.key).latestRawTileData,U=Math.floor((N&&N.byteLength||0)/1024),Z=t.getTile(a).tileSize,Q=512/Math.min(Z,512)*(a.overscaledZ/p.transform.zoom)*.5;let H=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(H+=` => ${a.overscaledZ}`),function(ae,ge){ae.initDebugOverlayCanvas();const Y=ae.debugOverlayCanvas,_e=ae.context.gl,Ce=ae.debugOverlayCanvas.getContext("2d");Ce.clearRect(0,0,Y.width,Y.height),Ce.shadowColor="white",Ce.shadowBlur=2,Ce.lineWidth=1.5,Ce.strokeStyle="white",Ce.textBaseline="top",Ce.font="bold 36px Open Sans, sans-serif",Ce.fillText(ge,5,5),Ce.strokeText(ge,5,5),ae.debugOverlayTexture.update(Y),ae.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(p,`${H} ${U}kB`),v.draw(l,h.TRIANGLES,w,k,ii.alphaBlended,Yr.disabled,ac(m,d.aP.transparent,Q),null,D,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),v.draw(l,h.LINE_STRIP,w,k,E,Yr.disabled,ac(m,d.aP.red),z,D,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function Qo(p,t,a){const l=p.context,h=l.gl,m=p.colorModeForRenderPass(),v=new ir(h.LEQUAL,ir.ReadWrite,p.depthRangeFor3D),w=p.useProgram("terrain"),k=t.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,p.width,p.height]);for(const E of a){const D=p.renderToTexture.getTexture(E),z=t.getTerrainData(E.tileID);l.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,D.texture);const N={u_matrix:p.transform.calculatePosMatrix(E.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};w.draw(l,h.TRIANGLES,v,Xr.disabled,m,Yr.backCCW,N,z,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class kr{constructor(t,a){this.context=new mc(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Je.maxUnderzooming+Je.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ai}resize(t,a,l){if(this.width=Math.floor(t*l),this.height=Math.floor(a*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,a=new d.aW;a.emplaceBack(0,0),a.emplaceBack(d.W,0),a.emplaceBack(0,d.W),a.emplaceBack(d.W,d.W),this.tileExtentBuffer=t.createVertexBuffer(a,Kn.members),this.tileExtentSegments=d.$.simpleSegment(0,0,4,2);const l=new d.aW;l.emplaceBack(0,0),l.emplaceBack(d.W,0),l.emplaceBack(0,d.W),l.emplaceBack(d.W,d.W),this.debugBuffer=t.createVertexBuffer(l,Kn.members),this.debugSegments=d.$.simpleSegment(0,0,4,5);const h=new d.Z;h.emplaceBack(0,0,0,0),h.emplaceBack(d.W,0,d.W,0),h.emplaceBack(0,d.W,0,d.W),h.emplaceBack(d.W,d.W,d.W,d.W),this.rasterBoundsBuffer=t.createVertexBuffer(h,Et.members),this.rasterBoundsSegments=d.$.simpleSegment(0,0,4,2);const m=new d.aW;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,Kn.members),this.viewportSegments=d.$.simpleSegment(0,0,4,2);const v=new d.aX;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(v);const w=new d.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const k=this.context.gl;this.stencilClearMode=new Xr({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.F();d.aO(l,0,this.width,this.height,0,0,1),d.J(l,l,[a.drawingBufferWidth,a.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,a.TRIANGLES,ir.disabled,this.stencilClearMode,ii.disabled,Yr.disabled,iu(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source;const l=this.context,h=l.gl;this.nextStencilID+a.length>256&&this.clearStencil(),l.setColorMode(ii.disabled),l.setDepthMode(ir.disabled);const m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of a){const w=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);m.draw(l,h.TRIANGLES,ir.disabled,new Xr({func:h.ALWAYS,mask:0},w,255,h.KEEP,h.KEEP,h.REPLACE),ii.disabled,Yr.disabled,iu(v.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Xr({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new Xr({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,l=t.sort((v,w)=>w.overscaledZ-v.overscaledZ),h=l[l.length-1].overscaledZ,m=l[0].overscaledZ-h+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const v={};for(let w=0;w<m;w++)v[w+h]=new Xr({func:a.GEQUAL,mask:255},w+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=m,[v,l]}return[{[h]:Xr.disabled},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ii([t.CONSTANT_COLOR,t.ONE],new d.aP(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ii.unblended:ii.alphaBlended}depthModeForSublayer(t,a,l){if(!this.opaquePassEnabledForLayer())return ir.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ir(l||this.context.gl.LEQUAL,a,[h,h])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(ie.now()),this.imageManager.beginFrame();const l=this.style._order,h=this.style.sourceCaches,m={},v={},w={};for(const k in h){const E=h[k];E.used&&E.prepare(this.context),m[k]=E.getVisibleCoordinates(),v[k]=m[k].slice().reverse(),w[k]=E.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<l.length;k++)if(this.style._layers[l[k]].is3D()){this.opaquePassCutoff=k;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const k of l){const E=this.style._layers[k];if(!E.hasOffscreenPass()||E.isHidden(this.transform.zoom))continue;const D=v[E.source];(E.type==="custom"||D.length)&&this.renderLayer(this,h[E.source],E,D)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?d.aP.black:d.aP.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[l[this.currentLayer]],E=h[k.source],D=m[k.source];this._renderTileClippingMasks(k,D),this.renderLayer(this,E,k,D)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const k=this.style._layers[l[this.currentLayer]],E=h[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const D=(k.type==="symbol"?w:v)[k.source];this._renderTileClippingMasks(k,m[k.source]),this.renderLayer(this,E,k,D)}if(this.options.showTileBoundaries){const k=function(E,D){let z=null;const N=Object.values(E._layers).flatMap(H=>H.source&&!H.isHidden(D)?[E.sourceCaches[H.source]]:[]),U=N.filter(H=>H.getSource().type==="vector"),Z=N.filter(H=>H.getSource().type!=="vector"),Q=H=>{(!z||z.getSource().maxzoom<H.getSource().maxzoom)&&(z=H)};return U.forEach(H=>Q(H)),z||Z.forEach(H=>Q(H)),z}(this.style,this.transform.zoom);k&&function(E,D,z){for(let N=0;N<z.length;N++)xu(E,D,z[N])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const E=k.transform.padding;Ra(k,k.transform.height-(E.top||0),3,us),Ra(k,E.bottom||0,3,po),Qs(k,E.left||0,3,fo),Qs(k,k.transform.width-(E.right||0),3,La);const D=k.transform.centerPoint;(function(z,N,U,Z){Xn(z,N-1,U-10,2,20,Z),Xn(z,N-10,U-1,20,2,Z)})(k,D.x,k.transform.height-D.y,mo)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,l=this.transform.projMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!d.aZ(a,l):!d.a_(a,l)),h||(h=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),h&&(d.a$(a,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,v){const w=m.context,k=w.gl,E=ii.unblended,D=new ir(k.LEQUAL,ir.ReadWrite,[0,1]),z=v.getTerrainMesh(),N=v.sourceCache.getRenderableTiles(),U=m.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),w.clear({color:d.aP.transparent,depth:1});for(const Z of N){const Q=v.getTerrainData(Z.tileID),H={u_matrix:m.transform.calculatePosMatrix(Z.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(m.transform.zoom)};U.draw(w,k.TRIANGLES,D,Xr.disabled,E,Yr.backCCW,H,Q,"terrain",z.vertexBuffer,z.indexBuffer,z.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,v){const w=m.context,k=w.gl,E=ii.unblended,D=new ir(k.LEQUAL,ir.ReadWrite,[0,1]),z=v.getTerrainMesh(),N=v.getCoordsTexture(),U=v.sourceCache.getRenderableTiles(),Z=m.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),w.clear({color:d.aP.transparent,depth:1}),v.coordsIndex=[];for(const Q of U){const H=v.getTerrainData(Q.tileID);w.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,N.texture);const ae={u_matrix:m.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(m.transform.zoom)};Z.draw(w,k.TRIANGLES,D,Xr.disabled,E,Yr.backCCW,ae,H,"terrain",z.vertexBuffer,z.indexBuffer,z.segments),v.coordsIndex.push(Q.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(t,a,l,h){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(h||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(m,v,w,k,E){if(m.renderPass!=="translucent")return;const D=Xr.disabled,z=m.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(N,U,Z,Q,H,ae,ge,Y,_e){const Ce=U.transform,Pe=Ui(),Re=H==="map",We=ae==="map";for(const lt of N){const _t=Q.getTile(lt),et=_t.getBucket(Z);if(!et||!et.text||!et.text.segments.get().length)continue;const st=d.ag(et.textSizeData,Ce.zoom),wt=qt(_t,1,U.transform.zoom),Gt=as(lt.posMatrix,We,Re,U.transform,wt),ot=Z.layout.get("icon-text-fit")!=="none"&&et.hasIconData();if(st){const mt=Math.pow(2,Ce.zoom-_t.tileID.overscaledZ),Ut=U.style.map.terrain?(Yt,fr)=>U.style.map.terrain.getElevation(lt,Yt,fr):null,Zr=Pe.translatePosition(Ce,_t,ge,Y);Xo(et,Re,We,_e,Ce,Gt,lt.posMatrix,mt,st,ot,Pe,Zr,lt.toUnwrapped(),Ut)}}}(k,m,w,v,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),E),w.paint.get("icon-opacity").constantOr(1)!==0&&ho(m,v,w,k,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),D,z),w.paint.get("text-opacity").constantOr(1)!==0&&ho(m,v,w,k,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),D,z),v.map.showCollisionBoxes&&(gu(m,v,w,k,!0),gu(m,v,w,k,!1))})(t,a,l,h,this.style.placement.variableOffsets);break;case"circle":(function(m,v,w,k){if(m.renderPass!=="translucent")return;const E=w.paint.get("circle-opacity"),D=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),N=!w.layout.get("circle-sort-key").isConstant();if(E.constantOr(1)===0&&(D.constantOr(1)===0||z.constantOr(1)===0))return;const U=m.context,Z=U.gl,Q=m.depthModeForSublayer(0,ir.ReadOnly),H=Xr.disabled,ae=m.colorModeForRenderPass(),ge=[];for(let Y=0;Y<k.length;Y++){const _e=k[Y],Ce=v.getTile(_e),Pe=Ce.getBucket(w);if(!Pe)continue;const Re=Pe.programConfigurations.get(w.id),We=m.useProgram("circle",Re),lt=Pe.layoutVertexBuffer,_t=Pe.indexBuffer,et=m.style.map.terrain&&m.style.map.terrain.getTerrainData(_e),st={programConfiguration:Re,program:We,layoutVertexBuffer:lt,indexBuffer:_t,uniformValues:vh(m,_e,Ce,w),terrainData:et};if(N){const wt=Pe.segments.get();for(const Gt of wt)ge.push({segments:new d.$([Gt]),sortKey:Gt.sortKey,state:st})}else ge.push({segments:Pe.segments,sortKey:0,state:st})}N&&ge.sort((Y,_e)=>Y.sortKey-_e.sortKey);for(const Y of ge){const{programConfiguration:_e,program:Ce,layoutVertexBuffer:Pe,indexBuffer:Re,uniformValues:We,terrainData:lt}=Y.state;Ce.draw(U,Z.TRIANGLES,Q,H,ae,Yr.disabled,We,lt,w.id,Pe,Re,Y.segments,w.paint,m.transform.zoom,_e)}})(t,a,l,h);break;case"heatmap":(function(m,v,w,k){if(w.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const E=m.context,D=E.gl,z=Xr.disabled,N=new ii([D.ONE,D.ONE],d.aP.transparent,[!0,!0,!0,!0]);(function(U,Z,Q){const H=U.gl;U.activeTexture.set(H.TEXTURE1),U.viewport.set([0,0,Z.width/4,Z.height/4]);let ae=Q.heatmapFbo;if(ae)H.bindTexture(H.TEXTURE_2D,ae.colorAttachment.get()),U.bindFramebuffer.set(ae.framebuffer);else{const ge=H.createTexture();H.bindTexture(H.TEXTURE_2D,ge),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.LINEAR),ae=Q.heatmapFbo=U.createFramebuffer(Z.width/4,Z.height/4,!1,!1),function(Y,_e,Ce,Pe){var Re,We;const lt=Y.gl,_t=(Re=Y.HALF_FLOAT)!==null&&Re!==void 0?Re:lt.UNSIGNED_BYTE,et=(We=Y.RGBA16F)!==null&&We!==void 0?We:lt.RGBA;lt.texImage2D(lt.TEXTURE_2D,0,et,_e.width/4,_e.height/4,0,lt.RGBA,_t,null),Pe.colorAttachment.set(Ce)}(U,Z,ge,ae)}})(E,m,w),E.clear({color:d.aP.transparent});for(let U=0;U<k.length;U++){const Z=k[U];if(v.hasRenderableParent(Z))continue;const Q=v.getTile(Z),H=Q.getBucket(w);if(!H)continue;const ae=H.programConfigurations.get(w.id),ge=m.useProgram("heatmap",ae),{zoom:Y}=m.transform;ge.draw(E,D.TRIANGLES,ir.disabled,z,N,Yr.disabled,Ys(Z.posMatrix,Q,Y,w.paint.get("heatmap-intensity")),null,w.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,w.paint,m.transform.zoom,ae)}E.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(E,D){const z=E.context,N=z.gl,U=D.heatmapFbo;if(!U)return;z.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,U.colorAttachment.get()),z.activeTexture.set(N.TEXTURE1);let Z=D.colorRampTexture;Z||(Z=D.colorRampTexture=new Me(z,D.colorRamp,N.RGBA)),Z.bind(N.LINEAR,N.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(z,N.TRIANGLES,ir.disabled,Xr.disabled,E.colorModeForRenderPass(),Yr.disabled,((Q,H,ae,ge)=>{const Y=d.F();d.aO(Y,0,Q.width,Q.height,0,0,1);const _e=Q.context.gl;return{u_matrix:Y,u_world:[_e.drawingBufferWidth,_e.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}})(E,D),null,D.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,D.paint,E.transform.zoom)}(m,w))})(t,a,l,h);break;case"line":(function(m,v,w,k){if(m.renderPass!=="translucent")return;const E=w.paint.get("line-opacity"),D=w.paint.get("line-width");if(E.constantOr(1)===0||D.constantOr(1)===0)return;const z=m.depthModeForSublayer(0,ir.ReadOnly),N=m.colorModeForRenderPass(),U=w.paint.get("line-dasharray"),Z=w.paint.get("line-pattern"),Q=Z.constantOr(1),H=w.paint.get("line-gradient"),ae=w.getCrossfadeParameters(),ge=Q?"linePattern":U?"lineSDF":H?"lineGradient":"line",Y=m.context,_e=Y.gl;let Ce=!0;for(const Pe of k){const Re=v.getTile(Pe);if(Q&&!Re.patternsLoaded())continue;const We=Re.getBucket(w);if(!We)continue;const lt=We.programConfigurations.get(w.id),_t=m.context.program.get(),et=m.useProgram(ge,lt),st=Ce||et.program!==_t,wt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Pe),Gt=Z.constantOr(null);if(Gt&&Re.imageAtlas){const Ut=Re.imageAtlas,Zr=Ut.patternPositions[Gt.to.toString()],Yt=Ut.patternPositions[Gt.from.toString()];Zr&&Yt&&lt.setConstantPatternPositions(Zr,Yt)}const ot=wt?Pe:null,mt=Q?Sa(m,Re,w,ae,ot):U?ls(m,Re,w,U,ae,ot):H?yn(m,Re,w,We.lineClipsArray.length,ot):qi(m,Re,w,ot);if(Q)Y.activeTexture.set(_e.TEXTURE0),Re.imageAtlasTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),lt.updatePaintBuffers(ae);else if(U&&(st||m.lineAtlas.dirty))Y.activeTexture.set(_e.TEXTURE0),m.lineAtlas.bind(Y);else if(H){const Ut=We.gradients[w.id];let Zr=Ut.texture;if(w.gradientVersion!==Ut.version){let Yt=256;if(w.stepInterpolant){const fr=v.getSource().maxzoom,Hr=Pe.canonical.z===fr?Math.ceil(1<<m.transform.maxZoom-Pe.canonical.z):1;Yt=d.ac(d.aU(We.maxLineLength/d.W*1024*Hr),256,Y.maxTextureSize)}Ut.gradient=d.aV({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Yt,image:Ut.gradient||void 0,clips:We.lineClipsArray}),Ut.texture?Ut.texture.update(Ut.gradient):Ut.texture=new Me(Y,Ut.gradient,_e.RGBA),Ut.version=w.gradientVersion,Zr=Ut.texture}Y.activeTexture.set(_e.TEXTURE0),Zr.bind(w.stepInterpolant?_e.NEAREST:_e.LINEAR,_e.CLAMP_TO_EDGE)}et.draw(Y,_e.TRIANGLES,z,m.stencilModeForClipping(Pe),N,Yr.disabled,mt,wt,w.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,w.paint,m.transform.zoom,lt,We.layoutVertexBuffer2),Ce=!1}})(t,a,l,h);break;case"fill":(function(m,v,w,k){const E=w.paint.get("fill-color"),D=w.paint.get("fill-opacity");if(D.constantOr(1)===0)return;const z=m.colorModeForRenderPass(),N=w.paint.get("fill-pattern"),U=m.opaquePassEnabledForLayer()&&!N.constantOr(1)&&E.constantOr(d.aP.transparent).a===1&&D.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===U){const Z=m.depthModeForSublayer(1,m.renderPass==="opaque"?ir.ReadWrite:ir.ReadOnly);As(m,v,w,k,Z,z,!1)}if(m.renderPass==="translucent"&&w.paint.get("fill-antialias")){const Z=m.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,ir.ReadOnly);As(m,v,w,k,Z,z,!0)}})(t,a,l,h);break;case"fill-extrusion":(function(m,v,w,k){const E=w.paint.get("fill-extrusion-opacity");if(E!==0&&m.renderPass==="translucent"){const D=new ir(m.context.gl.LEQUAL,ir.ReadWrite,m.depthRangeFor3D);if(E!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Ji(m,v,w,k,D,Xr.disabled,ii.disabled),Ji(m,v,w,k,D,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const z=m.colorModeForRenderPass();Ji(m,v,w,k,D,Xr.disabled,z)}}})(t,a,l,h);break;case"hillshade":(function(m,v,w,k){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const E=m.context,D=m.depthModeForSublayer(0,ir.ReadOnly),z=m.colorModeForRenderPass(),[N,U]=m.renderPass==="translucent"?m.stencilConfigForOverlap(k):[{},k];for(const Z of U){const Q=v.getTile(Z);Q.needsHillshadePrepare!==void 0&&Q.needsHillshadePrepare&&m.renderPass==="offscreen"?vu(m,Q,w,D,Xr.disabled,z):m.renderPass==="translucent"&&_u(m,Z,Q,w,D,N[Z.overscaledZ],z)}E.viewport.set([0,0,m.width,m.height])})(t,a,l,h);break;case"raster":(function(m,v,w,k){if(m.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!k.length)return;const E=m.context,D=E.gl,z=v.getSource(),N=m.useProgram("raster"),U=m.colorModeForRenderPass(),[Z,Q]=z instanceof Zt?[{},k]:m.stencilConfigForOverlap(k),H=Q[Q.length-1].overscaledZ,ae=!m.options.moving;for(const ge of Q){const Y=m.depthModeForSublayer(ge.overscaledZ-H,w.paint.get("raster-opacity")===1?ir.ReadWrite:ir.ReadOnly,D.LESS),_e=v.getTile(ge);_e.registerFadeDuration(w.paint.get("raster-fade-duration"));const Ce=v.findLoadedParent(ge,0),Pe=v.findLoadedSibling(ge),Re=yc(_e,Ce||Pe||null,v,w,m.transform,m.style.map.terrain);let We,lt;const _t=w.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;E.activeTexture.set(D.TEXTURE0),_e.texture.bind(_t,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(D.TEXTURE1),Ce?(Ce.texture.bind(_t,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST),We=Math.pow(2,Ce.tileID.overscaledZ-_e.tileID.overscaledZ),lt=[_e.tileID.canonical.x*We%1,_e.tileID.canonical.y*We%1]):_e.texture.bind(_t,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const et=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ge),st=et?ge:null,wt=st?st.posMatrix:m.transform.calculatePosMatrix(ge.toUnwrapped(),ae),Gt=ka(wt,lt||[0,0],We||1,Re,w);z instanceof Zt?N.draw(E,D.TRIANGLES,Y,Xr.disabled,U,Yr.disabled,Gt,et,w.id,z.boundsBuffer,m.quadTriangleIndexBuffer,z.boundsSegments):N.draw(E,D.TRIANGLES,Y,Z[ge.overscaledZ],U,Yr.disabled,Gt,et,w.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}})(t,a,l,h);break;case"background":(function(m,v,w,k){const E=w.paint.get("background-color"),D=w.paint.get("background-opacity");if(D===0)return;const z=m.context,N=z.gl,U=m.transform,Z=U.tileSize,Q=w.paint.get("background-pattern");if(m.isPatternMissing(Q))return;const H=!Q&&E.a===1&&D===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==H)return;const ae=Xr.disabled,ge=m.depthModeForSublayer(0,H==="opaque"?ir.ReadWrite:ir.ReadOnly),Y=m.colorModeForRenderPass(),_e=m.useProgram(Q?"backgroundPattern":"background"),Ce=k||U.coveringTiles({tileSize:Z,terrain:m.style.map.terrain});Q&&(z.activeTexture.set(N.TEXTURE0),m.imageManager.bind(m.context));const Pe=w.getCrossfadeParameters();for(const Re of Ce){const We=k?Re.posMatrix:m.transform.calculatePosMatrix(Re.toUnwrapped()),lt=Q?bh(We,D,m,Q,{tileID:Re,tileSize:Z},Pe):Ca(We,D,E),_t=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Re);_e.draw(z,N.TRIANGLES,ge,ae,Y,Yr.disabled,lt,_t,w.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}})(t,0,l,h);break;case"custom":(function(m,v,w){const k=m.context,E=w.implementation;if(m.renderPass==="offscreen"){const D=E.prerender;D&&(m.setCustomLayerDefaults(),k.setColorMode(m.colorModeForRenderPass()),D.call(E,k.gl,m.transform.customLayerMatrix()),k.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),k.setColorMode(m.colorModeForRenderPass()),k.setStencilMode(Xr.disabled);const D=E.renderingMode==="3d"?new ir(m.context.gl.LEQUAL,ir.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,ir.ReadOnly);k.setDepthMode(D),E.render(k.gl,m.transform.customLayerMatrix()),k.setDirty(),m.setBaseState(),k.bindFramebuffer.set(null)}})(t,0,l)}}translatePosMatrix(t,a,l,h,m){if(!l[0]&&!l[1])return t;const v=m?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(v){const E=Math.sin(v),D=Math.cos(v);l=[l[0]*D-l[1]*E,l[0]*E+l[1]*D]}const w=[m?l[0]:qt(a,l[0],this.transform.zoom),m?l[1]:qt(a,l[1],this.transform.zoom),0],k=new Float32Array(16);return d.H(k,t,w),k}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!a||!l}useProgram(t,a){this.cache=this.cache||{};const l=t+(a?a.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new nc(this.context,wa[t],a,Zo[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Me(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}class Fa{constructor(t,a){this.points=t,this.planes=a}static fromInvProjectionMatrix(t,a,l){const h=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const k=1/(w=d.af([],w,t))[3]/a*h;return d.b0(w,w,[k,k,1/w[3],k])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const k=function(N,U){var Z=U[0],Q=U[1],H=U[2],ae=Z*Z+Q*Q+H*H;return ae>0&&(ae=1/Math.sqrt(ae)),N[0]=U[0]*ae,N[1]=U[1]*ae,N[2]=U[2]*ae,N}([],function(N,U,Z){var Q=U[0],H=U[1],ae=U[2],ge=Z[0],Y=Z[1],_e=Z[2];return N[0]=H*_e-ae*Y,N[1]=ae*ge-Q*_e,N[2]=Q*Y-H*ge,N}([],Ge([],m[w[0]],m[w[1]]),Ge([],m[w[2]],m[w[1]]))),E=-((D=k)[0]*(z=m[w[1]])[0]+D[1]*z[1]+D[2]*z[2]);var D,z;return k.concat(E)});return new Fa(m,v)}}class el{constructor(t,a){this.min=t,this.max=a,this.center=function(l,h,m){return l[0]=.5*h[0],l[1]=.5*h[1],l[2]=.5*h[2],l}([],function(l,h,m){return l[0]=h[0]+m[0],l[1]=h[1]+m[1],l[2]=h[2]+m[2],l}([],this.min,this.max))}quadrant(t){const a=[t%2==0,t<2],l=Ue(this.min),h=Ue(this.max);for(let m=0;m<a.length;m++)l[m]=a[m]?this.min[m]:this.center[m],h[m]=a[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new el(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const a=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let h=0;h<t.planes.length;h++){const m=t.planes[h];let v=0;for(let w=0;w<a.length;w++)d.b1(m,a[w])>=0&&v++;if(v===0)return 0;v!==a.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let m=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<t.points.length;w++){const k=t.points[w][h]-this.min[h];m=Math.min(m,k),v=Math.max(v,k)}if(v<0||m>this.max[h]-this.min[h])return 0}return 1}}class ea{constructor(t=0,a=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=l,this.right=h}interpolate(t,a,l){return a.top!=null&&t.top!=null&&(this.top=d.z.number(t.top,a.top,l)),a.bottom!=null&&t.bottom!=null&&(this.bottom=d.z.number(t.bottom,a.bottom,l)),a.left!=null&&t.left!=null&&(this.left=d.z.number(t.left,a.left,l)),a.right!=null&&t.right!=null&&(this.right=d.z.number(t.right,a.right,l)),this}getCenter(t,a){const l=d.ac((this.left+t-this.right)/2,0,t),h=d.ac((this.top+a-this.bottom)/2,0,a);return new d.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ea(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const hs=85.051129;class go{constructor(t,a,l,h,m){this.tileSize=512,this._renderWorldCopies=m===void 0||!!m,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=l??0,this._maxPitch=h??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ea,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new go(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const a=-d.b2(t,-180,180)*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=function(){var l=new d.A(4);return d.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,h,m){var v=h[0],w=h[1],k=h[2],E=h[3],D=Math.sin(m),z=Math.cos(m);l[0]=v*z+k*D,l[1]=w*z+E*D,l[2]=v*-D+k*z,l[3]=w*-D+E*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=d.ac(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this.tileZoom=Math.max(0,Math.floor(a)),this.scale=this.zoomScale(a),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,l){this._unmodified=!1,this._edgeInsets.interpolate(t,a,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new d.b3(0,t)];if(this._renderWorldCopies){const l=this.pointCoordinate(new d.P(0,0)),h=this.pointCoordinate(new d.P(this.width,0)),m=this.pointCoordinate(new d.P(this.width,this.height)),v=this.pointCoordinate(new d.P(0,this.height)),w=Math.floor(Math.min(l.x,h.x,m.x,v.x)),k=Math.floor(Math.max(l.x,h.x,m.x,v.x)),E=1;for(let D=w-E;D<=k+E;D++)D!==0&&a.push(new d.b3(D,t))}return a}coveringTiles(t){var a,l;let h=this.coveringZoomLevel(t);const m=h;if(t.minzoom!==void 0&&h<t.minzoom)return[];t.maxzoom!==void 0&&h>t.maxzoom&&(h=t.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),w=d.Y.fromLngLat(this.center),k=Math.pow(2,h),E=[k*v.x,k*v.y,0],D=[k*w.x,k*w.y,0],z=Fa.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h);let N=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(N=h);const U=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,Z=Y=>({aabb:new el([Y*k,0,0],[(Y+1)*k,k,0]),zoom:0,x:0,y:0,wrap:Y,fullyVisible:!1}),Q=[],H=[],ae=h,ge=t.reparseOverscaled?m:h;if(this._renderWorldCopies)for(let Y=1;Y<=3;Y++)Q.push(Z(-Y)),Q.push(Z(Y));for(Q.push(Z(0));Q.length>0;){const Y=Q.pop(),_e=Y.x,Ce=Y.y;let Pe=Y.fullyVisible;if(!Pe){const et=Y.aabb.intersects(z);if(et===0)continue;Pe=et===2}const Re=t.terrain?E:D,We=Y.aabb.distanceX(Re),lt=Y.aabb.distanceY(Re),_t=Math.max(Math.abs(We),Math.abs(lt));if(Y.zoom===ae||_t>U+(1<<ae-Y.zoom)-2&&Y.zoom>=N){const et=ae-Y.zoom,st=E[0]-.5-(_e<<et),wt=E[1]-.5-(Ce<<et);H.push({tileID:new d.Q(Y.zoom===ae?ge:Y.zoom,Y.wrap,Y.zoom,_e,Ce),distanceSq:re([D[0]-.5-_e,D[1]-.5-Ce]),tileDistanceToCamera:Math.sqrt(st*st+wt*wt)})}else for(let et=0;et<4;et++){const st=(_e<<1)+et%2,wt=(Ce<<1)+(et>>1),Gt=Y.zoom+1;let ot=Y.aabb.quadrant(et);if(t.terrain){const mt=new d.Q(Gt,Y.wrap,Gt,st,wt),Ut=t.terrain.getMinMaxElevation(mt),Zr=(a=Ut.minElevation)!==null&&a!==void 0?a:this.elevation,Yt=(l=Ut.maxElevation)!==null&&l!==void 0?l:this.elevation;ot=new el([ot.min[0],ot.min[1],Zr],[ot.max[0],ot.max[1],Yt])}Q.push({aabb:ot,zoom:Gt,x:st,y:wt,wrap:Y.wrap,fullyVisible:Pe})}}return H.sort((Y,_e)=>Y.distanceSq-_e.distanceSq).map(Y=>Y.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const a=d.ac(t.lat,-85.051129,hs);return new d.P(d.N(t.lng)*this.worldSize,d.O(a)*this.worldSize)}unproject(t){return new d.Y(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const a=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,h=this.pointLocation(this.centerPoint,t),m=t.getElevationForLngLatZoom(h,this.tileZoom);if(!(this.elevation-m))return;const v=l+a-m,w=Math.cos(this._pitch)*this.cameraToCenterDistance/v/d.b4(1,h.lat),k=this.scaleZoom(w/this.tileSize);this._elevation=m,this._center=h,this.zoom=k}setLocationAtPoint(t,a){const l=this.pointCoordinate(a),h=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(t),v=new d.Y(m.x-(l.x-h.x),m.y-(l.y-h.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,a){return a?this.coordinatePoint(this.locationCoordinate(t),a.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,a){return this.coordinateLocation(this.pointCoordinate(t,a))}locationCoordinate(t){return d.Y.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,a){if(a){const N=a.pointCoordinate(t);if(N!=null)return N}const l=[t.x,t.y,0,1],h=[t.x,t.y,1,1];d.af(l,l,this.pixelMatrixInverse),d.af(h,h,this.pixelMatrixInverse);const m=l[3],v=h[3],w=l[1]/m,k=h[1]/v,E=l[2]/m,D=h[2]/v,z=E===D?0:(0-E)/(D-E);return new d.Y(d.z.number(l[0]/m,h[0]/v,z)/this.worldSize,d.z.number(w,k,z)/this.worldSize)}coordinatePoint(t,a=0,l=this.pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,a,1];return d.af(h,h,l),new d.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new or().extend(this.pointLocation(new d.P(0,t))).extend(this.pointLocation(new d.P(this.width,t))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new or([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,hs])}calculatePosMatrix(t,a=!1){const l=t.key,h=a?this._alignedPosMatrixCache:this._posMatrixCache;if(h[l])return h[l];const m=t.canonical,v=this.worldSize/this.zoomScale(m.z),w=m.x+Math.pow(2,m.z)*t.wrap,k=d.an(new Float64Array(16));return d.H(k,k,[w*v,m.y*v,0]),d.J(k,k,[v/d.W,v/d.W,1]),d.K(k,a?this.alignedProjMatrix:this.projMatrix,k),h[l]=new Float32Array(k),h[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,a){a=d.ac(+a,this.minZoom,this.maxZoom);const l={center:new d.M(t.lng,t.lat),zoom:a};let h=this.lngRange;if(!this._renderWorldCopies&&h===null){const Y=179.9999999999;h=[-Y,Y]}const m=this.tileSize*this.zoomScale(l.zoom);let v=0,w=m,k=0,E=m,D=0,z=0;const{x:N,y:U}=this.size;if(this.latRange){const Y=this.latRange;v=d.O(Y[1])*m,w=d.O(Y[0])*m,w-v<U&&(D=U/(w-v))}h&&(k=d.b2(d.N(h[0])*m,0,m),E=d.b2(d.N(h[1])*m,0,m),E<k&&(E+=m),E-k<N&&(z=N/(E-k)));const{x:Z,y:Q}=this.project.call({worldSize:m},t);let H,ae;const ge=Math.max(z||0,D||0);if(ge){const Y=new d.P(z?(E+k)/2:Z,D?(w+v)/2:Q);return l.center=this.unproject.call({worldSize:m},Y).wrap(),l.zoom+=this.scaleZoom(ge),l}if(this.latRange){const Y=U/2;Q-Y<v&&(ae=v+Y),Q+Y>w&&(ae=w-Y)}if(h){const Y=(k+E)/2;let _e=Z;this._renderWorldCopies&&(_e=d.b2(Z,Y-m/2,Y+m/2));const Ce=N/2;_e-Ce<k&&(H=k+Ce),_e+Ce>E&&(H=E-Ce)}if(H!==void 0||ae!==void 0){const Y=new d.P(H??Z,ae??Q);l.center=this.unproject.call({worldSize:m},Y).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=a,this.zoom=l,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b4(1,this.center.lat)*this.worldSize;let h=d.an(new Float64Array(16));d.J(h,h,[this.width/2,-this.height/2,1]),d.H(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=d.an(new Float64Array(16)),d.J(h,h,[1,-1,1]),d.H(h,h,[-1,-1,0]),d.J(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h;const m=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),w=m-v*this._pixelPerMeter/Math.cos(this._pitch),k=v<0?w:m,E=Math.PI/2+this._pitch,D=this._fov*(.5+t.y/this.height),z=Math.sin(D)*k/Math.sin(d.ac(Math.PI-E-D,.01,Math.PI-.01)),N=this.getHorizon(),U=2*Math.atan(N/this.cameraToCenterDistance)*(.5+t.y/(2*N)),Z=Math.sin(U)*k/Math.sin(d.ac(Math.PI-E-U,.01,Math.PI-.01)),Q=Math.min(z,Z),H=1.01*(Math.cos(Math.PI/2-this._pitch)*Q+k),ae=this.height/50;h=new Float64Array(16),d.b5(h,this._fov,this.width/this.height,ae,H),h[8]=2*-t.x/this.width,h[9]=2*t.y/this.height,d.J(h,h,[1,-1,1]),d.H(h,h,[0,0,-this.cameraToCenterDistance]),d.b6(h,h,this._pitch),d.ad(h,h,this.angle),d.H(h,h,[-a,-l,0]),this.mercatorMatrix=d.J([],h,[this.worldSize,this.worldSize,this.worldSize]),d.J(h,h,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.K(new Float64Array(16),this.labelPlaneMatrix,h),d.H(h,h,[0,0,-this.elevation]),this.projMatrix=h,this.invProjMatrix=d.as([],h),this.pixelMatrix3D=d.K(new Float64Array(16),this.labelPlaneMatrix,h);const ge=this.width%2/2,Y=this.height%2/2,_e=Math.cos(this.angle),Ce=Math.sin(this.angle),Pe=a-Math.round(a)+_e*ge+Ce*Y,Re=l-Math.round(l)+_e*Y+Ce*ge,We=new Float64Array(h);if(d.H(We,We,[Pe>.5?Pe-1:Pe,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=We,h=d.as(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");this.pixelMatrixInverse=h,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new d.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return d.af(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,t))}getCameraQueryGeometry(t){const a=this.getCameraPoint();if(t.length===1)return[t[0],a];{let l=a.x,h=a.y,m=a.x,v=a.y;for(const w of t)l=Math.min(l,w.x),h=Math.min(h,w.y),m=Math.max(m,w.x),v=Math.max(v,w.y);return[new d.P(l,h),new d.P(m,h),new d.P(m,v),new d.P(l,v),new d.P(l,h)]}}lngLatToCameraDepth(t,a){const l=this.locationCoordinate(t),h=[l.x*this.worldSize,l.y*this.worldSize,a,1];return d.af(h,h,this.projMatrix),h[2]/h[3]}}function bu(p,t){let a,l=!1,h=null,m=null;const v=()=>{h=null,l&&(p.apply(m,a),h=setTimeout(v,t),l=!1)};return(...w)=>(l=!0,m=this,a=w,h||v(),h)}class _c{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let l;return a.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(a.length>=3&&!a.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:l,pitch:+(a[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch{}},this._updateHash=bu(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const a=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,h),v=Math.round(a.lng*m)/m,w=Math.round(a.lat*m)/m,k=this._map.getBearing(),E=this._map.getPitch();let D="";if(D+=t?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(k||E)&&(D+="/"+Math.round(10*k)/10),E&&(D+=`/${Math.round(E)}`),this._hashName){const z=this._hashName;let N=!1;const U=window.location.hash.slice(1).split("&").map(Z=>{const Q=Z.split("=")[0];return Q===z?(N=!0,`${Q}=${D}`):Z}).filter(Z=>Z);return N||U.push(`${z}=${D}`),`#${U.join("&")}`}return`#${D}`}}const Ba={linearity:.3,easing:d.b7(0,0,.3,1)},vc=d.e({deceleration:2500,maxSpeed:1400},Ba),tl=d.e({deceleration:20,maxSpeed:1400},Ba),rl=d.e({deceleration:1e3,maxSpeed:360},Ba),il=d.e({deceleration:1e3,maxSpeed:90},Ba);class yo{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ie.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=ie.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)a.zoom+=m.zoomDelta||0,a.bearing+=m.bearingDelta||0,a.pitch+=m.pitchDelta||0,m.panDelta&&a.pan._add(m.panDelta),m.around&&(a.around=m.around),m.pinchAround&&(a.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(a.pan.mag()){const m=Yn(a.pan.mag(),l,d.e({},vc,t||{}));h.offset=a.pan.mult(m.amount/a.pan.mag()),h.center=this._map.transform.center,_o(h,m)}if(a.zoom){const m=Yn(a.zoom,l,tl);h.zoom=this._map.transform.zoom+m.amount,_o(h,m)}if(a.bearing){const m=Yn(a.bearing,l,rl);h.bearing=this._map.transform.bearing+d.ac(m.amount,-179,179),_o(h,m)}if(a.pitch){const m=Yn(a.pitch,l,il);h.pitch=this._map.transform.pitch+m.amount,_o(h,m)}if(h.zoom||h.bearing){const m=a.pinchAround===void 0?a.around:a.pinchAround;h.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),d.e(h,{noMoveStart:!0})}}function _o(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function Yn(p,t,a){const{maxSpeed:l,linearity:h,deceleration:m}=a,v=d.ac(p*h/(t/1e3),-l,l),w=Math.abs(v)/(m*h);return{easing:a.easing,duration:1e3*w,amount:v*(w/2)}}class Gi extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l,h={}){const m=G.mousePos(a.getCanvas(),l),v=a.unproject(m);super(t,d.e({point:m,lngLat:v,originalEvent:l},h)),this._defaultPrevented=!1,this.target=a}}class ta extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l){const h=t==="touchend"?l.changedTouches:l.touches,m=G.touchPos(a.getCanvasContainer(),h),v=m.map(k=>a.unproject(k)),w=m.reduce((k,E,D,z)=>k.add(E.div(z.length)),new d.P(0,0));super(t,{points:m,point:w,lngLats:v,lngLat:a.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class xc extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class vo{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new xc(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Gi(t.type,this._map,t))}mouseup(t){this._map.fire(new Gi(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Gi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Gi(t.type,this._map,t))}mouseover(t){this._map.fire(new Gi(t.type,this._map,t))}mouseout(t){this._map.fire(new Gi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new ta(t.type,this._map,t))}touchmove(t){this._map.fire(new ta(t.type,this._map,t))}touchend(t){this._map.fire(new ta(t.type,this._map,t))}touchcancel(t){this._map.fire(new ta(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Gi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Gi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Na{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(d.P.convert(t),this._map.terrain)}}class xo{constructor(t,a){this._map=t,this._tr=new Na(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(G.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const l=a;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=G.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const m=Math.min(h.x,l.x),v=Math.max(h.x,l.x),w=Math.min(h.y,l.y),k=Math.max(h.y,l.y);G.setTransform(this._box,`translate(${m}px,${w}px)`),this._box.style.width=v-m+"px",this._box.style.height=k-w+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const l=this._startPos,h=a;if(this.reset(),G.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new d.k(t,{originalEvent:a}))}}function Oa(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const a={};for(let l=0;l<p.length;l++)a[p[l].identifier]=t[l];return a}class bc{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const m=new d.P(0,0);for(const v of h)m._add(v);return m.div(h.length)}(a),this.touches=Oa(l,a)))}touchmove(t,a,l){if(this.aborted||!this.centroid)return;const h=Oa(l,a);for(const m in this.touches){const v=h[m];(!v||v.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,a,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class nl{constructor(t){this.singleTap=new bc(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,l){this.singleTap.touchstart(t,a,l)}touchmove(t,a,l){this.singleTap.touchmove(t,a,l)}touchend(t,a,l){const h=this.singleTap.touchend(t,a,l);if(h){const m=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(h)<30;if(m&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class sl{constructor(t){this._tr=new Na(t),this._zoomIn=new nl({numTouches:1,numTaps:2}),this._zoomOut=new nl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,l){this._zoomIn.touchstart(t,a,l),this._zoomOut.touchstart(t,a,l)}touchmove(t,a,l){this._zoomIn.touchmove(t,a,l),this._zoomOut.touchmove(t,a,l)}touchend(t,a,l){const h=this._zoomIn.touchend(t,a,l),m=this._zoomOut.touchend(t,a,l),v=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(h)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ra{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=a.length?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=a.length?a[0]:a;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&G.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Dh={0:1,2:2};class al{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=G.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(a,l){const h=Dh[l];return a.buttons===void 0||(a.buttons&h)!==h}(t,this._eventButton)}isValidEndEvent(t){return G.mouseButton(t)===this._eventButton}}class ni{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ds=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=t=>{t.preventDefault()}},vn=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:a=.8})=>{const l=new al({checkCorrectEvent:h=>G.mouseButton(h)===0&&h.ctrlKey||G.mouseButton(h)===2});return new ra({clickTolerance:t,move:(h,m)=>({bearingDelta:(m.x-h.x)*a}),moveStateManager:l,enable:p,assignEvents:ds})},ol=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:a=-.5})=>{const l=new al({checkCorrectEvent:h=>G.mouseButton(h)===0&&h.ctrlKey||G.mouseButton(h)===2});return new ra({clickTolerance:t,move:(h,m)=>({pitchDelta:(m.y-h.y)*a}),moveStateManager:l,enable:p,assignEvents:ds})};class wc{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,a,l){return this._calculateTransform(t,a,l)}touchmove(t,a,l){if(this._active&&!(l.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,a,l)}touchend(t,a,l){this._calculateTransform(t,a,l),this._active&&l.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,l){l.length>0&&(this._active=!0);const h=Oa(l,a),m=new d.P(0,0),v=new d.P(0,0);let w=0;for(const E in h){const D=h[E],z=this._touches[E];z&&(m._add(D),v._add(D.sub(z)),w++,h[E]=D)}if(this._touches=h,w<this.minTouchs()||!v.mag())return;const k=v.div(w);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(w),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ll{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,m]=this._firstTwoTouches,v=ps(l,a,h),w=ps(l,a,m);if(!v||!w)return;const k=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],k,t)}touchend(t,a,l){if(!this._firstTwoTouches)return;const[h,m]=this._firstTwoTouches,v=ps(l,a,h),w=ps(l,a,m);v&&w||(this._active&&G.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ps(p,t,a){for(let l=0;l<p.length;l++)if(p[l].identifier===a)return t[l]}function $a(p,t){return Math.log(p/t)/Math.LN2}class cl extends ll{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs($a(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$a(this._distance,l),pinchAround:a}}}function ul(p,t){return 180*p.angleWith(t)/Math.PI}class hl extends ll{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ul(this._vector,h),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,l=ul(t,this._startVector);return Math.abs(l)<a}}function dl(p){return Math.abs(p.y)>Math.abs(p.x)}class pl extends ll{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,l){super.touchstart(t,a,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,dl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),m=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,m,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,m=a.mag()>=2;if(!h&&!m)return;if(!h||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==a.y>0;return dl(t)&&dl(a)&&v}}const wu={panStep:100,bearingStep:15,pitchStep:10};class Ms{constructor(t){this._tr=new Na(t);const a=wu;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,l=0,h=0,m=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:w=>{const k=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:zs,zoom:a?Math.round(k.zoom)+a*(t.shiftKey?2:1):k.zoom,bearing:k.bearing+l*this._bearingStep,pitch:k.pitch+h*this._pitchStep,offset:[-m*this._panStep,-v*this._panStep],center:k.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function zs(p){return p*(2-p)}const Sc=4.000244140625;class kc{constructor(t,a){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new Na(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=ie.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,a!==0&&a%Sc==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=G.mousePos(this._map.getCanvas(),t),l=this._tr;this._around=a.y>l.transform.height/2-l.transform.getHorizon()?d.M.convert(this._aroundCenter?l.center:l.unproject(a)):d.M.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Sc?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&k!==0&&(k=1/k);const E=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(E*k))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,l=this._startZoom,h=this._easing;let m,v=!1;if(this._type==="wheel"&&l&&h){const w=Math.min((ie.now()-this._lastWheelEventTime)/200,1),k=h(w);m=d.z.number(l,a,k),w<1?this._frameId||(this._frameId=!0):v=!0}else m=a,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:m-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=d.b8;if(this._prevEase){const l=this._prevEase,h=(ie.now()-l.start)/l.duration,m=l.easing(h+.01)-l.easing(h),v=.27/Math.sqrt(m*m+1e-4)*.01,w=Math.sqrt(.0729-v*v);a=d.b7(v,w,.25,1)}return this._prevEase={start:ie.now(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ds{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Su{constructor(t){this._tr=new Na(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ku{constructor(){this._tap=new nl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,l){if(!this._swipePoint)if(this._tapTime){const h=a[0],m=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(h)<30;m&&v?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,a,l)}touchmove(t,a,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=a[0],m=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,a,l)}touchend(t,a,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,a,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cc{constructor(t,a,l){this._el=t,this._mousePan=a,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ja{constructor(t,a,l){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Tc{constructor(t,a,l,h){this._el=t,this._touchZoom=a,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class un{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=G.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=a,this._container.appendChild(h);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=l,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(G.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){this._enabled&&t&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Jr=p=>p.zoom||p.drag||p.pitch||p.rotate;class Ic extends d.k{}function xn(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Ls{constructor(t,a){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,m)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=h.type==="renderFrame"?void 0:h,w={needsRenderFrame:!1},k={},E={},D=h.touches,z=D?this._getMapTouches(D):void 0,N=z?G.touchPos(this._map.getCanvas(),z):G.mousePos(this._map.getCanvas(),h);for(const{handlerName:Q,handler:H,allowed:ae}of this._handlers){if(!H.isEnabled())continue;let ge;this._blockedByActive(E,ae,Q)?H.reset():H[m||h.type]&&(ge=H[m||h.type](h,N,z),this.mergeHandlerResult(w,k,ge,Q,v),ge&&ge.needsRenderFrame&&this._triggerRenderFrame()),(ge||H.isActive())&&(E[Q]=H)}const U={};for(const Q in this._previousActiveHandlers)E[Q]||(U[Q]=v);this._previousActiveHandlers=E,(Object.keys(U).length||xn(w))&&(this._changes.push([w,k,U]),this._triggerRenderFrame()),(Object.keys(E).length||xn(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=w;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yo(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,m,v]of this._listeners)G.addEventListener(h,m,h===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,a,l]of this._listeners)G.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const a=this._map,l=a.getCanvasContainer();this._add("mapEvent",new vo(a,t));const h=a.boxZoom=new xo(a,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const m=a.cooperativeGestures=new un(a,t.cooperativeGestures);this._add("cooperativeGestures",m),t.cooperativeGestures&&m.enable();const v=new sl(a),w=new Su(a);a.doubleClickZoom=new Ds(w,v),this._add("tapZoom",v),this._add("clickZoom",w),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const k=new ku;this._add("tapDragZoom",k);const E=a.touchPitch=new pl(a);this._add("touchPitch",E),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const D=vn(t),z=ol(t);a.dragRotate=new ja(t,D,z),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const N=(({enable:ge,clickTolerance:Y})=>{const _e=new al({checkCorrectEvent:Ce=>G.mouseButton(Ce)===0&&!Ce.ctrlKey});return new ra({clickTolerance:Y,move:(Ce,Pe)=>({around:Pe,panDelta:Pe.sub(Ce)}),activateOnStart:!0,moveStateManager:_e,enable:ge,assignEvents:ds})})(t),U=new wc(t,a);a.dragPan=new Cc(l,N,U),this._add("mousePan",N),this._add("touchPan",U,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const Z=new hl,Q=new cl;a.touchZoomRotate=new Tc(l,Q,Z,k),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate);const H=a.scrollZoom=new kc(a,()=>this._triggerRenderFrame());this._add("scrollZoom",H,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const ae=a.keyboard=new Ms(a);this._add("keyboard",ae),t.interactive&&t.keyboard&&a.keyboard.enable(),this._add("blockableMapEvent",new zh(a))}_add(t,a,l){this._handlers.push({handlerName:t,handler:a,allowed:l}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Jr(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,l){for(const h in t)if(h!==l&&(!a||a.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const l of t)this._el.contains(l.target)&&a.push(l);return a}mergeHandlerResult(t,a,l,h,m){if(!l)return;d.e(t,l);const v={handlerName:h,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(a.zoom=v),l.panDelta!==void 0&&(a.drag=v),l.pitchDelta!==void 0&&(a.pitch=v),l.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){const t={},a={},l={};for(const[h,m,v]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new d.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),d.e(a,m),d.e(l,v);this._updateMapTransform(t,a,l),this._changes=[]}_updateMapTransform(t,a,l){const h=this._map,m=h._getTransformForUpdate(),v=h.terrain;if(!(xn(t)||v&&this._terrainMovement))return this._fireEvents(a,l,!0);let{panDelta:w,zoomDelta:k,bearingDelta:E,pitchDelta:D,around:z,pinchAround:N}=t;N!==void 0&&(z=N),h._stop(!0),z=z||h.transform.centerPoint;const U=m.pointLocation(w?z.sub(w):z);E&&(m.bearing+=E),D&&(m.pitch+=D),k&&(m.zoom+=k),v?this._terrainMovement||!a.drag&&!a.zoom?a.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(w)):m.setLocationAtPoint(U,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,m.setLocationAtPoint(U,z)):m.setLocationAtPoint(U,z),h._applyUpdatedTransform(m),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,l,!0)}_fireEvents(t,a,l){const h=Jr(this._eventsInProgress),m=Jr(t),v={};for(const z in t){const{originalEvent:N}=t[z];this._eventsInProgress[z]||(v[`${z}start`]=N),this._eventsInProgress[z]=t[z]}!h&&m&&this._fireEvent("movestart",m.originalEvent);for(const z in v)this._fireEvent(z,v[z]);m&&this._fireEvent("move",m.originalEvent);for(const z in t){const{originalEvent:N}=t[z];this._fireEvent(z,N)}const w={};let k;for(const z in this._eventsInProgress){const{handlerName:N,originalEvent:U}=this._eventsInProgress[z];this._handlersById[N].isActive()||(delete this._eventsInProgress[z],k=a[N]||U,w[`${z}end`]=k)}for(const z in w)this._fireEvent(z,w[z]);const E=Jr(this._eventsInProgress),D=(h||m)&&!E;if(D&&this._terrainMovement&&(this._map._elevationFreeze=!1,this._terrainMovement=!1,this._map.transform.recalculateZoom(this._map.terrain)),l&&D){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;!z||!z.essential&&ie.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:k})),N(this._map.getBearing())&&this._map.resetNorth()):(N(z.bearing||this._map.getBearing())&&(z.bearing=0),z.freezeElevation=!0,this._map.easeTo(z,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new d.k(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Ic("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Cu extends d.E{constructor(t,a){super(),this._renderFrameCallback=()=>{const l=Math.min((ie.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.M(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,l){return t=d.P.convert(t).mult(-1),this.panTo(this.transform.center,d.e({offset:t},a),l)}panTo(t,a,l){return this.easeTo(d.e({center:t},a),l)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,l){return this.easeTo(d.e({zoom:t},a),l)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,l){return this.easeTo(d.e({bearing:t},a),l)}resetNorth(t,a){return this.rotateTo(0,d.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=or.convert(t);const l=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,a)}_cameraForBoxAndBearing(t,a,l,h){const m={top:0,bottom:0,right:0,left:0};if(typeof(h=d.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const et=h.padding;h.padding={top:et,bottom:et,right:et,left:et}}h.padding=d.e(m,h.padding);const v=this.transform,w=v.padding,k=new or(t,a),E=v.project(k.getNorthWest()),D=v.project(k.getNorthEast()),z=v.project(k.getSouthEast()),N=v.project(k.getSouthWest()),U=d.b9(-l),Z=E.rotate(U),Q=D.rotate(U),H=z.rotate(U),ae=N.rotate(U),ge=new d.P(Math.max(Z.x,Q.x,ae.x,H.x),Math.max(Z.y,Q.y,ae.y,H.y)),Y=new d.P(Math.min(Z.x,Q.x,ae.x,H.x),Math.min(Z.y,Q.y,ae.y,H.y)),_e=ge.sub(Y),Ce=(v.width-(w.left+w.right+h.padding.left+h.padding.right))/_e.x,Pe=(v.height-(w.top+w.bottom+h.padding.top+h.padding.bottom))/_e.y;if(Pe<0||Ce<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Re=Math.min(v.scaleZoom(v.scale*Math.min(Ce,Pe)),h.maxZoom),We=d.P.convert(h.offset),lt=new d.P((h.padding.left-h.padding.right)/2,(h.padding.top-h.padding.bottom)/2).rotate(d.b9(l)),_t=We.add(lt).mult(v.scale/v.zoomScale(Re));return{center:v.unproject(E.add(z).div(2).sub(_t)),zoom:Re,bearing:l}}fitBounds(t,a,l){return this._fitInternal(this.cameraForBounds(t,a),a,l)}fitScreenCoordinates(t,a,l,h,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(t)),this.transform.pointLocation(d.P.convert(a)),l,h),h,m)}_fitInternal(t,a,l){return t?(delete(a=d.e(t,a)).padding,a.linear?this.easeTo(a,l):this.flyTo(a,l)):this}jumpTo(t,a){this.stop();const l=this._getTransformForUpdate();let h=!1,m=!1,v=!1;return"zoom"in t&&l.zoom!==+t.zoom&&(h=!0,l.zoom=+t.zoom),t.center!==void 0&&(l.center=d.M.convert(t.center)),"bearing"in t&&l.bearing!==+t.bearing&&(m=!0,l.bearing=+t.bearing),"pitch"in t&&l.pitch!==+t.pitch&&(v=!0,l.pitch=+t.pitch),t.padding==null||l.isPaddingEqual(t.padding)||(l.padding=t.padding),this._applyUpdatedTransform(l),this.fire(new d.k("movestart",a)).fire(new d.k("move",a)),h&&this.fire(new d.k("zoomstart",a)).fire(new d.k("zoom",a)).fire(new d.k("zoomend",a)),m&&this.fire(new d.k("rotatestart",a)).fire(new d.k("rotate",a)).fire(new d.k("rotateend",a)),v&&this.fire(new d.k("pitchstart",a)).fire(new d.k("pitch",a)).fire(new d.k("pitchend",a)),this.fire(new d.k("moveend",a))}calculateCameraOptionsFromTo(t,a,l,h=0){const m=d.Y.fromLngLat(t,a),v=d.Y.fromLngLat(l,h),w=v.x-m.x,k=v.y-m.y,E=v.z-m.z,D=Math.hypot(w,k,E);if(D===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,k),N=this.transform.scaleZoom(this.transform.cameraToCenterDistance/D/this.transform.tileSize),U=180*Math.atan2(w,-k)/Math.PI;let Z=180*Math.acos(z/D)/Math.PI;return Z=E<0?90-Z:90+Z,{center:v.toLngLat(),zoom:N,pitch:Z,bearing:U}}easeTo(t,a){var l;this._stop(!1,t.easeId),((t=d.e({offset:[0,0],duration:500,easing:d.b8},t)).animate===!1||!t.essential&&ie.prefersReducedMotion)&&(t.duration=0);const h=this._getTransformForUpdate(),m=this.getZoom(),v=this.getBearing(),w=this.getPitch(),k=this.getPadding(),E="bearing"in t?this._normalizeBearing(t.bearing,v):v,D="pitch"in t?+t.pitch:w,z="padding"in t?t.padding:h.padding,N=d.P.convert(t.offset);let U=h.centerPoint.add(N);const Z=h.pointLocation(U),{center:Q,zoom:H}=h.getConstrained(d.M.convert(t.center||Z),(l=t.zoom)!==null&&l!==void 0?l:m);this._normalizeCenter(Q);const ae=h.project(Z),ge=h.project(Q).sub(ae),Y=h.zoomScale(H-m);let _e,Ce;t.around&&(_e=d.M.convert(t.around),Ce=h.locationPoint(_e));const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||H!==m,this._rotating=this._rotating||v!==E,this._pitching=this._pitching||D!==w,this._padding=!h.isPaddingEqual(z),this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Pe),this.terrain&&this._prepareElevation(Q),this._ease(Re=>{if(this._zooming&&(h.zoom=d.z.number(m,H,Re)),this._rotating&&(h.bearing=d.z.number(v,E,Re)),this._pitching&&(h.pitch=d.z.number(w,D,Re)),this._padding&&(h.interpolatePadding(k,z,Re),U=h.centerPoint.add(N)),this.terrain&&!t.freezeElevation&&this._updateElevation(Re),_e)h.setLocationAtPoint(_e,Ce);else{const We=h.zoomScale(h.zoom-m),lt=H>m?Math.min(2,Y):Math.max(.5,Y),_t=Math.pow(lt,1-Re),et=h.unproject(ae.add(ge.mult(Re*_t)).mult(We));h.setLocationAtPoint(h.renderWorldCopies?et.wrap():et,U)}this._applyUpdatedTransform(h),this._fireMoveEvents(a)},Re=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,Re)},t),this}_prepareEase(t,a,l={}){this._moving=!0,a||l.moving||this.fire(new d.k("movestart",t)),this._zooming&&!l.zooming&&this.fire(new d.k("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new d.k("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new d.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(a-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.elevation=d.z.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const a=t.clone(),{center:l,zoom:h,pitch:m,bearing:v,elevation:w}=this.transformCameraUpdate(a);l&&(a.center=l),h!==void 0&&(a.zoom=h),m!==void 0&&(a.pitch=m),v!==void 0&&(a.bearing=v),w!==void 0&&(a.elevation=w),this.transform.apply(a)}_fireMoveEvents(t){this.fire(new d.k("move",t)),this._zooming&&this.fire(new d.k("zoom",t)),this._rotating&&this.fire(new d.k("rotate",t)),this._pitching&&this.fire(new d.k("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const l=this._zooming,h=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new d.k("zoomend",t)),h&&this.fire(new d.k("rotateend",t)),m&&this.fire(new d.k("pitchend",t)),this.fire(new d.k("moveend",t))}flyTo(t,a){var l;if(!t.essential&&ie.prefersReducedMotion){const mt=d.L(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(mt,a)}this.stop(),t=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b8},t);const h=this._getTransformForUpdate(),m=this.getZoom(),v=this.getBearing(),w=this.getPitch(),k=this.getPadding(),E="bearing"in t?this._normalizeBearing(t.bearing,v):v,D="pitch"in t?+t.pitch:w,z="padding"in t?t.padding:h.padding,N=d.P.convert(t.offset);let U=h.centerPoint.add(N);const Z=h.pointLocation(U),{center:Q,zoom:H}=h.getConstrained(d.M.convert(t.center||Z),(l=t.zoom)!==null&&l!==void 0?l:m);this._normalizeCenter(Q);const ae=h.zoomScale(H-m),ge=h.project(Z),Y=h.project(Q).sub(ge);let _e=t.curve;const Ce=Math.max(h.width,h.height),Pe=Ce/ae,Re=Y.mag();if("minZoom"in t){const mt=d.ac(Math.min(t.minZoom,m,H),h.minZoom,h.maxZoom),Ut=Ce/h.zoomScale(mt-m);_e=Math.sqrt(Ut/Re*2)}const We=_e*_e;function lt(mt){const Ut=(Pe*Pe-Ce*Ce+(mt?-1:1)*We*We*Re*Re)/(2*(mt?Pe:Ce)*We*Re);return Math.log(Math.sqrt(Ut*Ut+1)-Ut)}function _t(mt){return(Math.exp(mt)-Math.exp(-mt))/2}function et(mt){return(Math.exp(mt)+Math.exp(-mt))/2}const st=lt(!1);let wt=function(mt){return et(st)/et(st+_e*mt)},Gt=function(mt){return Ce*((et(st)*(_t(Ut=st+_e*mt)/et(Ut))-_t(st))/We)/Re;var Ut},ot=(lt(!0)-st)/_e;if(Math.abs(Re)<1e-6||!isFinite(ot)){if(Math.abs(Ce-Pe)<1e-6)return this.easeTo(t,a);const mt=Pe<Ce?-1:1;ot=Math.abs(Math.log(Pe/Ce))/_e,Gt=()=>0,wt=Ut=>Math.exp(mt*_e*Ut)}return t.duration="duration"in t?+t.duration:1e3*ot/("screenSpeed"in t?+t.screenSpeed/_e:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=v!==E,this._pitching=D!==w,this._padding=!h.isPaddingEqual(z),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(Q),this._ease(mt=>{const Ut=mt*ot,Zr=1/wt(Ut);h.zoom=mt===1?H:m+h.scaleZoom(Zr),this._rotating&&(h.bearing=d.z.number(v,E,mt)),this._pitching&&(h.pitch=d.z.number(w,D,mt)),this._padding&&(h.interpolatePadding(k,z,mt),U=h.centerPoint.add(N)),this.terrain&&!t.freezeElevation&&this._updateElevation(mt);const Yt=mt===1?Q:h.unproject(ge.add(Y.mult(Gt(Ut))).mult(Zr));h.setLocationAtPoint(h.renderWorldCopies?Yt.wrap():Yt,U),this._applyUpdatedTransform(h),this._fireMoveEvents(a)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,a)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,a,l){l.animate===!1||l.duration===0?(t(1),a()):(this._easeStart=ie.now(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=d.b2(t,-180,180);const l=Math.abs(t-a);return Math.abs(t-360-a)<l&&(t-=360),Math.abs(t+360-a)<l&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(!a.renderWorldCopies||a.lngRange)return;const l=t.lng-a.center.lng;t.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(d.M.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}const Ec={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Tu{constructor(t=Ec){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=G.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=G.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const l=this._map._getUIString(`AttributionControl.${a}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const a=this._map.style.sourceCaches;for(const h in a){const m=a[h];if(m.used||m.usedForTerrain){const v=m.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter(h=>String(h).trim()),t.sort((h,m)=>h.length-m.length),t=t.filter((h,m)=>{for(let v=m+1;v<t.length;v++)if(t[v].indexOf(h)>=0)return!1;return!0});const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class fl{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const l=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=G.create("div","maplibregl-ctrl");const a=G.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){G.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ia{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,l=a?this._queue.concat(a):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const l of a)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Rs=d.X([{name:"a_pos3d",type:"Int16",components:3}]);class bt extends d.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,a){this.sourceCache.update(t,a),this._renderableTilesKeys=[];const l={};for(const h of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.posMatrix=new Float64Array(16),d.aO(h.posMatrix,0,d.W,0,d.W,0,1),this._tiles[h.key]=new br(h,this.tileSize));for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const a in this._tiles){const l=this._tiles[a];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const a={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID;if(h.canonical.equals(t.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16),d.aO(m.posMatrix,0,d.W,0,d.W,0,1),a[l]=m}else if(h.canonical.isChildOf(t.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16);const v=h.canonical.z-t.canonical.z,w=h.canonical.x-(h.canonical.x>>v<<v),k=h.canonical.y-(h.canonical.y>>v<<v),E=d.W>>v;d.aO(m.posMatrix,0,E,0,E,0,1),d.H(m.posMatrix,m.posMatrix,[-w*E,-k*E,0]),a[l]=m}else if(t.canonical.isChildOf(h.canonical)){const m=t.clone();m.posMatrix=new Float64Array(16);const v=t.canonical.z-h.canonical.z,w=t.canonical.x-(t.canonical.x>>v<<v),k=t.canonical.y-(t.canonical.y>>v<<v),E=d.W>>v;d.aO(m.posMatrix,0,d.W,0,d.W,0,1),d.H(m.posMatrix,m.posMatrix,[w*E,k*E,0]),d.J(m.posMatrix,m.posMatrix,[1/2**v,1/2**v,0]),a[l]=m}}return a}getSourceTile(t,a){const l=this.sourceCache._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!m||!m.dem)&&a)for(;h>=l.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(t.scaledTo(h--).key);return m}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(a=>a.timeAdded>=t)}}class Pc{constructor(t,a,l){this.painter=t,this.sourceCache=new bt(a),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,l,h=d.W){var m;if(!(a>=0&&a<h&&l>=0&&l<h))return 0;const v=this.getTerrainData(t),w=(m=v.tile)===null||m===void 0?void 0:m.dem;if(!w)return 0;const k=function(Z,Q,H){var ae=Q[0],ge=Q[1];return Z[0]=H[0]*ae+H[4]*ge+H[12],Z[1]=H[1]*ae+H[5]*ge+H[13],Z}([],[a/h*d.W,l/h*d.W],v.u_terrain_matrix),E=[k[0]*w.dim,k[1]*w.dim],D=Math.floor(E[0]),z=Math.floor(E[1]),N=E[0]-D,U=E[1]-z;return w.get(D,z)*(1-N)*(1-U)+w.get(D+1,z)*N*(1-U)+w.get(D,z+1)*(1-N)*U+w.get(D+1,z+1)*N*U}getElevationForLngLatZoom(t,a){const{tileID:l,mercatorX:h,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(l,h%d.W,m%d.W,d.W)}getElevation(t,a,l,h=d.W){return this.getDEMElevation(t,a,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,m=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Me(h,m,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Me(h,new d.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const a=this.sourceCache.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const h=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new Me(h,a.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),a.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const l=a&&a+a.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.sourceCache.sourceCache._source.maxzoom;let m=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?m=t.canonical.z-h:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>m<<m),w=t.canonical.y-(t.canonical.y>>m<<m),k=d.ba(new Float64Array(16),[1/(d.W<<m),1/(d.W<<m),0]);d.H(k,k,[v*d.W,w*d.W,0]),this._demMatrixCache[t.key]={matrix:k,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,l=a.width/devicePixelRatio,h=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Me(a.context,{width:l,height:h,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Me(a.context,{width:l,height:h,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,v=0;m<this._coordsTextureSize;m++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)a[v+0]=255&w,a[v+1]=255&m,a[v+2]=w>>8<<4|m>>8,a[v+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),h=new Me(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),l=this.painter.context,h=l.gl,m=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(m,w-v-1,1,1,h.RGBA,h.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null);const k=a[0]+(a[2]>>4<<8),E=a[1]+((15&a[2])<<8),D=this.coordsIndex[255-a[3]],z=D&&this.sourceCache.getTileByID(D);if(!z)return null;const N=this._coordsTextureSize,U=(1<<z.tileID.canonical.z)*N;return new d.Y((z.tileID.canonical.x*N+k)/U+z.tileID.wrap,(z.tileID.canonical.y*N+E)/U,this.getElevation(z.tileID,k,E,N))}depthAtPoint(t){const a=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,a=new d.bb,l=new d.aY,h=this.meshSize,m=d.W/h,v=h*h;for(let z=0;z<=h;z++)for(let N=0;N<=h;N++)a.emplaceBack(N*m,z*m,0);for(let z=0;z<v;z+=h+1)for(let N=0;N<h;N++)l.emplaceBack(N+z,h+N+z+1,h+N+z+2),l.emplaceBack(N+z,h+N+z+2,N+z+1);const w=a.length,k=w+2*(h+1);for(const z of[0,1])for(let N=0;N<=h;N++)for(const U of[0,1])a.emplaceBack(N*m,z*d.W,U);for(let z=0;z<2*h;z+=2)l.emplaceBack(k+z,k+z+1,k+z+3),l.emplaceBack(k+z,k+z+3,k+z+2),l.emplaceBack(w+z,w+z+3,w+z+1),l.emplaceBack(w+z,w+z+2,w+z+3);const E=a.length,D=E+2*(h+1);for(const z of[0,1])for(let N=0;N<=h;N++)for(const U of[0,1])a.emplaceBack(z*d.W,N*m,U);for(let z=0;z<2*h;z+=2)l.emplaceBack(E+z,E+z+1,E+z+3),l.emplaceBack(E+z,E+z+3,E+z+2),l.emplaceBack(D+z,D+z+3,D+z+1),l.emplaceBack(D+z,D+z+2,D+z+3);return this._mesh={indexBuffer:t.createIndexBuffer(l),vertexBuffer:t.createVertexBuffer(a,Rs.members),segments:d.$.simpleSegment(0,0,a.length,l.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*d.bc/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,a){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return a&&a.dem&&(l.minElevation=a.dem.min*this.exaggeration,l.maxElevation=a.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,a){const l=d.Y.fromLngLat(t.wrap()),h=(1<<a)*d.W,m=l.x*h,v=l.y*h,w=Math.floor(m/d.W),k=Math.floor(v/d.W);return{tileID:new d.Q(a,0,a,w,k),mercatorX:m,mercatorY:v}}}class bo{constructor(t,a,l){this._context=t,this._size=a,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new Me(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(l.texture),{id:t,fbo:a,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(a=>t.id!==a),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Jn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Iu{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new bo(t.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(l=>!t._layers[l].isHidden(a)),this._coordsDescendingInv={};for(const l in t.sourceCaches){this._coordsDescendingInv[l]={};const h=t.sourceCaches[l].getVisibleCoordinates();for(const m of h){const v=this.terrain.sourceCache.getTerrainCoords(m);for(const w in v)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(v[w])}}this._coordsDescendingInvStr={};for(const l of t._order){const h=t._layers[l],m=h.source;if(Jn[h.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(const v in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][v]=this._coordsDescendingInv[m][v].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsDescendingInvStr){const m=this._coordsDescendingInvStr[h][l.tileID.key];m&&m!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const a=t.type,l=this.painter,h=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Jn[a]&&(this._prevType&&Jn[this._prevType]||this._stacks.push([]),this._prevType=a,this._stacks[this._stacks.length-1].push(t.id),!h))return!0;if(Jn[this._prevType]||Jn[a]&&h){this._prevType=a;const m=this._stacks.length-1,v=this._stacks[m]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(Qo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[m]){const E=this.pool.getObjectForId(w.rtt[m].id);if(E.stamp===w.rtt[m].stamp){this.pool.useObject(E);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),w.rtt[m]={id:k.id,stamp:k.stamp},l.context.bindFramebuffer.set(k.fbo.framebuffer),l.context.clear({color:d.aP.transparent,stencil:0}),l.currentStencilSource=void 0;for(let E=0;E<v.length;E++){const D=l.style._layers[v[E]],z=D.source?this._coordsDescendingInv[D.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),l._renderTileClippingMasks(D,z),l.renderLayer(l,l.style.sourceCaches[D.source],D,z),D.source&&(w.rttCoords[D.source]=this._coordsDescendingInvStr[D.source][w.tileID.key])}}return Qo(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Jn[a]}return!1}}const ft={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Fs=V,Lh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Ec,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Eu=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},Ac={showCompass:!0,showZoom:!0,visualizePitch:!1};class Mc{constructor(t,a,l=!1){this.mousedown=v=>{this.startMouse(d.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),G.mousePos(this.element,v)),G.addEventListener(window,"mousemove",this.mousemove),G.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,G.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),G.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const h=t.dragRotate._mouseRotate.getClickTolerance(),m=t.dragRotate._mousePitch.getClickTolerance();this.element=a,this.mouseRotate=vn({clickTolerance:h,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:w,bearingDegreesPerPixelMoved:k=.8})=>{const E=new ni;return new ra({clickTolerance:w,move:(D,z)=>({bearingDelta:(z.x-D.x)*k}),moveStateManager:E,enable:v,assignEvents:Eu})})({clickTolerance:h,enable:!0}),this.map=t,l&&(this.mousePitch=ol({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:w,pitchDegreesPerPixelMoved:k=-.5})=>{const E=new ni;return new ra({clickTolerance:w,move:(D,z)=>({pitchDelta:(z.y-D.y)*k}),moveStateManager:E,enable:v,assignEvents:Eu})})({clickTolerance:m,enable:!0})),G.addEventListener(a,"mousedown",this.mousedown),G.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(a,"touchcancel",this.reset)}startMouse(t,a){this.mouseRotate.dragStart(t,a),this.mousePitch&&this.mousePitch.dragStart(t,a),G.disableDrag()}startTouch(t,a){this.touchRotate.dragStart(t,a),this.touchPitch&&this.touchPitch.dragStart(t,a),G.disableDrag()}moveMouse(t,a){const l=this.map,{bearingDelta:h}=this.mouseRotate.dragMove(t,a)||{};if(h&&l.setBearing(l.getBearing()+h),this.mousePitch){const{pitchDelta:m}=this.mousePitch.dragMove(t,a)||{};m&&l.setPitch(l.getPitch()+m)}}moveTouch(t,a){const l=this.map,{bearingDelta:h}=this.touchRotate.dragMove(t,a)||{};if(h&&l.setBearing(l.getBearing()+h),this.touchPitch){const{pitchDelta:m}=this.touchPitch.dragMove(t,a)||{};m&&l.setPitch(l.getPitch()+m)}}off(){const t=this.element;G.removeEventListener(t,"mousedown",this.mousedown),G.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.removeEventListener(window,"touchend",this.touchend),G.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){G.enableDrag(),G.removeEventListener(window,"mousemove",this.mousemove),G.removeEventListener(window,"mouseup",this.mouseup),G.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.removeEventListener(window,"touchend",this.touchend)}}let bn;function Pu(p,t,a){const l=new d.M(p.lng,p.lat);if(p=new d.M(p.lng,p.lat),t){const h=new d.M(p.lng-360,p.lat),m=new d.M(p.lng+360,p.lat),v=a.locationPoint(p).distSqr(t);a.locationPoint(h).distSqr(t)<v?p=h:a.locationPoint(m).distSqr(t)<v&&(p=m)}for(;Math.abs(p.lng-a.center.lng)>180;){const h=a.locationPoint(p);if(h.x>=0&&h.y>=0&&h.x<=a.width&&h.y<=a.height)break;p.lng>a.center.lng?p.lng-=360:p.lng+=360}return p.lng!==l.lng&&a.locationPoint(p).y>a.height/2-a.getHorizon()?p:l}const ml={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Bs(p,t,a){const l=p.classList;for(const h in ml)l.remove(`maplibregl-${a}-anchor-${h}`);l.add(`maplibregl-${a}-anchor-${t}`)}class jr extends d.E{constructor(t){if(super(),this._onKeyPress=a=>{const l=a.code,h=a.charCode||a.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=a=>{const l=a.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=a=>{var l;if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();((a==null?void 0:a.type)==="terrain"||(a==null?void 0:a.type)==="render"&&!h)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Pu(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,`${ml[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${m}`),ie.frameAsync(new AbortController).then(()=>{this._updateOpacity(a&&a.type==="moveend")}).catch(()=>{})},this._onMove=a=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=d.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div"),this._element.setAttribute("aria-label","Map marker");const a=G.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${l}px`),a.setAttributeNS(null,"width",`${h}px`),a.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const m=G.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const v=G.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=G.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of k){const ge=G.createNS("http://www.w3.org/2000/svg","ellipse");ge.setAttributeNS(null,"opacity","0.04"),ge.setAttributeNS(null,"cx","10.5"),ge.setAttributeNS(null,"cy","5.80029008"),ge.setAttributeNS(null,"rx",ae.rx),ge.setAttributeNS(null,"ry",ae.ry),w.appendChild(ge)}const E=G.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill",this._color);const D=G.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),E.appendChild(D);const z=G.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const N=G.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(N);const U=G.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(6.0, 7.0)"),U.setAttributeNS(null,"fill","#FFFFFF");const Z=G.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Q=G.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#000000"),Q.setAttributeNS(null,"opacity","0.25"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962");const H=G.createNS("http://www.w3.org/2000/svg","circle");H.setAttributeNS(null,"fill","#FFFFFF"),H.setAttributeNS(null,"cx","5.5"),H.setAttributeNS(null,"cy","5.5"),H.setAttributeNS(null,"r","5.4999962"),Z.appendChild(Q),Z.appendChild(H),v.appendChild(w),v.appendChild(E),v.appendChild(z),v.appendChild(U),v.appendChild(Z),a.appendChild(v),a.setAttributeNS(null,"height",l*this._scale+"px"),a.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(a),this._offset=d.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",a=>{a.preventDefault()}),this._element.addEventListener("mousedown",a=>{a.preventDefault()}),Bs(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=d.M.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,l;if(!(!((a=this._map)===null||a===void 0)&&a.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const h=this._map,m=h.terrain.depthAtPoint(this._pos),v=h.terrain.getElevationForLngLatZoom(this._lngLat,h.transform.tileZoom);if(h.transform.lngLatToCameraDepth(this._lngLat,v)-m<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/h.transform._pixelPerMeter,k=Math.sin(h.getPitch()*Math.PI/180)*w,E=h.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),D=h.transform.lngLatToCameraDepth(this._lngLat,v+k)-E>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&D&&this._popup.remove(),this._element.style.opacity=D?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=d.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return t===void 0&&a===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const gl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Va=0,Ua=!1;const Au={maxWidth:100,unit:"metric"};function zc(p,t,a){const l=a&&a.maxWidth||100,h=p._container.clientHeight/2,m=p.unproject([0,h]),v=p.unproject([l,h]),w=m.distanceTo(v);if(a&&a.unit==="imperial"){const k=3.2808*w;k>5280?wo(t,l,k/5280,p._getUIString("ScaleControl.Miles")):wo(t,l,k,p._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?wo(t,l,w/1852,p._getUIString("ScaleControl.NauticalMiles")):w>=1e3?wo(t,l,w/1e3,p._getUIString("ScaleControl.Kilometers")):wo(t,l,w,p._getUIString("ScaleControl.Meters"))}function wo(p,t,a,l){const h=function(m){const v=Math.pow(10,`${Math.floor(m)}`.length-1);let w=m/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(k){const E=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*E)/E}(w),v*w}(a);p.style.width=t*(h/a)+"px",p.innerHTML=`${h}&nbsp;${l}`}const Qn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},yl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pt(p){if(p){if(typeof p=="number"){const t=Math.round(Math.abs(p)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,p),"top-left":new d.P(t,t),"top-right":new d.P(-t,t),bottom:new d.P(0,-p),"bottom-left":new d.P(t,-t),"bottom-right":new d.P(-t,-t),left:new d.P(p,0),right:new d.P(-p,0)}}if(p instanceof d.P||Array.isArray(p)){const t=d.P.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:d.P.convert(p.center||[0,0]),top:d.P.convert(p.top||[0,0]),"top-left":d.P.convert(p["top-left"]||[0,0]),"top-right":d.P.convert(p["top-right"]||[0,0]),bottom:d.P.convert(p.bottom||[0,0]),"bottom-left":d.P.convert(p["bottom-left"]||[0,0]),"bottom-right":d.P.convert(p["bottom-right"]||[0,0]),left:d.P.convert(p.left||[0,0]),right:d.P.convert(p.right||[0,0])}}return Pt(new d.P(0,0))}const jt=V;S.AJAXError=d.bf,S.Evented=d.E,S.LngLat=d.M,S.MercatorCoordinate=d.Y,S.Point=d.P,S.addProtocol=d.bg,S.config=d.a,S.removeProtocol=d.bh,S.AttributionControl=Tu,S.BoxZoomHandler=xo,S.CanvasSource=lr,S.CooperativeGesturesHandler=un,S.DoubleClickZoomHandler=Ds,S.DragPanHandler=Cc,S.DragRotateHandler=ja,S.EdgeInsets=ea,S.FullscreenControl=class extends d.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a==null?void 0:a.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){G.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=G.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);G.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=ct,S.GeolocateControl=class extends d.E{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new d.M(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),m=d.e({bearing:h},this.options.fitBoundsOptions),v=or.fromLngLat(a,l);this._map.fitBounds(v,m,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new d.M(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Ua)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=G.create("button","maplibregl-ctrl-geolocate",this._container),G.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new jr({element:this._dotElement}),this._circleElement=G.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")))})}},this.options=d.e({},gl,p)}onAdd(p){return this._map=p,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return d._(this,arguments,void 0,function*(t=!1){if(bn!==void 0&&!t)return bn;if(window.navigator.permissions===void 0)return bn=!!window.navigator.geolocation,bn;try{bn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{bn=!!window.navigator.geolocation}return bn})}().then(t=>this._setupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Va=0,Ua=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),a=p.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),a=p.getNorthEast(),l=t.distanceTo(a),h=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Va--,Ua=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Va++,Va>1?(p={maximumAge:6e5,timeout:0},Ua=!0):(p=this.options.positionOptions,Ua=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=_c,S.ImageSource=Zt,S.KeyboardHandler=Ms,S.LngLatBounds=or,S.LogoControl=fl,S.Map=class extends Cu{constructor(p){if(d.bd.mark(d.be.create),(p=d.e({},Lh,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new go(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._contextLost=t=>{t.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new ia,this._controls=[],this._mapId=d.a3(),this._locale=d.e({},ft,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=p.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=me.addThrottleControl(()=>this.isMoving()),this._requestManager=new De(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const a=bu(l=>{this._trackResize&&!this._removed&&this.resize(l)._update()},50);this._resizeObserver=new ResizeObserver(l=>{t?a(l):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ls(this,p),this._hash=p.hash&&new _c(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,d.e({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Tu(typeof p.attributionControl=="boolean"?void 0:p.attributionControl)),p.maplibreLogo&&this.addControl(new fl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new d.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new d.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new d.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(a,l.firstChild):l.appendChild(a),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,a,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,t,a,l)}resize(p){var t;const a=this._containerDimensions(),l=a[0],h=a[1],m=this._getClampedPixelRatio(l,h);if(this._resizeCanvas(l,h,m),this.painter.resize(l,h,m),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const k=this._getClampedPixelRatio(l,h);this._resizeCanvas(l,h,k),this.painter.resize(l,h,k)}this.transform.resize(l,h),(t=this._requestedCameraState)===null||t===void 0||t.resize(l,h);const v=!this._moving;return v&&(this.stop(),this.fire(new d.k("movestart",p)).fire(new d.k("move",p))),this.fire(new d.k("resize",p)),v&&this.fire(new d.k("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:a,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),m=p*h,v=t*h;return Math.min(m>a?a/m:1,v>l?l/v:1)*h}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(or.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(d.M.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(d.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,a){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layer:t,listener:a,delegates:{mousemove:m=>{const v=this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[];v.length?l||(l=!0,a.call(this,new Gi(p,this,m.originalEvent,{features:v}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layer:t,listener:a,delegates:{mousemove:v=>{(this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[]).length?l=!0:l&&(l=!1,a.call(this,new Gi(p,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,a.call(this,new Gi(p,this,v.originalEvent)))}}}}{const l=h=>{const m=this.getLayer(t)?this.queryRenderedFeatures(h.point,{layers:[t]}):[];m.length&&(h.features=m,a.call(this,h),delete h.features)};return{layer:t,listener:a,delegates:{[p]:l}}}}on(p,t,a){if(a===void 0)return super.on(p,t);const l=this._createDelegatedListener(p,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(l);for(const h in l.delegates)this.on(h,l.delegates[h]);return this}once(p,t,a){if(a===void 0)return super.once(p,t);const l=this._createDelegatedListener(p,t,a);for(const h in l.delegates)this.once(h,l.delegates[h]);return this}off(p,t,a){return a===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(l=>{const h=this._delegatedListeners[p];for(let m=0;m<h.length;m++){const v=h[m];if(v.layer===t&&v.listener===a){for(const w in v.delegates)this.off(w,v.delegates[w]);return h.splice(m,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let a;const l=p instanceof d.P||Array.isArray(p),h=l?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:p)||{},h instanceof d.P||typeof h[0]=="number")a=[d.P.convert(h)];else{const m=d.P.convert(h[0]),v=d.P.convert(h[1]);a=[m,new d.P(v.x,m.y),v,new d.P(m.x,v.y),m]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const a=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new ro(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,a):this.style.loadJSON(p,t,a),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ro(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const a=this._requestManager.transformRequest(p,"Style");d.h(a,new AbortController).then(l=>{this._updateDiff(l.data,t)}).catch(l=>{l&&this.fire(new d.j(l))})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(a){d.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new d.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const l=this.style._layers[a];l.type==="hillshade"&&l.source===p.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Pc(this.painter,t,p),this.painter.renderToTexture=new Iu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=a=>{a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:p})),this}getTerrain(){var p,t;return(t=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const a=p[t]._tiles;for(const l in a){const h=a[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,a={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:m,stretchY:v,content:w,textFitWidth:k,textFitHeight:E}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||d.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:z,data:N}=t,U=t;return this.style.addImage(p,{data:new d.R({width:D,height:z},new Uint8Array(N)),pixelRatio:l,stretchX:m,stretchY:v,content:w,textFitWidth:k,textFitHeight:E,sdf:h,version:0,userImage:U}),U.onAdd&&U.onAdd(this,p),this}}{const{width:D,height:z,data:N}=ie.getImageData(t);this.style.addImage(p,{data:new d.R({width:D,height:z},N),pixelRatio:l,stretchX:m,stretchY:v,content:w,textFitWidth:k,textFitHeight:E,sdf:h,version:0})}}updateImage(p,t){const a=this.style.getImage(p);if(!a)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||d.b(t)?ie.getImageData(t):t,{width:h,height:m,data:v}=l;if(h===void 0||m===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==a.data.width||m!==a.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||d.b(t));return a.data.replace(v,w),this.style.updateImage(p,a),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return me.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,t,a){return this.style.setLayerZoomRange(p,t,a),this._update(!0)}setFilter(p,t,a={}){return this.style.setFilter(p,t,a),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,a,l={}){return this.style.setPaintProperty(p,t,a,l),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,a,l={}){return this.style.setLayoutProperty(p,t,a,l),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,a,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,a=>{a||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=G.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=G.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),l=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],l);const h=this._controlContainer=G.create("div","maplibregl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{m[v]=G.create("div",`maplibregl-ctrl-${v} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,t,a){this._canvas.width=Math.floor(a*p),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{t={requestedAttributes:p},l&&(t.statusMessage=l.statusMessage,t.type=l.type)},{once:!0});const a=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!a){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new kr(a,this.transform),He.testSupport(a)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const h=this.transform.zoom,m=ie.now();this.style.zoomHistory.update(h,m);const v=new d.a8(h,{now:m,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=v.crossFadingFactor();w===1&&w===this._crossFadingFactor||(a=!0,this._crossFadingFactor=w),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bd.mark(d.be.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,d.bd.mark(d.be.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),me.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),G.remove(this._canvasContainer),G.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bd.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ie.frameAsync(this._frameRequest).then(p=>{d.bd.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return Fs}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=Gi,S.MapTouchEvent=ta,S.MapWheelEvent=xc,S.Marker=jr,S.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,a)=>{const l=this._map._getUIString(`NavigationControl.${a}`);t.title=l,t.setAttribute("aria-label",l)},this.options=d.e({},Ac,p),this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),G.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),G.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=G.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Mc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const a=G.create("button",p,this._container);return a.type="button",a.addEventListener("click",t),a}},S.Popup=class extends d.E{constructor(p){super(),this.remove=()=>(this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var a;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=G.create("div","maplibregl-popup",this._map.getContainer()),this._tip=G.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Pu(this._lngLat,this._flatPos,this._map.transform):(a=this._lngLat)===null||a===void 0?void 0:a.wrap(),this._trackPointer&&!t)return;const l=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationPoint(this._lngLat));let h=this.options.anchor;const m=Pt(this.options.offset);if(!h){const w=this._container.offsetWidth,k=this._container.offsetHeight;let E;E=l.y+m.bottom.y<k?["top"]:l.y>this._map.transform.height-k?["bottom"]:[],l.x<w/2?E.push("left"):l.x>this._map.transform.width-w/2&&E.push("right"),h=E.length===0?"bottom":E.join("-")}let v=l.add(m[h]);this.options.subpixelPositioning||(v=v.round()),G.setTransform(this._container,`${ml[h]} translate(${v.x}px,${v.y}px)`),Bs(this._container,h,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(Qn),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=d.M.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),a=document.createElement("body");let l;for(a.innerHTML=p;l=a.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=G.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(yl);p&&p.focus()}},S.RasterDEMTileSource=Ft,S.RasterTileSource=Ne,S.ScaleControl=class{constructor(p){this._onMove=()=>{zc(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,zc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Au),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=kc,S.Style=ro,S.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=G.create("button","maplibregl-ctrl-terrain",this._container),G.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){G.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=pl,S.TwoFingersTouchRotateHandler=hl,S.TwoFingersTouchZoomHandler=cl,S.TwoFingersTouchZoomRotateHandler=Tc,S.VectorTileSource=Ee,S.VideoSource=rr,S.addSourceType=(p,t)=>d._(void 0,void 0,void 0,function*(){if(Wt(p))throw new Error(`A source type called "${p}" already exists.`);((a,l)=>{Kr[a]=l})(p,t)}),S.clearPrewarmedResources=function(){const p=pr;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(nt),pr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return Fr().getRTLTextPluginStatus()},S.getVersion=function(){return jt},S.getWorkerCount=function(){return er.workerCount},S.getWorkerUrl=function(){return d.a.WORKER_URL},S.importScriptInWorkers=function(p){return Bt().broadcast("IS",p)},S.prewarm=function(){ar().acquire(nt)},S.setMaxParallelImageRequests=function(p){d.a.MAX_PARALLEL_IMAGE_REQUESTS=p},S.setRTLTextPlugin=function(p,t){return Fr().setRTLTextPlugin(p,t)},S.setWorkerCount=function(p){er.workerCount=p},S.setWorkerUrl=function(p){d.a.WORKER_URL=p}});var C=u;return C})})(zx);var mk=zx.exports;const iv=lv(mk);var Lx={exports:{}};/* @license
Papa Parse
v5.4.1
https://github.com/mholt/PapaParse
License: MIT
*/(function(i,s){(function(u,y){i.exports=y()})(Ag,function u(){var y=typeof self<"u"?self:typeof window<"u"?window:y!==void 0?y:{},x=!y.document&&!!y.postMessage,C=y.IS_PAPA_WORKER||!1,S={},d=0,V={parse:function(re,ne){var fe=(ne=ne||{}).dynamicTyping||!1;if(Ge(fe)&&(ne.dynamicTypingFunction=fe,fe={}),ne.dynamicTyping=fe,ne.transform=!!Ge(ne.transform)&&ne.transform,ne.worker&&V.WORKERS_SUPPORTED){var Me=function(){if(!V.WORKERS_SUPPORTED)return!1;var tt=(dr=y.URL||y.webkitURL||null,Jt=u.toString(),V.BLOB_URL||(V.BLOB_URL=dr.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",Jt,")();"],{type:"text/javascript"})))),dt=new y.Worker(tt),dr,Jt;return dt.onmessage=oe,dt.id=d++,S[dt.id]=dt}();return Me.userStep=ne.step,Me.userChunk=ne.chunk,Me.userComplete=ne.complete,Me.userError=ne.error,ne.step=Ge(ne.step),ne.chunk=Ge(ne.chunk),ne.complete=Ge(ne.complete),ne.error=Ge(ne.error),delete ne.worker,void Me.postMessage({input:re,config:ne,workerId:Me.id})}var Oe=null;return V.NODE_STREAM_INPUT,typeof re=="string"?(re=function(tt){return tt.charCodeAt(0)===65279?tt.slice(1):tt}(re),Oe=ne.download?new ie(ne):new He(ne)):re.readable===!0&&Ge(re.read)&&Ge(re.on)?Oe=new Ke(ne):(y.File&&re instanceof File||re instanceof Object)&&(Oe=new G(ne)),Oe.stream(re)},unparse:function(re,ne){var fe=!1,Me=!0,Oe=",",tt=`\r
`,dt='"',dr=dt+dt,Jt=!1,pt=null,Qe=!1;(function(){if(typeof ne=="object"){if(typeof ne.delimiter!="string"||V.BAD_DELIMITERS.filter(function(nt){return ne.delimiter.indexOf(nt)!==-1}).length||(Oe=ne.delimiter),(typeof ne.quotes=="boolean"||typeof ne.quotes=="function"||Array.isArray(ne.quotes))&&(fe=ne.quotes),typeof ne.skipEmptyLines!="boolean"&&typeof ne.skipEmptyLines!="string"||(Jt=ne.skipEmptyLines),typeof ne.newline=="string"&&(tt=ne.newline),typeof ne.quoteChar=="string"&&(dt=ne.quoteChar),typeof ne.header=="boolean"&&(Me=ne.header),Array.isArray(ne.columns)){if(ne.columns.length===0)throw new Error("Option columns is empty");pt=ne.columns}ne.escapeChar!==void 0&&(dr=ne.escapeChar+dt),(typeof ne.escapeFormulae=="boolean"||ne.escapeFormulae instanceof RegExp)&&(Qe=ne.escapeFormulae instanceof RegExp?ne.escapeFormulae:/^[=+\-@\t\r].*$/)}})();var Xe=new RegExp(ht(dt),"g");if(typeof re=="string"&&(re=JSON.parse(re)),Array.isArray(re)){if(!re.length||Array.isArray(re[0]))return It(null,re,Jt);if(typeof re[0]=="object")return It(pt||Object.keys(re[0]),re,Jt)}else if(typeof re=="object")return typeof re.data=="string"&&(re.data=JSON.parse(re.data)),Array.isArray(re.data)&&(re.fields||(re.fields=re.meta&&re.meta.fields||pt),re.fields||(re.fields=Array.isArray(re.data[0])?re.fields:typeof re.data[0]=="object"?Object.keys(re.data[0]):[]),Array.isArray(re.data[0])||typeof re.data[0]=="object"||(re.data=[re.data])),It(re.fields||[],re.data||[],Jt);throw new Error("Unable to serialize unrecognized input");function It(nt,er,mr){var pr="";typeof nt=="string"&&(nt=JSON.parse(nt)),typeof er=="string"&&(er=JSON.parse(er));var tr=Array.isArray(nt)&&0<nt.length,ar=!Array.isArray(er[0]);if(tr&&Me){for(var Sr=0;Sr<nt.length;Sr++)0<Sr&&(pr+=Oe),pr+=$t(nt[Sr],Sr);0<er.length&&(pr+=tt)}for(var Bt=0;Bt<er.length;Bt++){var gr=tr?nt.length:er[Bt].length,Lr=!1,Ir=tr?Object.keys(er[Bt]).length===0:er[Bt].length===0;if(mr&&!tr&&(Lr=mr==="greedy"?er[Bt].join("").trim()==="":er[Bt].length===1&&er[Bt][0].length===0),mr==="greedy"&&tr){for(var _r=[],or=0;or<gr;or++){var Rr=ar?nt[or]:or;_r.push(er[Bt][Rr])}Lr=_r.join("").trim()===""}if(!Lr){for(var Ee=0;Ee<gr;Ee++){0<Ee&&!Ir&&(pr+=Oe);var Ne=tr&&ar?nt[Ee]:Ee;pr+=$t(er[Bt][Ne],Ee)}Bt<er.length-1&&(!mr||0<gr&&!Ir)&&(pr+=tt)}}return pr}function $t(nt,er){if(nt==null)return"";if(nt.constructor===Date)return JSON.stringify(nt).slice(1,25);var mr=!1;Qe&&typeof nt=="string"&&Qe.test(nt)&&(nt="'"+nt,mr=!0);var pr=nt.toString().replace(Xe,dr);return(mr=mr||fe===!0||typeof fe=="function"&&fe(nt,er)||Array.isArray(fe)&&fe[er]||function(tr,ar){for(var Sr=0;Sr<ar.length;Sr++)if(-1<tr.indexOf(ar[Sr]))return!0;return!1}(pr,V.BAD_DELIMITERS)||-1<pr.indexOf(Oe)||pr.charAt(0)===" "||pr.charAt(pr.length-1)===" ")?dt+pr+dt:pr}}};if(V.RECORD_SEP="",V.UNIT_SEP="",V.BYTE_ORDER_MARK="\uFEFF",V.BAD_DELIMITERS=["\r",`
`,'"',V.BYTE_ORDER_MARK],V.WORKERS_SUPPORTED=!x&&!!y.Worker,V.NODE_STREAM_INPUT=1,V.LocalChunkSize=10485760,V.RemoteChunkSize=5242880,V.DefaultDelimiter=",",V.Parser=pe,V.ParserHandle=ke,V.NetworkStreamer=ie,V.FileStreamer=G,V.StringStreamer=He,V.ReadableStreamStreamer=Ke,y.jQuery){var ee=y.jQuery;ee.fn.parse=function(re){var ne=re.config||{},fe=[];return this.each(function(tt){if(!(ee(this).prop("tagName").toUpperCase()==="INPUT"&&ee(this).attr("type").toLowerCase()==="file"&&y.FileReader)||!this.files||this.files.length===0)return!0;for(var dt=0;dt<this.files.length;dt++)fe.push({file:this.files[dt],inputElem:this,instanceConfig:ee.extend({},ne)})}),Me(),this;function Me(){if(fe.length!==0){var tt,dt,dr,Jt,pt=fe[0];if(Ge(re.before)){var Qe=re.before(pt.file,pt.inputElem);if(typeof Qe=="object"){if(Qe.action==="abort")return tt="AbortError",dt=pt.file,dr=pt.inputElem,Jt=Qe.reason,void(Ge(re.error)&&re.error({name:tt},dt,dr,Jt));if(Qe.action==="skip")return void Oe();typeof Qe.config=="object"&&(pt.instanceConfig=ee.extend(pt.instanceConfig,Qe.config))}else if(Qe==="skip")return void Oe()}var Xe=pt.instanceConfig.complete;pt.instanceConfig.complete=function(It){Ge(Xe)&&Xe(It,pt.file,pt.inputElem),Oe()},V.parse(pt.file,pt.instanceConfig)}else Ge(re.complete)&&re.complete()}function Oe(){fe.splice(0,1),Me()}}}function Te(re){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(ne){var fe=Ue(ne);fe.chunkSize=parseInt(fe.chunkSize),ne.step||ne.chunk||(fe.chunkSize=null),this._handle=new ke(fe),(this._handle.streamer=this)._config=fe}).call(this,re),this.parseChunk=function(ne,fe){if(this.isFirstChunk&&Ge(this._config.beforeFirstChunk)){var Me=this._config.beforeFirstChunk(ne);Me!==void 0&&(ne=Me)}this.isFirstChunk=!1,this._halted=!1;var Oe=this._partialLine+ne;this._partialLine="";var tt=this._handle.parse(Oe,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var dt=tt.meta.cursor;this._finished||(this._partialLine=Oe.substring(dt-this._baseIndex),this._baseIndex=dt),tt&&tt.data&&(this._rowCount+=tt.data.length);var dr=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(C)y.postMessage({results:tt,workerId:V.WORKER_ID,finished:dr});else if(Ge(this._config.chunk)&&!fe){if(this._config.chunk(tt,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);tt=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(tt.data),this._completeResults.errors=this._completeResults.errors.concat(tt.errors),this._completeResults.meta=tt.meta),this._completed||!dr||!Ge(this._config.complete)||tt&&tt.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),dr||tt&&tt.meta.paused||this._nextChunk(),tt}this._halted=!0},this._sendError=function(ne){Ge(this._config.error)?this._config.error(ne):C&&this._config.error&&y.postMessage({workerId:V.WORKER_ID,error:ne,finished:!1})}}function ie(re){var ne;(re=re||{}).chunkSize||(re.chunkSize=V.RemoteChunkSize),Te.call(this,re),this._nextChunk=x?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(fe){this._input=fe,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(ne=new XMLHttpRequest,this._config.withCredentials&&(ne.withCredentials=this._config.withCredentials),x||(ne.onload=ze(this._chunkLoaded,this),ne.onerror=ze(this._chunkError,this)),ne.open(this._config.downloadRequestBody?"POST":"GET",this._input,!x),this._config.downloadRequestHeaders){var fe=this._config.downloadRequestHeaders;for(var Me in fe)ne.setRequestHeader(Me,fe[Me])}if(this._config.chunkSize){var Oe=this._start+this._config.chunkSize-1;ne.setRequestHeader("Range","bytes="+this._start+"-"+Oe)}try{ne.send(this._config.downloadRequestBody)}catch(tt){this._chunkError(tt.message)}x&&ne.status===0&&this._chunkError()}},this._chunkLoaded=function(){ne.readyState===4&&(ne.status<200||400<=ne.status?this._chunkError():(this._start+=this._config.chunkSize?this._config.chunkSize:ne.responseText.length,this._finished=!this._config.chunkSize||this._start>=function(fe){var Me=fe.getResponseHeader("Content-Range");return Me===null?-1:parseInt(Me.substring(Me.lastIndexOf("/")+1))}(ne),this.parseChunk(ne.responseText)))},this._chunkError=function(fe){var Me=ne.statusText||fe;this._sendError(new Error(Me))}}function G(re){var ne,fe;(re=re||{}).chunkSize||(re.chunkSize=V.LocalChunkSize),Te.call(this,re);var Me=typeof FileReader<"u";this.stream=function(Oe){this._input=Oe,fe=Oe.slice||Oe.webkitSlice||Oe.mozSlice,Me?((ne=new FileReader).onload=ze(this._chunkLoaded,this),ne.onerror=ze(this._chunkError,this)):ne=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var Oe=this._input;if(this._config.chunkSize){var tt=Math.min(this._start+this._config.chunkSize,this._input.size);Oe=fe.call(Oe,this._start,tt)}var dt=ne.readAsText(Oe,this._config.encoding);Me||this._chunkLoaded({target:{result:dt}})},this._chunkLoaded=function(Oe){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(Oe.target.result)},this._chunkError=function(){this._sendError(ne.error)}}function He(re){var ne;Te.call(this,re=re||{}),this.stream=function(fe){return ne=fe,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var fe,Me=this._config.chunkSize;return Me?(fe=ne.substring(0,Me),ne=ne.substring(Me)):(fe=ne,ne=""),this._finished=!ne,this.parseChunk(fe)}}}function Ke(re){Te.call(this,re=re||{});var ne=[],fe=!0,Me=!1;this.pause=function(){Te.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){Te.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(Oe){this._input=Oe,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){Me&&ne.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),ne.length?this.parseChunk(ne.shift()):fe=!0},this._streamData=ze(function(Oe){try{ne.push(typeof Oe=="string"?Oe:Oe.toString(this._config.encoding)),fe&&(fe=!1,this._checkIsFinished(),this.parseChunk(ne.shift()))}catch(tt){this._streamError(tt)}},this),this._streamError=ze(function(Oe){this._streamCleanUp(),this._sendError(Oe)},this),this._streamEnd=ze(function(){this._streamCleanUp(),Me=!0,this._streamData("")},this),this._streamCleanUp=ze(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function ke(re){var ne,fe,Me,Oe=Math.pow(2,53),tt=-Oe,dt=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,dr=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,Jt=this,pt=0,Qe=0,Xe=!1,It=!1,$t=[],nt={data:[],errors:[],meta:{}};if(Ge(re.step)){var er=re.step;re.step=function(Bt){if(nt=Bt,tr())pr();else{if(pr(),nt.data.length===0)return;pt+=Bt.data.length,re.preview&&pt>re.preview?fe.abort():(nt.data=nt.data[0],er(nt,Jt))}}}function mr(Bt){return re.skipEmptyLines==="greedy"?Bt.join("").trim()==="":Bt.length===1&&Bt[0].length===0}function pr(){return nt&&Me&&(Sr("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+V.DefaultDelimiter+"'"),Me=!1),re.skipEmptyLines&&(nt.data=nt.data.filter(function(Bt){return!mr(Bt)})),tr()&&function(){if(!nt)return;function Bt(Lr,Ir){Ge(re.transformHeader)&&(Lr=re.transformHeader(Lr,Ir)),$t.push(Lr)}if(Array.isArray(nt.data[0])){for(var gr=0;tr()&&gr<nt.data.length;gr++)nt.data[gr].forEach(Bt);nt.data.splice(0,1)}else nt.data.forEach(Bt)}(),function(){if(!nt||!re.header&&!re.dynamicTyping&&!re.transform)return nt;function Bt(Lr,Ir){var _r,or=re.header?{}:[];for(_r=0;_r<Lr.length;_r++){var Rr=_r,Ee=Lr[_r];re.header&&(Rr=_r>=$t.length?"__parsed_extra":$t[_r]),re.transform&&(Ee=re.transform(Ee,Rr)),Ee=ar(Rr,Ee),Rr==="__parsed_extra"?(or[Rr]=or[Rr]||[],or[Rr].push(Ee)):or[Rr]=Ee}return re.header&&(_r>$t.length?Sr("FieldMismatch","TooManyFields","Too many fields: expected "+$t.length+" fields but parsed "+_r,Qe+Ir):_r<$t.length&&Sr("FieldMismatch","TooFewFields","Too few fields: expected "+$t.length+" fields but parsed "+_r,Qe+Ir)),or}var gr=1;return!nt.data.length||Array.isArray(nt.data[0])?(nt.data=nt.data.map(Bt),gr=nt.data.length):nt.data=Bt(nt.data,0),re.header&&nt.meta&&(nt.meta.fields=$t),Qe+=gr,nt}()}function tr(){return re.header&&$t.length===0}function ar(Bt,gr){return Lr=Bt,re.dynamicTypingFunction&&re.dynamicTyping[Lr]===void 0&&(re.dynamicTyping[Lr]=re.dynamicTypingFunction(Lr)),(re.dynamicTyping[Lr]||re.dynamicTyping)===!0?gr==="true"||gr==="TRUE"||gr!=="false"&&gr!=="FALSE"&&(function(Ir){if(dt.test(Ir)){var _r=parseFloat(Ir);if(tt<_r&&_r<Oe)return!0}return!1}(gr)?parseFloat(gr):dr.test(gr)?new Date(gr):gr===""?null:gr):gr;var Lr}function Sr(Bt,gr,Lr,Ir){var _r={type:Bt,code:gr,message:Lr};Ir!==void 0&&(_r.row=Ir),nt.errors.push(_r)}this.parse=function(Bt,gr,Lr){var Ir=re.quoteChar||'"';if(re.newline||(re.newline=function(Rr,Ee){Rr=Rr.substring(0,1048576);var Ne=new RegExp(ht(Ee)+"([^]*?)"+ht(Ee),"gm"),Ft=(Rr=Rr.replace(Ne,"")).split("\r"),ct=Rr.split(`
`),Et=1<ct.length&&ct[0].length<Ft[0].length;if(Ft.length===1||Et)return`
`;for(var Zt=0,rr=0;rr<Ft.length;rr++)Ft[rr][0]===`
`&&Zt++;return Zt>=Ft.length/2?`\r
`:"\r"}(Bt,Ir)),Me=!1,re.delimiter)Ge(re.delimiter)&&(re.delimiter=re.delimiter(Bt),nt.meta.delimiter=re.delimiter);else{var _r=function(Rr,Ee,Ne,Ft,ct){var Et,Zt,rr,lr;ct=ct||[",","	","|",";",V.RECORD_SEP,V.UNIT_SEP];for(var Kr=0;Kr<ct.length;Kr++){var Wt=ct[Kr],li=0,ci=0,Ze=0;rr=void 0;for(var Fr=new pe({comments:Ft,delimiter:Wt,newline:Ee,preview:10}).parse(Rr),br=0;br<Fr.data.length;br++)if(Ne&&mr(Fr.data[br]))Ze++;else{var Li=Fr.data[br].length;ci+=Li,rr!==void 0?0<Li&&(li+=Math.abs(Li-rr),rr=Li):rr=Li}0<Fr.data.length&&(ci/=Fr.data.length-Ze),(Zt===void 0||li<=Zt)&&(lr===void 0||lr<ci)&&1.99<ci&&(Zt=li,Et=Wt,lr=ci)}return{successful:!!(re.delimiter=Et),bestDelimiter:Et}}(Bt,re.newline,re.skipEmptyLines,re.comments,re.delimitersToGuess);_r.successful?re.delimiter=_r.bestDelimiter:(Me=!0,re.delimiter=V.DefaultDelimiter),nt.meta.delimiter=re.delimiter}var or=Ue(re);return re.preview&&re.header&&or.preview++,ne=Bt,fe=new pe(or),nt=fe.parse(ne,gr,Lr),pr(),Xe?{meta:{paused:!0}}:nt||{meta:{paused:!1}}},this.paused=function(){return Xe},this.pause=function(){Xe=!0,fe.abort(),ne=Ge(re.chunk)?"":ne.substring(fe.getCharIndex())},this.resume=function(){Jt.streamer._halted?(Xe=!1,Jt.streamer.parseChunk(ne,!0)):setTimeout(Jt.resume,3)},this.aborted=function(){return It},this.abort=function(){It=!0,fe.abort(),nt.meta.aborted=!0,Ge(re.complete)&&re.complete(nt),ne=""}}function ht(re){return re.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function pe(re){var ne,fe=(re=re||{}).delimiter,Me=re.newline,Oe=re.comments,tt=re.step,dt=re.preview,dr=re.fastMode,Jt=ne=re.quoteChar===void 0||re.quoteChar===null?'"':re.quoteChar;if(re.escapeChar!==void 0&&(Jt=re.escapeChar),(typeof fe!="string"||-1<V.BAD_DELIMITERS.indexOf(fe))&&(fe=","),Oe===fe)throw new Error("Comment character same as delimiter");Oe===!0?Oe="#":(typeof Oe!="string"||-1<V.BAD_DELIMITERS.indexOf(Oe))&&(Oe=!1),Me!==`
`&&Me!=="\r"&&Me!==`\r
`&&(Me=`
`);var pt=0,Qe=!1;this.parse=function(Xe,It,$t){if(typeof Xe!="string")throw new Error("Input must be a string");var nt=Xe.length,er=fe.length,mr=Me.length,pr=Oe.length,tr=Ge(tt),ar=[],Sr=[],Bt=[],gr=pt=0;if(!Xe)return si();if(re.header&&!It){var Lr=Xe.split(Me)[0].split(fe),Ir=[],_r={},or=!1;for(var Rr in Lr){var Ee=Lr[Rr];Ge(re.transformHeader)&&(Ee=re.transformHeader(Ee,Rr));var Ne=Ee,Ft=_r[Ee]||0;for(0<Ft&&(or=!0,Ne=Ee+"_"+Ft),_r[Ee]=Ft+1;Ir.includes(Ne);)Ne=Ne+"_"+Ft;Ir.push(Ne)}if(or){var ct=Xe.split(Me);ct[0]=Ir.join(fe),Xe=ct.join(Me)}}if(dr||dr!==!1&&Xe.indexOf(ne)===-1){for(var Et=Xe.split(Me),Zt=0;Zt<Et.length;Zt++){if(Bt=Et[Zt],pt+=Bt.length,Zt!==Et.length-1)pt+=Me.length;else if($t)return si();if(!Oe||Bt.substring(0,pr)!==Oe){if(tr){if(ar=[],Ze(Bt.split(fe)),Je(),Qe)return si()}else Ze(Bt.split(fe));if(dt&&dt<=Zt)return ar=ar.slice(0,dt),si(!0)}}return si()}for(var rr=Xe.indexOf(fe,pt),lr=Xe.indexOf(Me,pt),Kr=new RegExp(ht(Jt)+ht(ne),"g"),Wt=Xe.indexOf(ne,pt);;)if(Xe[pt]!==ne)if(Oe&&Bt.length===0&&Xe.substring(pt,pt+pr)===Oe){if(lr===-1)return si();pt=lr+mr,lr=Xe.indexOf(Me,pt),rr=Xe.indexOf(fe,pt)}else if(rr!==-1&&(rr<lr||lr===-1))Bt.push(Xe.substring(pt,rr)),pt=rr+er,rr=Xe.indexOf(fe,pt);else{if(lr===-1)break;if(Bt.push(Xe.substring(pt,lr)),Li(lr+mr),tr&&(Je(),Qe))return si();if(dt&&ar.length>=dt)return si(!0)}else for(Wt=pt,pt++;;){if((Wt=Xe.indexOf(ne,Wt+1))===-1)return $t||Sr.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:ar.length,index:pt}),br();if(Wt===nt-1)return br(Xe.substring(pt,Wt).replace(Kr,ne));if(ne!==Jt||Xe[Wt+1]!==Jt){if(ne===Jt||Wt===0||Xe[Wt-1]!==Jt){rr!==-1&&rr<Wt+1&&(rr=Xe.indexOf(fe,Wt+1)),lr!==-1&&lr<Wt+1&&(lr=Xe.indexOf(Me,Wt+1));var li=Fr(lr===-1?rr:Math.min(rr,lr));if(Xe.substr(Wt+1+li,er)===fe){Bt.push(Xe.substring(pt,Wt).replace(Kr,ne)),Xe[pt=Wt+1+li+er]!==ne&&(Wt=Xe.indexOf(ne,pt)),rr=Xe.indexOf(fe,pt),lr=Xe.indexOf(Me,pt);break}var ci=Fr(lr);if(Xe.substring(Wt+1+ci,Wt+1+ci+mr)===Me){if(Bt.push(Xe.substring(pt,Wt).replace(Kr,ne)),Li(Wt+1+ci+mr),rr=Xe.indexOf(fe,pt),Wt=Xe.indexOf(ne,pt),tr&&(Je(),Qe))return si();if(dt&&ar.length>=dt)return si(!0);break}Sr.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:ar.length,index:pt}),Wt++}}else Wt++}return br();function Ze(Nt){ar.push(Nt),gr=pt}function Fr(Nt){var Vt=0;if(Nt!==-1){var ui=Xe.substring(Wt+1,Nt);ui&&ui.trim()===""&&(Vt=ui.length)}return Vt}function br(Nt){return $t||(Nt===void 0&&(Nt=Xe.substring(pt)),Bt.push(Nt),pt=nt,Ze(Bt),tr&&Je()),si()}function Li(Nt){pt=Nt,Ze(Bt),Bt=[],lr=Xe.indexOf(Me,pt)}function si(Nt){return{data:ar,errors:Sr,meta:{delimiter:fe,linebreak:Me,aborted:Qe,truncated:!!Nt,cursor:gr+(It||0)}}}function Je(){tt(si()),ar=[],Sr=[]}},this.abort=function(){Qe=!0},this.getCharIndex=function(){return pt}}function oe(re){var ne=re.data,fe=S[ne.workerId],Me=!1;if(ne.error)fe.userError(ne.error,ne.file);else if(ne.results&&ne.results.data){var Oe={abort:function(){Me=!0,me(ne.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:De,resume:De};if(Ge(fe.userStep)){for(var tt=0;tt<ne.results.data.length&&(fe.userStep({data:ne.results.data[tt],errors:ne.results.errors,meta:ne.results.meta},Oe),!Me);tt++);delete ne.results}else Ge(fe.userChunk)&&(fe.userChunk(ne.results,Oe,ne.file),delete ne.results)}ne.finished&&!Me&&me(ne.workerId,ne.results)}function me(re,ne){var fe=S[re];Ge(fe.userComplete)&&fe.userComplete(ne),fe.terminate(),delete S[re]}function De(){throw new Error("Not implemented.")}function Ue(re){if(typeof re!="object"||re===null)return re;var ne=Array.isArray(re)?[]:{};for(var fe in re)ne[fe]=Ue(re[fe]);return ne}function ze(re,ne){return function(){re.apply(ne,arguments)}}function Ge(re){return typeof re=="function"}return C&&(y.onmessage=function(re){var ne=re.data;if(V.WORKER_ID===void 0&&ne&&(V.WORKER_ID=ne.workerId),typeof ne.input=="string")y.postMessage({workerId:V.WORKER_ID,results:V.parse(ne.input,ne.config),finished:!0});else if(y.File&&ne.input instanceof File||ne.input instanceof Object){var fe=V.parse(ne.input,ne.config);fe&&y.postMessage({workerId:V.WORKER_ID,results:fe,finished:!0})}}),(ie.prototype=Object.create(Te.prototype)).constructor=ie,(G.prototype=Object.create(Te.prototype)).constructor=G,(He.prototype=Object.create(He.prototype)).constructor=He,(Ke.prototype=Object.create(Te.prototype)).constructor=Ke,V})})(Lx);var gk=Lx.exports;const uf=lv(gk),yk="data:image/svg+xml,%3csvg%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3.60625%2012.0625L4.19375%2013.0875C4.7125%2013.9937%205.5625%2014.6625%206.56875%2014.95L10.1875%2015.9812C11.2625%2016.2875%2012%2017.2688%2012%2018.3875V20.8813C12%2021.5688%2012.3875%2022.1937%2013%2022.5C13.6125%2022.8063%2014%2023.4312%2014%2024.1187V26.5562C14%2027.5312%2014.9312%2028.2375%2015.8687%2027.9688C16.875%2027.6813%2017.6563%2026.875%2017.9125%2025.8563L18.0875%2025.1562C18.35%2024.1%2019.0375%2023.1938%2019.9813%2022.6562L20.4875%2022.3687C21.425%2021.8375%2022%2020.8375%2022%2019.7625V19.2437C22%2018.45%2021.6812%2017.6875%2021.1187%2017.125L20.875%2016.8813C20.3125%2016.3188%2019.55%2016%2018.7563%2016H16.0625C15.3687%2016%2014.6812%2015.8188%2014.075%2015.475L11.9187%2014.2437C11.65%2014.0875%2011.4438%2013.8375%2011.3438%2013.5437C11.1437%2012.9437%2011.4125%2012.2937%2011.9812%2012.0125L12.35%2011.825C12.7625%2011.6187%2013.2437%2011.5812%2013.6812%2011.7312L15.1313%2012.2125C15.6438%2012.3812%2016.2063%2012.1875%2016.5%2011.7437C16.7937%2011.3062%2016.7625%2010.725%2016.425%2010.3188L15.575%209.3C14.95%208.55%2014.9563%207.45625%2015.5938%206.71875L16.575%205.575C17.125%204.93125%2017.2125%204.0125%2016.7938%203.28125L16.6437%203.01875C16.425%203.00625%2016.2125%203%2015.9937%203C10.1937%203%205.275%206.80625%203.60625%2012.0625ZM29%2016C29%2013.7%2028.4%2011.5375%2027.35%209.65625L25.75%2010.3C24.7688%2010.6938%2024.2625%2011.7875%2024.5938%2012.7875L25.65%2015.9563C25.8687%2016.6063%2026.4%2017.1%2027.0625%2017.2625L28.8813%2017.7188C28.9563%2017.1562%2028.9937%2016.5813%2028.9937%2016H29ZM0%2016C0%2011.7565%201.68571%207.68687%204.68629%204.68629C7.68687%201.68571%2011.7565%200%2016%200C20.2435%200%2024.3131%201.68571%2027.3137%204.68629C30.3143%207.68687%2032%2011.7565%2032%2016C32%2020.2435%2030.3143%2024.3131%2027.3137%2027.3137C24.3131%2030.3143%2020.2435%2032%2016%2032C11.7565%2032%207.68687%2030.3143%204.68629%2027.3137C1.68571%2024.3131%200%2020.2435%200%2016Z'%20fill='black'/%3e%3c/svg%3e",Rx="data:image/svg+xml,%3csvg%20width='19'%20height='19'%20viewBox='0%200%2019%2019'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15.4383%207.71762C15.4383%209.42069%2014.8853%2010.9939%2013.9538%2012.2703L18.6521%2016.9713C19.116%2017.4351%2019.116%2018.1884%2018.6521%2018.6522C18.1882%2019.1159%2017.4348%2019.1159%2016.9709%2018.6522L12.2727%2013.9511C10.996%2014.8861%209.42253%2015.4352%207.71913%2015.4352C3.45505%2015.4352%200%2011.9809%200%207.71762C0%203.45438%203.45505%200%207.71913%200C11.9832%200%2015.4383%203.45438%2015.4383%207.71762ZM7.71913%2013.0606C8.42091%2013.0606%209.11583%2012.9224%209.76419%2012.6539C10.4126%2012.3854%2011.0017%2011.9918%2011.4979%2011.4957C11.9941%2010.9995%2012.3878%2010.4105%2012.6563%209.76228C12.9249%209.11405%2013.0631%208.41927%2013.0631%207.71762C13.0631%207.01597%2012.9249%206.32119%2012.6563%205.67295C12.3878%205.02472%2011.9941%204.43571%2011.4979%203.93957C11.0017%203.44343%2010.4126%203.04987%209.76419%202.78136C9.11583%202.51285%208.42091%202.37465%207.71913%202.37465C7.01734%202.37465%206.32243%202.51285%205.67406%202.78136C5.0257%203.04987%204.43658%203.44343%203.94034%203.93957C3.4441%204.43571%203.05047%205.02472%202.7819%205.67295C2.51334%206.32119%202.37512%207.01597%202.37512%207.71762C2.37512%208.41927%202.51334%209.11405%202.7819%209.76228C3.05047%2010.4105%203.4441%2010.9995%203.94034%2011.4957C4.43658%2011.9918%205.0257%2012.3854%205.67406%2012.6539C6.32243%2012.9224%207.01734%2013.0606%207.71913%2013.0606Z'%20fill='%23595959'/%3e%3c/svg%3e",_k="data:image/svg+xml,%3csvg%20width='11'%20height='11'%20viewBox='0%200%2011%2011'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.5%201V10'%20stroke='black'%20stroke-linecap='round'/%3e%3cpath%20d='M10%205.5L1%205.5'%20stroke='black'%20stroke-linecap='round'/%3e%3c/svg%3e",vk="data:image/svg+xml,%3csvg%20width='11'%20height='2'%20viewBox='0%200%2011%202'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10%201L1%201'%20stroke='black'%20stroke-linecap='round'/%3e%3c/svg%3e",xk=({label:i,startColor:s,endColor:u})=>{const y=Array.from({length:10},(x,C)=>Kl(s,u,(10-C)/10));return te.jsxs("div",{className:"absolute bottom-10 right-1 z-20 flex w-[9rem] flex-col rounded-lg bg-white px-2 py-4 shadow-lg",children:[te.jsx("h2",{className:"mb-2 text-center text-base font-bold leading-5",children:i}),te.jsx("div",{className:"flex columns-2 flex-row justify-center align-middle",children:te.jsxs("div",{className:"relative flex flex-col justify-between",children:[y.map((x,C)=>te.jsx("div",{className:"min-h-7 w-7",style:{backgroundColor:x}},C)),te.jsxs("div",{className:"absolute left-7 ml-1 flex h-full w-full flex-col justify-between",children:[te.jsx("span",{className:"mt-[-0.3rem] text-sm",children:"100"}),te.jsx("span",{className:"mb-[0rem] text-sm",children:"50"}),te.jsx("span",{className:"mb-[-0.3rem] text-sm",children:"0"})]})]})})]})},Cp=["us-fill","canada-fill"],bk=["us-state-boundary","canada-province-boundary"],nv="https://major-sculpin.nceas.ucsb.edu",wk=()=>({version:8,glyphs:"https://tiles.openfreemap.org/fonts/{fontstack}/{range}.pbf",sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"Map data  OpenStreetMap contributors"},"us-state-boundaries":{type:"vector",tiles:[`${nv}/data/us_states/{z}/{x}/{y}.pbf`],minzoom:0,maxzoom:14},"canada-province-boundaries":{type:"vector",tiles:[`${nv}/data/ca_provinces/{z}/{x}/{y}.pbf`],minzoom:0,maxzoom:14},openfreemap:{type:"vector",tiles:[HS],minzoom:0,maxzoom:14,attribution:" OpenFreeMap  OpenStreetMap contributors"}},layers:[{id:"simple-tiles",type:"raster",source:"osm"}]}),Sk=async(i,s)=>{const u=WS(i.domainId,i.metricId,s),[y,x]=await Promise.all([fetch(u.us),fetch(u.canada)]),[C,S]=await Promise.all([y.text(),x.text()]),d=uf.parse(C,{header:!0}),V=uf.parse(S,{header:!0}),ee={},Te=i.metricId.endsWith("_domain_score")||i.metricId==="wwri_final_score";return d.data.forEach(ie=>{if(ie[$l]&&ie[i.metricId]){let G=parseFloat(ie[i.metricId]);Te&&(G=G/100),ee[ie[$l]]=G}}),V.data.forEach(ie=>{if(ie[$l]&&ie[i.metricId]){let G=parseFloat(ie[i.metricId]);Te&&(G=G/100),ee[ie[$l]]=G}}),console.log(`[${s}] Loaded metrics: US=${d.data.length}, Canada=${V.data.length}, Total=${Object.keys(ee).length}`),ee},kk=async i=>{const s=KS(i),[u,y]=await Promise.all([fetch(s.us),fetch(s.canada)]),[x,C]=await Promise.all([u.text(),y.text()]),S=uf.parse(x,{header:!0}),d=uf.parse(C,{header:!0}),V={};return S.data.forEach(ee=>{if(ee[$l]){const Te=i==="tract"?ee.county_name||ee.name||"":ee.name||ee.county_name||"";V[ee[$l]]={name:Te,region:ee.state_name||"",country:"us"}}}),d.data.forEach(ee=>{ee[$l]&&(V[ee[$l]]={name:ee.name||"",region:ee.province||"",country:"canada"})}),console.log(`[${i}] Loaded locations: US=${S.data.length}, Canada=${d.data.length}, Total=${Object.keys(V).length}`),V},Ck=({selectedGeoId:i,selectedMetricIdObject:s,setSelectedRegionName:u,setSelectedStateName:y,setSelectedMetricValue:x,setSelectedGeoId:C,setSelectedCountry:S,selectedGeoLevel:d,setSelectedGeoLevel:V,leftSidebarOpen:ee})=>{const Te=Ot.useRef(null),[ie,G]=Ot.useState({}),[He,Ke]=Ot.useState({}),ke=Ot.useRef({}),ht=Ot.useRef({}),[pe,oe]=Ot.useState(!1),[me,De]=Ot.useState(!1),Ue=Ot.useRef(null),ze=Ot.useRef(null),[Ge,re]=Ot.useState([]),[ne,fe]=Ot.useState(""),[Me,Oe]=Ot.useState(!1),tt=Ot.useRef(null),dt=Ol[d],dr=dt.us,Jt=dt.canada,pt=Ot.useRef(dr),Qe=Ot.useRef(Jt);Ot.useEffect(()=>{pt.current=dr,Qe.current=Jt},[dr,Jt]);const Xe=Ot.useRef(s.colorGradient.startColor),It=Ot.useRef(s.colorGradient.endColor);Ot.useEffect(()=>{Xe.current=s.colorGradient.startColor,It.current=s.colorGradient.endColor},[s]),Ot.useEffect(()=>{(async()=>{oe(!1);const Ft=Sk(s,d),ct=kk(d),Et=await Ft,Zt=await ct;G(Et),Ke(Zt),ke.current=Et,ht.current=Zt,oe(!0)})()},[s,d]);const $t=Ot.useCallback((Ne,Ft)=>{const ct=Ol[Ft];Ne.addSource("us-tiles",{type:"vector",tiles:[ct.us.tileUrl],minzoom:0,maxzoom:14}),Ne.addSource("canada-tiles",{type:"vector",tiles:[ct.canada.tileUrl],minzoom:0,maxzoom:14}),Ne.addLayer({id:"us-fill",type:"fill",source:"us-tiles","source-layer":ct.us.sourceLayer,paint:{"fill-color":["coalesce",["feature-state","color"],"#D3D3D3"],"fill-opacity":1}}),Ne.addLayer({id:"canada-fill",type:"fill",source:"canada-tiles","source-layer":ct.canada.sourceLayer,paint:{"fill-color":["coalesce",["feature-state","color"],"#D3D3D3"],"fill-opacity":1}}),Ne.addLayer({id:"us-highlight",type:"line",source:"us-tiles","source-layer":ct.us.sourceLayer,paint:{"line-color":"#00FFFF","line-width":3,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),Ne.addLayer({id:"canada-highlight",type:"line",source:"canada-tiles","source-layer":ct.canada.sourceLayer,paint:{"line-color":"#00FFFF","line-width":3,"line-opacity":["case",["boolean",["feature-state","selected"],!1],1,0]}}),console.log(`Added layers for geo level: ${Ft}`)},[]),nt=Ot.useCallback(Ne=>{["us-highlight","canada-highlight","us-fill","canada-fill"].forEach(Et=>{Ne.getLayer(Et)&&Ne.removeLayer(Et)}),["us-tiles","canada-tiles"].forEach(Et=>{Ne.getSource(Et)&&Ne.removeSource(Et)}),tt.current=null,console.log("Removed geo level layers")},[]),er=Ot.useCallback(Ne=>{if(Ne.getLayer("us-state-boundary")){console.log("Boundary layers already exist, skipping");return}Ne.addLayer({id:"us-state-boundary",type:"line",source:"us-state-boundaries","source-layer":"us_states",paint:{"line-color":"#ffffff","line-width":2.5,"line-opacity":1}}),Ne.addLayer({id:"canada-province-boundary",type:"line",source:"canada-province-boundaries","source-layer":"ca_provinces",paint:{"line-color":"#ffffff","line-width":2.5,"line-opacity":1}}),console.log("Added state/province boundary layers")},[]),mr=Ot.useCallback(Ne=>{bk.forEach(Ft=>{Ne.getLayer(Ft)&&Ne.moveLayer(Ft,"us-highlight")}),console.log("Repositioned boundary layers")},[]),pr=Ot.useCallback(Ne=>{if(Ne.getLayer("labels-states-abbrev"))return;const Ft="#ffffff",ct=2,Et="#333333";Ne.addLayer({id:"labels-states-abbrev",type:"symbol",source:"openfreemap","source-layer":"place",minzoom:3,maxzoom:5.5,filter:["==",["get","class"],"state"],layout:{"text-field":["upcase",["coalesce",["get","name:en"],["get","name"]]],"text-font":["Noto Sans Medium"],"text-size":11,"text-letter-spacing":.1,"text-max-width":8},paint:{"text-color":Et,"text-halo-color":Ft,"text-halo-width":ct,"text-opacity":.9}}),Ne.addLayer({id:"labels-states-full",type:"symbol",source:"openfreemap","source-layer":"place",minzoom:5.5,maxzoom:7.5,filter:["==",["get","class"],"state"],layout:{"text-field":["coalesce",["get","name:en"],["get","name"]],"text-font":["Noto Sans Medium"],"text-size":14,"text-max-width":10},paint:{"text-color":Et,"text-halo-color":Ft,"text-halo-width":ct}}),Ne.addLayer({id:"labels-cities",type:"symbol",source:"openfreemap","source-layer":"place",minzoom:7,filter:["in",["get","class"],["literal",["city","town"]]],layout:{"text-field":["coalesce",["get","name:en"],["get","name"]],"text-font":["Noto Sans Regular"],"text-size":["interpolate",["linear"],["zoom"],7,11,10,14,14,18],"text-max-width":10,"text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":.5},paint:{"text-color":Et,"text-halo-color":Ft,"text-halo-width":ct}}),console.log("Added vector label layers (OpenFreeMap)")},[]),tr=Ot.useCallback(Ne=>{["labels-states-abbrev","labels-states-full","labels-cities"].forEach(ct=>{Ne.getLayer(ct)&&Ne.moveLayer(ct)}),console.log("Repositioned label layers to top")},[]),ar=Ot.useCallback(Ne=>{let Ft=0,ct=0;Ne.getLayer("us-fill")&&Ne.queryRenderedFeatures({layers:["us-fill"]}).forEach(Zt=>{if(Zt.id===void 0)return;const rr=Zt.properties[pt.current.idField],lr=ke.current[rr],Kr={source:"us-tiles",sourceLayer:pt.current.sourceLayer,id:Zt.id};if(lr!==void 0){const Wt=Kl(Xe.current,It.current,lr);Ne.setFeatureState(Kr,{color:Wt}),Ft++}else Ne.setFeatureState(Kr,{color:"#D3D3D3"}),ct++}),Ne.getLayer("canada-fill")&&Ne.queryRenderedFeatures({layers:["canada-fill"]}).forEach(Zt=>{if(Zt.id===void 0)return;const rr=Zt.properties[Qe.current.idField],lr=ke.current[rr],Kr={source:"canada-tiles",sourceLayer:Qe.current.sourceLayer,id:Zt.id};if(lr!==void 0){const Wt=Kl(Xe.current,It.current,lr);Ne.setFeatureState(Kr,{color:Wt}),Ft++}else Ne.setFeatureState(Kr,{color:"#D3D3D3"}),ct++}),console.log(`loadColors: colored=${Ft}, noData=${ct}`)},[]),Sr=Ot.useRef(d);Ot.useEffect(()=>{if(Te.current&&!Ue.current){const Ne=new iv.Map({container:Te.current,style:wk(),center:[-103.9375,38.7888894],zoom:3.3});Ue.current=Ne,Ne.getCanvas().style.cursor="pointer",Ne.on("load",()=>{$t(Ne,Sr.current),er(Ne),mr(Ne),pr(Ne),tr(Ne),De(!0)});const Ft=Zt=>{const rr=Zt.features;if(rr&&rr.length>0){const lr=rr[0],Wt=lr.layer.id.startsWith("canada-"),li=Wt?Qe.current:pt.current,ci=Wt?"canada-tiles":"us-tiles",Ze=lr.properties[li.idField],Fr=ke.current[Ze];if(tt.current&&Ue.current&&Ue.current.setFeatureState(tt.current,{selected:!1}),lr.id!==void 0){const br={source:ci,sourceLayer:li.sourceLayer,id:lr.id};Ne.setFeatureState(br,{selected:!0}),tt.current=br}if(typeof Fr=="number"&&x){const br=ht.current[Ze];br&&(u(br.name),y(br.region),S(br.country)),C(Ze),x(Fr)}}};Cp.forEach(Zt=>{Ne.on("click",Zt,Ft)});const ct=()=>{ze.current&&(ze.current.remove(),ze.current=null)};Cp.forEach(Zt=>{Ne.on("mouseleave",Zt,ct)});const Et=()=>{console.log("moveend event"),ar(Ne)};return Ne.on("moveend",Et),()=>{var Zt;Ne.off("moveend",Et),(Zt=Ue.current)==null||Zt.remove(),Ue.current=null}}},[$t,er,mr,pr,tr]),Ot.useEffect(()=>{if(Ue.current&&me){const Ne=Ue.current;if(Sr.current===d&&Ne.getSource("us-tiles"))return;console.log(`Switching geo level: ${Sr.current} -> ${d}`),nt(Ne),$t(Ne,d),mr(Ne),tr(Ne),Sr.current=d;const Ft=ct=>{ct.sourceId==="us-tiles"&&ct.isSourceLoaded&&(ar(Ne),Ne.off("sourcedata",Ft))};Ne.on("sourcedata",Ft)}},[d,me,$t,nt,mr,tr]),Ot.useEffect(()=>{if(pe&&me&&Ue.current){const Ne=Ue.current;ar(Ne),tr(Ne);const Ft=()=>{ar(Ne),tr(Ne)},ct=Et=>{(Et.sourceId==="us-tiles"||Et.sourceId==="canada-tiles")&&Et.isSourceLoaded&&setTimeout(()=>{ar(Ne),tr(Ne)},100)};return Ne.on("idle",Ft),Ne.on("sourcedata",ct),()=>{Ne.off("idle",Ft),Ne.off("sourcedata",ct)}}},[ie,pe,me,ar,tr]);const Bt=(Ne,Ft,ct,Et)=>{if(Ft==="tract"){if(!ct&&Ne.length>=11){const Zt=Ne.slice(-6),rr=Zt.slice(0,4).replace(/^0+/,"")||"0",lr=Zt.slice(4);return`${rr}.${lr}`}return Ne}return Et||Ne};Ot.useEffect(()=>{if(Ue.current&&me){const Ne=Ue.current,Ft=ct=>{var Zt;const Et=ct.features;if(Et&&Et.length>0){const rr=Et[0],Kr=rr.layer.id.startsWith("canada-"),Wt=Kr?Qe.current:pt.current,li=rr.properties[Wt.idField],ci=ke.current[li],Ze=ht.current[li];ze.current||(ze.current=new iv.Popup({closeButton:!1,closeOnClick:!1}));const Fr=Ze!=null&&Ze.region?Mx(Ze.region):"",br=Kl(Xe.current,It.current,ci),Li=Wt.displayName,si=Bt(li,d,Kr,(Ze==null?void 0:Ze.name)||""),Je=`
            <div id="map-tooltip" class="rounded">
              <h1 class="font-bold text-[0.8rem] text-selectedIndicatorTextColor">
                ${((Zt=Ze==null?void 0:Ze.name)==null?void 0:Zt.toUpperCase())||"N/A"}${Fr?`, ${Fr}`:""}
              </h1>
              <h2 class="text-xs tracking-widest">${Li} ${si}</h2>
              <div class="mt-1 flex items-center">
                <div class="blackc mr-1 inline-block min-h-4 min-w-4 rounded-sm border-[1px] border-solid border-black" style="background-color: ${br}"></div>
                <span class="font-bold text-black">
                  ${ci!==void 0?`${(ci*100).toFixed(1)}%`:"N/A"}
                </span>
                <span class="ml-1 text-xs"> ${s.label}</span>
              </div>
            </div>
          `,Nt=ct.lngLat,Vt=Ne.project(Nt);Vt.y-=5;const ui=Ne.unproject(Vt);ze.current.setLngLat(ui).setHTML(Je).addTo(Ne)}};return Cp.forEach(ct=>{Ne.getLayer(ct)&&(Ne.off("mousemove",ct,Ft),Ne.on("mousemove",ct,Ft))}),()=>{Cp.forEach(ct=>{Ne.getLayer(ct)&&Ne.off("mousemove",ct,Ft)})}}},[ie,pe,me,s,d]);const gr=Ne=>{const Ft=Ne.target.value;fe(Ft),Ft.length>2?Ir(Ft):re([])},Lr=(Ne,Ft,ct)=>{Ue.current&&Ue.current.flyTo({center:[Ft,Ne],zoom:8.5,essential:!0}),fe(ct),re([])},Ir=async Ne=>{const Et=await(await fetch(`https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(Ne)}&key=7daab0c61bc84b5d80eb72315d130135&countrycode=us,ca&limit=5`)).json();re(Et.results)},_r=()=>{fe(""),re([]),Oe(!1)},or=()=>{Ue.current&&Ue.current.zoomIn()},Rr=()=>{Ue.current&&Ue.current.zoomOut()},Ee=()=>{Ue.current&&Ue.current.flyTo({center:[-103.9375,38.7888894],zoom:3.3,essential:!0})};return te.jsxs("div",{id:"map-area",className:"relative h-full w-full",children:[te.jsxs("div",{id:"search-icon-searchbox-container",className:`transition-width absolute right-1 top-1 z-10 rounded-md bg-white shadow-sm duration-200 ${Me?"w-80":"w-10"}`,children:[!Me&&te.jsx("button",{className:"flex h-10 w-10 items-center justify-center rounded-md border border-gray-400",onClick:()=>Oe(!0),children:te.jsx("img",{src:Rx,alt:"search icon",className:"h-6 w-6",style:{filter:"grayscale(100%) invert(70%)"}})}),Me&&te.jsxs(te.Fragment,{children:[te.jsxs("div",{id:"location-search-box",className:"relative w-full",children:[te.jsx("input",{type:"text",className:"search-input h-10 w-full rounded border border-gray-400 py-1 pl-2 pr-8 text-sm focus:border-gray-400 focus:outline-none",placeholder:"Search for a location",value:ne,onChange:gr,onBlur:()=>{setTimeout(()=>{re([])},100)}}),te.jsx("button",{className:"absolute right-0 top-0 flex h-10 w-10 items-center justify-center text-gray-400",onClick:_r,children:te.jsx("img",{src:kx,alt:"close search",className:"h-4 w-4",style:{filter:"grayscale(80%) invert(70%)"}})})]}),Ge.length>0&&te.jsx("div",{id:"location-autocomplete-suggestions",className:"autocomplete-suggestions absolute z-30 w-[calc(100%-2.8rem)] rounded bg-white shadow-md",children:Ge.map((Ne,Ft)=>te.jsxs("div",{className:"autocomplete-suggestion cursor-pointer p-2 hover:bg-gray-200",onClick:()=>Lr(Ne.geometry.lat,Ne.geometry.lng,Ne.formatted),children:[te.jsx("strong",{className:"text-sm",children:Ne.formatted.split(",")[0]}),te.jsx("span",{className:"text-sm text-gray-500",children:`,${Ne.formatted.split(",").slice(1).join(",")}`})]},Ft))})]})]}),te.jsx("div",{id:"geo-level-selector",className:`absolute top-1 z-10 flex h-10 gap-1 rounded-md border border-gray-400 bg-white p-1 shadow-md transition-[left] duration-300 ease-in-out ${ee?"left-[238px]":"left-12"}`,children:Object.keys(Ol).map(Ne=>te.jsx("button",{id:`geo-level-${Ne}`,onClick:()=>V(Ne),className:`rounded-md px-3 py-1.5 text-sm font-medium transition-all duration-150 ${d===Ne?"bg-leftSidebarOverallResilience text-white shadow-sm":"bg-transparent text-gray-600 hover:bg-gray-100 hover:text-gray-800"}`,children:Ol[Ne].label},Ne))}),te.jsxs("div",{id:"map-area-controls",className:"absolute right-1 top-12 z-10 flex flex-col space-y-1",children:[te.jsx("button",{id:"zoom-in-button",className:"flex h-10 w-10 items-center justify-center rounded-md border border-gray-400 bg-white align-middle text-4xl text-mapIconColor",onClick:or,children:te.jsx("img",{src:_k,alt:"zoom in",className:"h-6 w-6",style:{filter:"grayscale(50%) invert(50%)"}})}),te.jsx("button",{id:"zoom-out-button",className:"flex h-10 w-10 items-center justify-center rounded-md border border-gray-400 bg-white align-middle text-4xl text-mapIconColor",onClick:Rr,children:te.jsx("img",{src:vk,alt:"zoom out",className:"h-6 w-6 fill-mapIconColor stroke-mapIconColor",style:{filter:"grayscale(50%) invert(50%)"}})}),te.jsx("button",{id:"reset-view-button",className:"flex h-10 w-10 items-center justify-center rounded-md border border-gray-400 bg-white",onClick:Ee,children:te.jsx("img",{src:yk,alt:"reset view",className:"h-6 w-6 fill-current stroke-mapIconColor",style:{filter:"grayscale(50%) invert(50%)"}})})]}),te.jsx(xk,{startColor:Xe.current,endColor:It.current,label:s.label}),te.jsx("div",{ref:Te,className:"absolute left-0 top-0 flex h-full w-full"})]})};var Tk={exports:{}};/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2019, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */(function(i,s){(function(u,y){i.exports=y()})(Ag,function(){for(var u=function(I,M,O){return M===void 0&&(M=0),O===void 0&&(O=1),I<M?M:I>O?O:I},y=u,x=function(I){I._clipped=!1,I._unclipped=I.slice(0);for(var M=0;M<=3;M++)M<3?((I[M]<0||I[M]>255)&&(I._clipped=!0),I[M]=y(I[M],0,255)):M===3&&(I[M]=y(I[M],0,1));return I},C={},S=0,d=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];S<d.length;S+=1){var V=d[S];C["[object "+V+"]"]=V.toLowerCase()}var ee=function(I){return C[Object.prototype.toString.call(I)]||"object"},Te=ee,ie=function(I,M){return M===void 0&&(M=null),I.length>=3?Array.prototype.slice.call(I):Te(I[0])=="object"&&M?M.split("").filter(function(O){return I[0][O]!==void 0}).map(function(O){return I[0][O]}):I[0]},G=ee,He=function(I){if(I.length<2)return null;var M=I.length-1;return G(I[M])=="string"?I[M].toLowerCase():null},Ke=Math.PI,ke={clip_rgb:x,limit:u,type:ee,unpack:ie,last:He,PI:Ke,TWOPI:Ke*2,PITHIRD:Ke/3,DEG2RAD:Ke/180,RAD2DEG:180/Ke},ht={format:{},autodetect:[]},pe=ke.last,oe=ke.clip_rgb,me=ke.type,De=ht,Ue=function(){for(var M=[],O=arguments.length;O--;)M[O]=arguments[O];var X=this;if(me(M[0])==="object"&&M[0].constructor&&M[0].constructor===this.constructor)return M[0];var de=pe(M),ve=!1;if(!de){ve=!0,De.sorted||(De.autodetect=De.autodetect.sort(function(Ye,xt){return xt.p-Ye.p}),De.sorted=!0);for(var ce=0,we=De.autodetect;ce<we.length;ce+=1){var Ae=we[ce];if(de=Ae.test.apply(Ae,M),de)break}}if(De.format[de]){var qe=De.format[de].apply(null,ve?M:M.slice(0,-1));X._rgb=oe(qe)}else throw new Error("unknown format: "+M);X._rgb.length===3&&X._rgb.push(1)};Ue.prototype.toString=function(){return me(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var ze=Ue,Ge=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(Ge.Color,[null].concat(I)))};Ge.Color=ze,Ge.version="2.4.2";var re=Ge,ne=ke.unpack,fe=Math.max,Me=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=ne(I,"rgb"),X=O[0],de=O[1],ve=O[2];X=X/255,de=de/255,ve=ve/255;var ce=1-fe(X,fe(de,ve)),we=ce<1?1/(1-ce):0,Ae=(1-X-ce)*we,qe=(1-de-ce)*we,Ye=(1-ve-ce)*we;return[Ae,qe,Ye,ce]},Oe=Me,tt=ke.unpack,dt=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];I=tt(I,"cmyk");var O=I[0],X=I[1],de=I[2],ve=I[3],ce=I.length>4?I[4]:1;return ve===1?[0,0,0,ce]:[O>=1?0:255*(1-O)*(1-ve),X>=1?0:255*(1-X)*(1-ve),de>=1?0:255*(1-de)*(1-ve),ce]},dr=dt,Jt=re,pt=ze,Qe=ht,Xe=ke.unpack,It=ke.type,$t=Oe;pt.prototype.cmyk=function(){return $t(this._rgb)},Jt.cmyk=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(pt,[null].concat(I,["cmyk"])))},Qe.format.cmyk=dr,Qe.autodetect.push({p:2,test:function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];if(I=Xe(I,"cmyk"),It(I)==="array"&&I.length===4)return"cmyk"}});var nt=ke.unpack,er=ke.last,mr=function(I){return Math.round(I*100)/100},pr=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=nt(I,"hsla"),X=er(I)||"lsa";return O[0]=mr(O[0]||0),O[1]=mr(O[1]*100)+"%",O[2]=mr(O[2]*100)+"%",X==="hsla"||O.length>3&&O[3]<1?(O[3]=O.length>3?O[3]:1,X="hsla"):O.length=3,X+"("+O.join(",")+")"},tr=pr,ar=ke.unpack,Sr=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];I=ar(I,"rgba");var O=I[0],X=I[1],de=I[2];O/=255,X/=255,de/=255;var ve=Math.min(O,X,de),ce=Math.max(O,X,de),we=(ce+ve)/2,Ae,qe;return ce===ve?(Ae=0,qe=Number.NaN):Ae=we<.5?(ce-ve)/(ce+ve):(ce-ve)/(2-ce-ve),O==ce?qe=(X-de)/(ce-ve):X==ce?qe=2+(de-O)/(ce-ve):de==ce&&(qe=4+(O-X)/(ce-ve)),qe*=60,qe<0&&(qe+=360),I.length>3&&I[3]!==void 0?[qe,Ae,we,I[3]]:[qe,Ae,we]},Bt=Sr,gr=ke.unpack,Lr=ke.last,Ir=tr,_r=Bt,or=Math.round,Rr=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=gr(I,"rgba"),X=Lr(I)||"rgb";return X.substr(0,3)=="hsl"?Ir(_r(O),X):(O[0]=or(O[0]),O[1]=or(O[1]),O[2]=or(O[2]),(X==="rgba"||O.length>3&&O[3]<1)&&(O[3]=O.length>3?O[3]:1,X="rgba"),X+"("+O.slice(0,X==="rgb"?3:4).join(",")+")")},Ee=Rr,Ne=ke.unpack,Ft=Math.round,ct=function(){for(var I,M=[],O=arguments.length;O--;)M[O]=arguments[O];M=Ne(M,"hsl");var X=M[0],de=M[1],ve=M[2],ce,we,Ae;if(de===0)ce=we=Ae=ve*255;else{var qe=[0,0,0],Ye=[0,0,0],xt=ve<.5?ve*(1+de):ve+de-ve*de,it=2*ve-xt,At=X/360;qe[0]=At+1/3,qe[1]=At,qe[2]=At-1/3;for(var Mt=0;Mt<3;Mt++)qe[Mt]<0&&(qe[Mt]+=1),qe[Mt]>1&&(qe[Mt]-=1),6*qe[Mt]<1?Ye[Mt]=it+(xt-it)*6*qe[Mt]:2*qe[Mt]<1?Ye[Mt]=xt:3*qe[Mt]<2?Ye[Mt]=it+(xt-it)*(2/3-qe[Mt])*6:Ye[Mt]=it;I=[Ft(Ye[0]*255),Ft(Ye[1]*255),Ft(Ye[2]*255)],ce=I[0],we=I[1],Ae=I[2]}return M.length>3?[ce,we,Ae,M[3]]:[ce,we,Ae,1]},Et=ct,Zt=Et,rr=ht,lr=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,Kr=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,Wt=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,li=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,ci=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Ze=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Fr=Math.round,br=function(I){I=I.toLowerCase().trim();var M;if(rr.format.named)try{return rr.format.named(I)}catch{}if(M=I.match(lr)){for(var O=M.slice(1,4),X=0;X<3;X++)O[X]=+O[X];return O[3]=1,O}if(M=I.match(Kr)){for(var de=M.slice(1,5),ve=0;ve<4;ve++)de[ve]=+de[ve];return de}if(M=I.match(Wt)){for(var ce=M.slice(1,4),we=0;we<3;we++)ce[we]=Fr(ce[we]*2.55);return ce[3]=1,ce}if(M=I.match(li)){for(var Ae=M.slice(1,5),qe=0;qe<3;qe++)Ae[qe]=Fr(Ae[qe]*2.55);return Ae[3]=+Ae[3],Ae}if(M=I.match(ci)){var Ye=M.slice(1,4);Ye[1]*=.01,Ye[2]*=.01;var xt=Zt(Ye);return xt[3]=1,xt}if(M=I.match(Ze)){var it=M.slice(1,4);it[1]*=.01,it[2]*=.01;var At=Zt(it);return At[3]=+M[4],At}};br.test=function(I){return lr.test(I)||Kr.test(I)||Wt.test(I)||li.test(I)||ci.test(I)||Ze.test(I)};var Li=br,si=re,Je=ze,Nt=ht,Vt=ke.type,ui=Ee,Vi=Li;Je.prototype.css=function(I){return ui(this._rgb,I)},si.css=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(Je,[null].concat(I,["css"])))},Nt.format.css=Vi,Nt.autodetect.push({p:5,test:function(I){for(var M=[],O=arguments.length-1;O-- >0;)M[O]=arguments[O+1];if(!M.length&&Vt(I)==="string"&&Vi.test(I))return"css"}});var Kt=ze,as=re,os=ht,Ii=ke.unpack;os.format.gl=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=Ii(I,"rgba");return O[0]*=255,O[1]*=255,O[2]*=255,O},as.gl=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(Kt,[null].concat(I,["gl"])))},Kt.prototype.gl=function(){var I=this._rgb;return[I[0]/255,I[1]/255,I[2]/255,I[3]]};var K=ke.unpack,R=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=K(I,"rgb"),X=O[0],de=O[1],ve=O[2],ce=Math.min(X,de,ve),we=Math.max(X,de,ve),Ae=we-ce,qe=Ae*100/255,Ye=ce/(255-Ae)*100,xt;return Ae===0?xt=Number.NaN:(X===we&&(xt=(de-ve)/Ae),de===we&&(xt=2+(ve-X)/Ae),ve===we&&(xt=4+(X-de)/Ae),xt*=60,xt<0&&(xt+=360)),[xt,qe,Ye]},B=R,j=ke.unpack,J=Math.floor,he=function(){for(var I,M,O,X,de,ve,ce=[],we=arguments.length;we--;)ce[we]=arguments[we];ce=j(ce,"hcg");var Ae=ce[0],qe=ce[1],Ye=ce[2],xt,it,At;Ye=Ye*255;var Mt=qe*255;if(qe===0)xt=it=At=Ye;else{Ae===360&&(Ae=0),Ae>360&&(Ae-=360),Ae<0&&(Ae+=360),Ae/=60;var vr=J(Ae),xr=Ae-vr,Mr=Ye*(1-qe),Dr=Mr+Mt*(1-xr),tn=Mr+Mt*xr,Ei=Mr+Mt;switch(vr){case 0:I=[Ei,tn,Mr],xt=I[0],it=I[1],At=I[2];break;case 1:M=[Dr,Ei,Mr],xt=M[0],it=M[1],At=M[2];break;case 2:O=[Mr,Ei,tn],xt=O[0],it=O[1],At=O[2];break;case 3:X=[Mr,Dr,Ei],xt=X[0],it=X[1],At=X[2];break;case 4:de=[tn,Mr,Ei],xt=de[0],it=de[1],At=de[2];break;case 5:ve=[Ei,Mr,Dr],xt=ve[0],it=ve[1],At=ve[2];break}}return[xt,it,At,ce.length>3?ce[3]:1]},ye=he,be=ke.unpack,le=ke.type,Ie=re,je=ze,Fe=ht,Le=B;je.prototype.hcg=function(){return Le(this._rgb)},Ie.hcg=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(je,[null].concat(I,["hcg"])))},Fe.format.hcg=ye,Fe.autodetect.push({p:1,test:function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];if(I=be(I,"hcg"),le(I)==="array"&&I.length===3)return"hcg"}});var Lt=ke.unpack,zt=ke.last,nr=Math.round,qt=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=Lt(I,"rgba"),X=O[0],de=O[1],ve=O[2],ce=O[3],we=zt(I)||"auto";ce===void 0&&(ce=1),we==="auto"&&(we=ce<1?"rgba":"rgb"),X=nr(X),de=nr(de),ve=nr(ve);var Ae=X<<16|de<<8|ve,qe="000000"+Ae.toString(16);qe=qe.substr(qe.length-6);var Ye="0"+nr(ce*255).toString(16);switch(Ye=Ye.substr(Ye.length-2),we.toLowerCase()){case"rgba":return"#"+qe+Ye;case"argb":return"#"+Ye+qe;default:return"#"+qe}},yr=qt,Nr=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,Gr=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,pi=function(I){if(I.match(Nr)){(I.length===4||I.length===7)&&(I=I.substr(1)),I.length===3&&(I=I.split(""),I=I[0]+I[0]+I[1]+I[1]+I[2]+I[2]);var M=parseInt(I,16),O=M>>16,X=M>>8&255,de=M&255;return[O,X,de,1]}if(I.match(Gr)){(I.length===5||I.length===9)&&(I=I.substr(1)),I.length===4&&(I=I.split(""),I=I[0]+I[0]+I[1]+I[1]+I[2]+I[2]+I[3]+I[3]);var ve=parseInt(I,16),ce=ve>>24&255,we=ve>>16&255,Ae=ve>>8&255,qe=Math.round((ve&255)/255*100)/100;return[ce,we,Ae,qe]}throw new Error("unknown hex color: "+I)},Xt=pi,ri=re,fi=ze,an=ke.type,on=ht,xi=yr;fi.prototype.hex=function(I){return xi(this._rgb,I)},ri.hex=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(fi,[null].concat(I,["hex"])))},on.format.hex=Xt,on.autodetect.push({p:4,test:function(I){for(var M=[],O=arguments.length-1;O-- >0;)M[O]=arguments[O+1];if(!M.length&&an(I)==="string"&&[3,4,5,6,7,8,9].indexOf(I.length)>=0)return"hex"}});var ba=ke.unpack,ru=ke.TWOPI,Br=Math.min,tc=Math.sqrt,rc=Math.acos,gn=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=ba(I,"rgb"),X=O[0],de=O[1],ve=O[2];X/=255,de/=255,ve/=255;var ce,we=Br(X,de,ve),Ae=(X+de+ve)/3,qe=Ae>0?1-we/Ae:0;return qe===0?ce=NaN:(ce=(X-de+(X-ve))/2,ce/=tc((X-de)*(X-de)+(X-ve)*(de-ve)),ce=rc(ce),ve>de&&(ce=ru-ce),ce/=ru),[ce*360,qe,Ae]},ln=gn,eo=ke.unpack,Ui=ke.limit,Ri=ke.TWOPI,$o=ke.PITHIRD,cn=Math.cos,mi=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];I=eo(I,"hsi");var O=I[0],X=I[1],de=I[2],ve,ce,we;return isNaN(O)&&(O=0),isNaN(X)&&(X=0),O>360&&(O-=360),O<0&&(O+=360),O/=360,O<1/3?(we=(1-X)/3,ve=(1+X*cn(Ri*O)/cn($o-Ri*O))/3,ce=1-(we+ve)):O<2/3?(O-=1/3,ve=(1-X)/3,ce=(1+X*cn(Ri*O)/cn($o-Ri*O))/3,we=1-(ve+ce)):(O-=2/3,ce=(1-X)/3,we=(1+X*cn(Ri*O)/cn($o-Ri*O))/3,ve=1-(ce+we)),ve=Ui(de*ve*3),ce=Ui(de*ce*3),we=Ui(de*we*3),[ve*255,ce*255,we*255,I.length>3?I[3]:1]},to=mi,Ws=ke.unpack,ai=ke.type,Ks=re,An=ze,ro=ht,Kn=ln;An.prototype.hsi=function(){return Kn(this._rgb)},Ks.hsi=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(An,[null].concat(I,["hsi"])))},ro.format.hsi=to,ro.autodetect.push({p:2,test:function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];if(I=Ws(I,"hsi"),ai(I)==="array"&&I.length===3)return"hsi"}});var ic=ke.unpack,wa=ke.type,Er=re,io=ze,Xs=ht,nc=Bt;io.prototype.hsl=function(){return nc(this._rgb)},Er.hsl=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(io,[null].concat(I,["hsl"])))},Xs.format.hsl=Et,Xs.autodetect.push({p:2,test:function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];if(I=ic(I,"hsl"),wa(I)==="array"&&I.length===3)return"hsl"}});var jo=ke.unpack,no=Math.min,sc=Math.max,Vo=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];I=jo(I,"rgb");var O=I[0],X=I[1],de=I[2],ve=no(O,X,de),ce=sc(O,X,de),we=ce-ve,Ae,qe,Ye;return Ye=ce/255,ce===0?(Ae=Number.NaN,qe=0):(qe=we/ce,O===ce&&(Ae=(X-de)/we),X===ce&&(Ae=2+(de-O)/we),de===ce&&(Ae=4+(O-X)/we),Ae*=60,Ae<0&&(Ae+=360)),[Ae,qe,Ye]},so=Vo,Uo=ke.unpack,ao=Math.floor,vh=function(){for(var I,M,O,X,de,ve,ce=[],we=arguments.length;we--;)ce[we]=arguments[we];ce=Uo(ce,"hsv");var Ae=ce[0],qe=ce[1],Ye=ce[2],xt,it,At;if(Ye*=255,qe===0)xt=it=At=Ye;else{Ae===360&&(Ae=0),Ae>360&&(Ae-=360),Ae<0&&(Ae+=360),Ae/=60;var Mt=ao(Ae),vr=Ae-Mt,xr=Ye*(1-qe),Mr=Ye*(1-qe*vr),Dr=Ye*(1-qe*(1-vr));switch(Mt){case 0:I=[Ye,Dr,xr],xt=I[0],it=I[1],At=I[2];break;case 1:M=[Mr,Ye,xr],xt=M[0],it=M[1],At=M[2];break;case 2:O=[xr,Ye,Dr],xt=O[0],it=O[1],At=O[2];break;case 3:X=[xr,Mr,Ye],xt=X[0],it=X[1],At=X[2];break;case 4:de=[Dr,xr,Ye],xt=de[0],it=de[1],At=de[2];break;case 5:ve=[Ye,xr,Mr],xt=ve[0],it=ve[1],At=ve[2];break}}return[xt,it,At,ce.length>3?ce[3]:1]},xh=vh,ac=ke.unpack,iu=ke.type,Ys=re,oo=ze,qi=ht,yn=so;oo.prototype.hsv=function(){return yn(this._rgb)},Ys.hsv=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(oo,[null].concat(I,["hsv"])))},qi.format.hsv=xh,qi.autodetect.push({p:2,test:function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];if(I=ac(I,"hsv"),iu(I)==="array"&&I.length===3)return"hsv"}});var Sa={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},ls=Sa,oc=ke.unpack,qo=Math.pow,ka=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=oc(I,"rgb"),X=O[0],de=O[1],ve=O[2],ce=nu(X,de,ve),we=ce[0],Ae=ce[1],qe=ce[2],Ye=116*Ae-16;return[Ye<0?0:Ye,500*(we-Ae),200*(Ae-qe)]},lc=function(I){return(I/=255)<=.04045?I/12.92:qo((I+.055)/1.055,2.4)},Go=function(I){return I>ls.t3?qo(I,1/3):I/ls.t2+ls.t0},nu=function(I,M,O){I=lc(I),M=lc(M),O=lc(O);var X=Go((.4124564*I+.3575761*M+.1804375*O)/ls.Xn),de=Go((.2126729*I+.7151522*M+.072175*O)/ls.Yn),ve=Go((.0193339*I+.119192*M+.9503041*O)/ls.Zn);return[X,de,ve]},su=ka,Ca=Sa,bh=ke.unpack,Zo=Math.pow,cc=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];I=bh(I,"lab");var O=I[0],X=I[1],de=I[2],ve,ce,we,Ae,qe,Ye;return ce=(O+16)/116,ve=isNaN(X)?ce:ce+X/500,we=isNaN(de)?ce:ce-de/200,ce=Ca.Yn*lo(ce),ve=Ca.Xn*lo(ve),we=Ca.Zn*lo(we),Ae=Ta(3.2404542*ve-1.5371385*ce-.4985314*we),qe=Ta(-.969266*ve+1.8760108*ce+.041556*we),Ye=Ta(.0556434*ve-.2040259*ce+1.0572252*we),[Ae,qe,Ye,I.length>3?I[3]:1]},Ta=function(I){return 255*(I<=.00304?12.92*I:1.055*Zo(I,1/2.4)-.055)},lo=function(I){return I>Ca.t1?I*I*I:Ca.t2*(I-Ca.t0)},Ia=cc,_n=ke.unpack,Pr=ke.type,uc=re,Ea=ze,Pa=ht,wh=su;Ea.prototype.lab=function(){return wh(this._rgb)},uc.lab=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(Ea,[null].concat(I,["lab"])))},Pa.format.lab=Ia,Pa.autodetect.push({p:2,test:function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];if(I=_n(I,"lab"),Pr(I)==="array"&&I.length===3)return"lab"}});var Ho=ke.unpack,Sh=ke.RAD2DEG,Aa=Math.sqrt,kh=Math.atan2,au=Math.round,Ch=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=Ho(I,"lab"),X=O[0],de=O[1],ve=O[2],ce=Aa(de*de+ve*ve),we=(kh(ve,de)*Sh+360)%360;return au(ce*1e4)===0&&(we=Number.NaN),[X,ce,we]},hc=Ch,dc=ke.unpack,ou=su,lu=hc,cu=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=dc(I,"rgb"),X=O[0],de=O[1],ve=O[2],ce=ou(X,de,ve),we=ce[0],Ae=ce[1],qe=ce[2];return lu(we,Ae,qe)},uu=cu,Js=ke.unpack,hu=ke.DEG2RAD,Th=Math.sin,Ih=Math.cos,du=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=Js(I,"lch"),X=O[0],de=O[1],ve=O[2];return isNaN(ve)&&(ve=0),ve=ve*hu,[X,Ih(ve)*de,Th(ve)*de]},Ma=du,Eh=ke.unpack,Wo=Ma,Ph=Ia,Ah=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];I=Eh(I,"lch");var O=I[0],X=I[1],de=I[2],ve=Wo(O,X,de),ce=ve[0],we=ve[1],Ae=ve[2],qe=Ph(ce,we,Ae),Ye=qe[0],xt=qe[1],it=qe[2];return[Ye,xt,it,I.length>3?I[3]:1]},pc=Ah,pu=ke.unpack,fu=pc,fc=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=pu(I,"hcl").reverse();return fu.apply(void 0,O)},mu=fc,za=ke.unpack,cs=ke.type,Ko=re,Da=ze,co=ht,ii=uu;Da.prototype.lch=function(){return ii(this._rgb)},Da.prototype.hcl=function(){return ii(this._rgb).reverse()},Ko.lch=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(Da,[null].concat(I,["lch"])))},Ko.hcl=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(Da,[null].concat(I,["hcl"])))},co.format.lch=pc,co.format.hcl=mu,["lch","hcl"].forEach(function(I){return co.autodetect.push({p:2,test:function(){for(var M=[],O=arguments.length;O--;)M[O]=arguments[O];if(M=za(M,I),cs(M)==="array"&&M.length===3)return I}})});var mc={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ir=mc,uo=ze,Xr=ht,Yr=ke.type,Es=ir,gu=Xt,gc=yr;uo.prototype.name=function(){for(var I=gc(this._rgb,"rgb"),M=0,O=Object.keys(Es);M<O.length;M+=1){var X=O[M];if(Es[X]===I)return X.toLowerCase()}return I},Xr.format.named=function(I){if(I=I.toLowerCase(),Es[I])return gu(Es[I]);throw new Error("unknown color name: "+I)},Xr.autodetect.push({p:5,test:function(I){for(var M=[],O=arguments.length-1;O-- >0;)M[O]=arguments[O+1];if(!M.length&&Yr(I)==="string"&&Es[I.toLowerCase()])return"named"}});var Mh=ke.unpack,yu=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=Mh(I,"rgb"),X=O[0],de=O[1],ve=O[2];return(X<<16)+(de<<8)+ve},Xo=yu,Yo=ke.type,ho=function(I){if(Yo(I)=="number"&&I>=0&&I<=16777215){var M=I>>16,O=I>>8&255,X=I&255;return[M,O,X,1]}throw new Error("unknown num color: "+I)},Jo=ho,Ps=re,As=ze,Ji=ht,_u=ke.type,vu=Xo;As.prototype.num=function(){return vu(this._rgb)},Ps.num=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(As,[null].concat(I,["num"])))},Ji.format.num=Jo,Ji.autodetect.push({p:5,test:function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];if(I.length===1&&_u(I[0])==="number"&&I[0]>=0&&I[0]<=16777215)return"num"}});var yc=re,us=ze,po=ht,fo=ke.unpack,La=ke.type,mo=Math.round;us.prototype.rgb=function(I){return I===void 0&&(I=!0),I===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(mo)},us.prototype.rgba=function(I){return I===void 0&&(I=!0),this._rgb.slice(0,4).map(function(M,O){return O<3?I===!1?M:mo(M):M})},yc.rgb=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(us,[null].concat(I,["rgb"])))},po.format.rgb=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=fo(I,"rgba");return O[3]===void 0&&(O[3]=1),O},po.autodetect.push({p:3,test:function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];if(I=fo(I,"rgba"),La(I)==="array"&&(I.length===3||I.length===4&&La(I[3])=="number"&&I[3]>=0&&I[3]<=1))return"rgb"}});var Ra=Math.log,Qs=function(I){var M=I/100,O,X,de;return M<66?(O=255,X=M<6?0:-155.25485562709179-.44596950469579133*(X=M-2)+104.49216199393888*Ra(X),de=M<20?0:-254.76935184120902+.8274096064007395*(de=M-10)+115.67994401066147*Ra(de)):(O=351.97690566805693+.114206453784165*(O=M-55)-40.25366309332127*Ra(O),X=325.4494125711974+.07943456536662342*(X=M-50)-28.0852963507957*Ra(X),de=255),[O,X,de,1]},Xn=Qs,xu=Xn,Qo=ke.unpack,kr=Math.round,Fa=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];for(var O=Qo(I,"rgb"),X=O[0],de=O[2],ve=1e3,ce=4e4,we=.4,Ae;ce-ve>we;){Ae=(ce+ve)*.5;var qe=xu(Ae);qe[2]/qe[0]>=de/X?ce=Ae:ve=Ae}return kr(Ae)},el=Fa,ea=re,hs=ze,go=ht,bu=el;hs.prototype.temp=hs.prototype.kelvin=hs.prototype.temperature=function(){return bu(this._rgb)},ea.temp=ea.kelvin=ea.temperature=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(hs,[null].concat(I,["temp"])))},go.format.temp=go.format.kelvin=go.format.temperature=Xn;var _c=ke.unpack,Ba=Math.cbrt,vc=Math.pow,tl=Math.sign,rl=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=_c(I,"rgb"),X=O[0],de=O[1],ve=O[2],ce=[yo(X/255),yo(de/255),yo(ve/255)],we=ce[0],Ae=ce[1],qe=ce[2],Ye=Ba(.4122214708*we+.5363325363*Ae+.0514459929*qe),xt=Ba(.2119034982*we+.6806995451*Ae+.1073969566*qe),it=Ba(.0883024619*we+.2817188376*Ae+.6299787005*qe);return[.2104542553*Ye+.793617785*xt-.0040720468*it,1.9779984951*Ye-2.428592205*xt+.4505937099*it,.0259040371*Ye+.7827717662*xt-.808675766*it]},il=rl;function yo(I){var M=Math.abs(I);return M<.04045?I/12.92:(tl(I)||1)*vc((M+.055)/1.055,2.4)}var _o=ke.unpack,Yn=Math.pow,Gi=Math.sign,ta=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];I=_o(I,"lab");var O=I[0],X=I[1],de=I[2],ve=Yn(O+.3963377774*X+.2158037573*de,3),ce=Yn(O-.1055613458*X-.0638541728*de,3),we=Yn(O-.0894841775*X-1.291485548*de,3);return[255*vo(4.0767416621*ve-3.3077115913*ce+.2309699292*we),255*vo(-1.2684380046*ve+2.6097574011*ce-.3413193965*we),255*vo(-.0041960863*ve-.7034186147*ce+1.707614701*we),I.length>3?I[3]:1]},xc=ta;function vo(I){var M=Math.abs(I);return M>.0031308?(Gi(I)||1)*(1.055*Yn(M,1/2.4)-.055):I*12.92}var zh=ke.unpack,Na=ke.type,xo=re,Oa=ze,bc=ht,nl=il;Oa.prototype.oklab=function(){return nl(this._rgb)},xo.oklab=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(Oa,[null].concat(I,["oklab"])))},bc.format.oklab=xc,bc.autodetect.push({p:3,test:function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];if(I=zh(I,"oklab"),Na(I)==="array"&&I.length===3)return"oklab"}});var sl=ke.unpack,ra=il,Dh=hc,al=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];var O=sl(I,"rgb"),X=O[0],de=O[1],ve=O[2],ce=ra(X,de,ve),we=ce[0],Ae=ce[1],qe=ce[2];return Dh(we,Ae,qe)},ni=al,ds=ke.unpack,vn=Ma,ol=xc,wc=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];I=ds(I,"lch");var O=I[0],X=I[1],de=I[2],ve=vn(O,X,de),ce=ve[0],we=ve[1],Ae=ve[2],qe=ol(ce,we,Ae),Ye=qe[0],xt=qe[1],it=qe[2];return[Ye,xt,it,I.length>3?I[3]:1]},ll=wc,ps=ke.unpack,$a=ke.type,cl=re,ul=ze,hl=ht,dl=ni;ul.prototype.oklch=function(){return dl(this._rgb)},cl.oklch=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];return new(Function.prototype.bind.apply(ul,[null].concat(I,["oklch"])))},hl.format.oklch=ll,hl.autodetect.push({p:3,test:function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];if(I=ps(I,"oklch"),$a(I)==="array"&&I.length===3)return"oklch"}});var pl=ze,wu=ke.type;pl.prototype.alpha=function(I,M){return M===void 0&&(M=!1),I!==void 0&&wu(I)==="number"?M?(this._rgb[3]=I,this):new pl([this._rgb[0],this._rgb[1],this._rgb[2],I],"rgb"):this._rgb[3]};var Ms=ze;Ms.prototype.clipped=function(){return this._rgb._clipped||!1};var zs=ze,Sc=Sa;zs.prototype.darken=function(I){I===void 0&&(I=1);var M=this,O=M.lab();return O[0]-=Sc.Kn*I,new zs(O,"lab").alpha(M.alpha(),!0)},zs.prototype.brighten=function(I){return I===void 0&&(I=1),this.darken(-I)},zs.prototype.darker=zs.prototype.darken,zs.prototype.brighter=zs.prototype.brighten;var kc=ze;kc.prototype.get=function(I){var M=I.split("."),O=M[0],X=M[1],de=this[O]();if(X){var ve=O.indexOf(X)-(O.substr(0,2)==="ok"?2:0);if(ve>-1)return de[ve];throw new Error("unknown channel "+X+" in mode "+O)}else return de};var Ds=ze,Su=ke.type,ku=Math.pow,Cc=1e-7,ja=20;Ds.prototype.luminance=function(I){if(I!==void 0&&Su(I)==="number"){if(I===0)return new Ds([0,0,0,this._rgb[3]],"rgb");if(I===1)return new Ds([255,255,255,this._rgb[3]],"rgb");var M=this.luminance(),O="rgb",X=ja,de=function(ce,we){var Ae=ce.interpolate(we,.5,O),qe=Ae.luminance();return Math.abs(I-qe)<Cc||!X--?Ae:qe>I?de(ce,Ae):de(Ae,we)},ve=(M>I?de(new Ds([0,0,0]),this):de(this,new Ds([255,255,255]))).rgb();return new Ds(ve.concat([this._rgb[3]]))}return Tc.apply(void 0,this._rgb.slice(0,3))};var Tc=function(I,M,O){return I=un(I),M=un(M),O=un(O),.2126*I+.7152*M+.0722*O},un=function(I){return I/=255,I<=.03928?I/12.92:ku((I+.055)/1.055,2.4)},Jr={},Ic=ze,xn=ke.type,Ls=Jr,Cu=function(I,M,O){O===void 0&&(O=.5);for(var X=[],de=arguments.length-3;de-- >0;)X[de]=arguments[de+3];var ve=X[0]||"lrgb";if(!Ls[ve]&&!X.length&&(ve=Object.keys(Ls)[0]),!Ls[ve])throw new Error("interpolation mode "+ve+" is not defined");return xn(I)!=="object"&&(I=new Ic(I)),xn(M)!=="object"&&(M=new Ic(M)),Ls[ve](I,M,O).alpha(I.alpha()+O*(M.alpha()-I.alpha()))},Ec=ze,Tu=Cu;Ec.prototype.mix=Ec.prototype.interpolate=function(I,M){M===void 0&&(M=.5);for(var O=[],X=arguments.length-2;X-- >0;)O[X]=arguments[X+2];return Tu.apply(void 0,[this,I,M].concat(O))};var fl=ze;fl.prototype.premultiply=function(I){I===void 0&&(I=!1);var M=this._rgb,O=M[3];return I?(this._rgb=[M[0]*O,M[1]*O,M[2]*O,O],this):new fl([M[0]*O,M[1]*O,M[2]*O,O],"rgb")};var ia=ze,Rs=Sa;ia.prototype.saturate=function(I){I===void 0&&(I=1);var M=this,O=M.lch();return O[1]+=Rs.Kn*I,O[1]<0&&(O[1]=0),new ia(O,"lch").alpha(M.alpha(),!0)},ia.prototype.desaturate=function(I){return I===void 0&&(I=1),this.saturate(-I)};var bt=ze,Pc=ke.type;bt.prototype.set=function(I,M,O){O===void 0&&(O=!1);var X=I.split("."),de=X[0],ve=X[1],ce=this[de]();if(ve){var we=de.indexOf(ve)-(de.substr(0,2)==="ok"?2:0);if(we>-1){if(Pc(M)=="string")switch(M.charAt(0)){case"+":ce[we]+=+M;break;case"-":ce[we]+=+M;break;case"*":ce[we]*=+M.substr(1);break;case"/":ce[we]/=+M.substr(1);break;default:ce[we]=+M}else if(Pc(M)==="number")ce[we]=M;else throw new Error("unsupported value for Color.set");var Ae=new bt(ce,de);return O?(this._rgb=Ae._rgb,this):Ae}throw new Error("unknown channel "+ve+" in mode "+de)}else return ce};var bo=ze,Jn=function(I,M,O){var X=I._rgb,de=M._rgb;return new bo(X[0]+O*(de[0]-X[0]),X[1]+O*(de[1]-X[1]),X[2]+O*(de[2]-X[2]),"rgb")};Jr.rgb=Jn;var Iu=ze,ft=Math.sqrt,Fs=Math.pow,Lh=function(I,M,O){var X=I._rgb,de=X[0],ve=X[1],ce=X[2],we=M._rgb,Ae=we[0],qe=we[1],Ye=we[2];return new Iu(ft(Fs(de,2)*(1-O)+Fs(Ae,2)*O),ft(Fs(ve,2)*(1-O)+Fs(qe,2)*O),ft(Fs(ce,2)*(1-O)+Fs(Ye,2)*O),"rgb")};Jr.lrgb=Lh;var Eu=ze,Ac=function(I,M,O){var X=I.lab(),de=M.lab();return new Eu(X[0]+O*(de[0]-X[0]),X[1]+O*(de[1]-X[1]),X[2]+O*(de[2]-X[2]),"lab")};Jr.lab=Ac;var Mc=ze,bn=function(I,M,O,X){var de,ve,ce,we;X==="hsl"?(ce=I.hsl(),we=M.hsl()):X==="hsv"?(ce=I.hsv(),we=M.hsv()):X==="hcg"?(ce=I.hcg(),we=M.hcg()):X==="hsi"?(ce=I.hsi(),we=M.hsi()):X==="lch"||X==="hcl"?(X="hcl",ce=I.hcl(),we=M.hcl()):X==="oklch"&&(ce=I.oklch().reverse(),we=M.oklch().reverse());var Ae,qe,Ye,xt,it,At;(X.substr(0,1)==="h"||X==="oklch")&&(de=ce,Ae=de[0],Ye=de[1],it=de[2],ve=we,qe=ve[0],xt=ve[1],At=ve[2]);var Mt,vr,xr,Mr;return!isNaN(Ae)&&!isNaN(qe)?(qe>Ae&&qe-Ae>180?Mr=qe-(Ae+360):qe<Ae&&Ae-qe>180?Mr=qe+360-Ae:Mr=qe-Ae,vr=Ae+O*Mr):isNaN(Ae)?isNaN(qe)?vr=Number.NaN:(vr=qe,(it==1||it==0)&&X!="hsv"&&(Mt=xt)):(vr=Ae,(At==1||At==0)&&X!="hsv"&&(Mt=Ye)),Mt===void 0&&(Mt=Ye+O*(xt-Ye)),xr=it+O*(At-it),X==="oklch"?new Mc([xr,Mt,vr],X):new Mc([vr,Mt,xr],X)},Pu=bn,ml=function(I,M,O){return Pu(I,M,O,"lch")};Jr.lch=ml,Jr.hcl=ml;var Bs=ze,jr=function(I,M,O){var X=I.num(),de=M.num();return new Bs(X+O*(de-X),"num")};Jr.num=jr;var gl=bn,Va=function(I,M,O){return gl(I,M,O,"hcg")};Jr.hcg=Va;var Ua=bn,Au=function(I,M,O){return Ua(I,M,O,"hsi")};Jr.hsi=Au;var zc=bn,wo=function(I,M,O){return zc(I,M,O,"hsl")};Jr.hsl=wo;var Qn=bn,yl=function(I,M,O){return Qn(I,M,O,"hsv")};Jr.hsv=yl;var Pt=ze,jt=function(I,M,O){var X=I.oklab(),de=M.oklab();return new Pt(X[0]+O*(de[0]-X[0]),X[1]+O*(de[1]-X[1]),X[2]+O*(de[2]-X[2]),"oklab")};Jr.oklab=jt;var p=bn,t=function(I,M,O){return p(I,M,O,"oklch")};Jr.oklch=t;var a=ze,l=ke.clip_rgb,h=Math.pow,m=Math.sqrt,v=Math.PI,w=Math.cos,k=Math.sin,E=Math.atan2,D=function(I,M,O){M===void 0&&(M="lrgb"),O===void 0&&(O=null);var X=I.length;O||(O=Array.from(new Array(X)).map(function(){return 1}));var de=X/O.reduce(function(vr,xr){return vr+xr});if(O.forEach(function(vr,xr){O[xr]*=de}),I=I.map(function(vr){return new a(vr)}),M==="lrgb")return z(I,O);for(var ve=I.shift(),ce=ve.get(M),we=[],Ae=0,qe=0,Ye=0;Ye<ce.length;Ye++)if(ce[Ye]=(ce[Ye]||0)*O[0],we.push(isNaN(ce[Ye])?0:O[0]),M.charAt(Ye)==="h"&&!isNaN(ce[Ye])){var xt=ce[Ye]/180*v;Ae+=w(xt)*O[0],qe+=k(xt)*O[0]}var it=ve.alpha()*O[0];I.forEach(function(vr,xr){var Mr=vr.get(M);it+=vr.alpha()*O[xr+1];for(var Dr=0;Dr<ce.length;Dr++)if(!isNaN(Mr[Dr]))if(we[Dr]+=O[xr+1],M.charAt(Dr)==="h"){var tn=Mr[Dr]/180*v;Ae+=w(tn)*O[xr+1],qe+=k(tn)*O[xr+1]}else ce[Dr]+=Mr[Dr]*O[xr+1]});for(var At=0;At<ce.length;At++)if(M.charAt(At)==="h"){for(var Mt=E(qe/we[At],Ae/we[At])/v*180;Mt<0;)Mt+=360;for(;Mt>=360;)Mt-=360;ce[At]=Mt}else ce[At]=ce[At]/we[At];return it/=X,new a(ce,M).alpha(it>.99999?1:it,!0)},z=function(I,M){for(var O=I.length,X=[0,0,0,0],de=0;de<I.length;de++){var ve=I[de],ce=M[de]/O,we=ve._rgb;X[0]+=h(we[0],2)*ce,X[1]+=h(we[1],2)*ce,X[2]+=h(we[2],2)*ce,X[3]+=we[3]*ce}return X[0]=m(X[0]),X[1]=m(X[1]),X[2]=m(X[2]),X[3]>.9999999&&(X[3]=1),new a(l(X))},N=re,U=ke.type,Z=Math.pow,Q=function(I){var M="rgb",O=N("#ccc"),X=0,de=[0,1],ve=[],ce=[0,0],we=!1,Ae=[],qe=!1,Ye=0,xt=1,it=!1,At={},Mt=!0,vr=1,xr=function(rt){if(rt=rt||["#fff","#000"],rt&&U(rt)==="string"&&N.brewer&&N.brewer[rt.toLowerCase()]&&(rt=N.brewer[rt.toLowerCase()]),U(rt)==="array"){rt.length===1&&(rt=[rt[0],rt[0]]),rt=rt.slice(0);for(var Ht=0;Ht<rt.length;Ht++)rt[Ht]=N(rt[Ht]);ve.length=0;for(var cr=0;cr<rt.length;cr++)ve.push(cr/(rt.length-1))}return wn(),Ae=rt},Mr=function(rt){if(we!=null){for(var Ht=we.length-1,cr=0;cr<Ht&&rt>=we[cr];)cr++;return cr-1}return 0},Dr=function(rt){return rt},tn=function(rt){return rt},Ei=function(rt,Ht){var cr,ur;if(Ht==null&&(Ht=!1),isNaN(rt)||rt===null)return O;if(Ht)ur=rt;else if(we&&we.length>2){var Pi=Mr(rt);ur=Pi/(we.length-2)}else xt!==Ye?ur=(rt-Ye)/(xt-Ye):ur=1;ur=tn(ur),Ht||(ur=Dr(ur)),vr!==1&&(ur=Z(ur,vr)),ur=ce[0]+ur*(1-ce[0]-ce[1]),ur=Math.min(1,Math.max(0,ur));var ei=Math.floor(ur*1e4);if(Mt&&At[ei])cr=At[ei];else{if(U(Ae)==="array")for(var Cr=0;Cr<ve.length;Cr++){var $r=ve[Cr];if(ur<=$r){cr=Ae[Cr];break}if(ur>=$r&&Cr===ve.length-1){cr=Ae[Cr];break}if(ur>$r&&ur<ve[Cr+1]){ur=(ur-$r)/(ve[Cr+1]-$r),cr=N.interpolate(Ae[Cr],Ae[Cr+1],ur,M);break}}else U(Ae)==="function"&&(cr=Ae(ur));Mt&&(At[ei]=cr)}return cr},wn=function(){return At={}};xr(I);var wr=function(rt){var Ht=N(Ei(rt));return qe&&Ht[qe]?Ht[qe]():Ht};return wr.classes=function(rt){if(rt!=null){if(U(rt)==="array")we=rt,de=[rt[0],rt[rt.length-1]];else{var Ht=N.analyze(de);rt===0?we=[Ht.min,Ht.max]:we=N.limits(Ht,"e",rt)}return wr}return we},wr.domain=function(rt){if(!arguments.length)return de;Ye=rt[0],xt=rt[rt.length-1],ve=[];var Ht=Ae.length;if(rt.length===Ht&&Ye!==xt)for(var cr=0,ur=Array.from(rt);cr<ur.length;cr+=1){var Pi=ur[cr];ve.push((Pi-Ye)/(xt-Ye))}else{for(var ei=0;ei<Ht;ei++)ve.push(ei/(Ht-1));if(rt.length>2){var Cr=rt.map(function(sr,zr){return zr/(rt.length-1)}),$r=rt.map(function(sr){return(sr-Ye)/(xt-Ye)});$r.every(function(sr,zr){return Cr[zr]===sr})||(tn=function(sr){if(sr<=0||sr>=1)return sr;for(var zr=0;sr>=$r[zr+1];)zr++;var $n=(sr-$r[zr])/($r[zr+1]-$r[zr]),oa=Cr[zr]+$n*(Cr[zr+1]-Cr[zr]);return oa})}}return de=[Ye,xt],wr},wr.mode=function(rt){return arguments.length?(M=rt,wn(),wr):M},wr.range=function(rt,Ht){return xr(rt),wr},wr.out=function(rt){return qe=rt,wr},wr.spread=function(rt){return arguments.length?(X=rt,wr):X},wr.correctLightness=function(rt){return rt==null&&(rt=!0),it=rt,wn(),it?Dr=function(Ht){for(var cr=Ei(0,!0).lab()[0],ur=Ei(1,!0).lab()[0],Pi=cr>ur,ei=Ei(Ht,!0).lab()[0],Cr=cr+(ur-cr)*Ht,$r=ei-Cr,sr=0,zr=1,$n=20;Math.abs($r)>.01&&$n-- >0;)(function(){return Pi&&($r*=-1),$r<0?(sr=Ht,Ht+=(zr-Ht)*.5):(zr=Ht,Ht+=(sr-Ht)*.5),ei=Ei(Ht,!0).lab()[0],$r=ei-Cr})();return Ht}:Dr=function(Ht){return Ht},wr},wr.padding=function(rt){return rt!=null?(U(rt)==="number"&&(rt=[rt,rt]),ce=rt,wr):ce},wr.colors=function(rt,Ht){arguments.length<2&&(Ht="hex");var cr=[];if(arguments.length===0)cr=Ae.slice(0);else if(rt===1)cr=[wr(.5)];else if(rt>1){var ur=de[0],Pi=de[1]-ur;cr=H(0,rt).map(function(zr){return wr(ur+zr/(rt-1)*Pi)})}else{I=[];var ei=[];if(we&&we.length>2)for(var Cr=1,$r=we.length,sr=1<=$r;sr?Cr<$r:Cr>$r;sr?Cr++:Cr--)ei.push((we[Cr-1]+we[Cr])*.5);else ei=de;cr=ei.map(function(zr){return wr(zr)})}return N[Ht]&&(cr=cr.map(function(zr){return zr[Ht]()})),cr},wr.cache=function(rt){return rt!=null?(Mt=rt,wr):Mt},wr.gamma=function(rt){return rt!=null?(vr=rt,wr):vr},wr.nodata=function(rt){return rt!=null?(O=N(rt),wr):O},wr};function H(I,M,O){for(var X=[],de=I<M,ve=M,ce=I;de?ce<ve:ce>ve;de?ce++:ce--)X.push(ce);return X}var ae=ze,ge=Q,Y=function(I){for(var M=[1,1],O=1;O<I;O++){for(var X=[1],de=1;de<=M.length;de++)X[de]=(M[de]||0)+M[de-1];M=X}return M},_e=function(I){var M,O,X,de,ve,ce,we;if(I=I.map(function(it){return new ae(it)}),I.length===2)M=I.map(function(it){return it.lab()}),ve=M[0],ce=M[1],de=function(it){var At=[0,1,2].map(function(Mt){return ve[Mt]+it*(ce[Mt]-ve[Mt])});return new ae(At,"lab")};else if(I.length===3)O=I.map(function(it){return it.lab()}),ve=O[0],ce=O[1],we=O[2],de=function(it){var At=[0,1,2].map(function(Mt){return(1-it)*(1-it)*ve[Mt]+2*(1-it)*it*ce[Mt]+it*it*we[Mt]});return new ae(At,"lab")};else if(I.length===4){var Ae;X=I.map(function(it){return it.lab()}),ve=X[0],ce=X[1],we=X[2],Ae=X[3],de=function(it){var At=[0,1,2].map(function(Mt){return(1-it)*(1-it)*(1-it)*ve[Mt]+3*(1-it)*(1-it)*it*ce[Mt]+3*(1-it)*it*it*we[Mt]+it*it*it*Ae[Mt]});return new ae(At,"lab")}}else if(I.length>=5){var qe,Ye,xt;qe=I.map(function(it){return it.lab()}),xt=I.length-1,Ye=Y(xt),de=function(it){var At=1-it,Mt=[0,1,2].map(function(vr){return qe.reduce(function(xr,Mr,Dr){return xr+Ye[Dr]*Math.pow(At,xt-Dr)*Math.pow(it,Dr)*Mr[vr]},0)});return new ae(Mt,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return de},Ce=function(I){var M=_e(I);return M.scale=function(){return ge(M)},M},Pe=re,Re=function(I,M,O){if(!Re[O])throw new Error("unknown blend mode "+O);return Re[O](I,M)},We=function(I){return function(M,O){var X=Pe(O).rgb(),de=Pe(M).rgb();return Pe.rgb(I(X,de))}},lt=function(I){return function(M,O){var X=[];return X[0]=I(M[0],O[0]),X[1]=I(M[1],O[1]),X[2]=I(M[2],O[2]),X}},_t=function(I){return I},et=function(I,M){return I*M/255},st=function(I,M){return I>M?M:I},wt=function(I,M){return I>M?I:M},Gt=function(I,M){return 255*(1-(1-I/255)*(1-M/255))},ot=function(I,M){return M<128?2*I*M/255:255*(1-2*(1-I/255)*(1-M/255))},mt=function(I,M){return 255*(1-(1-M/255)/(I/255))},Ut=function(I,M){return I===255?255:(I=255*(M/255)/(1-I/255),I>255?255:I)};Re.normal=We(lt(_t)),Re.multiply=We(lt(et)),Re.screen=We(lt(Gt)),Re.overlay=We(lt(ot)),Re.darken=We(lt(st)),Re.lighten=We(lt(wt)),Re.dodge=We(lt(Ut)),Re.burn=We(lt(mt));for(var Zr=Re,Yt=ke.type,fr=ke.clip_rgb,Hr=ke.TWOPI,Zi=Math.pow,Nn=Math.sin,Wr=Math.cos,Qi=re,en=function(I,M,O,X,de){I===void 0&&(I=300),M===void 0&&(M=-1.5),O===void 0&&(O=1),X===void 0&&(X=1),de===void 0&&(de=[0,1]);var ve=0,ce;Yt(de)==="array"?ce=de[1]-de[0]:(ce=0,de=[de,de]);var we=function(Ae){var qe=Hr*((I+120)/360+M*Ae),Ye=Zi(de[0]+ce*Ae,X),xt=ve!==0?O[0]+Ae*ve:O,it=xt*Ye*(1-Ye)/2,At=Wr(qe),Mt=Nn(qe),vr=Ye+it*(-.14861*At+1.78277*Mt),xr=Ye+it*(-.29227*At-.90649*Mt),Mr=Ye+it*(1.97294*At);return Qi(fr([vr*255,xr*255,Mr*255,1]))};return we.start=function(Ae){return Ae==null?I:(I=Ae,we)},we.rotations=function(Ae){return Ae==null?M:(M=Ae,we)},we.gamma=function(Ae){return Ae==null?X:(X=Ae,we)},we.hue=function(Ae){return Ae==null?O:(O=Ae,Yt(O)==="array"?(ve=O[1]-O[0],ve===0&&(O=O[1])):ve=0,we)},we.lightness=function(Ae){return Ae==null?de:(Yt(Ae)==="array"?(de=Ae,ce=Ae[1]-Ae[0]):(de=[Ae,Ae],ce=0),we)},we.scale=function(){return Qi.scale(we)},we.hue(O),we},Hi=ze,Wi="0123456789abcdef",On=Math.floor,na=Math.random,_l=function(){for(var I="#",M=0;M<6;M++)I+=Wi.charAt(On(na()*16));return new Hi(I,"hex")},Ns=ee,Os=Math.log,vl=Math.pow,Dc=Math.floor,Fi=Math.abs,Mn=function(I,M){M===void 0&&(M=null);var O={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return Ns(I)==="object"&&(I=Object.values(I)),I.forEach(function(X){M&&Ns(X)==="object"&&(X=X[M]),X!=null&&!isNaN(X)&&(O.values.push(X),O.sum+=X,X<O.min&&(O.min=X),X>O.max&&(O.max=X),O.count+=1)}),O.domain=[O.min,O.max],O.limits=function(X,de){return fs(O,X,de)},O},fs=function(I,M,O){M===void 0&&(M="equal"),O===void 0&&(O=7),Ns(I)=="array"&&(I=Mn(I));var X=I.min,de=I.max,ve=I.values.sort(function(Bh,Nc){return Bh-Nc});if(O===1)return[X,de];var ce=[];if(M.substr(0,1)==="c"&&(ce.push(X),ce.push(de)),M.substr(0,1)==="e"){ce.push(X);for(var we=1;we<O;we++)ce.push(X+we/O*(de-X));ce.push(de)}else if(M.substr(0,1)==="l"){if(X<=0)throw new Error("Logarithmic scales are only possible for values > 0");var Ae=Math.LOG10E*Os(X),qe=Math.LOG10E*Os(de);ce.push(X);for(var Ye=1;Ye<O;Ye++)ce.push(vl(10,Ae+Ye/O*(qe-Ae)));ce.push(de)}else if(M.substr(0,1)==="q"){ce.push(X);for(var xt=1;xt<O;xt++){var it=(ve.length-1)*xt/O,At=Dc(it);if(At===it)ce.push(ve[At]);else{var Mt=it-At;ce.push(ve[At]*(1-Mt)+ve[At+1]*Mt)}}ce.push(de)}else if(M.substr(0,1)==="k"){var vr,xr=ve.length,Mr=new Array(xr),Dr=new Array(O),tn=!0,Ei=0,wn=null;wn=[],wn.push(X);for(var wr=1;wr<O;wr++)wn.push(X+wr/O*(de-X));for(wn.push(de);tn;){for(var rt=0;rt<O;rt++)Dr[rt]=0;for(var Ht=0;Ht<xr;Ht++)for(var cr=ve[Ht],ur=Number.MAX_VALUE,Pi=void 0,ei=0;ei<O;ei++){var Cr=Fi(wn[ei]-cr);Cr<ur&&(ur=Cr,Pi=ei),Dr[Pi]++,Mr[Ht]=Pi}for(var $r=new Array(O),sr=0;sr<O;sr++)$r[sr]=null;for(var zr=0;zr<xr;zr++)vr=Mr[zr],$r[vr]===null?$r[vr]=ve[zr]:$r[vr]+=ve[zr];for(var $n=0;$n<O;$n++)$r[$n]*=1/Dr[$n];tn=!1;for(var oa=0;oa<O;oa++)if($r[oa]!==wn[oa]){tn=!0;break}wn=$r,Ei++,Ei>200&&(tn=!1)}for(var es={},kl=0;kl<O;kl++)es[kl]=[];for(var la=0;la<xr;la++)vr=Mr[la],es[vr].push(ve[la]);for(var ca=[],Ga=0;Ga<O;Ga++)ca.push(es[Ga][0]),ca.push(es[Ga][es[Ga].length-1]);ca=ca.sort(function(Bh,Nc){return Bh-Nc}),ce.push(ca[0]);for(var Cl=1;Cl<ca.length;Cl+=2){var Za=ca[Cl];!isNaN(Za)&&ce.indexOf(Za)===-1&&ce.push(Za)}}return ce},sa={analyze:Mn,limits:fs},Bi=ze,Ki=function(I,M){I=new Bi(I),M=new Bi(M);var O=I.luminance(),X=M.luminance();return O>X?(O+.05)/(X+.05):(X+.05)/(O+.05)},bi=ze,Ar=Math.sqrt,Qr=Math.pow,Lc=Math.min,wi=Math.max,Rc=Math.atan2,So=Math.abs,aa=Math.cos,ms=Math.sin,Mu=Math.exp,xl=Math.PI,Fc=function(I,M,O,X,de){O===void 0&&(O=1),X===void 0&&(X=1),de===void 0&&(de=1);var ve=function(Za){return 360*Za/(2*xl)},ce=function(Za){return 2*xl*Za/360};I=new bi(I),M=new bi(M);var we=Array.from(I.lab()),Ae=we[0],qe=we[1],Ye=we[2],xt=Array.from(M.lab()),it=xt[0],At=xt[1],Mt=xt[2],vr=(Ae+it)/2,xr=Ar(Qr(qe,2)+Qr(Ye,2)),Mr=Ar(Qr(At,2)+Qr(Mt,2)),Dr=(xr+Mr)/2,tn=.5*(1-Ar(Qr(Dr,7)/(Qr(Dr,7)+Qr(25,7)))),Ei=qe*(1+tn),wn=At*(1+tn),wr=Ar(Qr(Ei,2)+Qr(Ye,2)),rt=Ar(Qr(wn,2)+Qr(Mt,2)),Ht=(wr+rt)/2,cr=ve(Rc(Ye,Ei)),ur=ve(Rc(Mt,wn)),Pi=cr>=0?cr:cr+360,ei=ur>=0?ur:ur+360,Cr=So(Pi-ei)>180?(Pi+ei+360)/2:(Pi+ei)/2,$r=1-.17*aa(ce(Cr-30))+.24*aa(ce(2*Cr))+.32*aa(ce(3*Cr+6))-.2*aa(ce(4*Cr-63)),sr=ei-Pi;sr=So(sr)<=180?sr:ei<=Pi?sr+360:sr-360,sr=2*Ar(wr*rt)*ms(ce(sr)/2);var zr=it-Ae,$n=rt-wr,oa=1+.015*Qr(vr-50,2)/Ar(20+Qr(vr-50,2)),es=1+.045*Ht,kl=1+.015*Ht*$r,la=30*Mu(-Qr((Cr-275)/25,2)),ca=2*Ar(Qr(Ht,7)/(Qr(Ht,7)+Qr(25,7))),Ga=-ca*ms(2*ce(la)),Cl=Ar(Qr(zr/(O*oa),2)+Qr($n/(X*es),2)+Qr(sr/(de*kl),2)+Ga*($n/(X*es))*(sr/(de*kl)));return wi(0,Lc(100,Cl))},bl=ze,wl=function(I,M,O){O===void 0&&(O="lab"),I=new bl(I),M=new bl(M);var X=I.get(O),de=M.get(O),ve=0;for(var ce in X){var we=(X[ce]||0)-(de[ce]||0);ve+=we*we}return Math.sqrt(ve)},qa=ze,Ud=function(){for(var I=[],M=arguments.length;M--;)I[M]=arguments[M];try{return new(Function.prototype.bind.apply(qa,[null].concat(I))),!0}catch{return!1}},zu=re,Bc=Q,ko={cool:function(){return Bc([zu.hsl(180,1,.9),zu.hsl(250,.7,.4)])},hot:function(){return Bc(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Co={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Du=0,Rh=Object.keys(Co);Du<Rh.length;Du+=1){var qd=Rh[Du];Co[qd.toLowerCase()]=Co[qd]}var Fh=Co,gi=re;gi.average=D,gi.bezier=Ce,gi.blend=Zr,gi.cubehelix=en,gi.mix=gi.interpolate=Cu,gi.random=_l,gi.scale=Q,gi.analyze=sa.analyze,gi.contrast=Ki,gi.deltaE=Fc,gi.distance=wl,gi.limits=sa.limits,gi.valid=Ud,gi.scales=ko,gi.colors=ir,gi.brewer=Fh;var Sl=gi;return Sl})})(Tk);const hf=[{id:"infrastructure",label:"Infrastructure",description:"Built infrastructure resilience to wildfire damage.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:171,g:16,b:78}},status:{id:"infrastructure_status",label:"Status",description:"Current infrastructure status.",metrics:[]},resilience:{id:"infrastructure_resilience",label:"Resilience",description:"Infrastructure capacity to resist and recover from wildfire.",resistance:{id:"infrastructure_resistance",label:"Resistance",description:"Structural resistance to wildfire damage.",metrics:[{id:"infrastructure_resistance_building_codes",label:"Building Codes",description:"Adoption of wildfire-resistant building codes."},{id:"infrastructure_resistance_wildland_urban_interface",label:"Wildland Urban Interface",description:"Exposure in the wildland-urban interface zone."},{id:"infrastructure_resistance_egress",label:"Road Access",description:"Evacuation route accessibility and egress capacity."},{id:"infrastructure_resistance_fire_resource_density",label:"Fire Fighting Access",description:"Fire resource density and response capability."},{id:"infrastructure_resistance_d_space",label:"Defensible Space",description:"Defensible space around structures."}]},recovery:{id:"infrastructure_recovery",label:"Recovery",description:"Capacity to recover infrastructure after wildfire.",metrics:[{id:"infrastructure_recovery_income",label:"Income",description:"Household income levels supporting recovery."},{id:"infrastructure_recovery_incorporation",label:"Incorporation",description:"Municipal incorporation status."},{id:"infrastructure_recovery_owners",label:"Home Ownership",description:"Home ownership rates."}]}}},{id:"communities",label:"Communities",description:"Community social resilience to wildfire impacts.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:225,g:107,b:93}},status:void 0,resilience:{id:"communities_resilience",label:"Resilience",description:"Community capacity to resist and recover from wildfire.",resistance:{id:"communities_resistance",label:"Resistance",description:"Community resistance to wildfire impacts.",metrics:[{id:"communities_resistance_cwpps",label:"Community Wildfire Protection Plans",description:"Presence of Community Wildfire Protection Plans."},{id:"communities_resistance_firewise_communities",label:"Firewise Communities",description:"Firewise USA community recognition."},{id:"communities_resistance_volunteer_fire_stations",label:"Volunteer Firefighters",description:"Volunteer fire station coverage."},{id:"communities_resistance_age_65_plus",label:"Age (65+)",description:"Population age 65 and older."},{id:"communities_resistance_disability",label:"Disability",description:"Population with disabilities."},{id:"communities_resistance_no_vehicle",label:"Car Access",description:"Households without vehicle access."},{id:"communities_resistance_egress",label:"Evacuation Routes",description:"Evacuation route accessibility."}]},recovery:{id:"communities_recovery",label:"Recovery",description:"Community capacity to recover after wildfire.",metrics:[{id:"communities_recovery_income",label:"Income",description:"Household income levels."},{id:"communities_recovery_incorporation",label:"Incorporation",description:"Municipal incorporation status."},{id:"communities_recovery_owners",label:"Home Ownership",description:"Home ownership rates."}]}}},{id:"livelihoods",label:"Livelihoods",description:"Economic livelihood resilience to wildfire impacts.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:249,g:178,b:103}},status:{id:"livelihoods_status",label:"Status",description:"Current economic status indicators.",metrics:[{id:"livelihoods_status_unemployment",label:"Unemployment",description:"Unemployment rate."},{id:"livelihoods_status_median_income",label:"Median Income",description:"Median household income."},{id:"livelihoods_status_housing_burden",label:"Housing Burden",description:"Housing cost burden as percentage of income."}]},resilience:{id:"livelihoods_resilience",label:"Resilience",description:"Economic capacity to resist and recover from wildfire.",resistance:{id:"livelihoods_resistance",label:"Resistance",description:"Economic resistance to wildfire impacts.",metrics:[{id:"livelihoods_resistance_job_vulnerability",label:"Vulnerable Jobs",description:"Jobs vulnerable to wildfire disruption."}]},recovery:{id:"livelihoods_recovery",label:"Recovery",description:"Economic recovery capacity.",metrics:[{id:"livelihoods_recovery_diversity_of_jobs",label:"Job Diversity",description:"Economic diversity of employment."}]}}},{id:"sense_of_place",label:"Sense of Place",description:"Cultural and iconic value resilience to wildfire.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:125,g:200,b:165}},subdomains:[{id:"iconic_places",label:"Iconic Places",description:"Nationally recognized iconic places resilience to wildfire.",status:{id:"sense_of_place_iconic_places_status_presence",label:"Status",description:"Presence and status of iconic places.",metrics:[{id:"sense_of_place_iconic_places_status_presence",label:"Places Presence",description:"Presence of nationally recognized iconic places."}]},resilience:{id:"sense_of_place_iconic_places_resilience",label:"Resilience",description:"Iconic places capacity to resist and recover from wildfire.",resistance:{id:"sense_of_place_iconic_places_resistance",label:"Resistance",description:"Resistance to wildfire impacts on iconic places.",metrics:[{id:"sense_of_place_iconic_places_resistance_wui",label:"WUI Exposure",description:"Iconic places exposure in WUI."},{id:"sense_of_place_iconic_places_resistance_egress",label:"Road Access",description:"Access routes to iconic places."},{id:"sense_of_place_iconic_places_resistance_fire_resource_density",label:"Fire Access",description:"Fire resource access to iconic places."},{id:"sense_of_place_iconic_places_resistance_structures",label:"Structures",description:"Structural vulnerability of iconic places."},{id:"sense_of_place_iconic_places_resistance_national_parks",label:"Nat'l Parks",description:"National park fire resistance."}]},recovery:{id:"sense_of_place_iconic_places_recovery",label:"Recovery",description:"Recovery capacity for iconic places.",metrics:[{id:"sense_of_place_iconic_places_recovery_degree_of_protection",label:"Protection",description:"Level of protection for iconic places."},{id:"sense_of_place_iconic_places_recovery_national_parks",label:"Nat'l Parks",description:"National park recovery capacity."}]}}},{id:"iconic_species",label:"Iconic Species",description:"Iconic species resilience to wildfire.",status:{id:"sense_of_place_iconic_species_status",label:"Status",description:"Conservation status of iconic species.",metrics:[{id:"sense_of_place_iconic_species_status",label:"Species Status",description:"Conservation status of iconic species."},{id:"sense_of_place_iconic_species_status_75_extinction_rescaled",label:"Extinction Risk",description:"Iconic species extinction risk assessment."}]},resilience:{id:"sense_of_place_iconic_species_resilience",label:"Resilience",description:"Iconic species capacity to resist and recover from wildfire.",resistance:{id:"sense_of_place_iconic_species_resistance",label:"Resistance",description:"Iconic species resistance to fire.",metrics:[{id:"sense_of_place_iconic_species_resistance",label:"Species",description:"Iconic species resistance to fire."},{id:"sense_of_place_iconic_species_traits_resistance",label:"Species Traits",description:"Iconic species fire resistance traits."}]},recovery:{id:"sense_of_place_iconic_species_recovery",label:"Recovery",description:"Iconic species recovery capacity.",metrics:[{id:"sense_of_place_iconic_species_recovery",label:"Species",description:"Iconic species recovery capacity."},{id:"sense_of_place_iconic_species_traits_recovery",label:"Species Traits",description:"Iconic species recovery traits."},{id:"sense_of_place_iconic_species_area_recovery",label:"Range Size",description:"Iconic species range recovery potential."}]}}}]},{id:"biodiversity",label:"Species",description:"Biodiversity and species resilience to wildfire.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:109,g:169,b:147}},status:{id:"biodiversity_status",label:"Status",description:"Current species conservation status.",metrics:[{id:"biodiversity_status",label:"Conservation Threat",description:"Species conservation threat level."}]},resilience:{id:"biodiversity_resilience",label:"Resilience",description:"Species capacity to resist and recover from wildfire.",resistance:{id:"biodiversity_resistance",label:"Resistance",description:"Species resistance to wildfire impacts.",metrics:[{id:"biodiversity_resistance_traits",label:"Resistance Traits",description:"Species traits conferring fire resistance."}]},recovery:{id:"biodiversity_recovery",label:"Recovery",description:"Species recovery capacity after wildfire.",metrics:[{id:"biodiversity_recovery_traits",label:"Recovery Traits",description:"Species traits supporting post-fire recovery."},{id:"biodiversity_recovery_range_area",label:"Range Size",description:"Species geographic range area."}]}}},{id:"natural_habitats",label:"Habitats",description:"Natural habitat resilience to wildfire.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:54,g:114,b:111}},status:{id:"natural_habitats_status",label:"Status",description:"Current habitat status.",metrics:[{id:"natural_habitats_status_percent_protected",label:"Protection Status",description:"Percentage of habitat under protection."},{id:"natural_habitats_status_extent_change_2005",label:"Development",description:"Habitat extent change since 2005."}]},resilience:{id:"natural_habitats_resilience",label:"Resilience",description:"Habitat capacity to resist and recover from wildfire.",resistance:{id:"natural_habitats_resistance",label:"Resistance",description:"Habitat resistance to wildfire impacts.",metrics:[{id:"natural_habitats_resistance_tree_traits",label:"Tree Traits",description:"Tree species traits conferring fire resistance."},{id:"natural_habitats_resistance_density",label:"Stand Density",description:"Forest stand density."},{id:"natural_habitats_resistance_NDVI",label:"NDVI Heterogeneity",description:"Normalized Difference Vegetation Index heterogeneity."},{id:"natural_habitats_resistance_npp",label:"Net Primary Production",description:"Net primary productivity."},{id:"natural_habitats_resistance_vpd",label:"Vapor Pressure Deficit",description:"Vapor pressure deficit indicating drought stress."}]},recovery:{id:"natural_habitats_recovery",label:"Recovery",description:"Habitat recovery capacity after wildfire.",metrics:[{id:"natural_habitats_recovery_tree_traits",label:"Tree Traits",description:"Tree species traits supporting recovery."},{id:"natural_habitats_recovery_diversity",label:"Stand Diversity",description:"Forest stand species diversity."},{id:"natural_habitats_recovery_ppt",label:"Precipitation",description:"Rainfall supporting post-fire recovery."}]}}},{id:"water",label:"Water",description:"Water resources resilience to wildfire impacts.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:65,g:110,b:146}},status:{id:"water_status",label:"Status",description:"Current water resource status.",metrics:[{id:"water_status_surface_water_quantity",label:"Water Quantity",description:"Surface water quantity availability."},{id:"water_status_surface_water_timing",label:"Water Timing",description:"Timing of surface water availability."}]},resilience:{id:"water_resilience",label:"Resilience",description:"Capacity to maintain water resources during and after wildfires.",resistance:{id:"water_resistance",label:"Resistance",description:"Ability to resist water quality and quantity impacts.",metrics:[{id:"water_resistance_water_treatment",label:"Water Treatment Compliance",description:"Water treatment plant compliance rates."},{id:"water_resistance_drought_plans",label:"Drought Plans",description:"State and local drought planning coverage."}]},recovery:void 0}},{id:"air_quality",label:"Air Quality",description:"Air quality resilience measures the ability to maintain healthy air during wildfire events.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:70,g:69,b:85}},status:{id:"air_quality_status",label:"Status",description:"Current air quality status indicators.",metrics:[{id:"air_quality_status_aqi_100",label:"Days AQI > 100",description:"Number of days with Air Quality Index exceeding 100 (unhealthy for sensitive groups)."},{id:"air_quality_status_aqi_300",label:"Days AQI > 300",description:"Number of days with Air Quality Index exceeding 300 (hazardous)."}]},resilience:{id:"air_quality_resilience",label:"Resilience",description:"Capacity to resist and recover from air quality impacts.",resistance:{id:"air_quality_resistance",label:"Resistance",description:"Ability to resist air quality degradation impacts.",metrics:[{id:"air_quality_resistance_copd",label:"COPD Prevalence",description:"Chronic obstructive pulmonary disease prevalence in the population."},{id:"air_quality_resistance_asthma",label:"Asthma Prevalence",description:"Asthma prevalence in the population."},{id:"air_quality_resistance_vulnerable_populations",label:"Vulnerable Populations",description:"Demographics of populations vulnerable to air quality impacts."},{id:"air_quality_resistance_vulnerable_workers",label:"Vulnerable Workers",description:"Employment in forestry, construction, or farmwork."},{id:"air_quality_resistance_hospital_density",label:"Medical Infrastructure",description:"Access to medical infrastructure and hospitals."}]},recovery:void 0}}],sv="data:image/svg+xml,%3csvg%20width='9'%20height='7'%20viewBox='0%200%209%207'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.560059%201.41797L4.3045%205.5027L8.04895%201.41797'%20stroke='%23C5C5C5'%20stroke-width='1.04847'%20stroke-linecap='round'/%3e%3c/svg%3e",av="data:image/svg+xml,%3csvg%20width='7'%20height='9'%20viewBox='0%200%207%209'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M1.42676%208.3125L5.50552%204.56155L1.41485%200.823597'%20stroke='%23C5C5C5'%20stroke-width='1.04847'%20stroke-linecap='round'/%3e%3c/svg%3e",Fx=i=>{const s=[],u=y=>{var C,S,d;const x=y.label;s.push({domainId:y.id,metricId:`${y.id}_domain_score`,traversedPathForSearchSuggestions:`${x} > Domain Score`,label:x,description:y.description,colorGradient:y.colorGradient}),(C=y.status)!=null&&C.metrics&&y.status.metrics.forEach(V=>{s.push({domainId:y.id,metricId:V.id,traversedPathForSearchSuggestions:`${x} > ${y.status.label} > ${V.label}`,label:V.label,description:V.description,colorGradient:y.colorGradient})}),y.resilience&&(s.push({domainId:y.id,metricId:`${y.id}_resilience`,traversedPathForSearchSuggestions:`${x} > ${y.resilience.label}`,label:`${x} Resilience`,description:y.resilience.description,colorGradient:y.colorGradient}),(S=y.resilience.resistance)!=null&&S.metrics&&(s.push({domainId:y.id,metricId:`${y.id}_resistance`,traversedPathForSearchSuggestions:`${x} > ${y.resilience.label} > ${y.resilience.resistance.label}`,label:`${x} Resistance`,description:y.resilience.resistance.description,colorGradient:y.colorGradient}),y.resilience.resistance.metrics.forEach(V=>{s.push({domainId:y.id,metricId:V.id,traversedPathForSearchSuggestions:`${x} > ${y.resilience.label} > ${y.resilience.resistance.label} > ${V.label}`,label:V.label,description:V.description,colorGradient:y.colorGradient})})),(d=y.resilience.recovery)!=null&&d.metrics&&(s.push({domainId:y.id,metricId:`${y.id}_recovery`,traversedPathForSearchSuggestions:`${x} > ${y.resilience.label} > ${y.resilience.recovery.label}`,label:`${x} Recovery`,description:y.resilience.recovery.description,colorGradient:y.colorGradient}),y.resilience.recovery.metrics.forEach(V=>{s.push({domainId:y.id,metricId:V.id,traversedPathForSearchSuggestions:`${x} > ${y.resilience.label} > ${y.resilience.recovery.label} > ${V.label}`,label:V.label,description:V.description,colorGradient:y.colorGradient})})))};return i.forEach(y=>u(y)),s};Fx(hf);const Bx="data:image/svg+xml,%3csvg%20width='228'%20height='21'%20viewBox='0%200%20228%2021'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3%2021L5.89009%2015.9942H0.109908L3%2021ZM3%201V0.499421H2.49942V1H3ZM225%201H225.501V0.499421H225V1ZM225%2021L227.89%2015.9942H222.11L225%2021ZM3.50058%2016.4948V1H2.49942V16.4948H3.50058ZM3%201.50058H225V0.499421H3V1.50058ZM224.499%201V16.4948H225.501V1H224.499Z'%20fill='%23C5C5C5'/%3e%3c/svg%3e",Nx="data:image/svg+xml,%3csvg%20width='138'%20height='21'%20viewBox='0%200%20138%2021'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M3%2021L5.89009%2015.9942H0.109908L3%2021ZM3%201V0.499421H2.49942V1H3ZM135%201H135.501V0.499421H135V1ZM135%2021L137.89%2015.9942H132.11L135%2021ZM3.50058%2016.4948V1H2.49942V16.4948H3.50058ZM3%201.50058H135V0.499421H3V1.50058ZM134.499%201V16.4948H135.501V1H134.499Z'%20fill='%23C5C5C5'/%3e%3c/svg%3e",Fm=i=>i&&i.metrics&&i.metrics.length>0,Ik=({domain:i,activeButton:s,setActiveButton:u,setSelectedIndicator:y,setSelectedMetricIdObject:x,statusLabel:C,setStatusLabel:S,resistanceLabel:d,setResistanceLabel:V,recoveryLabel:ee,setRecoveryLabel:Te,domainScores:ie,selectedMetricValue:G,regionAllMetrics:He})=>{var De,Ue,ze,Ge,re;const Ke=vd(i.id,ie),ke=Fm(i.status),ht=Fm((De=i.resilience)==null?void 0:De.resistance),pe=Fm((Ue=i.resilience)==null?void 0:Ue.recovery),oe=(ne,fe="md")=>`${fe==="sm"?"h-3.5 w-3.5 rounded-sm":"h-4 w-4 rounded-[0.2rem]"} border-[1px] transition-colors duration-200 ${s===ne?"border-black ring-2 ring-gray-700 ring-offset-1 ring-offset-white":"border-metricSelectorBoxesBorderDefault"}`,me=ne=>{if(He){const fe=He[i.id];if(fe&&ne in fe){const Me=fe[ne];if(Me!=null)return cf(i.id,Me)}}return Ke};return te.jsxs("div",{id:`layout-unified-${i.id}`,className:"ml-[0.95rem] mt-1 h-[9.5rem]",children:[te.jsx("div",{className:"ml-2 h-5 flex-shrink-0",children:te.jsx("img",{src:Bx,alt:"arrows-status-resilience",className:"ml-3 h-full w-auto"})}),te.jsxs("div",{className:"flex max-w-[390px] flex-1 justify-between",children:[te.jsxs("div",{className:"ml-[0.9rem] mr-3 flex flex-shrink-0 flex-col items-start",children:[te.jsx("div",{className:"flex items-center",children:ke?te.jsxs(te.Fragment,{children:[te.jsx("button",{id:`${i.id}-${i.status.id}`,onClick:()=>{u(`${i.id}-${i.status.id}`),y(`${i.label} ${i.status.label}`),x({domainId:i.id,metricId:i.status.id,label:i.status.label,description:i.status.description,colorGradient:i.colorGradient})},className:`mr-1 ${oe(`${i.id}-${i.status.id}`)}`,style:{backgroundColor:me(i.status.id)}}),te.jsx("span",{children:"Status"})]}):te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"mr-1 h-4 w-4 rounded-[0.2rem] border-[1px] border-gray-300",style:{backgroundColor:"#c8c8c8"},title:"Unavailable"}),te.jsx("span",{className:"text-gray-400",title:"Unavailable",children:"Status"})]})}),ke?te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"ml-[1.14rem] grid grid-cols-5 gap-x-1 gap-y-1",children:i.status.metrics.map(ne=>te.jsx("button",{id:`${i.id}-${ne.id}`,onMouseEnter:()=>S(ne.label),onMouseLeave:()=>S(null),onClick:()=>{u(`${i.id}-${ne.id}`),x({domainId:i.id,metricId:ne.id,label:`${i.label} ${ne.label}`,description:ne.description,colorGradient:i.colorGradient}),y(`${i.label} ${ne.label}`)},className:oe(`${i.id}-${ne.id}`,"sm"),style:{backgroundColor:me(ne.id)}},`${i.id}-${ne.id}`))}),te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8 max-w-[6rem] font-BeVietnamPro text-xs text-selectedMetricTextLabel",children:C||""})]}):te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8 max-w-[6rem]",children:""})]}),te.jsxs("div",{className:"ml-2 flex w-[60%] flex-shrink-0 flex-col items-center",children:[te.jsxs("div",{className:"ml-[4.4rem] flex items-center self-start",children:[te.jsx("button",{id:`${i.id}-${((ze=i.resilience)==null?void 0:ze.id)||"resilience"}`,onClick:()=>{i.resilience&&(u(`${i.id}-${i.resilience.id}`),y(`${i.label} ${i.resilience.label}`),x({domainId:i.id,metricId:i.resilience.id,label:i.resilience.label,description:i.resilience.description,colorGradient:i.colorGradient}))},className:`mr-1 ${oe(`${i.id}-${(Ge=i.resilience)==null?void 0:Ge.id}`)}`,style:{backgroundColor:me(((re=i.resilience)==null?void 0:re.id)||"")}}),te.jsx("span",{children:"Resilience"})]}),te.jsx("div",{className:"ml-[0.6rem] h-5 flex-shrink-0 self-start",children:te.jsx("img",{src:Nx,alt:"arrows-resistance-recovery",className:"h-full w-auto"})}),te.jsxs("div",{className:"flex w-full flex-row justify-between",children:[te.jsxs("div",{className:"ml-1 flex w-[45%] flex-shrink-0 flex-col items-start",children:[te.jsx("div",{className:"flex items-center",children:ht?te.jsxs(te.Fragment,{children:[te.jsx("button",{id:`${i.id}-${i.resilience.resistance.id}`,onClick:()=>{u(`${i.id}-${i.resilience.resistance.id}`),y(`${i.label} ${i.resilience.resistance.label}`),x({domainId:i.id,metricId:i.resilience.resistance.id,label:i.resilience.resistance.label,description:i.resilience.resistance.description,colorGradient:i.colorGradient})},className:`mr-1 ${oe(`${i.id}-${i.resilience.resistance.id}`)}`,style:{backgroundColor:me(i.resilience.resistance.id)}}),te.jsx("span",{children:"Resistance"})]}):te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"mr-1 h-4 w-4 rounded-[0.2rem] border-[1px] border-gray-300",style:{backgroundColor:"#c8c8c8"},title:"Unavailable"}),te.jsx("span",{className:"text-gray-400",title:"Unavailable",children:"Resistance"})]})}),ht?te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"ml-[1.14rem] grid grid-cols-5 gap-x-1 gap-y-1",children:i.resilience.resistance.metrics.map(ne=>te.jsx("button",{id:`${i.id}-${ne.id}`,onMouseEnter:()=>V(ne.label),onMouseLeave:()=>V(null),onClick:()=>{u(`${i.id}-${ne.id}`),x({domainId:i.id,metricId:ne.id,label:`${i.label} ${ne.label}`,description:ne.description,colorGradient:i.colorGradient}),y(`${i.label} ${ne.label}`)},className:oe(`${i.id}-${ne.id}`,"sm"),style:{backgroundColor:me(ne.id)}},`${i.id}-${ne.id}`))}),te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8 font-BeVietnamPro text-xs text-selectedMetricTextLabel",children:d||""})]}):te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8",children:""})]}),te.jsxs("div",{className:"ml-[1.3rem] flex min-w-[50%] flex-col items-start",children:[te.jsx("div",{className:"flex items-center",children:pe?te.jsxs(te.Fragment,{children:[te.jsx("button",{id:`${i.id}-${i.resilience.recovery.id}`,onClick:()=>{u(`${i.id}-${i.resilience.recovery.id}`),y(`${i.label} ${i.resilience.recovery.label}`),x({domainId:i.id,metricId:i.resilience.recovery.id,label:i.resilience.recovery.label,description:i.resilience.recovery.description,colorGradient:i.colorGradient})},className:`mr-1 ${oe(`${i.id}-${i.resilience.recovery.id}`)}`,style:{backgroundColor:me(i.resilience.recovery.id)}}),te.jsx("span",{children:"Recovery"})]}):te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"mr-1 h-4 w-4 rounded-[0.2rem] border-[1px] border-gray-300",style:{backgroundColor:"#c8c8c8"},title:"Unavailable"}),te.jsx("span",{className:"text-gray-400",title:"Unavailable",children:"Recovery"})]})}),pe?te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"ml-[1.14rem] grid grid-cols-5 gap-x-1 gap-y-1",children:i.resilience.recovery.metrics.map(ne=>te.jsx("button",{id:`${i.id}-${ne.id}`,onMouseEnter:()=>Te(ne.label),onMouseLeave:()=>Te(null),onClick:()=>{u(`${i.id}-${ne.id}`),x({domainId:i.id,metricId:ne.id,label:`${i.label} ${ne.label}`,description:ne.description,colorGradient:i.colorGradient}),y(`${i.label} ${ne.label}`)},className:oe(`${i.id}-${ne.id}`,"sm"),style:{backgroundColor:me(ne.id)}},`${i.id}-${ne.id}`))}),te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8 font-BeVietnamPro text-xs text-selectedMetricTextLabel",children:ee||""})]}):te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8",children:""})]})]})]})]})]})},Bm=i=>i&&i.metrics&&i.metrics.length>0,Ek=({subdomain:i,parentDomainId:s,colorGradient:u,activeButton:y,setActiveButton:x,setSelectedIndicator:C,setSelectedMetricIdObject:S,statusLabel:d,setStatusLabel:V,resistanceLabel:ee,setResistanceLabel:Te,recoveryLabel:ie,setRecoveryLabel:G,domainScores:He,selectedMetricValue:Ke,regionAllMetrics:ke})=>{var Ge,re,ne,fe,Me;const ht=vd(s,He),pe=Bm(i.status),oe=Bm((Ge=i.resilience)==null?void 0:Ge.resistance),me=Bm((re=i.resilience)==null?void 0:re.recovery),De=Oe=>`${s}-${i.id}-${Oe}`,Ue=(Oe,tt="md")=>`${tt==="sm"?"h-3.5 w-3.5 rounded-sm":"h-4 w-4 rounded-[0.2rem]"} border-[1px] transition-colors duration-200 ${y===Oe?"border-black ring-2 ring-gray-700 ring-offset-1 ring-offset-white":"border-metricSelectorBoxesBorderDefault"}`,ze=Oe=>{if(ke){const tt=ke[s];if(tt&&Oe in tt){const dt=tt[Oe];if(dt!=null)return cf(s,dt)}}return ht};return te.jsxs("div",{id:`layout-compact-${i.id}`,className:"mt-1 h-[9rem]",children:[te.jsx("div",{className:"ml-2 h-5 flex-shrink-0",children:te.jsx("img",{src:Bx,alt:"arrows-status-resilience",className:"ml-3 h-full w-auto"})}),te.jsxs("div",{className:"flex max-w-[370px] flex-1 justify-between",children:[te.jsxs("div",{className:"ml-[0.9rem] mr-3 flex flex-shrink-0 flex-col items-start",children:[te.jsx("div",{className:"flex items-center",children:pe?te.jsxs(te.Fragment,{children:[te.jsx("button",{id:De(i.status.id),onClick:()=>{x(De(i.status.id)),C(`${i.label} ${i.status.label}`),S({domainId:s,metricId:i.status.id,label:i.status.label,description:i.status.description,colorGradient:u})},className:`mr-1 ${Ue(De(i.status.id))}`,style:{backgroundColor:ze(i.status.id)}}),te.jsx("span",{children:"Status"})]}):te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"mr-1 h-4 w-4 rounded-[0.2rem] border-[1px] border-gray-300",style:{backgroundColor:"#c8c8c8"},title:"Unavailable"}),te.jsx("span",{className:"text-gray-400",title:"Unavailable",children:"Status"})]})}),pe?te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"ml-[1.14rem] grid grid-cols-5 gap-x-1 gap-y-1",children:i.status.metrics.map(Oe=>te.jsx("button",{id:De(Oe.id),onMouseEnter:()=>V(Oe.label),onMouseLeave:()=>V(null),onClick:()=>{x(De(Oe.id)),S({domainId:s,metricId:Oe.id,label:`${i.label} ${Oe.label}`,description:Oe.description,colorGradient:u}),C(`${i.label} ${Oe.label}`)},className:Ue(De(Oe.id),"sm"),style:{backgroundColor:ze(Oe.id)}},De(Oe.id)))}),te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8 max-w-[6rem] font-BeVietnamPro text-xs text-selectedMetricTextLabel",children:d||""})]}):te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8 max-w-[6rem]",children:""})]}),te.jsxs("div",{className:"ml-2 flex w-[60%] flex-shrink-0 flex-col items-center",children:[te.jsxs("div",{className:"ml-[4.4rem] flex items-center self-start",children:[te.jsx("button",{id:De(((ne=i.resilience)==null?void 0:ne.id)||"resilience"),onClick:()=>{i.resilience&&(x(De(i.resilience.id)),C(`${i.label} ${i.resilience.label}`),S({domainId:s,metricId:i.resilience.id,label:i.resilience.label,description:i.resilience.description,colorGradient:u}))},className:`mr-1 ${Ue(De(((fe=i.resilience)==null?void 0:fe.id)||""))}`,style:{backgroundColor:ze(((Me=i.resilience)==null?void 0:Me.id)||"")}}),te.jsx("span",{children:"Resilience"})]}),te.jsx("div",{className:"ml-[0.6rem] h-5 flex-shrink-0 self-start",children:te.jsx("img",{src:Nx,alt:"arrows-resistance-recovery",className:"h-full w-auto"})}),te.jsxs("div",{className:"flex w-full flex-row justify-between",children:[te.jsxs("div",{className:"ml-1 flex w-[45%] flex-shrink-0 flex-col items-start",children:[te.jsx("div",{className:"flex items-center",children:oe?te.jsxs(te.Fragment,{children:[te.jsx("button",{id:De(i.resilience.resistance.id),onClick:()=>{x(De(i.resilience.resistance.id)),C(`${i.label} ${i.resilience.resistance.label}`),S({domainId:s,metricId:i.resilience.resistance.id,label:i.resilience.resistance.label,description:i.resilience.resistance.description,colorGradient:u})},className:`mr-1 ${Ue(De(i.resilience.resistance.id))}`,style:{backgroundColor:ze(i.resilience.resistance.id)}}),te.jsx("span",{children:"Resistance"})]}):te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"mr-1 h-4 w-4 rounded-[0.2rem] border-[1px] border-gray-300",style:{backgroundColor:"#c8c8c8"},title:"Unavailable"}),te.jsx("span",{className:"text-gray-400",title:"Unavailable",children:"Resistance"})]})}),oe?te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"ml-[1.14rem] grid grid-cols-5 gap-x-1 gap-y-1",children:i.resilience.resistance.metrics.map(Oe=>te.jsx("button",{id:De(Oe.id),onMouseEnter:()=>Te(Oe.label),onMouseLeave:()=>Te(null),onClick:()=>{x(De(Oe.id)),S({domainId:s,metricId:Oe.id,label:`${i.label} ${Oe.label}`,description:Oe.description,colorGradient:u}),C(`${i.label} ${Oe.label}`)},className:Ue(De(Oe.id),"sm"),style:{backgroundColor:ze(Oe.id)}},De(Oe.id)))}),te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8 font-BeVietnamPro text-xs text-selectedMetricTextLabel",children:ee||""})]}):te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8",children:""})]}),te.jsxs("div",{className:"ml-[1.3rem] flex min-w-[50%] flex-col items-start",children:[te.jsx("div",{className:"flex items-center",children:me?te.jsxs(te.Fragment,{children:[te.jsx("button",{id:De(i.resilience.recovery.id),onClick:()=>{x(De(i.resilience.recovery.id)),C(`${i.label} ${i.resilience.recovery.label}`),S({domainId:s,metricId:i.resilience.recovery.id,label:i.resilience.recovery.label,description:i.resilience.recovery.description,colorGradient:u})},className:`mr-1 ${Ue(De(i.resilience.recovery.id))}`,style:{backgroundColor:ze(i.resilience.recovery.id)}}),te.jsx("span",{children:"Recovery"})]}):te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"mr-1 h-4 w-4 rounded-[0.2rem] border-[1px] border-gray-300",style:{backgroundColor:"#c8c8c8"},title:"Unavailable"}),te.jsx("span",{className:"text-gray-400",title:"Unavailable",children:"Recovery"})]})}),me?te.jsxs(te.Fragment,{children:[te.jsx("div",{className:"ml-[1.14rem] grid grid-cols-5 gap-x-1 gap-y-1",children:i.resilience.recovery.metrics.map(Oe=>te.jsx("button",{id:De(Oe.id),onMouseEnter:()=>G(Oe.label),onMouseLeave:()=>G(null),onClick:()=>{x(De(Oe.id)),S({domainId:s,metricId:Oe.id,label:`${i.label} ${Oe.label}`,description:Oe.description,colorGradient:u}),C(`${i.label} ${Oe.label}`)},className:Ue(De(Oe.id),"sm"),style:{backgroundColor:ze(Oe.id)}},De(Oe.id)))}),te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8 font-BeVietnamPro text-xs text-selectedMetricTextLabel",children:ie||""})]}):te.jsx("span",{className:"ml-[1.125rem] mt-1 block h-8",children:""})]})]})]})]})]})},Pk=(i,s)=>{if(!s.trim())return i;const u=s.trim().split(/\s+/).filter(Boolean),y=u.map(S=>S.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),x=new RegExp(`(${y.join("|")})`,"gi");return i.split(x).map((S,d)=>u.some(V=>S.toLowerCase()===V.toLowerCase())?te.jsx("strong",{children:S},d):S)},Ak=({selectedMetricIdObject:i,setSelectedMetricIdObject:s,domainScores:u,selectedMetricValue:y,regionAllMetrics:x})=>{var ne;const[C,S]=Ot.useState(!1),[d,V]=Ot.useState("infrastructure"),[ee,Te]=Ot.useState(null),[ie,G]=Ot.useState(null),[He,Ke]=Ot.useState(null),[ke,ht]=Ot.useState("Air Quality Score"),[pe,oe]=Ot.useState({}),[me,De]=Ot.useState(""),[Ue,ze]=Ot.useState([]),Ge=Fx(hf);Ot.useEffect(()=>{if(me.trim()){const fe=me.toLowerCase().trim().split(/\s+/).filter(Boolean),Me=Ge.filter(Oe=>{const tt=Oe.traversedPathForSearchSuggestions.toLowerCase();return fe.every(dt=>tt.includes(dt))});ze(Me)}else ze([])},[me]);const re=fe=>{oe(Me=>{const Oe=fe.includes("-")&&fe.split("-").length>1,tt={};for(const dt in Me)if(Oe){const dr=fe.split("-")[0],Jt=dt===dr,pt=dt.startsWith(dr+"-")&&dt!==fe;Jt?tt[dt]=!0:pt?tt[dt]=!1:dt===fe?tt[dt]=!Me[dt]:tt[dt]=Me[dt]}else tt[dt]=dt===fe?!Me[dt]:!1;return fe in Me||(tt[fe]=!0),tt})};return te.jsxs("div",{id:"right-sidebar",className:"h-[calc(100vh-60px)] min-w-[470px] max-w-[470px] overflow-scroll border-l-[1px] border-t-[1px] border-solid border-rightSidebarBorder px-4 pb-2 pt-[0.8rem]",children:[te.jsx("h1",{id:"indicator-navigation-header",className:"mb-1 font-BeVietnamPro text-xl font-medium",children:"Indicator Navigation"}),te.jsxs("div",{id:"indicator-search-box",className:`relative mb-2 flex w-full flex-row border-[1px] border-rightSidebarSearchBoxGray px-2 py-1 ${C?"rounded-t-lg":"rounded-lg rounded-b-lg"}`,children:[te.jsx("img",{src:Rx,alt:""}),te.jsx("input",{type:"text",placeholder:"Search or select a topic to update the map...",className:"ml-2 w-full border-none bg-transparent text-rightSidebarSearchBoxGray outline-none",value:me,onChange:fe=>De(fe.target.value),onInput:fe=>S(fe.target.value!==""),onFocus:fe=>{fe.target.value&&S(!0)},onBlur:()=>S(!1)}),C&&te.jsx("div",{id:"indicator-search-suggestions",className:"absolute left-[-1px] top-[2rem] z-20 max-h-48 min-h-[10rem] w-[calc(100%+2px)] overflow-y-auto rounded-b-lg border-b border-l border-r border-t border-rightSidebarSearchBoxGray border-t-gray-200 bg-white",children:Ue.map((fe,Me)=>te.jsx("div",{className:"cursor-pointer py-1 pl-9 hover:bg-gray-200",onMouseDown:()=>{V(`${fe.domainId}-${fe.metricId}`),re(fe.domainId),ht(fe.label),s({domainId:fe.domainId,metricId:fe.metricId,label:fe.label,description:fe.description,colorGradient:fe.colorGradient}),De(""),S(!1)},children:te.jsx("span",{className:"font-be-vietnam-pro text-base text-rightSidebarSearchBoxGray",children:Pk(fe.traversedPathForSearchSuggestions,me)})},Me))})]}),te.jsxs("div",{id:"domain-list",className:"relative mb-1 ml-[0.35rem]",children:[te.jsxs("div",{className:"flex items-center",children:[te.jsx("button",{id:"overall_resilience-btn",onClick:()=>{V("wwri_final_score"),ht("Overall Resilience"),s({domainId:"wwri",metricId:"wwri_final_score",label:"Overall Resilience",description:"Overall wildfire resilience score combining all domains.",colorGradient:{startColor:Ex,endColor:Px}})},className:`mr-2 h-[20px] w-[20px] justify-self-start rounded-[0.2rem] border-[1px] transition-colors duration-200 ${d==="wwri_final_score"?"border-black ring-2 ring-gray-700 ring-offset-1 ring-offset-white":"border-metricSelectorBoxesBorderDefault"}`,style:{backgroundColor:rv((ne=x==null?void 0:x.wwri)==null?void 0:ne.wwri_final_score)}}),te.jsx("span",{className:"font-bold",children:"Overall Resilience"})]}),hf.map(fe=>te.jsxs("div",{id:fe.id,className:"ml-[calc(2.05rem-0.35rem)] mt-1",children:[te.jsxs("div",{className:"flex w-[39%] text-sm items-center justify-between",children:[te.jsxs("div",{className:"flex items-center",children:[te.jsx("button",{id:`${fe.id}-btn`,onClick:()=>{V(fe.id),ht(fe.label),s({domainId:fe.id,metricId:`${fe.id}_domain_score`,label:fe.label,description:fe.description,colorGradient:fe.colorGradient})},className:`mr-2 h-[20px] w-[20px] justify-self-start rounded-[0.2rem] border-[1px] transition-colors duration-200 ${d===fe.id?"border-black ring-2 ring-gray-700 ring-offset-1 ring-offset-white":"border-metricSelectorBoxesBorderDefault"}`,style:{backgroundColor:vd(fe.id,u)}}),te.jsx("span",{className:"font-bold",children:fe.label})]}),te.jsx("button",{onClick:()=>re(fe.id),className:"ml-2 text-[lightgray]",children:pe[fe.id]?te.jsx("img",{src:sv,alt:"down-arrow",className:"min-h-3 min-w-3"}):te.jsx("img",{src:av,alt:"right-side-arrow",className:"min-h-3 min-w-3"})})]}),te.jsx("div",{className:`grid transition-[grid-template-rows] duration-300 ease-in-out ${pe[fe.id]?"grid-rows-[1fr]":"grid-rows-[0fr]"}`,children:te.jsx("div",{className:"overflow-hidden",children:fe.subdomains?te.jsx("div",{id:`subdomains-${fe.id}`,className:"ml-[1.7rem] mt-1",children:fe.subdomains.map(Me=>te.jsxs("div",{id:`subdomain-${Me.id}`,children:[te.jsxs("div",{className:"flex w-[50%] items-center justify-between text-sm",children:[te.jsxs("div",{className:"flex items-center",children:[te.jsx("button",{id:`${fe.id}-${Me.id}-btn`,onClick:()=>{V(`${fe.id}-${Me.id}`),ht(Me.label),s({domainId:fe.id,metricId:`${fe.id}_${Me.id}_domain_score`,label:Me.label,description:Me.description,colorGradient:fe.colorGradient})},className:`mr-2 h-[18px] w-[18px] rounded-[0.2rem] border-[1px] transition-colors duration-200 ${d===`${fe.id}-${Me.id}`?"border-black ring-2 ring-gray-700 ring-offset-1 ring-offset-white":"border-metricSelectorBoxesBorderDefault"}`,style:{backgroundColor:vd(fe.id,u)}}),te.jsx("span",{className:"font-semibold",children:Me.label})]}),te.jsx("button",{onClick:()=>re(`${fe.id}-${Me.id}`),className:"ml-2 text-[lightgray]",children:pe[`${fe.id}-${Me.id}`]?te.jsx("img",{src:sv,alt:"down-arrow",className:"min-h-3 min-w-3"}):te.jsx("img",{src:av,alt:"right-side-arrow",className:"min-h-3 min-w-3"})})]}),te.jsx("div",{className:`grid transition-[grid-template-rows] duration-300 ease-in-out ${pe[`${fe.id}-${Me.id}`]?"grid-rows-[1fr]":"grid-rows-[0fr]"}`,children:te.jsx("div",{className:"overflow-hidden",children:te.jsx(Ek,{subdomain:Me,parentDomainId:fe.id,colorGradient:fe.colorGradient,activeButton:d,setActiveButton:V,setSelectedIndicator:ht,setSelectedMetricIdObject:s,statusLabel:ee,setStatusLabel:Te,resistanceLabel:ie,setResistanceLabel:G,recoveryLabel:He,setRecoveryLabel:Ke,domainScores:u,selectedMetricValue:y,regionAllMetrics:x})})})]},Me.id))}):te.jsx(Ik,{domain:fe,activeButton:d,setActiveButton:V,setSelectedIndicator:ht,setSelectedMetricIdObject:s,statusLabel:ee,setStatusLabel:Te,resistanceLabel:ie,setResistanceLabel:G,recoveryLabel:He,setRecoveryLabel:Ke,domainScores:u,selectedMetricValue:y,regionAllMetrics:x})})})]},fe.id))]}),te.jsxs("div",{id:"selected-indicator-right-sidebar",className:"relative -ml-4 -mr-4 mt-3 flex w-[calc(100%+2rem)] flex-col bg-subheaderBackground p-2",children:[te.jsx("h1",{className:"ml-2 text-sm font-bold text-selectedIndicatorTextColor",children:"SELECTED INDICATOR"}),te.jsxs("div",{id:"box-holder",className:"ml-2 flex flex-row items-center",children:[te.jsx("div",{id:"selected-indicator-box",className:"flex h-5 w-5 items-center justify-center rounded-[0.2rem] border-[1px] border-black",style:{backgroundColor:(()=>{var fe;if(!i)return"rgb(200, 200, 200)";if(i.domainId==="wwri"){const Me=(fe=x==null?void 0:x.wwri)==null?void 0:fe.wwri_final_score;return rv(Me)}if(x){const Me=x[i.domainId];if(Me&&i.metricId in Me){const Oe=Me[i.metricId];if(Oe!=null)return cf(i.domainId,Oe)}}return y!==null?cf(i.domainId,y):vd(i.domainId,u)})()}}),te.jsx("span",{className:"ml-2 font-BeVietnamPro font-semibold",children:i?i.label:"Select an indicator"})]})]}),!1]})};function Mk(i,s){var x,C,S,d,V,ee,Te;if(i==="wwri_final_score"||s==="wwri")return[{id:"wwri_final_score",label:"Overall Resilience",isCurrent:!0}];const u=hf.find(ie=>ie.id===s);if(!u)return[{id:i,label:i,isCurrent:!0}];const y=[{id:u.id,label:u.label,isCurrent:!1}];if(i===`${s}_domain_score`)return y[0].isCurrent=!0,y;if(u.subdomains)for(const ie of u.subdomains){const G=zk(ie,i);if(G)return y.push({id:ie.id,label:ie.label,isCurrent:!1}),y.push(...G),y[y.length-1].isCurrent=!0,y}if(u.status&&i===u.status.id)return y.push({id:u.status.id,label:"Status",isCurrent:!0}),y;if((x=u.status)!=null&&x.metrics){const ie=u.status.metrics.find(G=>G.id===i);if(ie)return y.push({id:u.status.id,label:"Status",isCurrent:!1}),y.push({id:ie.id,label:ie.label,isCurrent:!0}),y}if(u.resilience&&i===u.resilience.id)return y.push({id:u.resilience.id,label:"Resilience",isCurrent:!0}),y;if((C=u.resilience)!=null&&C.resistance&&i===u.resilience.resistance.id)return y.push({id:u.resilience.id,label:"Resilience",isCurrent:!1}),y.push({id:u.resilience.resistance.id,label:"Resistance",isCurrent:!0}),y;if((S=u.resilience)!=null&&S.recovery&&i===u.resilience.recovery.id)return y.push({id:u.resilience.id,label:"Resilience",isCurrent:!1}),y.push({id:u.resilience.recovery.id,label:"Recovery",isCurrent:!0}),y;if((V=(d=u.resilience)==null?void 0:d.resistance)!=null&&V.metrics){const ie=u.resilience.resistance.metrics.find(G=>G.id===i);if(ie)return y.push({id:u.resilience.id,label:"Resilience",isCurrent:!1}),y.push({id:u.resilience.resistance.id,label:"Resistance",isCurrent:!1}),y.push({id:ie.id,label:ie.label,isCurrent:!0}),y}if((Te=(ee=u.resilience)==null?void 0:ee.recovery)!=null&&Te.metrics){const ie=u.resilience.recovery.metrics.find(G=>G.id===i);if(ie)return y.push({id:u.resilience.id,label:"Resilience",isCurrent:!1}),y.push({id:u.resilience.recovery.id,label:"Recovery",isCurrent:!1}),y.push({id:ie.id,label:ie.label,isCurrent:!0}),y}return y[0].isCurrent=!0,y}function zk(i,s){var u,y,x,C,S,d,V;if(i.status&&s===i.status.id)return[{id:i.status.id,label:"Status",isCurrent:!1}];if((u=i.status)!=null&&u.metrics){const ee=i.status.metrics.find(Te=>Te.id===s);if(ee)return[{id:i.status.id,label:"Status",isCurrent:!1},{id:ee.id,label:ee.label,isCurrent:!1}]}if(i.resilience&&s===i.resilience.id)return[{id:i.resilience.id,label:"Resilience",isCurrent:!1}];if((y=i.resilience)!=null&&y.resistance&&s===i.resilience.resistance.id)return[{id:i.resilience.id,label:"Resilience",isCurrent:!1},{id:i.resilience.resistance.id,label:"Resistance",isCurrent:!1}];if((x=i.resilience)!=null&&x.recovery&&s===i.resilience.recovery.id)return[{id:i.resilience.id,label:"Resilience",isCurrent:!1},{id:i.resilience.recovery.id,label:"Recovery",isCurrent:!1}];if((S=(C=i.resilience)==null?void 0:C.resistance)!=null&&S.metrics){const ee=i.resilience.resistance.metrics.find(Te=>Te.id===s);if(ee)return[{id:i.resilience.id,label:"Resilience",isCurrent:!1},{id:i.resilience.resistance.id,label:"Resistance",isCurrent:!1},{id:ee.id,label:ee.label,isCurrent:!1}]}if((V=(d=i.resilience)==null?void 0:d.recovery)!=null&&V.metrics){const ee=i.resilience.recovery.metrics.find(Te=>Te.id===s);if(ee)return[{id:i.resilience.id,label:"Resilience",isCurrent:!1},{id:i.resilience.recovery.id,label:"Recovery",isCurrent:!1},{id:ee.id,label:ee.label,isCurrent:!1}]}return null}function Dk({items:i}){return te.jsx("nav",{id:"metric-breadcrumb-pathway",className:"flex items-center gap-1.5 text-base",children:i.map((s,u)=>te.jsxs("span",{className:"flex items-center gap-1.5",children:[u>0&&te.jsx("span",{className:"text-gray-300 select-none",children:""}),te.jsx("span",{className:s.isCurrent?"font-semibold text-gray-800":"text-gray-400",children:s.label})]},s.id))})}const Lk=({selectedMetricObject:i})=>{const s="Overall Resilience",u="The overall resilience score to wildfires. This score is calculated from the resilience scores of each domain (e.g. Water, Air, etc.).",y=Mk(i.metricId,i.domainId);return te.jsxs("div",{id:"sub-header",className:"relative flex min-h-[80px] w-full items-center border-b border-t border-solid border-subheaderBorder bg-subheaderBackground px-5",children:[te.jsxs("div",{className:"flex flex-1 flex-col pr-4",children:[te.jsx("h1",{className:"font-BeVietnamPro text-2xl font-bold",children:i.label||s}),te.jsx("h3",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap font-BeVietnamPro text-base text-gray-600",children:i.description||u})]}),te.jsx("div",{id:"subheader-breadcrumb-container",className:"flex-shrink-0",children:te.jsx(Dk,{items:y})})]})};function ov(i){const s=i.trim().split(`
`);if(s.length<2)return{};const u=s[0].split(",");return s.slice(1).reduce((y,x)=>{const C=x.split(","),S=C[0];if(!S)return y;const d=u.reduce((V,ee,Te)=>(ee!=="geoid"&&(V[ee]=parseFloat(C[Te])),V),{});return y[S]=d,y},{})}function Rk(){const[i,s]=Ot.useState({domainId:"infrastructure",metricId:"infrastructure_domain_score",label:"Infrastructure",description:"Built infrastructure resilience to wildfire damage.",colorGradient:{startColor:{r:255,g:255,b:255},endColor:{r:171,g:16,b:78}}}),[u,y]=Ot.useState(null),[x,C]=Ot.useState(""),[S,d]=Ot.useState(""),[V,ee]=Ot.useState(""),[Te,ie]=Ot.useState(""),[G,He]=Ot.useState("tract"),[Ke,ke]=Ot.useState(!0),[ht,pe]=Ot.useState({}),[oe,me]=Ot.useState(null);Ot.useEffect(()=>{(async()=>{try{const ze=Ol[G],[Ge,re]=await Promise.all([fetch(tv(ze.us.apiCountry,ze.us.apiGeoLevel)),fetch(tv(ze.canada.apiCountry,ze.canada.apiGeoLevel))]),[ne,fe]=await Promise.all([Ge.text(),re.text()]),Me=ov(ne),Oe=ov(fe),tt={...Me,...Oe};console.log(`[${G}] Loaded summary data: US=${Object.keys(Me).length}, Canada=${Object.keys(Oe).length}`),pe(tt)}catch(ze){console.error("Error fetching summary data:",ze)}})()},[G]);const De=x&&ht[x]||null;return Ot.useEffect(()=>{if(!x||!Te){me(null);return}(async()=>{try{const ze=Ol[G],Ge=Te==="canada"?ze.canada.apiGeoLevel:ze.us.apiGeoLevel,re=XS(x,Te,Ge),ne=await fetch(re);if(!ne.ok){console.warn(`Failed to fetch region metrics for ${x}`),me(null);return}const fe=await ne.json();me(fe.metrics||null)}catch(ze){console.error("Error fetching region metrics:",ze),me(null)}})()},[x,Te,G]),te.jsxs("div",{className:"h-full w-full",children:[te.jsx(JS,{}),te.jsxs("div",{id:"body",className:"flex flex-1",children:[te.jsxs("div",{id:"body-minus-right-sidebar",className:"flex min-w-[580px] flex-1 flex-col",children:[te.jsx(Lk,{selectedMetricObject:i}),te.jsx(fk,{selectedGeoId:x,selectedRegionName:S,selectedStateName:V,selectedCountry:Te,selectedGeoLevel:G,selectedMetricValue:u,isOpen:Ke,setIsOpen:ke,domainScores:De,regionAllMetrics:oe}),te.jsx(Ck,{selectedMetricIdObject:i,selectedGeoId:x,setSelectedRegionName:d,setSelectedStateName:ee,setSelectedGeoId:C,setSelectedCountry:ie,setSelectedMetricValue:y,selectedGeoLevel:G,setSelectedGeoLevel:He,leftSidebarOpen:Ke})]}),te.jsx(Ak,{selectedMetricIdObject:i,setSelectedMetricIdObject:s,domainScores:De,selectedMetricValue:u,regionAllMetrics:oe})]})]})}const Fk=document.getElementById("root"),Bk=bx(Fk);Bk.render(te.jsx(Rk,{}));
